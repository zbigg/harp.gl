!function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=116)}([function(e,t){e.exports=THREE},function(e,t,i){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i(130)),r(i(131)),r(i(135)),r(i(136)),r(i(137)),r(i(138)),r(i(139)),r(i(140)),r(i(141)),r(i(142)),r(i(143)),r(i(42)),r(i(144)),r(i(145))},function(e,t,i){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i(19)),r(i(5)),r(i(44)),r(i(74)),r(i(32)),r(i(20)),r(i(31)),r(i(173)),r(i(174)),r(i(175)),r(i(76)),r(i(176)),r(i(179)),r(i(73))},function(e,t,i){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i(15)),r(i(58)),r(i(7)),r(i(59)),r(i(60)),r(i(10)),r(i(61)),r(i(118)),r(i(13)),r(i(27)),r(i(62)),r(i(119)),r(i(63)),r(i(64)),r(i(28)),r(i(120)),r(i(65)),r(i(29)),r(i(66)),r(i(67)),r(i(16)),r(i(121)),r(i(122)),r(i(123)),r(i(124)),r(i(125)),r(i(11)),r(i(12)),r(i(8)),r(i(126)),r(i(127))},function(e,t,i){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i(128)),r(i(68)),r(i(129)),r(i(148)),r(i(149)),r(i(150)),r(i(151)),r(i(40)),r(i(152)),r(i(153)),r(i(154)),r(i(18)),r(i(155))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(156),n=i(171),s=i(172),o=i(20),a=i(31),l=i(32);!function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i(72));const c=new r.ExprEvaluator,h=new n.ExprInstantiator;class d{constructor(){this.properties=new Set}}t.ExprDependencies=d;class u{static of(e){const t=new d;return e.accept(this.instance,t),t}visitNullLiteralExpr(e,t){}visitBooleanLiteralExpr(e,t){}visitNumberLiteralExpr(e,t){}visitStringLiteralExpr(e,t){}visitObjectLiteralExpr(e,t){}visitVarExpr(e,t){t.properties.add(e.name)}visitHasAttributeExpr(e,t){t.properties.add(e.name)}visitContainsExpr(e,t){e.value.accept(this,t)}visitCallExpr(e,t){"zoom"===e.op&&0===e.args.length?t.zoom=!0:e.args.forEach(e=>e.accept(this,t))}visitMatchExpr(e,t){e.value.accept(this,t),e.branches.forEach(([e,i])=>i.accept(this,t)),e.fallback.accept(this,t)}visitCaseExpr(e,t){e.branches.forEach(([e,i])=>{e.accept(this,t),i.accept(this,t)}),e.fallback.accept(this,t)}}function m(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]}var p;u.instance=new u,t.isJsonExpr=m,function(e){e[e.Value=0]="Value",e[e.Condition=1]="Condition",e[e.Dynamic=2]="Dynamic"}(p=t.ExprScope||(t.ExprScope={}));class f{static isExpr(e){return e instanceof f}static parse(e){return new s.ExprParser(e).parse()}static fromJSON(e,t,i){return A(e,void 0!==t?{definitions:t,lockedNames:new Set,cache:i||new Map}:void 0)}evaluate(e,t=p.Value,i){return this.accept(c,new r.ExprEvaluatorContext(c,e,t,i))}instantiate(e){return this.accept(h,e)}dependencies(){return u.of(this)}intern(e){return e.add(this)}toJSON(){return(new C).serialize(this)}isDynamic(){return void 0===this.m_isDynamic&&(this.m_isDynamic=this.exprIsDynamic()),this.m_isDynamic}}t.Expr=f;class g extends f{constructor(e){super(),this.name=e}accept(e,t){return e.visitVarExpr(this,t)}exprIsDynamic(){return!1}}t.VarExpr=g;class v extends f{static fromValue(e){switch(typeof e){case"boolean":return new _(e);case"number":return new x(e);case"string":return new T(e);case"object":return null===e?y.instance:new S(e);default:throw new Error(`failed to create a literal from '${e}'`)}}exprIsDynamic(){return!1}}t.LiteralExpr=v;class y extends v{constructor(){super(),this.value=null}accept(e,t){return e.visitNullLiteralExpr(this,t)}exprIsDynamic(){return!1}}t.NullLiteralExpr=y,y.instance=new y;class _ extends v{constructor(e){super(),this.value=e}accept(e,t){return e.visitBooleanLiteralExpr(this,t)}}t.BooleanLiteralExpr=_;class x extends v{constructor(e){super(),this.value=e}accept(e,t){return e.visitNumberLiteralExpr(this,t)}}t.NumberLiteralExpr=x;class T extends v{constructor(e){super(),this.value=e}accept(e,t){return e.visitStringLiteralExpr(this,t)}}t.StringLiteralExpr=T;class S extends v{constructor(e){super(),this.value=e}get isArrayLiteral(){return Array.isArray(this.value)}accept(e,t){return e.visitObjectLiteralExpr(this,t)}}t.ObjectLiteralExpr=S;class w extends f{constructor(e){super(),this.name=e}accept(e,t){return e.visitHasAttributeExpr(this,t)}exprIsDynamic(){return!1}}t.HasAttributeExpr=w;class b extends f{constructor(e,t){super(),this.value=e,this.elements=t}static isValidElementsArray(e){if(!Array.isArray(e)||0===e.length)return!1;const t=typeof e[0];return("number"===t||"string"===t)&&e.every(e=>typeof e===t)}accept(e,t){return e.visitContainsExpr(this,t)}exprIsDynamic(){return this.value.isDynamic()}}t.ContainsExpr=b;class M extends f{constructor(e,t){super(),this.op=e,this.args=t}get children(){return this.args}accept(e,t){return e.visitCallExpr(this,t)}exprIsDynamic(){const e=this.descriptor||r.ExprEvaluator.getOperator(this.op);return!!(e&&e.isDynamicOperator&&e.isDynamicOperator(this))||this.args.some(e=>e.isDynamic())}}t.CallExpr=M;class E extends f{constructor(e,t,i){super(),this.value=e,this.branches=t,this.fallback=i}static isValidMatchLabel(e){switch(typeof e){case"number":case"string":return!0;case"object":if(!Array.isArray(e)||0===e.length)return!1;const t=typeof e[0];return("number"===t||"string"===t)&&e.every(e=>typeof e===t);default:return!1}}accept(e,t){return e.visitMatchExpr(this,t)}exprIsDynamic(){return this.value.isDynamic()||this.branches.some(([e,t])=>t.isDynamic())||this.fallback.isDynamic()}}t.MatchExpr=E;class P extends f{constructor(e,t){super(),this.branches=e,this.fallback=t}accept(e,t){return e.visitCaseExpr(this,t)}exprIsDynamic(){return this.branches.some(([e,t])=>e.isDynamic()||t.isDynamic())||this.fallback.isDynamic()}}t.CaseExpr=P;class C{serialize(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return["literal",e.value]}visitVarExpr(e,t){return["get",e.name]}visitHasAttributeExpr(e,t){return["has",e.name]}visitContainsExpr(e,t){return["in",this.serialize(e.value),e.elements]}visitCallExpr(e,t){return[e.op,...e.args.map(e=>this.serialize(e))]}visitMatchExpr(e,t){const i=[];for(const[t,r]of e.branches)i.push(t,this.serialize(r));return["match",this.serialize(e.value),...i,this.serialize(e.fallback)]}visitCaseExpr(e,t){const i=[];for(const[t,r]of e.branches)i.push(this.serialize(t),this.serialize(r));return["case",...i,this.serialize(e.fallback)]}}function A(e,t){if(Array.isArray(e))return function e(t,i){const r=t[0];if("string"!=typeof r)throw new Error("expected a builtin function name");switch(r){case"!has":case"!in":return new M("!",[e([r.slice(1),...t.slice(1)])]);case"ref":return function(e,t){if("string"!=typeof e[1])throw new Error("expected the name of an attribute");if(void 0===t)throw new Error("ref used with no definitions");const i=e[1];if(t.lockedNames.has(i))throw new Error(`circular referene to '${i}'`);if(!(i in t.definitions))throw new Error(`definition '${i}' not found`);const r=t.cache.get(i);if(void 0!==r)return r;let n,s=t.definitions[i];l.isSelectorDefinition(s)&&(s=s.value);if(l.isValueDefinition(s)){if(o.isInterpolatedPropertyDefinition(s.value))return f.fromJSON(a.interpolatedPropertyDefinitionToJsonExpr(s.value));if(!m(s.value))return f.fromJSON(s.value);s=s.value}if(!m(s))throw new Error(`unsupported definition ${i}`);t.lockedNames.add(i);try{n=A(s,t)}finally{t.lockedNames.delete(i)}return t.cache.set(i,n),n}(t,i);case"get":return function(e,t){if(void 0!==e[2])return L("get",e,t);const i=e[1];if("string"!=typeof i)throw new Error("expected the name of an attribute");return new g(i)}(t,i);case"has":return function(e,t){if(void 0!==e[2])return L("has",e,t);const i=e[1];if("string"!=typeof i)throw new Error("expected the name of an attribute");return new w(i)}(t,i);case"in":return function(e,t){const i=e[2];if(!b.isValidElementsArray(i))throw new Error("'in' expects an array of number or string literals");return new b(A(e[1],t),i)}(t,i);case"literal":return function(e){const t=e[1];if(null===t||"object"!=typeof t)throw new Error("expected an object or array literal");return new S(t)}(t);case"match":return function(e,t){if(e.length<4)throw new Error("not enough arguments");if(!(e.length%2))throw new Error("fallback is missing in 'match' expression");const i=A(e[1],t),r=[];for(let i=2;i<e.length-1;i+=2){const n=e[i];if(!E.isValidMatchLabel(n))throw new Error(`'${JSON.stringify(n)}' is not a valid label for 'match'`);const s=A(e[i+1],t);r.push([n,s])}const n=A(e[e.length-1],t);return new E(i,r,n)}(t,i);case"case":return function(e,t){if(e.length<3)throw new Error("not enough arguments");if(e.length%2)throw new Error("fallback is missing in 'case' expression");const i=[];for(let r=1;r<e.length-1;r+=2){const n=A(e[r],t),s=A(e[r+1],t);i.push([n,s])}const r=A(e[e.length-1],t);return new P(i,r)}(t,i);default:return L(r,t,i)}}(e,t);if(null===e)return y.instance;if("boolean"==typeof e)return new _(e);if("number"==typeof e)return new x(e);if("string"==typeof e)return new T(e);throw new Error(`failed to create expression from: ${JSON.stringify(e)}`)}function L(e,t,i){return new M(e,t.slice(1).map(e=>A(e,i)))}},function(e,t,i){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i(183)),r(i(46)),r(i(14)),r(i(79)),r(i(186)),r(i(189)),r(i(80)),r(i(49)),r(i(21))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(58),n=i(59),s=i(60),o=i(0);class a{constructor(e,t,i){this.latitude=e,this.longitude=t,this.altitude=i}static fromDegrees(e,t,i){return new a(e,t,i)}static fromRadians(e,t,i){return new a(o.Math.radToDeg(e),o.Math.radToDeg(t),i)}static fromLatLng(e){return new a(e.lat,e.lng)}static fromGeoPoint(e){return new a(e[1],e[0],e[2])}static fromObject(e){if(n.isGeoPointLike(e))return a.fromGeoPoint(e);if(r.isGeoCoordinatesLike(e))return a.fromDegrees(e.latitude,e.longitude,e.altitude);if(s.isLatLngLike(e))return a.fromDegrees(e.lat,e.lng);throw new Error("Invalid input coordinate format.")}get latitudeInRadians(){return o.Math.degToRad(this.latitude)}get longitudeInRadians(){return o.Math.degToRad(this.longitude)}get latitudeInDegrees(){return this.latitude}get longitudeInDegrees(){return this.longitude}get lat(){return this.latitude}get lng(){return this.longitude}isValid(){return!isNaN(this.latitude)&&!isNaN(this.longitude)}normalized(){let{latitude:e,longitude:t}=this;if(isNaN(e)||isNaN(t))return this;if(e>90){let i=(e+90)%360;i>=180&&(t+=180,i=360-i),e=i-90}if(e<-90){let i=(e-90)%360;i<=-180&&(t+=180,i=-360-i),e=i+90}if(t<-180||t>180){const e=Math.sign(t);t=(t%360+180*e)%360-180*e}return e===this.latitude&&t===this.longitude?this:new a(e,t,this.altitude)}equals(e){return this.latitude===e.latitude&&this.longitude===e.longitude&&this.altitude===e.altitude}copy(e){return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this}clone(){return new a(this.latitude,this.longitude,this.altitude)}toLatLng(){return{lat:this.latitude,lng:this.longitude}}toGeoPoint(){return void 0!==this.altitude?[this.longitude,this.latitude,this.altitude]:[this.longitude,this.latitude]}}t.GeoCoordinates=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);!function(e){function t(e){return(e%=360)<0&&(e+=360),e}function i(e,i){const r=(e=t(e))-(i=t(i));return r>180?r-360:r<=-180?r+360:r}e.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},e.newVector3=function(e,t,i,r){return void 0===r?{x:e,y:t,z:i}:(r.x=e,r.y=t,r.z=i,r)},e.degToRad=r.Math.degToRad,e.radToDeg=r.Math.radToDeg,e.clamp=r.Math.clamp,e.normalizeAngleDeg=t,e.angleDistanceDeg=i,e.interpolateAnglesDeg=function(e,t,r){return(e+i(t,e)*r)%360}}(t.MathUtils||(t.MathUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(3),s=i(10),o=i(4),a=i(1),l=i(38),c=a.LoggerManager.instance.create("MapViewUtils"),h=1e3,d=56,u=new r.Vector3(0,0,1),m=new r.Plane(u.clone()),p=new r.Sphere(void 0,s.EarthConstants.EQUATORIAL_RADIUS),f=new r.Raycaster,g={x:new r.Vector3,y:new r.Vector3,z:new r.Vector3},v={x:new r.Vector3,y:new r.Vector3,z:new r.Vector3},y={quaternions:[new r.Quaternion,new r.Quaternion],vector3:[new r.Vector3,new r.Vector3],matrix4:[new r.Matrix4,new r.Matrix4],transforms:[{xAxis:new r.Vector3,yAxis:new r.Vector3,zAxis:new r.Vector3,position:new r.Vector3}]};!function(e){function t(e,t,i,n=Math.PI/2){const s=a(e,0,0);if(null===s)throw new Error("MapView does not support a view pointing in the void");const o=e.projection.unprojectPoint(s),l=S(e,e.camera,o),c=Math.max(Math.min(r.Math.radToDeg(n),i+r.Math.radToDeg(l.tilt)),0);e.lookAt(o,s.distanceTo(e.camera.position),c,r.Math.radToDeg(l.azimuth+Math.PI)+t)}function i(e,t,i,o,a,l=new r.Vector3){const c=r.Math.degToRad(o),h=Math.cos(c)*t,d=r.Math.degToRad(i);a.projectPoint(e,l);const u=t*Math.sin(c);if(a.type===n.ProjectionType.Planar)l.x=l.x+Math.sin(d)*u,l.y=l.y-Math.cos(d)*u,l.z=l.z+h;else if(a.type===n.ProjectionType.Spherical){v.z.copy(l).normalize(),v.y.set(0,0,1).projectOnPlane(v.z).normalize(),y.quaternions[0].setFromAxisAngle(v.z,d-Math.PI),v.y.applyQuaternion(y.quaternions[0]),v.y.setLength(u);const e=t*Math.cos(c);l.add(v.y).add(v.z.setLength(e));const i=s.EarthConstants.EQUATORIAL_RADIUS+h,r=Math.sin(c)*t,n=Math.sqrt(i*i+r*r);l.setLength(n)}return l}function a(e,t,i,s){const o=new r.Vector3(t,i,0);y.vector3[1].copy(e.camera.position),y.matrix4[0].extractRotation(e.camera.matrixWorld),y.matrix4[1].multiplyMatrices(y.matrix4[0],y.matrix4[1].getInverse(e.camera.projectionMatrix));const a=o.applyMatrix4(y.matrix4[1]);f.set(y.vector3[1],a.normalize()),void 0!==s&&(m.constant=-s);const l=new r.Vector3,c=e.projection.type===n.ProjectionType.Planar?f.ray.intersectPlane(m,l):f.ray.intersectSphere(p,l);return m.constant=0,c}function u(e,t,i){e.camera.position.x+=t,e.camera.position.y+=i}function _(e,t,i){y.quaternions[0].setFromUnitVectors(t.normalize(),i.normalize()).inverse(),y.matrix4[0].makeRotationFromQuaternion(y.quaternions[0]),e.camera.applyMatrix(y.matrix4[0]),e.camera.updateMatrixWorld()}function x(e,t,i,n,s=new r.Quaternion){const o=y.transforms[0];return e.localTangentSpace(t,o),y.matrix4[0].makeBasis(o.xAxis,o.yAxis,o.zAxis),s.setFromRotationMatrix(y.matrix4[0]),y.quaternions[0].setFromAxisAngle(y.vector3[1].set(0,0,1),r.Math.degToRad(i)),y.quaternions[1].setFromAxisAngle(y.vector3[1].set(1,0,0),r.Math.degToRad(n)),s.multiply(y.quaternions[0]),s.multiply(y.quaternions[1]),s}function T(e,t){y.vector3[1].setFromMatrixPosition(t.matrixWorld),e.projection.localTangentSpace(e.projection.unprojectPoint(y.vector3[1]),{xAxis:v.x,yAxis:v.y,zAxis:v.z,position:y.vector3[0]}),y.matrix4[1].makeBasis(v.x,v.y,v.z),y.matrix4[0].getInverse(y.matrix4[1]).multiply(t.matrixWorld),g.x.setFromMatrixColumn(y.matrix4[0],0),g.y.setFromMatrixColumn(y.matrix4[0],1),g.z.setFromMatrixColumn(y.matrix4[0],2);let i=0,r=0,n=0;const s=g.z.dot(y.vector3[1].set(0,0,1));return s<.99999?s>1e-5-1?(i=Math.atan2(g.z.x,-g.z.y),r=Math.acos(g.z.z),n=Math.atan2(g.x.z,g.y.z)):(i=-Math.atan2(-g.y.x,g.x.x),r=180,n=0):(i=Math.atan2(-g.y.x,g.x.x),r=0,n=0),{yaw:i,pitch:r,roll:n}}function S(e,t,i){e.projection.localTangentSpace(i,{xAxis:v.x,yAxis:v.y,zAxis:v.z,position:y.vector3[0]});let r=0,n=0;return y.vector3[1].copy(t.position).sub(y.vector3[0]).normalize(),y.vector3[1].dot(v.z)>.99999?(n=Math.PI-T(e,t).yaw,n=Math.atan2(Math.sin(n),Math.cos(n)),r=0,{tilt:r,azimuth:n}):(r=y.vector3[1].angleTo(v.z),y.vector3[1].copy(t.position).sub(y.vector3[0]).projectOnPlane(v.z).normalize(),n=y.vector3[1].angleTo(v.y),y.vector3[1].cross(v.y).dot(v.z)<0&&(n=-n),{tilt:r,azimuth:n})}function w(e,t){const i=T(e,e.camera).pitch,r=s.EarthConstants.EQUATORIAL_CIRCUMFERENCE/Math.pow(2,t);return e.focalLength*r/256*Math.cos(i)}function b(e,t,i){if(null==e||void 0===e.image)return;if(void 0!==e.uuid&&!0===i.get(e.uuid))return;i.set(e.uuid,!0);const r=e.image,n=4*r.width*r.height;t.heapSize+=n,t.gpuSize+=n}function M(e,t,i){if(void 0===e.uuid||!0!==i.get(e.uuid))if(i.set(e.uuid,!0),e instanceof r.RawShaderMaterial||e instanceof r.ShaderMaterial){const n=e;for(const e in n.uniforms)if(void 0!==n.uniforms[e]){const s=n.uniforms[e];s instanceof r.Texture&&b(s,t,i)}}else if(e instanceof r.MeshBasicMaterial||e instanceof o.MapMeshBasicMaterial){const r=e;b(r.map,t,i),b(r.aoMap,t,i),b(r.specularMap,t,i),b(r.alphaMap,t,i),b(r.envMap,t,i)}else if(e instanceof o.MapMeshStandardMaterial){const r=e;b(r.map,t,i),b(r.lightMap,t,i),b(r.aoMap,t,i),b(r.emissiveMap,t,i),b(r.bumpMap,t,i),b(r.normalMap,t,i),b(r.displacementMap,t,i),b(r.roughnessMap,t,i),b(r.metalnessMap,t,i),b(r.alphaMap,t,i),b(r.envMap,t,i)}else e instanceof r.LineBasicMaterial||e instanceof r.LineDashedMaterial||c.warn("estimateMeshSize: unidentified material: ",e)}function E(e,t,i,n){if(void 0===e.uuid&&(e.uuid=r.Math.generateUUID()),!0===n.get(e.uuid))return;n.set(e.uuid,!0);let s=0,o=4;void 0!==e.array.BYTES_PER_ELEMENT&&(o=e.array.BYTES_PER_ELEMENT),e instanceof r.InterleavedBufferAttribute||e instanceof r.BufferAttribute?s=o*e.count*e.itemSize:c.warn("estimateMeshSize: unidentified attribute: ",t),i.heapSize+=s+d,i.gpuSize+=s}function P(e){return e.substring(0,2)}e.zoomOnTargetPosition=function(e,i,r,o,l=Math.PI/2){const c=a(e,i,r),h=w(e,o);if(e.projection.type===n.ProjectionType.Planar?e.camera.position.setZ(h):e.projection.type===n.ProjectionType.Spherical&&e.camera.position.setLength(s.EarthConstants.EQUATORIAL_RADIUS+h),e.projection.type===n.ProjectionType.Spherical){const i=a(e,0,0);if(null!==i){const r=S(e,e.camera,e.projection.unprojectPoint(i)).tilt-l;r>0&&t(e,0,r,l)}}const d=a(e,i,r);c&&d&&(e.projection.type===n.ProjectionType.Planar?(c.sub(d),u(e,c.x,c.y)):e.projection.type===n.ProjectionType.Spherical&&_(e,c,d))},e.orbitFocusPoint=t,e.getCameraPositionFromTargetCoordinates=i,e.getCameraCoordinatesFromTargetCoordinates=function(e,t,r,n,s){return s.projection.unprojectPoint(i(e,t,r,n,s.projection,y.vector3[1]))},e.rayCastWorldCoordinates=a,e.panCameraAboveFlatMap=u,e.panCameraAroundGlobe=_,e.rotate=function(t,i,o=0,a=Math.PI/4){if(t.camera.rotateOnWorldAxis(t.projection.type===n.ProjectionType.Spherical?y.vector3[0].copy(t.camera.position).normalize():y.vector3[0].set(0,0,1),n.MathUtils.degToRad(-i)),t.camera.updateMatrixWorld(),0===o)return;const l=e.extractAttitude(t,t.camera).pitch;let c=r.Math.clamp(l+r.Math.degToRad(o),0,a);if(t.projection.type===n.ProjectionType.Spherical){const e=Math.asin(s.EarthConstants.EQUATORIAL_RADIUS*Math.sin(Math.PI-a)/t.camera.position.length());c=Math.min(c,e)}t.camera.rotateX(c-l)},e.getCameraRotationAtTarget=x,e.setRotation=function(e,t,i){x(e.projection,e.geoCenter,t,i,e.camera.quaternion)},e.extractAttitude=T,e.extractSphericalCoordinatesFromLocation=S,e.getCameraFrustumPlanes=function(e){const t=e.near,i=e.far;let n=t*Math.tan(r.Math.degToRad(.5*e.fov))/e.zoom,s=2*n,o=e.aspect*s,a=-.5*o;const l=e.view;if(null!==l&&l.enabled){const e=l.fullWidth,t=l.fullHeight;a+=l.offsetX*o/e,n-=l.offsetY*s/t,o*=l.width/e,s*=l.height/t}return a+=0!==e.filmOffset?t*e.filmOffset/e.getFilmWidth():0,{left:a,right:a+o,top:n,bottom:n-s,near:t,far:i}},e.rayCastGeoCoordinates=function(e,t,i){const r=a(e,t,i);return r?e.projection.unprojectPoint(r):null},e.calculateDistanceToGroundFromZoomLevel=w,e.calculateZoomLevelFromDistance=function(e,t){const i=256*e/t.focalLength,n=r.Math.clamp(Math.log2(s.EarthConstants.EQUATORIAL_CIRCUMFERENCE/i),t.minZoomLevel,t.maxZoomLevel);return Math.round(1e16*n)/1e16},e.calculateDepthFromClipDistance=function(e,t){const i=t,r=i.far-i.near,n=e*i.far;return(1-i.near/n)*(i.far/r)},e.cameraToWorldDistance=function(e,t){return e*t.far},e.calculateVerticalFovByHorizontalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)/t)},e.calculateHorizontalFovByVerticalFov=function(e,t){return 2*Math.atan(Math.tan(e/2)*t)},e.calculateFocalLengthByVerticalFov=function(e,t){return t/2/Math.tan(e/2)},e.calculateFovByFocalLength=function(e,t){return r.Math.radToDeg(2*Math.atan(t/2/e))},e.calculateScreenSizeByFocalLength=function(e,t,i){return e*i/t},e.calculateWorldSizeByFocalLength=function(e,t,i){return t*i/e},e.estimateObject3dSize=function e(t,i,n){const s=void 0!==i?i:{heapSize:0,gpuSize:0};if(void 0===n&&(n=new Map),function(e,t,i){if(!e.isObject3D||e instanceof r.Scene)return;if(void 0!==e.uuid&&!0===i.get(e.uuid))return;if(i.set(e.uuid,!0),e.isMesh||e.isLine||e.isPoints){let n=h;const s=0,o=e;if(void 0!==o.material)if(Array.isArray(o.material)){const e=o.material;for(const r of e)M(r,t,i)}else{M(o.material,t,i)}void 0!==o.geometry&&function(e,t,i){if(void 0!==e.uuid&&!0===i.get(e.uuid))return;let n;i.set(e.uuid,!0),e instanceof r.Geometry?(t.heapSize+=24*e.vertices.length,t.heapSize+=48*e.faces.length,n=e._bufferGeometry):e instanceof r.BufferGeometry&&(n=e);if(void 0===n)return;const s=n.attributes;if(void 0===s)return void c.warn("estimateGeometrySize: unidentified geometry: ",e);for(const e in s)void 0!==s[e]&&E(s[e],e,t,i);null!==n.index&&E(n.index,"index",t,i)}(o.geometry,t,i);const a=void 0!==e.userData?e.userData.feature:void 0;void 0!==a&&(n+=l.getFeatureDataSize(a)),t.heapSize+=n,t.gpuSize+=s}else c.warn("estimateMeshSize: unidentified object",e)}(t,s,n),t.children.length>0)for(const i of t.children)e(i,s,n);return s},e.mapViewIsLoading=function(e){let t=0;for(const i of e.visibleTileSet.dataSourceTileList){t+=i.numTilesLoading;for(const e of i.visibleTiles)void 0===e.tileLoader||e.tileLoader.isFinished||t++,void 0===e.tileGeometryLoader||e.tileGeometryLoader.isFinished||t++}let i=t>0;return void 0!==e.textElementsRenderer&&(i=i||e.textElementsRenderer.loading),i=i||!e.poiTableManager.finishedLoading||!e.visibleTileSet.allVisibleTilesLoaded,i},e.getBrowserLanguages=function(){if(void 0!==navigator.languages&&navigator.languages.length>0){const e=[];for(const t of navigator.languages)e.push(P(t));return e}if(void 0!==navigator.language)return[P(navigator.language)]}}(t.MapViewUtils||(t.MapViewUtils={}));const _=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];!function(e){function t(e,t,i=4){const r=function(e,t=4){let i=0;const r=_[t];e+=r/2;for(;e<0;)e+=r;for(;e>=r;)e-=r;for(let r=0;r<t&&e>0;r++)1&e&&(i+=_[53-t+r]),e>>>=1;return a.assert(0===e),i}(t,i);return e.mortonCode()+r}function i(e,t=4){let i=0,r=e,n=0;for(;n<t;n++){const e=_[52-n];r>=e&&(r-=e,i+=_[t-1-n])}return i-=_[t-1],{offset:i,mortonCode:r}}e.getKeyForTileKeyAndOffset=t,e.extractOffsetAndMortonKeyFromKey=i,e.getParentKeyFromKey=function(e,r=4){const{offset:s,mortonCode:o}=i(e,r);return t(n.TileKey.fromMortonCode(n.TileKey.parentMortonCode(o)),s,r)}}(t.TileOffsetUtils||(t.TileOffsetUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{}t.EarthConstants=r,r.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,r.EQUATORIAL_RADIUS=6378137,r.MIN_ELEVATION=-433,r.MAX_ELEVATION=8848,r.MAX_BUILDING_HEIGHT=828},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBox3Like=function(e){const t=e;return void 0!==t.min&&void 0!==t.max}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOrientedBox3Like=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis&&void 0!==t.extents}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(8);!function(e){e[e.Planar=0]="Planar",e[e.Spherical=1]="Spherical"}(t.ProjectionType||(t.ProjectionType={}));t.Projection=class{constructor(e){this.unitScale=e}localTangentSpace(e,t){return this.projectPoint(e,t.position),r.MathUtils.newVector3(1,0,0,t.xAxis),r.MathUtils.newVector3(0,1,0,t.yAxis),r.MathUtils.newVector3(0,0,1,t.zAxis),t}reprojectPoint(e,t,i){return e===this?void 0===i?{x:t.x,y:t.y,z:t.z}:(i.x=t.x,i.y=t.y,i.z=t.z,i):this.projectPoint(e.unprojectPoint(t),i)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);var n,s,o,a,l,c,h;!function(e){e[e.Em=0]="Em",e[e.Pixel=1]="Pixel",e[e.Point=2]="Point",e[e.Percent=3]="Percent"}(n=t.FontUnit||(t.FontUnit={})),function(e){e[e.Regular=0]="Regular",e[e.Bold=1]="Bold",e[e.Italic=2]="Italic",e[e.BoldItalic=3]="BoldItalic"}(s=t.FontStyle||(t.FontStyle={})),function(e){e[e.Regular=0]="Regular",e[e.AllCaps=1]="AllCaps",e[e.SmallCaps=2]="SmallCaps"}(o=t.FontVariant||(t.FontVariant={})),function(e){e[e.Above=0]="Above",e[e.Center=-.5]="Center",e[e.Below=-1]="Below"}(a=t.VerticalAlignment||(t.VerticalAlignment={})),function(e){e[e.Left=0]="Left",e[e.Center=-.5]="Center",e[e.Right=-1]="Right"}(l=t.HorizontalAlignment||(t.HorizontalAlignment={})),function(e){e[e.None=0]="None",e[e.Character=1]="Character",e[e.Word=2]="Word"}(c=t.WrappingMode||(t.WrappingMode={})),function(e){e.DEFAULT_FONT_NAME="",e.DEFAULT_FONT_SIZE={unit:Object.freeze(n.Pixel),size:Object.freeze(16),backgroundSize:Object.freeze(0)},e.DEFAULT_FONT_STYLE=s.Regular,e.DEFAULT_FONT_VARIANT=o.Regular,e.DEFAULT_ROTATION=0,e.DEFAULT_COLOR=new r.Color(0),e.DEFAULT_OPACITY=1,e.DEFAULT_BACKGROUND_COLOR=new r.Color(0),e.DEFAULT_BACKGROUND_OPACITY=0,e.DEFAULT_TRACKING=0,e.DEFAULT_LEADING=0,e.DEFAULT_MAX_LINES=1/0,e.DEFAULT_LINE_WIDTH=1/0,e.DEFAULT_CANVAS_ROTATION=0,e.DEFAULT_LINE_ROTATION=0,e.DEFAULT_WRAPPING_MODE=c.Word,e.DEFAULT_VERTICAL_ALIGNMENT=a.Above,e.DEFAULT_HORIZONTAL_ALIGNMENT=l.Left}(h=t.DefaultTextStyle||(t.DefaultTextStyle={}));class d{constructor(e={}){this.m_params={fontName:void 0!==e.fontName?e.fontName:h.DEFAULT_FONT_NAME,fontSize:void 0!==e.fontSize?e.fontSize:{unit:h.DEFAULT_FONT_SIZE.unit,size:h.DEFAULT_FONT_SIZE.size,backgroundSize:h.DEFAULT_FONT_SIZE.backgroundSize},fontStyle:void 0!==e.fontStyle?e.fontStyle:h.DEFAULT_FONT_STYLE,fontVariant:void 0!==e.fontVariant?e.fontVariant:h.DEFAULT_FONT_VARIANT,rotation:void 0!==e.rotation?e.rotation:h.DEFAULT_ROTATION,color:void 0!==e.color?e.color:new r.Color(h.DEFAULT_COLOR),opacity:void 0!==e.opacity?e.opacity:h.DEFAULT_OPACITY,backgroundColor:void 0!==e.backgroundColor?e.backgroundColor:new r.Color(h.DEFAULT_BACKGROUND_COLOR),backgroundOpacity:void 0!==e.backgroundOpacity?e.backgroundOpacity:h.DEFAULT_BACKGROUND_OPACITY}}get params(){return this.m_params}set params(e){this.m_params=Object.assign(Object.assign({},this.m_params),e)}get fontName(){return this.m_params.fontName}set fontName(e){this.m_params.fontName=e}get fontSize(){return this.m_params.fontSize}set fontSize(e){this.m_params.fontSize=e}get fontStyle(){return this.m_params.fontStyle}set fontStyle(e){this.m_params.fontStyle=e}get fontVariant(){return this.m_params.fontVariant}set fontVariant(e){this.m_params.fontVariant=e}get rotation(){return this.m_params.rotation}set rotation(e){this.m_params.rotation=e}get color(){return this.m_params.color}set color(e){this.m_params.color=e}get backgroundColor(){return this.m_params.backgroundColor}set backgroundColor(e){this.m_params.backgroundColor=e}get opacity(){return this.m_params.opacity}set opacity(e){this.m_params.opacity=e}get backgroundOpacity(){return this.m_params.backgroundOpacity}set backgroundOpacity(e){this.m_params.backgroundOpacity=e}clone(e={}){return new d(Object.assign(Object.assign({},this.m_params),e))}}t.TextRenderStyle=d;class u{constructor(e={}){this.m_params={tracking:void 0!==e.tracking?e.tracking:h.DEFAULT_TRACKING,leading:void 0!==e.leading?e.leading:h.DEFAULT_LEADING,maxLines:void 0!==e.maxLines?e.maxLines:h.DEFAULT_MAX_LINES,lineWidth:void 0!==e.lineWidth?e.lineWidth:h.DEFAULT_LINE_WIDTH,canvasRotation:void 0!==e.canvasRotation?e.canvasRotation:h.DEFAULT_CANVAS_ROTATION,lineRotation:void 0!==e.lineRotation?e.lineRotation:h.DEFAULT_LINE_ROTATION,wrappingMode:void 0!==e.wrappingMode?e.wrappingMode:h.DEFAULT_WRAPPING_MODE,verticalAlignment:void 0!==e.verticalAlignment?e.verticalAlignment:h.DEFAULT_VERTICAL_ALIGNMENT,horizontalAlignment:void 0!==e.horizontalAlignment?e.horizontalAlignment:h.DEFAULT_HORIZONTAL_ALIGNMENT}}get params(){return this.m_params}set params(e){this.m_params=Object.assign(Object.assign({},this.m_params),e)}get tracking(){return this.m_params.tracking}set tracking(e){this.m_params.tracking=e}get leading(){return this.m_params.leading}set leading(e){this.m_params.leading=e}get maxLines(){return this.m_params.maxLines}set maxLines(e){this.m_params.maxLines=e}get lineWidth(){return this.m_params.lineWidth}set lineWidth(e){this.m_params.lineWidth=e}get canvasRotation(){return this.m_params.canvasRotation}set canvasRotation(e){this.m_params.canvasRotation=e}get lineRotation(){return this.m_params.lineRotation}set lineRotation(e){this.m_params.lineRotation=e}get wrappingMode(){return this.m_params.wrappingMode}set wrappingMode(e){this.m_params.wrappingMode=e}get verticalAlignment(){return this.m_params.verticalAlignment}set verticalAlignment(e){this.m_params.verticalAlignment=e}get horizontalAlignment(){return this.m_params.horizontalAlignment}set horizontalAlignment(e){this.m_params.horizontalAlignment=e}clone(e={}){return new u(Object.assign(Object.assign({},this.m_params),e))}}t.TextLayoutStyle=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(7),n=i(0);class s{constructor(e,t){this.southWest=e,this.northEast=t}static fromCoordinates(e,t){return new s(e,t)}get minAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)}get maxAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)}get south(){return this.southWest.latitude}get north(){return this.northEast.latitude}get west(){return this.southWest.longitude}get east(){return this.northEast.longitude}get center(){const e=.5*(this.south+this.north),{west:t,east:i}=this,{minAltitude:n,altitudeSpan:s}=this;let o;if(void 0!==n&&void 0!==s&&(o=n+.5*s),t<i)return new r.GeoCoordinates(e,.5*(t+i),o);let a=.5*(360+i+t);return a>360&&(a-=360),new r.GeoCoordinates(e,a,o)}get latitudeSpanInRadians(){return n.Math.degToRad(this.latitudeSpan)}get longitudeSpanInRadians(){return n.Math.degToRad(this.longitudeSpan)}get latitudeSpan(){return this.north-this.south}get altitudeSpan(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude}get longitudeSpan(){let e=this.northEast.longitude-this.southWest.longitude;return e<0&&(e+=360),e}get latitudeSpanInDegrees(){return this.latitudeSpan}get longitudeSpanInDegrees(){return this.longitudeSpan}contains(e){if(void 0===e.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(e);const t=this.minAltitude===this.maxAltitude,i=this.minAltitude===e.altitude,r=this.minAltitude<=e.altitude&&this.maxAltitude>e.altitude;return!(t?!i:!r)&&this.containsHelper(e)}clone(){return new s(this.southWest,this.northEast)}growToContain(e){this.southWest.latitude=Math.min(this.southWest.latitude,e.latitude),this.southWest.longitude=Math.min(this.southWest.longitude,e.longitude),this.southWest.altitude=void 0!==this.southWest.altitude&&void 0!==e.altitude?Math.min(this.southWest.altitude,e.altitude):void 0!==this.southWest.altitude?this.southWest.altitude:void 0!==e.altitude?e.altitude:void 0,this.northEast.latitude=Math.max(this.northEast.latitude,e.latitude),this.northEast.longitude=Math.max(this.northEast.longitude,e.longitude),this.northEast.altitude=void 0!==this.northEast.altitude&&void 0!==e.altitude?Math.max(this.northEast.altitude,e.altitude):void 0!==this.northEast.altitude?this.northEast.altitude:void 0!==e.altitude?e.altitude:void 0}containsHelper(e){if(e.latitude<this.southWest.latitude||e.latitude>=this.northEast.latitude)return!1;const{west:t,east:i}=this;return i>t?e.longitude>=t&&e.longitude<i:e.longitude>i||e.longitude<=t}}t.GeoBox=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(63),n=i(66),s=i(67);t.TilingScheme=class{constructor(e,t){this.subdivisionScheme=e,this.projection=t,this.boundingBoxGenerator=new r.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new s.TileTreeTraverse(e)}getSubTileKeys(e){return this.tileTreeTraverse.subTiles(e)}getTileKey(e,t){return n.TileKeyUtils.geoCoordinatesToTileKey(this,e,t)}getTileKeys(e,t){return n.TileKeyUtils.geoRectangleToTileKeys(this,e,t)}getGeoBox(e){return this.boundingBoxGenerator.getGeoBox(e)}getWorldBox(e,t){return this.boundingBoxGenerator.getWorldBox(e,t)}}},function(e,t,i){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i(39)),r(i(88)),r(i(89)),r(i(34)),r(i(90)),r(i(53)),r(i(53)),r(i(107)),r(i(107)),r(i(225)),r(i(54)),r(i(109)),r(i(226)),r(i(45)),r(i(102)),r(i(22)),r(i(82)),r(i(95)),r(i(228)),r(i(98)),r(i(97)),r(i(30)),r(i(99)),r(i(50)),r(i(37)),r(i(85)),r(i(100)),r(i(101)),r(i(83)),r(i(24)),r(i(23)),r(i(36)),r(i(87)),r(i(105)),r(i(38)),r(i(229)),r(i(111)),r(i(9)),r(i(106)),r(i(94)),r(i(108)),r(i(93))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);function n(e){e.transparent||e.forcedBlending||(e.blending=r.CustomBlending,!0===e.premultipliedAlpha?(e.blendSrc=r.OneFactor,e.blendDst=r.OneMinusSrcAlphaFactor,e.blendSrcAlpha=r.OneFactor,e.blendDstAlpha=r.OneMinusSrcAlphaFactor):(e.blendSrc=r.SrcAlphaFactor,e.blendDst=r.OneMinusSrcAlphaFactor,e.blendSrcAlpha=r.OneFactor,e.blendDstAlpha=r.OneMinusSrcAlphaFactor))}t.insertShaderInclude=function(e,t,i,r){const n=!0===r?"\t":"";return e.replace(`#include <${t}>`,`#include <${t}>\n${n}#include <${i}>`)},t.enforceBlending=function(e){e.transparent||(n(e),e.forcedBlending=!0)},t.enableBlending=n,t.disableBlending=function(e){e.transparent||e.forcedBlending||(e.blending=r.NormalBlending)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(0),s=24,o=16,a=8,l=0,c=255,h=16777215,d=4294967295,u=new n.Color;!function(e){e.getHexFromRgba=function(e,t,i,n){return r.assert(n>=0&&n<=1),c-Math.floor(n*c)<<s^e*c<<o^t*c<<a^i*c<<l},e.getHexFromRgb=function(e,t,i){return r.assert(e>=0&&e<=1),r.assert(t>=0&&t<=1),r.assert(i>=0&&i<=1),e*c<<o^t*c<<a^i*c<<l},e.getHexFromHsl=function(e,t,i){return r.assert(e>=0&&e<=1),r.assert(t>=0&&t<=1),r.assert(i>=0&&i<=1),u.setHSL(e,t,i).getHex()},e.getRgbaFromHex=function(e){return r.assert(0==(e&~d),"Wrong hex format: #"+e.toString(16)),{r:(e>>o&c)/c,g:(e>>a&c)/c,b:(e>>l&c)/c,a:(c-(e>>s&c))/c}},e.hasAlphaInHex=function(e){return r.assert(0==(e&~d),"Wrong hex format: #"+e.toString(16)),e>>s!=0},e.getAlphaFromHex=function(e){return r.assert(0==(e&~d),"Wrong hex format: #"+e.toString(16)),(c-(e>>s)&c)/c},e.removeAlphaFromHex=function(e){return r.assert(0==(e&~d),"Wrong hex format: #"+e.toString(16)),e&h}}(t.ColorUtils||(t.ColorUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(1),s=i(19),o=i(72),a=i(164),l=i(5),c=i(31),h=i(73),d=n.LoggerManager.instance.create("InterpolatedProperty"),u=[r.DiscreteInterpolant,r.LinearInterpolant,r.CubicInterpolant,a.ExponentialInterpolant],m=new Array(h.StringEncodedNumeralFormatMaxSize);function p(e){return void 0!==e&&void 0!==e.interpolationMode&&e.zoomLevels instanceof Float32Array&&void 0!==e.values&&e.values.length>0&&(e.zoomLevels.length===e.values.length/4||e.zoomLevels.length===e.values.length/3||e.zoomLevels.length===e.values.length)}t.isInterpolatedPropertyDefinition=function(e){return!!(e&&void 0===e.interpolationMode&&Array.isArray(e.values)&&e.values.length>0&&void 0!==e.values[0]&&Array.isArray(e.zoomLevels)&&e.zoomLevels.length>0&&void 0!==e.zoomLevels[0]&&e.values.length===e.zoomLevels.length)},t.isInterpolatedProperty=p;const f=new o.MapEnv({$zoom:0,$pixelToMeters:1});function g(e,t,i){const r=e.values.length/e.zoomLevels.length,n=new u[e.interpolationMode](e.zoomLevels,e.values,r);if(e.interpolationMode===c.InterpolationMode.Exponential&&void 0!==e.exponent&&(n.exponent=e.exponent),n.evaluate(t),void 0===e._stringEncodedNumeralDynamicMask)return n.resultBuffer[0];{const r=new u[e.interpolationMode](e.zoomLevels,e._stringEncodedNumeralDynamicMask,1);return e.interpolationMode===c.InterpolationMode.Exponential&&void 0!==e.exponent&&(r.exponent=e.exponent),r.evaluate(t),n.resultBuffer[0]*(1+r.resultBuffer[0]*(i-1))}}t.getPropertyValue=function(e,t,i=1){if(l.Expr.isExpr(e)){let r;return"number"==typeof t?(f.entries.$zoom=t,f.entries.$pixelToMeters=i,r=f):r=t,e.evaluate(r,l.ExprScope.Dynamic)}let o;if("number"==typeof t?o=t:(o=t.lookup("$zoom"),i=t.lookup("$pixelToMeters")),!p(e)){if("string"!=typeof e)return e;{const t=h.parseStringEncodedNumeral(e,i);return void 0!==t?t:e}}if(void 0!==e._stringEncodedNumeralType)switch(e._stringEncodedNumeralType){case h.StringEncodedNumeralType.Meters:case h.StringEncodedNumeralType.Pixels:return g(e,o,i);case h.StringEncodedNumeralType.Hex:case h.StringEncodedNumeralType.RGB:case h.StringEncodedNumeralType.RGBA:case h.StringEncodedNumeralType.HSL:return function(e,t){const i=e.values.length/e.zoomLevels.length,o=new u[e.interpolationMode](e.zoomLevels,e.values,i);e.interpolationMode===c.InterpolationMode.Exponential&&void 0!==e.exponent&&(o.exponent=e.exponent);return o.evaluate(t),n.assert(3===i||4===i),4===i?s.ColorUtils.getHexFromRgba(r.Math.clamp(o.resultBuffer[0],0,1),r.Math.clamp(o.resultBuffer[1],0,1),r.Math.clamp(o.resultBuffer[2],0,1),r.Math.clamp(o.resultBuffer[3],0,1)):s.ColorUtils.getHexFromRgb(r.Math.clamp(o.resultBuffer[0],0,1),r.Math.clamp(o.resultBuffer[1],0,1),r.Math.clamp(o.resultBuffer[2],0,1))}(e,o)}return g(e,o,i)},t.createInterpolatedProperty=function(e){!function(e){const t="Cubic"===e.interpolation;for(let i=0;i<e.values.length;++i){e.zoomLevels.findIndex(r=>t?Math.abs(r-e.zoomLevels[i])<.001:r===e.zoomLevels[i])!==i&&(e.zoomLevels.splice(--i,1),e.values.splice(--i,1))}}(e);const t=void 0!==e.interpolation?c.InterpolationMode[e.interpolation]:c.InterpolationMode.Discrete,i=new Float32Array(e.zoomLevels),r=e.values[0];switch(typeof r){default:case"number":case"boolean":return{interpolationMode:t,zoomLevels:i,values:new Float32Array(e.values),exponent:e.exponent};case"string":const n=h.StringEncodedNumeralFormats.find(e=>e.regExp.test(r));if(void 0===n)return t===c.InterpolationMode.Discrete?{interpolationMode:t,zoomLevels:i,values:e.values}:void d.error(`No StringEncodedNumeralFormat matched ${r}.`);let s=!1;const o=new Float32Array(e.values.length*n.size),a=new Float32Array(e.values.length);return s=function(e,t,i,r){let n=!1;const s=e.type===h.StringEncodedNumeralType.Meters||e.type===h.StringEncodedNumeralType.Pixels?h.StringEncodedMetricFormats:h.StringEncodedColorFormats;for(let e=0;e<t.values.length;++e){let o=!1;for(const a of s){const s=t.values[e];if(o=a.decoder(s,m),o){void 0!==a.mask&&(r[e]=a.mask,n=!0);for(let t=0;t<a.size;++t)i[e*a.size+t]=m[t];break}}if(!o)throw Error(`Not all interpolation values match the same format: ${JSON.stringify(t)}`)}return n}(n,e,o,a),{interpolationMode:t,zoomLevels:i,values:o,exponent:e.exponent,_stringEncodedNumeralType:n.type,_stringEncodedNumeralDynamicMask:s?a:void 0}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t;e.whiteSpaceRanges=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]],e.isWhiteSpace=function(t){for(const i of e.whiteSpaceRanges)if(t>=i[0]&&t<=i[1])return!0;return!1},e.newLineRanges=[[10,13],[133,133],[8232,8233]],e.isNewLine=function(t){for(const i of e.newLineRanges)if(t>=i[0]&&t<=i[1])return!0;return!1},e.nonPrintableRanges=[[0,31],[127,159]],e.isPrintable=function(t){for(const i of e.nonPrintableRanges)if(t>=i[0]&&t<=i[1])return!1;return!0},function(e){e[e.Neutral=0]="Neutral",e[e.Weak=.5]="Weak",e[e.LTR=1]="LTR",e[e.RTL=-1]="RTL"}(t=e.Direction||(e.Direction={})),e.rtlBlocks=["Hebrew","Alphabetic Presentation Forms","Arabic","Arabic Supplement","Arabic Extended-A","Arabic Presentation Forms-A","Arabic Presentation Forms-B","Arabic Mathematical Alphabetic Symbols","Indic Siyaq Numbers","Rumi Numeral Symbols","Syriac","Syriac Supplement","Samaritan","Mandaic","Thaana","Mende Kikakui","NKo","Adlam","Hanifi Rohingya"],e.neutralBidirectionalRanges=[[32,47],[58,64],[91,96],[123,126]],e.weakBidirectionalRanges=[[48,57],[1632,1641],[1776,1785]],e.getDirection=function(i,r){for(const r of e.weakBidirectionalRanges)if(i>=r[0]&&i<=r[1])return t.Weak;for(const r of e.neutralBidirectionalRanges)if(i>=r[0]&&i<=r[1])return t.Neutral;return void 0!==e.rtlBlocks.find(e=>e===r)?t.RTL:t.LTR},e.rtlMirroredCodePoints=[40,41,60,62,91,93,123,125],e.isRtlMirrored=function(t){return void 0!==e.rtlMirroredCodePoints.find(e=>e===t)}}(t.UnicodeUtils||(t.UnicodeUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(4),s=i(1),o=i(0),a=i(50),l=i(81),c=s.LoggerManager.instance.create("DecodedTileHelpers"),h=[...r.TEXTURE_PROPERTY_KEYS,"mapProperties","normalMapProperties","displacementMapProperties","roughnessMapProperties","emissiveMapProperties","alphaMapProperties","metalnessMapProperties","bumpMapProperties"];function d(e){if(void 0!==e.name)switch(e.name){case"extruded-line":if(!r.isExtrudedLineTechnique(e))throw new Error("Invalid extruded-line technique");return"standard"===e.shading?n.MapMeshStandardMaterial:n.MapMeshBasicMaterial;case"standard":case"terrain":case"extruded-polygon":return n.MapMeshStandardMaterial;case"dashed-line":case"solid-line":return n.SolidLineMaterial;case"fill":return n.MapMeshBasicMaterial;case"squares":return o.PointsMaterial;case"circles":return n.CirclePointsMaterial;case"line":case"segments":return o.LineBasicMaterial;case"shader":return o.ShaderMaterial;case"text":case"labeled-icon":case"line-marker":case"label-rejection-line":return}}function u(e,t,i,r){const n=e;n[t]instanceof o.Color?m(e[t],i,r):n[t]=f(i,r)}function m(e,t,i){let n=g(t,i);r.ColorUtils.hasAlphaInHex(n)&&(c.warn("Used RGBA value for technique color without transparency support!"),n=r.ColorUtils.removeAlphaFromHex(n)),e.setHex(n)}function p(e,t,i,s,a){const l=g(s,a),{r:c,g:h,b:d,a:u}=r.ColorUtils.getRgbaFromHex(l),m=i;let p=u;void 0!==m.opacity&&(p*=f(m.opacity,a)),p=o.Math.clamp(p,0,1),e.opacity=p,t.setRGB(c,h,d),p>=1?n.disableBlending(e):n.enableBlending(e)}function f(e,t){return void 0!==t&&(r.isInterpolatedProperty(e)||r.Expr.isExpr(e))&&(e=r.getPropertyValue(e,t)),e}function g(e,t){if("number"==typeof(e=f(e,t)))return e;if("string"==typeof e){const t=r.parseStringEncodedColor(e);if(void 0!==t)return t}throw new Error(`Unsupported color format: '${e}'`)}function v(e){const t=r.techniqueDescriptors[e.name];return void 0!==t?t.attrTransparencyColor:void 0}t.createMaterial=function(e,i){const n=e.technique,s=d(n),a={};if(void 0===s)return;s.prototype instanceof o.RawShaderMaterial&&(a.fog=e.fog);const m=new s(a);return void 0!==n.id&&(m.name=n.id),r.isExtrudedPolygonTechnique(n)&&(m.flatShading=!0,!0===n.vertexColors&&delete n.color),m.depthTest=r.isExtrudedPolygonTechnique(n)&&!1!==n.depthTest,(r.isStandardTechnique(n)||r.isTerrainTechnique(n)||r.isExtrudedPolygonTechnique(n))&&r.TEXTURE_PROPERTY_KEYS.forEach(e=>{const t=n[e];if(void 0===t)return;const s=t=>{const r=n[e+"Properties"];void 0!==r&&(void 0!==r.wrapS&&(t.wrapS=l.toWrappingMode(r.wrapS)),void 0!==r.wrapT&&(t.wrapT=l.toWrappingMode(r.wrapT)),void 0!==r.magFilter&&(t.magFilter=l.toTextureFilter(r.magFilter)),void 0!==r.minFilter&&(t.minFilter=l.toTextureFilter(r.minFilter)),void 0!==r.flipY&&(t.flipY=r.flipY),void 0!==r.repeatU&&(t.repeat.x=r.repeatU),void 0!==r.repeatV&&(t.repeat.y=r.repeatV)),m[e]=t,t.needsUpdate=!0,m.needsUpdate=!0,i&&i(t)},a=e=>{c.error("#createMaterial: Failed to load texture: ",e)};let h;if("string"==typeof t)h=t;else if(r.isTextureBuffer(t))if("image/raw"===t.type){const e=t.dataTextureProperties;if(void 0!==e){const i=e.type?l.toTextureDataType(e.type):void 0,r=function(e,t){if(void 0===t)return new Uint8Array(e);switch(t){case o.UnsignedByteType:return new Uint8Array(e);case o.ByteType:return new Int8Array(e);case o.ShortType:return new Int16Array(e);case o.UnsignedShortType:return new Uint16Array(e);case o.IntType:return new Int32Array(e);case o.UnsignedIntType:return new Uint32Array(e);case o.FloatType:return new Float32Array(e);case o.HalfFloatType:return new Uint16Array(e)}throw new Error("Unsupported texture data type")}(t.buffer,i);s(new o.DataTexture(r,e.width,e.height,e.format?l.toPixelFormat(e.format):void 0,i))}else a("no data texture properties provided.")}else{const e=new Blob([t.buffer],{type:t.type});h=URL.createObjectURL(e)}h&&(new o.TextureLoader).load(h,s,void 0,a)}),r.isShaderTechnique(n)?function(e,t){const i=e.params,n=v(e),s=n&&n in e.params;if(Object.getOwnPropertyNames(i).filter(e=>{if(n===e||s&&r.TRANSPARENCY_PROPERTY_KEYS.indexOf(e)!==-1){return false}const t=e;if(t==="name"){return false}return true}).forEach(e=>{u(t,e,i[e])}),s){const r=n;p(t,t[r],e,i[r])}}(n,m):function(e,i,n,s){const o=v(e),a=o&&o in e;Object.getOwnPropertyNames(e).filter(e=>{if(e.startsWith("_")||t.BASE_TECHNIQUE_NON_MATERIAL_PROPS.indexOf(e)!==-1||h.indexOf(e)!==-1||s!==undefined&&s.indexOf(e)!==-1){return false}if(o===e||a&&r.TRANSPARENCY_PROPERTY_KEYS.indexOf(e)!==-1){return false}const n=e;const l=i;if(typeof l[n]==="undefined"){return false}return true}).forEach(t=>{const r=e[t];void 0!==r&&u(i,t,r,n)}),a&&p(i,i[o],e,e[o],n)}(n,m,e.level,e.skipExtraProps),m},t.getBufferAttribute=function(e){switch(e.type){case"float":return new o.BufferAttribute(new Float32Array(e.buffer),e.itemCount);case"uint8":return new o.BufferAttribute(new Uint8Array(e.buffer),e.itemCount,e.normalized);case"uint16":return new o.BufferAttribute(new Uint16Array(e.buffer),e.itemCount,e.normalized);case"uint32":return new o.BufferAttribute(new Uint32Array(e.buffer),e.itemCount,e.normalized);case"int8":return new o.BufferAttribute(new Int8Array(e.buffer),e.itemCount,e.normalized);case"int16":return new o.BufferAttribute(new Int16Array(e.buffer),e.itemCount,e.normalized);case"int32":return new o.BufferAttribute(new Int32Array(e.buffer),e.itemCount,e.normalized);default:throw new Error(`unsupported buffer of type ${e.type}`)}},t.getObjectConstructor=function(e){if(void 0!==e.name)switch(e.name){case"extruded-line":case"standard":case"terrain":case"extruded-polygon":case"fill":case"dashed-line":case"solid-line":return o.Mesh;case"circles":return a.Circles;case"squares":return a.Squares;case"line":case"segments":return o.LineSegments;case"shader":if(!r.isShaderTechnique(e))throw new Error("Invalid technique");switch(e.primitive){case"line":return o.Line;case"segments":return o.LineSegments;case"point":return o.Points;case"mesh":return o.Mesh;default:return}case"text":case"labeled-icon":case"line-marker":case"label-rejection-line":return}},t.BASE_TECHNIQUE_NON_MATERIAL_PROPS=["name","id","renderOrder","transient"],t.getMaterialConstructor=d,t.evaluateBaseColorProperty=function(e,t){const i=function(e){const t=v(e);if(void 0!==t){if(r.isShaderTechnique(e)){return e.params[t]}return e[t]}return}(e);if(void 0!==i)return g(i,t)},t.applySecondaryColorToMaterial=m,t.applyBaseColorToMaterial=p,t.evaluateColorProperty=g},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(6),n=i(1),s=i(0),o=i(35);t.poiIsRenderable=function(e){return void 0!==e.poiRenderBatch},function(e){e[e.Requested=0]="Requested",e[e.Loaded=1]="Loaded",e[e.Initialized=2]="Initialized"}(t.LoadingState||(t.LoadingState={}));t.TextElement=class{constructor(e,t,i,n,a=0,l=0,c=0,h,d,u,m,p){this.text=e,this.points=t,this.renderParams=i,this.layoutParams=n,this.priority=a,this.xOffset=l,this.yOffset=c,this.featureId=h,this.style=d,this.fadeNear=u,this.fadeFar=m,this.tileOffset=p,this.visible=!0,this.distanceScale=.5,this.renderOrder=0,i instanceof r.TextRenderStyle&&(this.renderStyle=i),n instanceof r.TextLayoutStyle&&(this.layoutStyle=n),this.type=t instanceof s.Vector3?o.TextElementType.PoiLabel:o.TextElementType.PathLabel}get position(){if(this.points instanceof Array){return this.points[0]}return this.points}get path(){if(this.points instanceof Array)return this.points}get textMayOverlap(){return!0===this.mayOverlap}set textMayOverlap(e){this.mayOverlap=e}get textReservesSpace(){return!1!==this.reserveSpace}set textReservesSpace(e){this.reserveSpace=e}get poiInfo(){return this.m_poiInfo}set poiInfo(e){if(this.m_poiInfo=e,void 0!==e){void 0!==this.path&&(this.type=o.TextElementType.LineMarker);const t=void 0!==this.renderOrder?this.renderOrder:0;e.renderOrder=t}}get renderStyle(){return this.m_renderStyle}set renderStyle(e){this.m_renderStyle=e}get layoutStyle(){return this.m_layoutStyle}set layoutStyle(e){this.m_layoutStyle=e}hasFeatureId(){return void 0!==this.featureId&&0!==this.featureId}updateMinMaxZoomLevelsFromPoiInfo(){void 0!==this.poiInfo&&(void 0===this.minZoomLevel&&(this.minZoomLevel=n.MathUtils.min2(this.poiInfo.iconMinZoomLevel,this.poiInfo.textMinZoomLevel)),void 0===this.maxZoomLevel&&(this.maxZoomLevel=n.MathUtils.max2(this.poiInfo.iconMaxZoomLevel,this.poiInfo.textMaxZoomLevel)))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=r.LoggerManager.instance.create("Statistics");class s{constructor(e){this.capacity=e,this.buffer=new Array(e),this.capacity=e,this.head=this.tail=this.size=0}clear(){this.head=this.tail=this.size=0}enqOne(e){let t=this.head+1;t>=this.capacity&&(t=0),this.size<this.capacity&&this.size++,this.buffer[this.head]=e,this.head=t,this.size===this.capacity&&(this.tail=this.head)}enq(...e){for(const t of e)this.enqOne(t)}deq(){if(0===this.size)throw new Error("Ringbuffer underrun");const e=this.buffer[this.tail];let t=this.tail+1;return t>=this.capacity&&(t=0),this.size>0&&this.size--,this.tail=t,e}get top(){if(0===this.size)throw new Error("Ringbuffer underrun");return this.buffer[this.tail]}get bottom(){if(0===this.size)throw new Error("Ringbuffer underrun");let e=this.head-1;return e<0&&(e=this.capacity-1),this.buffer[e]}iterator(){return new s.Iterator(this)}asArray(){const e=new Array;for(let t=0;t<this.size;t++)e.push(this.buffer[(this.tail+t)%this.capacity]);return e}}t.RingBuffer=s,function(e){e.Iterator=class{constructor(e,t=0){this.m_buffer=e,this.m_index=t}get value(){return this.m_buffer.buffer[(this.m_buffer.tail+this.m_index)%this.m_buffer.capacity]}next(){return this.m_index++,this.m_index<this.m_buffer.size}}}(s=t.RingBuffer||(t.RingBuffer={}));class o{constructor(e,t){this.statistics=e,this.name=t,this.running=!1}get value(){return this.m_currentValue}setValue(e){this.m_currentValue=e}reset(){this.m_currentValue=void 0}start(){if(!this.statistics.enabled)return-1;if(this.running)throw new Error("Timer '"+this.name+"' is already running");return this.running=!0,this.m_currentValue=r.PerformanceTimer.now()}stop(){if(!this.statistics.enabled)return-1;if(this.running){const e=r.PerformanceTimer.now()-(this.m_currentValue||0);return this.m_currentValue=e,this.setValue(e),this.running=!1,e}throw new Error("Timer '"+this.name+"' has not been started")}now(){if(!this.statistics.enabled)return-1;if(this.running){return r.PerformanceTimer.now()-(this.m_currentValue||0)}throw new Error("Timer '"+this.name+"' has not been started")}}t.SimpleTimer=o;class a extends o{constructor(e,t){super(e,t),this.statistics=e,this.name=t,this.numResets=0,this.maxNumSamples=1e3,this.samples=new s(this.maxNumSamples)}reset(){super.reset(),this.getStats(),this.samples.clear(),this.numResets++}setValue(e){super.setValue(e),void 0!==e&&this.samples.enqOne(e)}getStats(){return l(this.samples.asArray())}}function l(e){if(0===e.length)return;e.sort((e,t)=>e-t);const t=e[0],i=e[e.length-1];let r,n,s,o,a,l,c;if(1===e.length)n=s=o=a=l=c=r=e[0];else if(2===e.length)r=.5*e[0]+.5*e[1],n=s=o=a=l=c=e[1];else{const t=Math.floor(e.length/2);r=e.length%2==0?.5*e[t-1]+.5*e[t]:e[t],n=e[Math.round(.75*e.length)-1],s=e[Math.round(.9*e.length)-1],o=e[Math.round(.95*e.length)-1],a=e[Math.round(.97*e.length)-1],l=e[Math.round(.99*e.length)-1],c=e[Math.round(.999*e.length)-1]}let h=0;for(let t=0,i=e.length;t<i;t++)h+=e[t];return{min:t,max:i,avg:h/e.length,median:r,median75:n,median90:s,median95:o,median97:a,median99:l,median999:c,numSamples:e.length}}t.SampledTimer=a,t.computeArrayStats=l,t.computeArrayAverage=function(e){if(0===e.length)return;let t=0;for(let i=0,r=e.length;i<r;i++)t+=e[i];return t/e.length};t.MultiStageTimer=class{constructor(e,t,i){if(this.statistics=e,this.name=t,this.stages=i,i.length<1)throw new Error("MultiStageTimer needs stages");i.forEach(t=>{if(!e.hasTimer(t))throw new Error("Unknown timer: "+t)})}get value(){return this.statistics.getTimer(this.stages[this.stages.length-1]).value}reset(){this.statistics.enabled&&this.stages.forEach(e=>{this.statistics.getTimer(e).reset()})}start(){return this.stage=this.stages[0],this.statistics.getTimer(this.stages[0]).value||-1}stop(){return this.stage=void 0,void 0!==this.value?this.value:-1}get stage(){return this.currentStage}set stage(e){this.currentStage!==e&&(this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).stop(),this.currentStage=e,this.statistics.enabled&&void 0!==this.currentStage&&this.statistics.getTimer(this.currentStage).start())}};t.Statistics=class{constructor(e,t=!1){this.name=e,this.enabled=t,this.timers=new Map,this.nullTimer=new o(this,"<null>")}createTimer(e,t=!0){const i=t?new a(this,e):new o(this,e);return this.addTimer(i)}addTimer(e){if(void 0!==this.timers.get(e.name))throw new Error("Duplicate timer name: '"+e.name+"'");return this.timers.set(e.name,e),e}getTimer(e){if(!this.enabled)return this.nullTimer;const t=this.timers.get(e);return void 0===t?this.nullTimer:t}hasTimer(e){return void 0!==this.timers.get(e)}reset(){this.timers.forEach(e=>{e.reset()})}log(e,t){void 0===e&&void 0===this.name||n.log(void 0!==e?e:this.name);let i=0;this.timers.forEach(e=>{i=Math.max(i,e.name.length)});const r=e=>void 0!==e?e.toFixed(5):"?";this.timers.forEach(e=>{let t=e.name+": "+" ".repeat(i-e.name.length);if(t+=r(e.value),e instanceof a){const i=e.getStats();void 0!==i&&(t+=`  [ min=${r(i.min)}, max=${r(i.max)}, `+`avg=${r(i.avg)}, med=${r(i.median)}, `+`med95=${r(i.median95)}, med99=${r(i.median99)}, `+`N=${r(i.numSamples)} ]`)}n.log(t)}),void 0!==t&&n.log(t)}};class c{constructor(){this.entries=new Map,this.messages=void 0}getValue(e){return this.entries.get(e)}setValue(e,t){this.entries.set(e,t)}addValue(e,t){const i=this.entries.get(e);this.entries.set(e,t+(void 0===i?0:i))}addMessage(e){void 0===this.messages&&(this.messages=[]),this.messages.push(e)}reset(){this.entries.forEach((e,t)=>{this.entries.set(t,0)}),this.messages=void 0}}t.FrameStats=c;class h{constructor(e=0){this.capacity=e,this.frameEntries=new Map,this.messages=new s(e)}get length(){return this.messages.size}reset(){this.frameEntries.forEach((e,t)=>{e.clear()}),this.messages.clear()}addFrame(e){const t=this.length,i=this.frameEntries;e.entries.forEach((e,r)=>{let n=i.get(r);if(void 0===n){n=new s(this.capacity);for(let e=0;e<t;e++)n.enqOne(0);this.frameEntries.set(r,n)}n.enqOne(e)}),this.messages.enq(e.messages)}log(){let e=0;this.frameEntries.forEach((t,i)=>{e=Math.max(e,i.length)});const t=e=>void 0!==e?e.toFixed(5):"?";this.frameEntries.forEach((i,r)=>{let s=r+": "+" ".repeat(e-r.length);const o=l(i.asArray());void 0!==o&&(s+=`  [ min=${t(o.min)}, max=${t(o.max)}, `+`avg=${t(o.avg)}, med=${t(o.median)}, `+`med95=${t(o.median95)}, med99=${t(o.median99)}, `+`N=${t(o.numSamples)} ]`),n.log(s)})}}t.FrameStatsArray=h;class d{constructor(e=!0,t=1e3){this.enabled=e,this.maxNumFrames=t,this.currentFrame=new c,this.appResults=new Map,this.configs=new Map,d.m_instance=this,this.m_frameEvents=new h(t)}get isFull(){return this.m_frameEvents.length>=this.maxNumFrames}static get instance(){return void 0===d.m_instance&&(d.m_instance=new d(!1,0)),d.m_instance}get frameEvents(){return this.m_frameEvents}clear(){this.clearFrames(),this.configs.clear(),this.appResults.clear()}clearFrames(){this.m_frameEvents.reset(),this.currentFrame.reset()}storeFrameInfo(e){if(this.m_frameEvents.length>=this.maxNumFrames)return!1;if(void 0!==e&&(void 0!==e.render&&(this.currentFrame.setValue("gl.numCalls",null===e.render.calls?0:e.render.calls),this.currentFrame.setValue("gl.numPoints",null===e.render.points?0:e.render.points),this.currentFrame.setValue("gl.numLines",null===e.render.lines?0:e.render.lines),this.currentFrame.setValue("gl.numTriangles",null===e.render.triangles?0:e.render.triangles)),void 0!==e.memory&&(this.currentFrame.setValue("gl.numGeometries",null===e.memory.geometries?0:e.memory.geometries),this.currentFrame.setValue("gl.numTextures",null===e.memory.textures?0:e.memory.textures)),void 0!==e.programs&&this.currentFrame.setValue("gl.numPrograms",null===e.programs?0:e.programs.length)),void 0!==window&&void 0!==window.performance){const e=window.performance.memory;void 0!==e&&(this.currentFrame.setValue("memory.totalJSHeapSize",e.totalJSHeapSize),this.currentFrame.setValue("memory.usedJSHeapSize",e.usedJSHeapSize),this.currentFrame.setValue("memory.jsHeapSizeLimit",e.jsHeapSizeLimit))}return this.m_frameEvents.addFrame(this.currentFrame),this.currentFrame.reset(),!0}log(e,t){n.log(void 0!==e?e:"PerformanceStatistics"),this.appResults.forEach((e,t)=>{n.log(t,e)}),this.configs.forEach((e,t)=>{n.log(t,e)}),this.m_frameEvents.log(),void 0!==t&&n.log(t)}getAsPlainObject(e=!1){const t={},i={},r={},n={configs:i,appResults:t,frames:r};if(this.appResults.forEach((e,i)=>{t[i]=e}),this.configs.forEach((e,t)=>{i[t]=e}),e)for(const[e,t]of this.m_frameEvents.frameEntries)r[e]=t.bottom;else for(const[e,t]of this.m_frameEvents.frameEntries)r[e]=t.asArray();return n.messages=this.m_frameEvents.messages.asArray(),n}getLastFrameStatistics(){return this.getAsPlainObject(!0)}getAsSimpleFrameStatistics(e=!1){const t=new Map,i=new Map,r=new Map,n={configs:t,appResults:i,frames:r,messages:this.m_frameEvents.messages.asArray()};if(this.appResults.forEach((e,t)=>{i.set(t,e)}),this.configs.forEach((e,i)=>{t.set(i,e)}),e)for(const[e,t]of this.m_frameEvents.frameEntries)r.set(e,t.bottom);else for(const[e,t]of this.m_frameEvents.frameEntries)r.set(e,t.asArray());return n}}t.PerformanceStatistics=d,d.m_instance=void 0},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);class n{constructor(){this.enabled=!1,this.renderToScreen=!1}setSize(e,t){}render(e,t,i,r,n,s){}}t.Pass=n;t.RenderPass=class extends n{constructor(){super()}render(e,t,i,r,n){e.setRenderTarget(this.renderToScreen?null:r),e.render(t,i)}};t.ShaderPass=class extends n{constructor(e,t="tDiffuse"){super(),this.textureID=t,e instanceof r.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=r.UniformsUtils.clone(e.uniforms),this.material=new r.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new s(this.material)}render(e,t,i,r,n,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,e.setRenderTarget(this.renderToScreen?null:r),this.fsQuad.render(e)}};class s{constructor(e){this.m_camera=new r.OrthographicCamera(-1,1,1,-1,0,1);const t=new r.PlaneBufferGeometry(2,2);this.m_mesh=new r.Mesh(t,e)}get material(){return this.m_mesh.material}set material(e){this.m_mesh.material=e}render(e){e.render(this.m_mesh,this.m_camera)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(15),n=i(7),s=i(11),o=i(8),a=i(12),l=i(10),c=i(13);class h extends c.Projection{constructor(){super(...arguments),this.type=c.ProjectionType.Planar}static clamp(e,t,i){return Math.min(Math.max(t,e),i)}static latitudeClamp(e){return h.clamp(e,-d.MAXIMUM_LATITUDE,d.MAXIMUM_LATITUDE)}static latitudeProject(e){return Math.log(Math.tan(.25*Math.PI+.5*e))/Math.PI}static latitudeClampProject(e){return h.latitudeProject(h.latitudeClamp(e))}static unprojectLatitude(e){return 2*Math.atan(Math.exp(Math.PI*e))-.5*Math.PI}getScaleFactor(e){return Math.cosh(2*Math.PI*(e.y/this.unitScale-.5))}worldExtent(e,t,i){return i||(i=o.MathUtils.newEmptyBox3()),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale,i.max.z=t,i}projectPoint(e,t){let i;return i=e instanceof n.GeoCoordinates?e:new n.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(i.longitude+180)/360*this.unitScale,t.y=(.5*h.latitudeClampProject(i.latitudeInRadians)+.5)*this.unitScale,t.z=i.altitude||0,t}unprojectPoint(e){return n.GeoCoordinates.fromRadians(h.unprojectLatitude(2*(e.y/this.unitScale-.5)),e.x/this.unitScale*2*Math.PI-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){const i=this.projectPoint(e.center),r=(.5*h.latitudeClampProject(e.northEast.latitudeInRadians)+.5)*this.unitScale,n=(.5*h.latitudeClampProject(e.southWest.latitudeInRadians)+.5)*this.unitScale,l=.5*(r+n);i.y=l;const c=r-n,d=e.longitudeSpan/360*this.unitScale;if(t||(t=o.MathUtils.newEmptyBox3()),s.isBox3Like(t)){t.min.x=i.x-.5*d,t.min.y=i.y-.5*c,t.max.x=i.x+.5*d,t.max.y=i.y+.5*c;const r=e.altitudeSpan;void 0!==r?(t.min.z=i.z-.5*r,t.max.z=i.z+.5*r):(t.min.z=0,t.max.z=0)}else{if(!a.isOrientedBox3Like(t))throw new Error("invalid bounding box");o.MathUtils.newVector3(1,0,0,t.xAxis),o.MathUtils.newVector3(0,1,0,t.yAxis),o.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=i.x,t.position.y=i.y,t.position.z=i.z,t.extents.x=.5*d,t.extents.y=.5*c,t.extents.z=Math.max(Number.EPSILON,.5*(e.altitudeSpan||0))}return t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}reprojectPoint(e,i,r){return e===this||e!==t.webMercatorProjection&&e!==t.mercatorProjection?super.reprojectPoint(e,i,r):(void 0===r&&(r={}),r.x=i.x,r.y=this.unitScale-i.y,r.z=i.z,r)}}class d{}t.MercatorConstants=d,d.MAXIMUM_LATITUDE=1.4844222297453322,t.mercatorProjection=new h(l.EarthConstants.EQUATORIAL_CIRCUMFERENCE),t.webMercatorProjection=new class extends h{projectPoint(e,t){let i;i=e instanceof n.GeoCoordinates?e:new n.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(i.longitude+180)/360*this.unitScale;const r=Math.sin(h.latitudeClamp(i.latitudeInRadians));return t.y=(.5-Math.log((1+r)/(1-r))/(4*Math.PI))*this.unitScale,t.z=i.altitude||0,t}unprojectPoint(e){const t=e.x/this.unitScale-.5,i=.5-e.y/this.unitScale,r=360*t,s=90-360*Math.atan(Math.exp(2*-i*Math.PI))/Math.PI;return new n.GeoCoordinates(s,r,e.z)}projectBox(e,t){const i=super.projectBox(e,t);if(s.isBox3Like(i)){const e=i.max.y;i.max.y=this.unitScale-i.min.y,i.min.y=this.unitScale-e}else a.isOrientedBox3Like(i)&&(o.MathUtils.newVector3(1,0,0,i.xAxis),o.MathUtils.newVector3(0,-1,0,i.yAxis),o.MathUtils.newVector3(0,0,-1,i.zAxis),i.position.y=this.unitScale-i.position.y);return i}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return new r.GeoBox(new n.GeoCoordinates(i.latitude,t.longitude,t.altitude),new n.GeoCoordinates(t.latitude,i.longitude,i.altitude))}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}localTangentSpace(e,t){return this.projectPoint(e,t.position),o.MathUtils.newVector3(1,0,0,t.xAxis),o.MathUtils.newVector3(0,-1,0,t.yAxis),o.MathUtils.newVector3(0,0,-1,t.zAxis),t}}(l.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.quadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(){return 2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 1<<e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];class n{constructor(e,t,i){this.row=e,this.column=t,this.level=i}static fromRowColumnLevel(e,t,i){return new n(e,t,i)}static fromQuadKey(e){const t=e.length;let i=0,r=0;for(let n=0;n<e.length;++n){const s=1<<n,o=parseInt(e.charAt(t-n-1),10);1&o&&(r|=s),2&o&&(i|=s)}return n.fromRowColumnLevel(i,r,t)}static fromMortonCode(e){let t=0,i=0,r=0,s=e;for(;s>1;){const e=1<<t;1&s&&(r|=e),2&s&&(i|=e),t++,s=(s-(3&s))/4}const o=n.fromRowColumnLevel(i,r,t);return o.m_mortonCode=e,o}static fromHereTile(e){const t=n.fromMortonCode(parseInt(e,10));return t.m_hereTile=e,t}static columnsAtLevel(e){return Math.pow(2,e)}static rowsAtLevel(e){return Math.pow(2,e)}static atCoords(e,t,i,r,s){return n.fromRowColumnLevel(Math.floor(i/(s/n.rowsAtLevel(e))),Math.floor(t/(r/n.columnsAtLevel(e))),e)}static parentMortonCode(e){return Math.floor(e/4)}parent(){if(0===this.level)throw new Error("Cannot get the parent of the root tile key");return n.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)}changedLevelBy(e){const t=Math.max(0,this.level+e);let i=this.row,r=this.column;return e>=0?(i<<=e,r<<=e):(i>>>=-e,r>>>=-e),n.fromRowColumnLevel(i,r,t)}changedLevelTo(e){return this.changedLevelBy(e-this.level)}mortonCode(){if(void 0===this.m_mortonCode){let e=this.column,t=this.row,i=r[this.level<<1];for(let n=0;n<this.level;++n)1&e&&(i+=r[2*n]),1&t&&(i+=r[2*n+1]),e>>>=1,t>>>=1;this.m_mortonCode=i}return this.m_mortonCode}toHereTile(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile}toQuadKey(){let e="";for(let t=this.level;t>0;--t){const i=1<<t-1,r=0!=(this.column&i),n=0!=(this.row&i);e+=r&&n?"3":n?"2":r?"1":"0"}return e}equals(e){return this.row===e.row&&this.column===e.column&&this.level===e.level}addedSubKey(e){const t=n.fromQuadKey(0===e.length?"-":e),i=this.changedLevelBy(t.level);return n.fromRowColumnLevel(i.row+t.row,i.column+t.column,i.level)}addedSubHereTile(e){const t=n.fromHereTile(e),i=this.changedLevelBy(t.level);return n.fromRowColumnLevel(i.row+t.row,i.column+t.column,i.level)}getSubHereTile(e){const t=1<<2*e;return(this.mortonCode()&t-1|t).toString()}rowCount(){return n.rowsAtLevel(this.level)}columnCount(){return n.columnsAtLevel(this.level)}}t.TileKey=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(3),s=i(1),o=i(0),a=i(39),l=i(180),c=i(88),h=i(89),d=i(90),u=i(53),m=i(54),p=i(208),f=i(210),g=i(211),v=i(96),y=i(97),_=i(99),x=i(37),T=i(100),S=i(213),w=i(101),b=i(102),M=i(218),E=i(219),P=i(220),C=i(24),A=i(222),L=i(223),R=i(224),F=i(36),D=i(81),O=i(105),I=i(9),U=i(106),z=!0;var k;z?s.LoggerManager.instance.setLogLevelForAll(s.LogLevel.Error):s.LoggerManager.instance.setLogLevelForAll(s.LogLevel.Log),function(e){e.Update="update",e.Resize="resize",e.Render="render",e.AfterRender="didrender",e.FirstFrame="first-render",e.FrameComplete="frame-complete",e.ThemeLoaded="theme-loaded",e.AnimationStarted="animation-started",e.AnimationFinished="animation-finished",e.MovementStarted="movement-started",e.MovementFinished="movement-finished",e.DataSourceConnect="datasource-connect",e.CopyrightChanged="copyright-changed",e.ContextLost="webglcontext-lost",e.ContextRestored="webglcontext-restored",e.CameraPositionChanged="camera-changed"}(k=t.MapViewEventNames||(t.MapViewEventNames={}));const G=s.LoggerManager.instance.create("MapView"),V=15722977,B={type:"dynamic",fov:40},j=.1,N=4e6,q=140,W=10;t.FALLBACK_RENDER_ORDER_OFFSET=2e4;const H=1,K=20,$=20,X=12,Y=30,Z=4,Q="polar",J={type:k.Update},ee={type:k.Render},te={type:k.AfterRender},ie={type:k.FirstFrame},re={type:k.FrameComplete},ne={type:k.ThemeLoaded},se={type:k.AnimationStarted},oe={type:k.AnimationFinished},ae={type:k.MovementStarted},le={type:k.MovementFinished},ce={type:k.ContextLost},he={type:k.ContextRestored},de={type:k.CopyrightChanged},ue={vector2:[new o.Vector2],vector3:[new o.Vector3]};var me;!function(e){e.Default="default",e.LowPower="low-power",e.HighPerformance="high-performance"}(me=t.MapViewPowerPreference||(t.MapViewPowerPreference={})),t.MapViewDefaults={projection:n.mercatorProjection,maxVisibleDataSourceTiles:120,extendedFrustumCulling:!0,tileCacheSize:200,resourceComputationType:U.ResourceComputationType.EstimationInMb,quadTreeSearchDistanceUp:3,quadTreeSearchDistanceDown:2,pixelRatio:"undefined"!=typeof window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1,geoCenter:new n.GeoCoordinates(25,0,3e7),target:new n.GeoCoordinates(25,0),zoomLevel:5,tilt:0,heading:0};class pe extends o.EventDispatcher{constructor(e){super(),this.dumpNext=!1,this.m_renderLabels=!0,this.m_screenCollisions=new M.ScreenCollisions,this.m_visibleTileSetLock=!1,this.m_tileWrappingEnabled=!0,this.m_zoomLevel=H,this.m_minZoomLevel=H,this.m_maxZoomLevel=K,this.m_minCameraHeight=$,this.m_screenCamera=new o.OrthographicCamera(-1,1,1,-1),this.m_rteCamera=new o.PerspectiveCamera,this.m_viewRanges={near:j,far:N,minimum:j,maximum:N},this.m_scene=new o.Scene,this.m_fog=new _.MapViewFog(this.m_scene),this.m_mapTilesRoot=new o.Object3D,this.m_mapAnchors=new o.Object3D,this.m_animationCount=0,this.m_drawing=!1,this.m_updatePending=!1,this.m_frameNumber=0,this.m_maxFps=0,this.m_detectedFps=Y,this.m_forceCameraAspect=void 0,this.m_tileDataSources=[],this.m_connectedDataSources=new Set,this.m_failedDataSources=new Set,this.m_enablePolarDataSource=!0,this.m_raycaster=new o.Raycaster,this.m_plane=new o.Plane(new o.Vector3(0,0,1)),this.m_sphere=new o.Sphere(void 0,n.EarthConstants.EQUATORIAL_RADIUS),this.m_theme={},this.m_themeIsLoading=!1,this.m_firstFrameRendered=!1,this.m_firstFrameComplete=!1,this.m_initialTextPlacementDone=!1,this.m_frameTimeIndex=0,this.m_frameTimeRing=[],this.m_imageCache=new y.MapViewImageCache(this),this.m_poiManager=new T.PoiManager(this),this.m_poiTableManager=new w.PoiTableManager(this),this.m_lastTileIds="",this.m_copyrightInfo=[],this.onWebGLContextLost=e=>{this.dispatchEvent(ce),G.warn("WebGL context lost",e)},this.onWebGLContextRestored=e=>{this.dispatchEvent(he),void 0!==this.m_renderer&&(void 0!==this.m_theme&&void 0!==this.m_theme.clearColor?this.m_renderer.setClearColor(new o.Color(this.m_theme.clearColor)):this.m_renderer.setClearColor(V),this.update()),G.warn("WebGL context restored",e)},this.m_options=Object.assign({},e),this.m_uriResolver=this.m_options.uriResolver,void 0!==this.m_options.minZoomLevel&&(this.m_minZoomLevel=this.m_options.minZoomLevel),void 0!==this.m_options.maxZoomLevel&&(this.m_maxZoomLevel=this.m_options.maxZoomLevel),void 0!==this.m_options.minCameraHeight&&(this.m_minCameraHeight=this.m_options.minCameraHeight),void 0!==this.m_options.decoderUrl&&(u.ConcurrentDecoderFacade.defaultScriptUrl=this.m_uriResolver?this.m_uriResolver.resolveUri(this.m_options.decoderUrl):this.m_options.decoderUrl),void 0!==this.m_options.decoderCount&&(u.ConcurrentDecoderFacade.defaultWorkerCount=this.m_options.decoderCount),this.m_visibleTileSetOptions=Object.assign(Object.assign({},t.MapViewDefaults),{clipPlanesEvaluator:void 0!==e.clipPlanesEvaluator?e.clipPlanesEvaluator:h.createDefaultClipPlanesEvaluator()}),void 0!==e.projection&&(this.m_visibleTileSetOptions.projection=e.projection),void 0!==e.extendedFrustumCulling&&(this.m_visibleTileSetOptions.extendedFrustumCulling=e.extendedFrustumCulling),void 0!==e.maxVisibleDataSourceTiles&&(this.m_visibleTileSetOptions.maxVisibleDataSourceTiles=e.maxVisibleDataSourceTiles),void 0!==e.tileCacheSize&&(this.m_visibleTileSetOptions.tileCacheSize=e.tileCacheSize),void 0!==e.resourceComputationType&&(this.m_visibleTileSetOptions.resourceComputationType=e.resourceComputationType),void 0!==e.quadTreeSearchDistanceUp&&(this.m_visibleTileSetOptions.quadTreeSearchDistanceUp=e.quadTreeSearchDistanceUp),void 0!==e.quadTreeSearchDistanceDown&&(this.m_visibleTileSetOptions.quadTreeSearchDistanceDown=e.quadTreeSearchDistanceDown),void 0!==e.enablePolarDataSource&&(this.m_enablePolarDataSource=e.enablePolarDataSource),this.m_pixelRatio=e.pixelRatio,void 0!==e.maxFps&&(this.m_maxFps=Math.max(0,e.maxFps)),this.m_options.enableStatistics=!0===this.m_options.enableStatistics,this.m_languages=this.m_options.languages,z||void 0===this.m_options.collisionDebugCanvas||null===this.m_options.collisionDebugCanvas||(this.m_collisionDebugCanvas=this.m_options.collisionDebugCanvas,this.m_screenCollisions=new M.ScreenCollisionsDebug(this.m_collisionDebugCanvas)),this.handleRequestAnimationFrame=this.renderFunc.bind(this),this.handlePostponedAnimationFrame=this.postponedAnimationFrame.bind(this),this.m_pickHandler=new x.PickHandler(this,this.m_rteCamera,!0===this.m_options.enableRoadPicking),void 0!==this.m_options.tileWrappingEnabled&&(this.m_tileWrappingEnabled=this.m_options.tileWrappingEnabled),this.setupStats(this.m_options.enableStatistics),this.canvas.addEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.addEventListener("webglcontextrestored",this.onWebGLContextRestored),this.m_renderer=new o.WebGLRenderer({canvas:this.canvas,antialias:this.nativeWebglAntialiasEnabled,alpha:this.m_options.alpha,preserveDrawingBuffer:!0===this.m_options.preserveDrawingBuffer,powerPreference:void 0===this.m_options.powerPreference?me.Default:this.m_options.powerPreference}),this.m_renderer.autoClear=!1,this.m_renderer.localClippingEnabled=!0,this.m_renderer.info.autoReset=!1,this.setupRenderer(),this.m_options.fovCalculation=void 0===this.m_options.fovCalculation?B:this.m_options.fovCalculation,this.m_options.fovCalculation.fov=o.Math.clamp(this.m_options.fovCalculation.fov,W,q);const{width:i,height:r}=this.getCanvasClientSize(),s=i/r;this.m_camera=new o.PerspectiveCamera(this.m_options.fovCalculation.fov,s,j,N),this.m_camera.up.set(0,0,1),this.m_lookAtDistance=0,this.m_focalLength=0,this.m_scene.add(this.m_camera),this.m_screenProjector=new E.ScreenProjector(this.m_camera),this.setupCamera(e),this.m_movementDetector=new c.CameraMovementDetector(this.m_options.movementThrottleTimeout,()=>this.movementStarted(),()=>this.movementFinished());const m=this.m_options.customAntialiasSettings;if(this.mapRenderingManager=new d.MapRenderingManager(i,r,this.m_options.dynamicPixelRatio,m),this.m_tileGeometryManager=!0===this.m_options.enablePhasedLoading?new g.PhasedTileGeometryManager(this):new v.SimpleTileGeometryManager(this),this.m_visibleTiles=new U.VisibleTileSet(new p.FrustumIntersection(this.m_camera,this,this.m_visibleTileSetOptions.extendedFrustumCulling,this.m_tileWrappingEnabled),this.m_tileGeometryManager,this.m_visibleTileSetOptions),this.m_animatedExtrusionHandler=new a.AnimatedExtrusionHandler(this),this.m_backgroundDataSource=new l.BackgroundDataSource,this.addDataSource(this.m_backgroundDataSource),this.m_enablePolarDataSource){const t=void 0!==e.polarStyleSetName?e.polarStyleSetName:Q;this.m_polarDataSource=new b.PolarTileDataSource({styleSetName:t,geometryLevelOffset:e.polarGeometryLevelOffset}),this.updatePolarDataSource()}void 0!==e.backgroundTilingScheme&&this.m_backgroundDataSource.setTilingScheme(e.backgroundTilingScheme),this.initTheme(),this.m_textElementsRenderer=this.createTextRenderer(),this.drawFrame()}get renderLabels(){return this.m_renderLabels}set renderLabels(e){this.m_renderLabels=e}get textElementsRenderer(){return this.m_textElementsRenderer}get cameraMovementDetector(){return this.m_movementDetector}get animatedExtrusionHandler(){return this.m_animatedExtrusionHandler}get tileGeometryManager(){return this.m_tileGeometryManager}dispose(){this.m_movementFinishedUpdateTimerId&&(clearTimeout(this.m_movementFinishedUpdateTimerId),this.m_movementFinishedUpdateTimerId=void 0),void 0!==this.m_animationFrameHandle&&(cancelAnimationFrame(this.m_animationFrameHandle),this.m_animationFrameHandle=void 0),this.canvas.removeEventListener("webglcontextlost",this.onWebGLContextLost),this.canvas.removeEventListener("webglcontextrestored",this.onWebGLContextRestored);for(const e of this.m_tileDataSources)e.dispose();this.m_visibleTiles.clearTileCache(),this.m_textElementsRenderer.clearRenderStates(),this.m_renderer.dispose(),this.m_imageCache.clear(),this.m_movementDetector.dispose()}get resourceComputationType(){return this.m_visibleTiles.resourceComputationType}set resourceComputationType(e){this.m_visibleTiles.resourceComputationType=e}getCacheSize(){return this.m_visibleTiles.getDataSourceCacheSize()}setCacheSize(e,t){this.m_visibleTiles.setDataSourceCacheSize(e),t=void 0!==t?t:e/2,this.m_visibleTiles.setNumberOfVisibleTiles(Math.floor(t)),this.updateImages(),this.updateLighting(),this.m_textElementsRenderer.invalidateCache(),this.updateSkyBackground(),this.update()}get extendedFrustumCulling(){return void 0===this.m_options.extendedFrustumCulling||this.m_visibleTileSetOptions.extendedFrustumCulling}set extendedFrustumCulling(e){this.m_visibleTileSetOptions.extendedFrustumCulling=e}get lockVisibleTileSet(){return this.m_visibleTileSetLock}set lockVisibleTileSet(e){this.m_visibleTileSetLock=e}get pointOfView(){return this.m_pointOfView}set pointOfView(e){this.m_pointOfView=e,this.update()}loadPostEffects(e){fetch(e).then(e=>e.json()).then(e=>{this.m_postEffects=e,this.setPostEffects()})}get postEffects(){return this.m_postEffects}set postEffects(e){this.m_postEffects=e,this.setPostEffects()}get theme(){return this.m_theme}set theme(e){if(!O.ThemeLoader.isThemeLoaded(e))return this.m_themeIsLoading=!0,void O.ThemeLoader.load(e,{uriResolver:this.m_uriResolver}).then(e=>{this.m_themeIsLoading=!1,this.theme=e}).catch(e=>{this.m_themeIsLoading=!1,G.error(`failed to set theme: ${e}`,e)});this.m_theme.fog=e.fog,this.m_theme.sky=e.sky,this.updateSkyBackground(),this.m_fog.reset(this.m_theme),this.m_theme.lights=e.lights,this.updateLighting(),this.m_theme.clearColor=e.clearColor,this.renderer.setClearColor(new o.Color(e.clearColor)),this.m_theme.images=e.images,this.m_theme.imageTextures=e.imageTextures,this.updateImages(),this.m_theme.poiTables=e.poiTables,this.loadPoiTables(),this.m_theme.textStyles=e.textStyles,this.m_theme.defaultTextStyle=e.defaultTextStyle,this.m_theme.fontCatalogs=e.fontCatalogs,this.resetTextRenderer(),void 0===this.m_theme.styles&&(this.m_theme.styles={}),this.m_backgroundDataSource&&this.m_backgroundDataSource.setTheme(this.m_theme),this.m_theme.styles=e.styles||{},this.m_theme.definitions=e.definitions;for(const e of this.m_tileDataSources)e.setTheme(this.m_theme);this.dispatchEvent(ne),this.update()}get uriResolver(){return this.m_uriResolver}get forceCameraAspect(){return this.m_forceCameraAspect}set forceCameraAspect(e){this.m_forceCameraAspect=e}set maxFps(e){this.m_maxFps=Math.max(0,e)}get maxFps(){return Math.max(0,this.m_maxFps)}get languages(){return this.m_languages}set languages(e){this.m_languages=e,this.m_tileDataSources.forEach(e=>{e.setLanguages(this.m_languages)}),this.update()}get copyrightInfo(){return this.m_copyrightInfo}set disableFading(e){this.m_textElementsRenderer.disableFading=e}get disableFading(){return this.m_textElementsRenderer.disableFading}get frameNumber(){return this.m_frameNumber}resetFrameNumber(){this.m_frameNumber=0,this.m_previousFrameTimeStamp=void 0}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}get canvas(){return this.m_options.canvas}get collisionDebugCanvas(){return this.m_collisionDebugCanvas}get scene(){return this.m_scene}get camera(){return this.m_camera}get renderer(){return this.m_renderer}get clearColor(){const e=this.m_renderer.getClearColor();return void 0!==e?e.getHex():0}set clearColor(e){this.m_renderer.setClearColor(e)}get projection(){return this.m_visibleTileSetOptions.projection}set projection(e){const t=I.MapViewUtils.rayCastWorldCoordinates(this,0,0);if(null===t)throw new Error("MapView does not support a view pointing in the void.");const i=this.projection.unprojectPoint(t),r=this.camera.position.distanceTo(t),n=I.MapViewUtils.extractAttitude(this,this.camera),s=o.Math.radToDeg(n.pitch),a=-o.Math.radToDeg(n.yaw);this.m_visibleTileSetOptions.projection=e,this.updatePolarDataSource(),this.clearTileCache(),this.textElementsRenderer.clearRenderStates(),this.m_visibleTiles=new U.VisibleTileSet(new p.FrustumIntersection(this.m_camera,this,this.m_visibleTileSetOptions.extendedFrustumCulling,this.m_tileWrappingEnabled),this.m_tileGeometryManager,this.m_visibleTileSetOptions),this.lookAt(i,r,s,a)}get clipPlanesEvaluator(){return this.m_visibleTileSetOptions.clipPlanesEvaluator}set clipPlanesEvaluator(e){this.m_visibleTileSetOptions.clipPlanesEvaluator=e}get focalLength(){return this.m_focalLength}get lookAtDistance(){return this.m_lookAtDistance}get viewRanges(){return this.m_viewRanges}get geoCenter(){return this.projection.unprojectPoint(this.m_camera.position).normalized()}set geoCenter(e){if(void 0!==e.altitude)this.projection.projectPoint(e,this.m_camera.position);else{const t=this.geoCenter.altitude;this.projection.projectPoint(new n.GeoCoordinates(e.latitude,e.longitude,t),this.m_camera.position)}this.update()}get mapAnchors(){return this.m_mapAnchors}get worldCenter(){return this.m_camera.position}get worldRootObject(){return this.m_mapTilesRoot}get pickHandler(){return this.m_pickHandler}get imageCache(){return this.m_imageCache}get poiManager(){return this.m_poiManager}get poiTableManager(){return this.m_poiTableManager}get minCameraHeight(){return this.m_minCameraHeight}get minZoomLevel(){return this.m_minZoomLevel}set minZoomLevel(e){this.m_minZoomLevel=e,this.update()}get maxZoomLevel(){return this.m_maxZoomLevel}set maxZoomLevel(e){this.m_maxZoomLevel=e,this.update()}get zoomLevel(){return this.m_zoomLevel}set zoomLevel(e){this.m_zoomLevel=o.Math.clamp(e,this.m_minZoomLevel,this.m_maxZoomLevel),I.MapViewUtils.zoomOnTargetPosition(this,0,0,this.m_zoomLevel),this.update()}get storageLevel(){return o.Math.clamp(Math.floor(this.m_zoomLevel),this.m_minZoomLevel,this.m_maxZoomLevel)}get viewportHeight(){return this.canvas.height}get nativeWebglAntialiasEnabled(){return void 0===this.m_options.enableNativeWebglAntialias?this.pixelRatio<2:this.m_options.enableNativeWebglAntialias}get phasedLoadingEnabled(){return!1!==this.m_options.enablePhasedLoading}get dataSources(){return this.m_tileDataSources}setFovCalculation(e){this.m_options.fovCalculation=e,this.calculateFocalLength(this.m_renderer.getSize(ue.vector2[0]).height),this.updateCameras()}getDataSourceByName(e){return this.m_tileDataSources.find(t=>t.name===e)}getDataSourcesByStyleSetName(e){return this.m_tileDataSources.filter(t=>t.styleSetName===e)}isDataSourceEnabled(e){return e.enabled&&e.ready()&&this.m_connectedDataSources.has(e.name)}addDataSource(e){if(void 0!==this.getDataSourceByName(e.name))throw new Error(`A DataSource with the name "${e.name}" already exists in this MapView.`);return e.attach(this),e.setEnableElevationOverlay(void 0!==this.m_elevationProvider),this.m_tileDataSources.push(e),this.m_backgroundDataSource&&this.m_backgroundDataSource.updateStorageLevelOffset(),e.connect().then(()=>new Promise(e=>{if(void 0!==this.theme&&void 0!==this.theme.styles)return void e();const t=()=>{this.removeEventListener(k.ThemeLoaded,t),e()};this.addEventListener(k.ThemeLoaded,t)})).then(()=>{-1===this.m_tileDataSources.indexOf(e)||(e.addEventListener(k.Update,()=>{this.update()}),e.setTheme(this.m_theme),this.m_connectedDataSources.add(e.name),this.dispatchEvent({type:k.DataSourceConnect,dataSourceName:e.name}),this.update())}).catch(t=>{G.error(`Failed to connect to datasource ${e.name}: ${t.message}`),this.m_failedDataSources.add(e.name),this.dispatchEvent({type:k.DataSourceConnect,dataSourceName:e.name,error:t})})}removeDataSource(e){const t=this.m_tileDataSources.indexOf(e);-1!==t&&(e.detach(this),this.m_visibleTiles.removeDataSource(e),this.m_tileDataSources.splice(t,1),this.m_connectedDataSources.delete(e.name),this.m_failedDataSources.delete(e.name),this.m_backgroundDataSource&&this.m_backgroundDataSource.updateStorageLevelOffset(),this.update())}get visibleTileSet(){return this.m_visibleTiles}addOverlayText(e){this.m_textElementsRenderer.addOverlayText(e),this.update()}clearOverlayText(){this.m_textElementsRenderer.clearOverlayText()}lookAt(e,t,i=0,r=0){const n=Math.min(89,i);I.MapViewUtils.getCameraRotationAtTarget(this.projection,e,-r,n,this.camera.quaternion),I.MapViewUtils.getCameraPositionFromTargetCoordinates(e,t,-r,n,this.projection,this.camera.position),this.camera.updateMatrixWorld(!0)}setCameraGeolocationAndZoom(e,t,i=0,r=0){this.geoCenter=e;let s=Math.min(89,r);if(this.projection.type===n.ProjectionType.Spherical){const e=Math.asin(n.EarthConstants.EQUATORIAL_RADIUS/(I.MapViewUtils.calculateDistanceToGroundFromZoomLevel(this,t)+n.EarthConstants.EQUATORIAL_RADIUS)),i=o.Math.radToDeg(e);s=Math.min(s,i)}I.MapViewUtils.zoomOnTargetPosition(this,0,0,t),I.MapViewUtils.setRotation(this,i,s),this.update()}get animating(){return this.m_animationCount>0}beginAnimation(){0==this.m_animationCount++&&(this.m_updatePending||(this.m_updatePending=!0,this.drawFrame()),se.time=Date.now(),this.dispatchEvent(se))}endAnimation(){this.m_animationCount>0&&--this.m_animationCount,0===this.m_animationCount&&(oe.time=Date.now(),this.dispatchEvent(oe))}get cameraIsMoving(){return this.m_movementDetector.cameraIsMoving}get isDynamicFrame(){return this.cameraIsMoving||this.animating||this.m_updatePending||this.m_animatedExtrusionHandler.isAnimating}get pixelToWorld(){if(void 0===this.m_pixelToWorld){s.assert(void 0!==this.m_options.fovCalculation);const e=this.m_lookAtDistance;this.m_pixelToWorld=I.MapViewUtils.calculateWorldSizeByFocalLength(this.m_focalLength,e,1)}return this.m_pixelToWorld}get worldToPixel(){return 1/this.pixelToWorld}get pixelRatio(){return void 0!==this.m_pixelRatio?this.m_pixelRatio:"undefined"!=typeof window&&void 0!==window.devicePixelRatio?window.devicePixelRatio:1}set pixelRatio(e){this.m_pixelRatio=e,this.renderer.getPixelRatio()!==this.pixelRatio&&this.renderer.setPixelRatio(this.pixelRatio)}set dynamicPixelRatio(e){this.mapRenderingManager.lowResPixelRatio=e}get dynamicPixelRatio(){return this.mapRenderingManager.lowResPixelRatio}getScreenPosition(e){this.projection.projectPoint(e,ue.vector3[0]);const t=this.m_screenProjector.project(ue.vector3[0]);if(void 0!==t){const{width:e,height:i}=this.getCanvasClientSize();t.x=t.x+e/2,t.y=i-(t.y+i/2)}return t}raycasterFromScreenPoint(e,t){return this.m_raycaster.setFromCamera(this.getNormalizedScreenCoordinates(e,t),this.m_rteCamera),this.m_raycaster}getWorldPositionAt(e,t){return this.m_raycaster.setFromCamera(this.getNormalizedScreenCoordinates(e,t),this.m_camera),this.projection.type===n.ProjectionType.Spherical?this.m_raycaster.ray.intersectSphere(this.m_sphere,ue.vector3[0]):this.m_raycaster.ray.intersectPlane(this.m_plane,ue.vector3[0])}getGeoCoordinatesAt(e,t){const i=this.getWorldPositionAt(e,t);return i?this.projection.unprojectPoint(i):null}getNormalizedScreenCoordinates(e,t){const{width:i,height:r}=this.getCanvasClientSize();return new o.Vector3(e/i*2-1,-t/r*2+1,0)}intersectMapObjects(e,t){return this.m_pickHandler.intersectMapObjects(e,t)}resize(e,t){this.m_renderer.setSize(e,t,!1),this.m_renderer.getPixelRatio()!==this.pixelRatio&&this.m_renderer.setPixelRatio(this.pixelRatio),void 0!==this.mapRenderingManager&&this.mapRenderingManager.setSize(e,t),void 0!==this.collisionDebugCanvas&&(this.collisionDebugCanvas.width=e,this.collisionDebugCanvas.height=t),this.updateCameras(),this.update(),this.dispatchEvent({type:k.Resize,size:{width:e,height:t}})}renderSync(){this.renderFunc(s.PerformanceTimer.now())}update(){this.dispatchEvent(J),this.m_updatePending||(this.m_updatePending=!0,this.animating||this.drawFrame())}get updatePending(){return this.m_updatePending}requestUpdateIfNeeded(){this.update()}clearTileCache(e){if(void 0!==e){const t=this.getDataSourceByName(e);t&&(this.m_visibleTiles.clearTileCache(t),t.clearCache())}else this.m_visibleTiles.clearTileCache(),this.m_tileDataSources.forEach(e=>e.clearCache());void 0!==this.m_elevationProvider&&this.m_elevationProvider.clearCache()}forEachVisibleTile(e){this.m_visibleTiles.forEachVisibleTile(e)}forEachCachedTile(e){this.m_visibleTiles.forEachCachedTile(e)}markTilesDirty(e){this.m_visibleTiles.markTilesDirty(e)}setElevationSource(e,t,i){this.removeDataSource(e),this.addDataSource(e),this.m_elevationRangeSource=t,this.m_elevationRangeSource.connect(),this.m_elevationProvider=i,this.dataSources.forEach(e=>{e.setEnableElevationOverlay(!0)}),this.m_tileGeometryManager.setTileUpdateCallback(e=>{f.overlayOnElevation(e)}),this.clearTileCache()}clearElevationSource(e){this.removeDataSource(e),this.m_elevationRangeSource=void 0,this.m_elevationProvider=void 0,this.dataSources.forEach(e=>{e.setEnableElevationOverlay(!1)}),this.m_tileGeometryManager.setTileUpdateCallback(void 0),this.clearTileCache()}get fog(){return this.m_fog}setPostEffects(){this.mapRenderingManager.bloom.enabled=!1,this.mapRenderingManager.outline.enabled=!1,this.mapRenderingManager.vignette.enabled=!1,this.mapRenderingManager.sepia.enabled=!1,void 0!==this.m_postEffects&&(void 0!==this.m_postEffects.bloom&&(this.mapRenderingManager.bloom=this.m_postEffects.bloom),void 0!==this.m_postEffects.outline&&(this.mapRenderingManager.outline.enabled=this.m_postEffects.outline.enabled,this.mapRenderingManager.updateOutline(this.m_postEffects.outline)),void 0!==this.m_postEffects.vignette&&(this.mapRenderingManager.vignette=this.m_postEffects.vignette),void 0!==this.m_postEffects.sepia&&(this.mapRenderingManager.sepia=this.m_postEffects.sepia))}get elevationProvider(){return this.m_elevationProvider}updatePolarDataSource(){const e=this.m_polarDataSource;if(!0===this.m_enablePolarDataSource&&void 0!==e){const t=this.getDataSourceByName(e.name);this.projection.type===n.ProjectionType.Spherical?void 0===t&&this.addDataSource(e):void 0!==t&&this.removeDataSource(e)}}updateCameras(e){const{width:t,height:i}=this.m_renderer.getSize(ue.vector2[0]);this.m_camera.aspect=void 0!==this.m_forceCameraAspect?this.m_forceCameraAspect:t/i,this.setFovOnCamera(this.m_options.fovCalculation,i);const r=this.projection.getScaleFactor(this.camera.position)*this.m_tileDataSources.reduce((e,t)=>Math.max(e,t.maxGeometryHeight),0);Object.assign(this.m_viewRanges,void 0===e?this.m_visibleTiles.updateClipPlanes(r):e),this.m_camera.near=this.m_viewRanges.near,this.m_camera.far=this.m_viewRanges.far,this.m_camera.updateProjectionMatrix(),this.m_camera.updateMatrixWorld(!1),this.m_rteCamera.copy(this.m_camera),this.m_rteCamera.position.setScalar(0),this.m_rteCamera.updateMatrixWorld(!0),this.m_screenCamera.left=t/-2,this.m_screenCamera.right=t/2,this.m_screenCamera.bottom=i/-2,this.m_screenCamera.top=i/2,this.m_screenCamera.updateProjectionMatrix(),this.m_screenCamera.updateMatrixWorld(!1),this.m_screenProjector.update(this.camera,t,i),this.m_screenCollisions.update(t,i),this.m_pixelToWorld=void 0;const n=I.MapViewUtils.extractAttitude(this,this.m_camera).pitch,s=this.getCameraHeightAboveTerrain(Z),o=I.MapViewUtils.rayCastWorldCoordinates(this,0,0);if(null!==o){this.m_lookAtDistance=o.sub(this.camera.position).length();const e=s/Math.cos(Math.min(n,Math.PI/3));this.m_zoomLevel=I.MapViewUtils.calculateZoomLevelFromDistance(e,this),this.m_fog.update(this,this.m_viewRanges.maximum)}}getCameraHeightAboveTerrain(e){if(void 0!==this.elevationProvider){const t=this.elevationProvider.getHeight(this.geoCenter,e);if(void 0!==t){const e=this.projection.unprojectAltitude(this.m_camera.position)-t;return Math.max(e,1)}}return Math.abs(this.projection.groundDistance(this.m_camera.position))}detectCurrentFps(e){if(void 0!==this.m_previousRequestAnimationTime&&this.m_frameNumber>5){const t=1e3/(e-this.m_previousRequestAnimationTime);this.m_frameTimeRing[this.m_frameTimeIndex%X]=t,this.m_frameTimeIndex++;const i=Math.min(this.m_frameTimeIndex,X);let r=0;for(let e=0;e<i;e++)r+=this.m_frameTimeRing[e];this.m_detectedFps=r/i}this.m_previousRequestAnimationTime=e}drawFrame(){if(this.m_drawing||this.m_options.synchronousRendering)return;if(void 0!==this.m_animationFrameHandle&&(cancelAnimationFrame(this.m_animationFrameHandle),this.m_animationFrameHandle=void 0),this.m_maxFps<=0)return void(this.m_animationFrameHandle=requestAnimationFrame(this.handleRequestAnimationFrame));const e=1e3/this.m_detectedFps,t=1e3/this.m_maxFps,i=void 0===this.m_previousFrameTimeStamp?0:this.m_previousFrameTimeStamp,r=i+t-e-3;this.m_targetRequestAnimationTime=r,this.postponedAnimationFrame(i)}postponedAnimationFrame(e){void 0!==this.m_targetRequestAnimationTime&&(void 0!==this.m_animationFrameHandle&&(cancelAnimationFrame(this.m_animationFrameHandle),this.m_animationFrameHandle=void 0),this.detectCurrentFps(e),this.m_animationFrameHandle=requestAnimationFrame(e>this.m_targetRequestAnimationTime?this.handleRequestAnimationFrame:this.handlePostponedAnimationFrame))}renderFunc(e){this.render(e)}getEnabledTileDataSources(){const e=[];for(const t of this.m_tileDataSources)this.isDataSourceEnabled(t)&&e.push(t);return e}render(e){if(this.m_drawing)return;++this.m_frameNumber;const t=C.PerformanceStatistics.instance,i=t.enabled,r=e;let o,a,l,c,h,d,u;if(ee.time=e,this.dispatchEvent(ee),i&&(o=t.currentFrame,o.setValue("renderCount.frameNumber",this.m_frameNumber),void 0!==this.m_previousFrameTimeStamp)){const e=r-this.m_previousFrameTimeStamp;i&&(o.setValue("render.fullFrameTime",e),o.setValue("render.fps",1e3/e))}for(this.m_previousFrameTimeStamp=r,this.m_renderer.info.reset(),this.m_updatePending=!1,this.m_thisFrameTilesChanged=void 0,this.m_drawing=!0,this.m_renderer.getPixelRatio()!==this.pixelRatio&&this.m_renderer.setPixelRatio(this.pixelRatio),this.updateCameras(),this.m_renderer.clear();this.m_mapTilesRoot.children.length>0;)this.m_mapTilesRoot.remove(this.m_mapTilesRoot.children[0]);if(i&&(a=s.PerformanceTimer.now()),!this.lockVisibleTileSet){const e=this.m_visibleTiles.updateRenderList(this.storageLevel,Math.floor(this.zoomLevel),this.getEnabledTileDataSources(),this.m_elevationRangeSource);e.viewRangesChanged&&this.updateCameras(e.viewRanges)}i&&(l=s.PerformanceTimer.now());const m=this.m_visibleTiles.dataSourceTileList;if(m.forEach(({zoomLevel:e,renderedTiles:t})=>{t.forEach(t=>{this.renderTileObjects(t,e),t.frameNumLastVisible=this.m_frameNumber})}),this.m_initialTextPlacementDone||this.m_firstFrameComplete||this.isDynamicFrame||this.m_themeIsLoading||!this.m_poiTableManager.finishedLoading||!this.m_visibleTiles.allVisibleTilesLoaded||this.m_connectedDataSources.size+this.m_failedDataSources.size!==this.m_tileDataSources.length||this.m_textElementsRenderer.initializing||this.m_textElementsRenderer.loading||(this.m_initialTextPlacementDone=!0),this.m_mapAnchors.children.forEach(e=>{void 0!==e.geoPosition&&(this.projection.projectPoint(e.geoPosition,e.position),e.position.sub(this.camera.position))}),this.m_animatedExtrusionHandler.zoom=this.m_zoomLevel,void 0!==o&&(o.addValue("renderCount.numTilesRendered",0),o.addValue("renderCount.numTilesVisible",0),o.addValue("renderCount.numTilesLoading",0),m.forEach(({zoomLevel:e,renderedTiles:t,visibleTiles:i,numTilesLoading:r})=>{o.addValue("renderCount.numTilesRendered",t.size),o.addValue("renderCount.numTilesVisible",i.length),o.addValue("renderCount.numTilesLoading",r)})),this.m_movementDetector.checkCameraMoved(this,e)){const{yaw:e,pitch:t,roll:i}=I.MapViewUtils.extractAttitude(this,this.camera),{latitude:r,longitude:n,altitude:s}=this.geoCenter;this.dispatchEvent({type:k.CameraPositionChanged,latitude:r,longitude:n,altitude:s,yaw:e,pitch:t,roll:i,zoom:this.zoomLevel})}const p=void 0!==this.m_pointOfView?this.m_pointOfView:this.m_rteCamera;this.renderLabels&&this.prepareRenderTextElements(e),i&&(c=s.PerformanceTimer.now()),void 0!==this.m_skyBackground&&this.projection.type===n.ProjectionType.Planar&&this.m_skyBackground.updateCamera(this.m_camera),this.mapRenderingManager.render(this.m_renderer,this.m_scene,p,!this.isDynamicFrame),i&&(h=s.PerformanceTimer.now()),this.renderLabels&&this.finishRenderTextElements(),i&&(d=s.PerformanceTimer.now()),this.m_firstFrameRendered||(this.m_firstFrameRendered=!0,i&&t.appResults.set("firstFrame",e),ie.time=e,this.dispatchEvent(ie)),this.m_visibleTiles.disposePendingTiles(),this.m_drawing=!1,(this.animating||this.m_updatePending)&&this.drawFrame(),this.checkCopyrightUpdates(),void 0!==o&&(u=s.PerformanceTimer.now(),o.setValue("render.setupTime",a-r),o.setValue("render.cullTime",l-a),o.setValue("render.textPlacementTime",c-l),o.setValue("render.drawTime",h-c),o.setValue("render.textDrawTime",d-h),o.setValue("render.cleanupTime",u-d),o.setValue("render.frameRenderTime",u-r),C.PerformanceStatistics.instance.storeFrameInfo(this.m_renderer.info)),te.time=e,this.dispatchEvent(te),this.m_firstFrameComplete||!this.m_initialTextPlacementDone||this.isDynamicFrame||this.textElementsRenderer.loading||(this.m_firstFrameComplete=!0,i&&t.appResults.set("firstFrameComplete",e),re.time=e,this.dispatchEvent(re))}renderTileObjects(e,i){const n=e.computeWorldOffsetX();if(e.willRender(i))for(const i of e.objects){i.position.copy(e.center),void 0!==i.displacement&&i.position.add(i.displacement),i.position.x+=n,i.position.sub(this.m_camera.position),e.localTangentSpace&&i.setRotationFromMatrix(e.boundingBox.getRotationMatrix()),i.frustumCulled=!1,void 0===i._backupRenderOrder&&(i._backupRenderOrder=i.renderOrder);const s=void 0!==i.userData&&void 0!==i.userData.kind&&i.userData.kind.includes(r.GeometryKind.Building);i.renderOrder=i._backupRenderOrder+(!s&&e.levelOffset<0?t.FALLBACK_RENDER_ORDER_OFFSET*e.levelOffset:0),this.m_mapTilesRoot.add(i)}e.didRender()}prepareRenderTextElements(e){void 0!==this.m_pointOfView||this.m_textElementsRenderer.placeText(this.m_visibleTiles.dataSourceTileList,this.projection,e)}finishRenderTextElements(){void 0===this.m_pointOfView&&(this.m_screenCamera.far=this.m_viewRanges.maximum,this.m_textElementsRenderer.renderText(this.m_screenCamera))}initTheme(){void 0!==this.m_options.theme&&(this.m_themeIsLoading=!0,Promise.resolve(this.m_options.theme).then(e=>O.ThemeLoader.load(e,{uriResolver:this.m_uriResolver})).then(e=>{this.m_themeIsLoading=!1,this.theme=e,ne.time=Date.now(),this.dispatchEvent(ne)}).catch(e=>{this.m_themeIsLoading=!1;const t="string"==typeof this.m_options.theme?` from ${this.m_options.theme}`:"";G.error(`Failed to load theme${t}: ${e}`,e)}))}setupCamera(e){const{width:i,height:r}=this.getCanvasClientSize(),s=t.MapViewDefaults.geoCenter;this.projection.projectPoint(s,this.m_camera.position),this.projection.type===n.ProjectionType.Spherical&&this.m_camera.lookAt(this.scene.position),this.m_lookAtDistance=s.altitude,this.calculateFocalLength(r),this.m_visibleTiles=new U.VisibleTileSet(new p.FrustumIntersection(this.m_camera,this,this.m_visibleTileSetOptions.extendedFrustumCulling,this.m_tileWrappingEnabled),this.m_tileGeometryManager,this.m_visibleTileSetOptions),this.setInitialCameraPosition(e),this.resize(i,r),this.m_screenCamera.position.z=1,this.m_screenCamera.near=0}setInitialCameraPosition(e){const i=n.GeoCoordinates.fromObject(s.getOptionValue(e.target,t.MapViewDefaults.target));i.altitude=0;const r=s.getOptionValue(e.zoomLevel,t.MapViewDefaults.zoomLevel),o=s.getOptionValue(e.tilt,t.MapViewDefaults.tilt),a=s.getOptionValue(e.heading,t.MapViewDefaults.heading);this.lookAt(i,3e5,o,a),this.zoomLevel=r}updateSkyBackground(){if(void 0===this.m_theme)return;const e=this.m_theme;if(this.m_skyBackground instanceof P.SkyBackground&&void 0!==e.sky)this.updateSkyBackgroundColors(e.sky,e.clearColor);else{if(void 0===this.m_skyBackground&&void 0!==e.sky)return void this.addNewSkyBackground(e.sky,e.clearColor);this.m_skyBackground instanceof P.SkyBackground&&void 0===e.sky&&this.removeSkyBackGround()}}addNewSkyBackground(e,t){"gradient"===e.type&&void 0===e.groundColor&&(e.groundColor=s.getOptionValue(t,"#000000")),this.m_skyBackground=new P.SkyBackground(e,this.projection.type,this.m_camera),this.m_scene.background=this.m_skyBackground.texture}removeSkyBackGround(){this.m_scene.background=null,void 0!==this.m_skyBackground&&(this.m_skyBackground.dispose(),this.m_skyBackground=void 0)}updateSkyBackgroundColors(e,t){"gradient"===e.type&&void 0===e.groundColor&&(e.groundColor=s.getOptionValue(t,"#000000")),void 0!==this.m_skyBackground&&this.m_skyBackground.updateTexture(e,this.projection.type)}updateLighting(){if(!this.m_theme)return;const e=this.m_theme;void 0!==e.clearColor&&this.m_renderer.setClearColor(new o.Color(e.clearColor)),this.m_createdLights&&this.m_createdLights.forEach(e=>{this.m_scene.remove(e)}),void 0!==e.lights&&(this.m_createdLights=[],e.lights.forEach(e=>{const t=D.createLight(e);t?(this.m_scene.add(t),this.m_createdLights.push(t)):G.warn(`MapView: failed to create light ${e.name} of type ${e.type}`)}))}movementStarted(){this.m_textElementsRenderer.movementStarted(),ae.time=Date.now(),this.dispatchEvent(ae)}movementFinished(){this.m_textElementsRenderer.movementFinished(),le.time=Date.now(),this.dispatchEvent(le),this.animating||(void 0!==this.m_movementFinishedUpdateTimerId&&clearTimeout(this.m_movementFinishedUpdateTimerId),this.m_movementFinishedUpdateTimerId=setTimeout(()=>{this.m_movementFinishedUpdateTimerId=void 0,this.update()},0))}checkIfTilesChanged(){if(void 0!==this.m_thisFrameTilesChanged)return this.m_thisFrameTilesChanged;const e=this.m_visibleTiles.dataSourceTileList,t=[];t.length=0,e.forEach(({dataSource:e,renderedTiles:i})=>{i.forEach(i=>{t.push(e.name+"-"+i.tileKey.mortonCode())})}),t.sort();const i=t.join("#");return i!==this.m_lastTileIds?(this.m_lastTileIds=i,this.m_thisFrameTilesChanged=!0):this.m_thisFrameTilesChanged=!1,this.m_thisFrameTilesChanged}checkCopyrightUpdates(){if(!this.checkIfTilesChanged())return;const e=this.getRenderedTilesCopyrightInfo();if(e!==this.m_copyrightInfo){if(e.length===this.m_copyrightInfo.length){let t=!0;for(let i=0;i<e.length;i++){const r=e[i],n=this.m_copyrightInfo[i];if(r.label!==n.label){t=!1;break}}if(t)return}this.m_copyrightInfo=e,this.dispatchEvent(de)}}getRenderedTilesCopyrightInfo(){let e=[];for(const t of this.m_visibleTiles.dataSourceTileList)for(const i of t.renderedTiles.values()){const t=i.copyrightInfo;void 0!==t&&0!==t.length&&(e=m.CopyrightInfo.mergeArrays(e,t))}return e}updateImages(){if(!this.m_theme)return;const e=this.m_theme;if(this.m_imageCache.clear(),this.poiManager.clear(),void 0!==e.images)for(const t of Object.keys(e.images)){const i=e.images[t];this.m_imageCache.addImage(t,i.url,!0===i.preload),"string"==typeof i.atlas&&this.poiManager.addTextureAtlas(t,i.atlas)}void 0!==e.imageTextures&&e.imageTextures.forEach(e=>{this.poiManager.addImageTexture(e)})}loadPoiTables(){void 0!==this.m_theme&&(this.poiTableManager.clear(),this.poiTableManager.loadPoiTables(this.m_theme).then(()=>this.update()).catch(()=>this.update()))}setupStats(e){new C.PerformanceStatistics(e,1e3)}setupRenderer(){this.m_renderer.setClearColor(V),this.m_scene.add(this.m_mapTilesRoot),this.m_scene.add(this.m_mapAnchors)}createTextRenderer(){return new F.TextElementsRenderer(new L.MapViewState(this,this.checkIfTilesChanged.bind(this)),this.m_camera,()=>{this.update()},this.m_screenCollisions,this.m_screenProjector,new R.TextCanvasFactory(this.m_renderer),this.m_poiManager,new S.PoiRendererFactory(this),new A.FontCatalogLoader(this.m_theme),this.m_theme,this.m_options)}resetTextRenderer(){const e=this.m_textElementsRenderer.overlayText;this.m_textElementsRenderer=this.createTextRenderer(),void 0!==e&&this.m_textElementsRenderer.addOverlayText(e)}limitFov(e,t){e=o.Math.clamp(e,W,q);let i=o.Math.radToDeg(I.MapViewUtils.calculateHorizontalFovByVerticalFov(o.Math.degToRad(e),t));return(i>q||i<W)&&(i=o.Math.clamp(i,W,q),e=o.Math.radToDeg(I.MapViewUtils.calculateVerticalFovByHorizontalFov(o.Math.degToRad(i),t))),e}setFovOnCamera(e,t){let i=0;"fixed"===e.type?(this.calculateFocalLength(t),i=e.fov):(s.assert(0!==this.m_focalLength),i=I.MapViewUtils.calculateFovByFocalLength(this.m_focalLength,t)),this.m_camera.fov=this.limitFov(i,this.m_camera.aspect)}calculateFocalLength(e){s.assert(void 0!==this.m_options.fovCalculation),this.m_focalLength=I.MapViewUtils.calculateFocalLengthByVerticalFov(o.Math.degToRad(this.m_options.fovCalculation.fov),e)}getCanvasClientSize(){const{clientWidth:e,clientHeight:t}=this.canvas;if(0===e||0===t||"number"!=typeof e||"number"!=typeof t){const e=this.m_renderer.getPixelRatio();return{width:Math.round(this.canvas.width/e),height:Math.round(this.canvas.height/e)}}return{width:e,height:t}}}t.MapView=pe},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Discrete=0]="Discrete",e[e.Linear=1]="Linear",e[e.Cubic=2]="Cubic",e[e.Exponential=3]="Exponential"}(t.InterpolationMode||(t.InterpolationMode={})),t.interpolatedPropertyDefinitionToJsonExpr=function(e){if(void 0===e.interpolation||"Discrete"===e.interpolation){const t=["step",["zoom"],e.values[0]];for(let i=1;i<e.zoomLevels.length;++i)t.push(e.zoomLevels[i],e.values[i]);return t}const t=["interpolate"];switch(e.interpolation){case"Linear":t.push(["linear"]);break;case"Cubic":t.push(["cubic"]);break;case"Exponential":t.push(["exponential",void 0!==e.exponent?e.exponent:2]);break;default:throw new Error(`interpolation mode '${e.interpolation}' is not supported`)}t.push(["zoom"]);for(let i=0;i<e.zoomLevels.length;++i)t.push(e.zoomLevels[i],e.values[i]);return t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isValueDefinition=function(e){const t=e;return"object"==typeof t&&null!==t&&"string"==typeof t.type&&void 0!==t.value},t.isSelectorDefinition=function(e){const t=e;return"object"==typeof t&&null!==t&&"selector"===t.type&&("string"==typeof t.value||Array.isArray(t.value))},t.isJsonExprReference=function(e){return Array.isArray(e)&&2===e.length&&"ref"===e[0]&&"string"==typeof e[1]},t.isActualSelectorDefinition=function(e){const t=e;return"object"==typeof t&&null!==t&&!Array.isArray(t)&&"string"==typeof t.technique}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(181),s=i(3),o=i(4),a=i(6),l=i(1),c=i(0),h=i(39),d=i(34),u=i(22),m=i(82),p=i(30),f=i(190),g=i(23),v=i(36),y=i(52),_=l.LoggerManager.instance.create("TileGeometryCreator"),x=.1;class T{constructor(){this.clippingPlanes=[new c.Plane(new c.Vector3(-1,0,0),0),new c.Plane(new c.Vector3(1,0,0),0),new c.Plane(new c.Vector3(0,-1,0),0),new c.Plane(new c.Vector3(0,1,0),0)]}static get instance(){return this.m_instance||(this.m_instance=new T)}initDecodedTile(e,t,i){for(const n of e.techniques)void 0===n.enabled&&(void 0!==n.kind&&(Array.isArray(n.kind)?n.kind=new r.GeometryKindSet(n.kind):"string"!=typeof n.kind&&(_.warn("Technique has unknown type of kind:",n),n.kind=void 0)),void 0===n.kind||n.kind instanceof Set&&0===n.kind.size?n.enabled=!0:n.enabled=!(void 0!==i&&i.hasOrIntersects(n.kind))||void 0!==t&&t.hasOrIntersects(n.kind));for(const t of e.geometries)for(const e of t.groups)e.createdOffsets=[];e.techniques.forEach(e=>{for(const t in e){if(!e.hasOwnProperty(t))continue;const i=e[t];if(r.isJsonExpr(i)&&"kind"!==t)try{e[t]=r.Expr.fromJSON(i)}catch(e){_.error("#initDecodedTile: Failed to compile expression:",e)}}})}createAllGeometries(e,t){const i=e=>!1!==e.enabled;void 0!==t.maxGeometryHeight&&(e.maxGeometryHeight=t.maxGeometryHeight),this.createObjects(e,t,i),this.preparePois(e,t);this.createTextElements(e,t,e=>!!(r.isPoiTechnique(e)||r.isLineMarkerTechnique(e)||r.isTextTechnique(e))&&i(e)),this.createLabelRejectionElements(e,t),e.dataSource.addGroundPlane&&e.projection.type===s.ProjectionType.Planar&&T.instance.addGroundPlane(e,-p.FALLBACK_RENDER_ORDER_OFFSET/2)}createLabelRejectionElements(e,t){if(void 0!==t.pathGeometries)for(const i of t.pathGeometries)e.addBlockingElement(new f.PathBlockingElement(i.path))}processTechniques(e,t,i){if(void 0!==e){for(const t of e.techniques)void 0===t.kind&&y.TileGeometryLoader.setDefaultGeometryKind(t);this.initDecodedTile(e,t,i)}}registerTileObject(e,t,i){void 0===t.userData&&(t.userData={});const r=t.userData;r.tileKey=e.tileKey,r.dataSource=e.dataSource.name,r.kind=i instanceof Set?Array.from(i.values()):Array.isArray(i)?i:[i],e.resetVisibilityCounter()}prepareTextPaths(e,t,i){const n=new Array,s=e.slice();for(;s.length>0;){const e=s.pop();if(void 0===e)break;const o=t.techniques[e.technique];r.isTextTechnique(o)&&(void 0===i||i(o))&&n.push(e)}return n}createTextElements(e,t,i){const n=e.mapView,s=n.textElementsRenderer,o=Math.floor(n.zoomLevel),l=e.computeWorldOffsetX();if(void 0!==t.textPathGeometries){const h=this.prepareTextPaths(t.textPathGeometries,t,i);let d=0;for(const e of h){const i=t.techniques[e.technique];!1!==i.enabled&&r.isTextTechnique(i)&&(e.pathLengthSqr>d&&(d=e.pathLengthSqr))}for(const u of h){const h=t.techniques[u.technique];if(!1===h.enabled||!r.isTextTechnique(h)||void 0!==i&&!i(h))continue;const m=[];for(let e=0;e<u.path.length;e+=3)m.push(new c.Vector3(u.path[e]+l,u.path[e+1],u.path[e+2]));const p=(void 0!==h.priority?r.getPropertyValue(h.priority,o):0)+(d>0?x*u.pathLengthSqr/d:0),f=void 0!==h.fadeNear?r.getPropertyValue(h.fadeNear,o):h.fadeNear,y=void 0!==h.fadeFar?r.getPropertyValue(h.fadeFar,o):h.fadeFar,_=u.objInfos,T=r.getFeatureId(_),S=new g.TextElement(a.ContextualArabicConverter.instance.convert(u.text),m,s.styleCache.getRenderStyle(e,h),s.styleCache.getLayoutStyle(e,h),p,void 0!==h.xOffset?h.xOffset:0,void 0!==h.yOffset?h.yOffset:0,T,h.style,f,y,e.offset);S.minZoomLevel=void 0!==h.minZoomLevel?h.minZoomLevel:n.minZoomLevel,S.maxZoomLevel=void 0!==h.maxZoomLevel?h.maxZoomLevel:n.maxZoomLevel,S.distanceScale=void 0!==h.distanceScale?h.distanceScale:v.DEFAULT_TEXT_DISTANCE_SCALE,S.mayOverlap=!0===h.mayOverlap,S.reserveSpace=!1!==h.reserveSpace,S.kind=h.kind,S.userData=u.objInfos,e.addTextElement(S)}}if(void 0!==t.textGeometries)for(const h of t.textGeometries){if(void 0===h.technique||void 0===h.stringCatalog)continue;const d=t.techniques[h.technique];if(!1===d.enabled||!r.isTextTechnique(d)||void 0!==i&&!i(d))continue;const u=new c.BufferAttribute(new Float32Array(h.positions.buffer),h.positions.itemCount),m=u.count;if(m<1)continue;const p=void 0!==d.priority?r.getPropertyValue(d.priority,o):0,f=void 0!==d.fadeNear?r.getPropertyValue(d.fadeNear,o):d.fadeNear,v=void 0!==d.fadeFar?r.getPropertyValue(d.fadeFar,o):d.fadeFar;for(let t=0;t<m;++t){const i=u.getX(t)+l,o=u.getY(t),m=u.getZ(t),y=h.stringCatalog[h.texts[t]];if(void 0===y)continue;const _=void 0!==h.objInfos?h.objInfos[t]:void 0,x=r.getFeatureId(_),T=new g.TextElement(a.ContextualArabicConverter.instance.convert(y),new c.Vector3(i,o,m),s.styleCache.getRenderStyle(e,d),s.styleCache.getLayoutStyle(e,d),p,d.xOffset||0,d.yOffset||0,x,d.style,void 0,void 0,e.offset);T.minZoomLevel=void 0!==d.minZoomLevel?d.minZoomLevel:n.minZoomLevel,T.maxZoomLevel=void 0!==d.maxZoomLevel?d.maxZoomLevel:n.maxZoomLevel,T.mayOverlap=!0===d.mayOverlap,T.reserveSpace=!1!==d.reserveSpace,T.kind=d.kind,T.fadeNear=f,T.fadeFar=v,T.userData=_,e.addTextElement(T)}}}createObjects(e,t,i){const n=[],a=e.mapView,p=e.dataSource,f=Math.floor(a.zoomLevel),g=e.objects,v=a.viewRanges;for(const y of t.geometries){const _=y.groups,x=_.length;for(let T=0;T<x;){const S=_[T++],w=S.start,b=S.technique,M=t.techniques[b];if(-1!==S.createdOffsets.indexOf(e.offset)||!1===M.enabled||void 0!==i&&!i(M))continue;let E=S.count;for(S.createdOffsets.push(e.offset);T<x&&_[T].technique===b&&w+E===_[T].start;++T)E+=_[T].count,_[T].createdOffsets.push(e.offset);const P=u.getObjectConstructor(M);if(void 0===P)continue;let C=n[b];if(void 0===C){const t=t=>{p.requestUpdate(),void 0!==t&&e.addOwnedTexture(t)};if(C=u.createMaterial({technique:M,level:f,fog:null!==a.scene.fog},t),void 0===C)continue;n[b]=C}r.isTerrainTechnique(M)&&this.setupTerrainMaterial(M,C,e.mapView.clearColor);const A=new c.BufferGeometry;if(y.vertexAttributes.forEach(e=>{const t=u.getBufferAttribute(e);A.setAttribute(e.name,t)}),void 0!==y.interleavedVertexAttributes&&y.interleavedVertexAttributes.forEach(e=>{const t=r.getArrayConstructor(e.type),i=new c.InterleavedBuffer(new t(e.buffer),e.stride);e.attributes.forEach(e=>{const t=new c.InterleavedBufferAttribute(i,e.itemSize,e.offset,!1);A.setAttribute(e.name,t)})}),y.index&&A.setIndex(u.getBufferAttribute(y.index)),!A.getAttribute("normal")&&r.needsVertexNormals(M)&&A.computeVertexNormals(),A.addGroup(w,E),r.isSolidLineTechnique(M)){const t=C;if(t.uniforms.opacity.value=C.opacity,!1!==M.clipping&&e.projection.type===s.ProjectionType.Planar){const i=t.uniforms.tileSize,r=new c.Vector3;e.boundingBox.getSize(r),i.value.x=r.x,i.value.y=r.y,t.defines.TILE_CLIP=1}A.getAttribute("color")&&(t.defines.USE_COLOR=1),void 0!==M.caps&&o.LineCapsDefinitions.hasOwnProperty(M.caps)&&(t.defines[o.LineCapsDefinitions[M.caps]]=1)}const L=r.isSolidLineTechnique(M)&&void 0!==M.secondaryWidth,R=new P(A,C);if(R.renderOrder=M.renderOrder,void 0!==S.renderOrderOffset&&(R.renderOrder+=S.renderOrderOffset),void 0!==y.uuid&&(R.userData.geometryId=y.uuid),r.isFillTechnique(M)&&a.projection.type===s.ProjectionType.Planar&&(R.onBeforeRender=l.chainCallbacks(R.onBeforeRender,(t,i,r,n,s)=>{null===s.clippingPlanes&&(s.clippingPlanes=this.clippingPlanes);const o=a.projection.worldExtent(0,0).max.x*e.offset,l=a.zoomLevel<=2?1.01:1.001,c=s.clippingPlanes,h=e.center.x-a.worldCenter.x+e.boundingBox.extents.x*l+o;c[0].constant=h;const d=e.center.x-a.worldCenter.x-e.boundingBox.extents.x*l+o;c[1].constant=-d;const u=e.center.y-a.worldCenter.y+e.boundingBox.extents.y*l;c[2].constant=u;const m=e.center.y-a.worldCenter.y-e.boundingBox.extents.y*l;c[3].constant=-m})),(r.isCirclesTechnique(M)||r.isSquaresTechnique(M))&&void 0!==M.enablePicking&&(R.enableRayTesting=M.enablePicking),r.isLineTechnique(M)||r.isSegmentsTechnique(M)&&void 0!==M.color&&r.Expr.isExpr(M.color)){const e=this.getFadingParams(f,M);o.FadingFeature.addRenderHelper(R,v,e.fadeNear,e.fadeFar,!1,(e,t)=>{const i=t;u.applyBaseColorToMaterial(i,i.color,M,M.color,a.zoomLevel)})}if(r.isSolidLineTechnique(M)){const e=this.getFadingParams(f,M);o.FadingFeature.addRenderHelper(R,v,e.fadeNear,e.fadeFar,!1,(e,t)=>{const i=t,n="Pixel"===M.metricUnit?a.pixelToWorld:1;void 0!==M.color&&u.applyBaseColorToMaterial(i,i.color,M,M.color,a.zoomLevel),i.lineWidth=r.getPropertyValue(M.lineWidth,a.zoomLevel,a.pixelToWorld)*n*.5,void 0!==M.outlineWidth&&(i.outlineWidth=r.getPropertyValue(M.outlineWidth,a.zoomLevel,a.pixelToWorld)*n),void 0!==M.dashSize&&(i.dashSize=r.getPropertyValue(M.dashSize,a.zoomLevel,a.pixelToWorld)*n*.5),void 0!==M.gapSize&&(i.gapSize=r.getPropertyValue(M.gapSize,a.zoomLevel,a.pixelToWorld)*n*.5)})}if(r.isExtrudedLineTechnique(M)&&(void 0!==M.fadeFar||r.Expr.isExpr(M.color))){const e=this.getFadingParams(f,M);o.FadingFeature.addRenderHelper(R,v,e.fadeNear,e.fadeFar,!0,void 0!==M.color&&r.Expr.isExpr(M.color)?(e,t)=>{const i=t;u.applyBaseColorToMaterial(i,i.color,M,M.color,a.zoomLevel)}:void 0)}if(this.addFeatureData(y,M,R),this.addGeometryObjInfos(e,y,M,R),r.isExtrudedPolygonTechnique(M)||r.isFillTechnique(M)){const e=void 0!==M.color&&r.Expr.isExpr(M.color)||r.isExtrudedPolygonTechnique(M)&&r.Expr.isExpr(M.emissive);if(void 0!==M.fadeFar||e){const t=this.getFadingParams(f,M);o.FadingFeature.addRenderHelper(R,v,t.fadeNear,t.fadeFar,!0,e?(e,t)=>{const i=t;if(u.applyBaseColorToMaterial(i,i.color,M,M.color,a.zoomLevel),r.isExtrudedPolygonTechnique(M)&&void 0!==M.emissive){const e=t;u.applySecondaryColorToMaterial(e.emissive,M.emissive,a.zoomLevel)}}:void 0)}}const F=[],D=a.animatedExtrusionHandler;let O=!1;if(r.isExtrudedPolygonTechnique(M)&&void 0!==D){let e=r.getPropertyValue(M.animateExtrusion,f);void 0!==e&&(e="boolean"==typeof e?e:"number"==typeof e&&0!==e),O=void 0!==e&&!1===D.forceEnabled?e:D.enabled}if(r.isExtrudedPolygonTechnique(M)&&m.isRenderDepthPrePassEnabled(M)){const t=m.createDepthPrePassMesh(R);this.registerTileObject(e,t,M.kind),g.push(t),O&&F.push({object:t,materialFeature:!0}),m.setDepthPrePassStencil(t,R)}if(this.registerTileObject(e,R,M.kind),g.push(R),r.isExtrudedPolygonTechnique(M)&&void 0!==y.edgeIndex){const t=new c.BufferGeometry;t.setAttribute("position",A.getAttribute("position"));const i=A.getAttribute("color");void 0!==i&&t.setAttribute("color",i);const n=A.getAttribute("extrusionAxis");void 0!==n&&t.setAttribute("extrusionAxis",n);const s=A.getAttribute("normal");void 0!==s&&t.setAttribute("normal",s);const l=A.getAttribute("uv");void 0!==l&&t.setAttribute("uv",l),t.setIndex(u.getBufferAttribute(y.edgeIndex));const h=M,d=this.getPolygonFadingParams(f,h),m={color:d.color,colorMix:d.colorMix,fadeNear:d.lineFadeNear,fadeFar:d.lineFadeFar},p=new o.EdgeMaterial(m),_=new c.LineSegments(t,p);_.renderOrder=R.renderOrder+.1,o.FadingFeature.addRenderHelper(_,v,d.lineFadeNear,d.lineFadeFar,!1,void 0!==h.lineColor&&r.Expr.isExpr(h.lineColor)?(e,t)=>{u.applyBaseColorToMaterial(p,p.color,h,h.lineColor,a.zoomLevel)}:void 0),O&&F.push({object:_,materialFeature:!1}),this.registerTileObject(e,_,M.kind),g.push(_)}if(r.isExtrudedPolygonTechnique(M)&&O){F.push({object:R,materialFeature:!0});const t=void 0!==M.animateExtrusionDuration&&!1===D.forceEnabled?M.animateExtrusionDuration:D.duration;e.animatedExtrusionTileHandler=new h.AnimatedExtrusionTileHandler(e,F,t),a.animatedExtrusionHandler.add(e.animatedExtrusionTileHandler)}if(r.isFillTechnique(M)&&void 0!==y.edgeIndex){const t=new c.BufferGeometry;t.setAttribute("position",A.getAttribute("position")),t.setIndex(u.getBufferAttribute(y.edgeIndex));const i=M,n=this.getPolygonFadingParams(f,i),s={color:n.color,colorMix:n.colorMix,fadeNear:n.lineFadeNear,fadeFar:n.lineFadeFar},l=new o.EdgeMaterial(s),h=new c.LineSegments(t,l);h.renderOrder=R.renderOrder+.1,o.FadingFeature.addRenderHelper(h,v,n.lineFadeNear,n.lineFadeFar,!1,void 0!==i.lineColor&&r.Expr.isExpr(i.lineColor)?(e,t)=>{const r=t;u.applyBaseColorToMaterial(r,r.color,i,i.lineColor,a.zoomLevel)}:void 0),this.registerTileObject(e,h,M.kind),g.push(h)}if(L){const t=M,i=C.clone(),n=d.ColorCache.instance.getColor(void 0!==t.secondaryColor?r.getPropertyValue(t.secondaryColor,f):0);i.uniforms.diffuse.value=n,void 0!==t.secondaryCaps&&(i.caps=t.secondaryCaps);const s=new P(A,i);s.renderOrder=void 0!==t.secondaryRenderOrder?t.secondaryRenderOrder:M.renderOrder-1e-7,void 0!==S.renderOrderOffset&&(s.renderOrder+=S.renderOrderOffset);const l=this.getFadingParams(f,M);o.FadingFeature.addRenderHelper(s,v,l.fadeNear,l.fadeFar,!1,(e,i)=>{const n=i,s="Pixel"===t.metricUnit?a.pixelToWorld:1;if(void 0!==t.secondaryColor&&u.applyBaseColorToMaterial(n,n.color,t,t.secondaryColor,a.zoomLevel),void 0!==t.secondaryWidth){const e=r.getPropertyValue(t.lineWidth,a.zoomLevel,a.pixelToWorld),i=r.getPropertyValue(t.secondaryWidth,a.zoomLevel,a.pixelToWorld),o=r.getPropertyValue(t.opacity,a.zoomLevel),l=i<=e&&(void 0===o||1===o)?0:i;n.lineWidth=l*s*.5}}),this.registerTileObject(e,s,M.kind),g.push(s)}}}}preparePois(e,t){void 0!==t.poiGeometries&&e.mapView.poiManager.addPois(e,t)}addGroundPlane(e,t){const i=e.mapView,a=e.dataSource,l=e.projection,h=i.clearColor,d=new c.Vector3;if(e.projection.type===s.ProjectionType.Spherical){const{east:i,west:u,north:m,south:p}=e.geoBox,f=a.getTilingScheme().projection,g=new c.BufferGeometry,v=new c.BufferAttribute(new Float32Array([...f.projectPoint(new s.GeoCoordinates(p,u),d).toArray(),...f.projectPoint(new s.GeoCoordinates(p,i),d).toArray(),...f.projectPoint(new s.GeoCoordinates(m,u),d).toArray(),...f.projectPoint(new s.GeoCoordinates(m,i),d).toArray()]),3);g.setAttribute("position",v),g.setIndex(new c.BufferAttribute(new Uint16Array([0,1,2,2,1,3]),1)),new n.SphericalGeometrySubdivisionModifier(c.Math.degToRad(10),f).modify(g);for(let t=0;t<v.array.length;t+=3)d.set(v.array[t],v.array[t+1],v.array[t+2]),l.reprojectPoint(f,d,d),d.sub(e.center),v.array[t]=d.x,v.array[t+1]=d.y,v.array[t+2]=d.z;v.needsUpdate=!0;const y=new o.MapMeshBasicMaterial({color:h,visible:!0,depthWrite:!0}),_=new c.Mesh(g,y);_.renderOrder=t,this.registerTileObject(e,_,r.GeometryKind.Background),e.objects.push(_)}else{e.boundingBox.getSize(d);const i=this.createPlane(d.x,d.y,e.center,h,!0,t);this.registerTileObject(e,i,r.GeometryKind.Background),e.objects.push(i)}}setupTerrainMaterial(e,t,i){if(void 0!==e.displacementMap)t.onBeforeCompile=e=>{e.fragmentShader=e.fragmentShader.replace("#include <map_pars_fragment>","#include <map_pars_fragment>\n    uniform sampler2D displacementMap;\n    uniform float displacementScale;\n    uniform float displacementBias;"),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#ifdef USE_MAP\n    float minElevation = ${s.EarthConstants.MIN_ELEVATION.toFixed(1)};\n    float maxElevation = ${s.EarthConstants.MAX_ELEVATION.toFixed(1)};\n    float elevationRange = maxElevation - minElevation;\n\n    float disp = texture2D( displacementMap, vUv ).x * displacementScale + displacementBias;\n    vec4 texelColor = texture2D( map, vec2((disp - minElevation) / elevationRange, 0.0) );\n    texelColor = mapTexelToLinear( texelColor );\n    diffuseColor *= texelColor;\n#endif`),e.vertexShader=e.vertexShader.replace("#include <displacementmap_vertex>","")},t.displacementMap.needsUpdate=!0;else{t.color.set(i)}}createPlane(e,t,i,r,n,s){const a=new c.PlaneGeometry(e,t,1),l=new o.MapMeshBasicMaterial({color:r,visible:n,depthWrite:!1}),h=new c.Mesh(a,l);return h.position.copy(i),h.renderOrder=s,h}addFeatureData(e,t,i){if((void 0!==e.objInfos&&e.objInfos.length>0||r.isCirclesTechnique(t)||r.isSquaresTechnique(t))&&!r.isSolidLineTechnique(t)){const t={geometryType:e.type,starts:e.featureStarts,objInfos:e.objInfos};i.userData.feature=t}}addGeometryObjInfos(e,t,i,n){if(!(void 0===t.objInfos||Object.keys(n.userData).length>0))if(r.isTerrainTechnique(i)){if("number"==typeof t.objInfos[0])return void l.assert(!1,"Wrong attribute map type for terrain geometry");const i=t.objInfos[0],r={tileKey:e.tileKey,texture:new c.DataTexture(i.buffer,i.xCountVertices,i.yCountVertices,c.LuminanceFormat,c.FloatType),displacementMap:i};n.userData=r}else n.userData=t.objInfos}getFadingParams(e,t){return{fadeNear:void 0!==t.fadeNear?r.getPropertyValue(t.fadeNear,e):o.FadingFeature.DEFAULT_FADE_NEAR,fadeFar:void 0!==t.fadeFar?r.getPropertyValue(t.fadeFar,e):o.FadingFeature.DEFAULT_FADE_FAR}}getPolygonFadingParams(e,t){let i,n=o.EdgeMaterial.DEFAULT_COLOR_MIX;if(void 0!==t.lineColor&&(i=r.getPropertyValue(t.lineColor,e),r.isExtrudedPolygonTechnique(t))){const e=t;n=void 0!==e.lineColorMix?e.lineColorMix:o.EdgeMaterial.DEFAULT_COLOR_MIX}const s=void 0!==t.fadeNear?r.getPropertyValue(t.fadeNear,e):o.FadingFeature.DEFAULT_FADE_NEAR,a=void 0!==t.fadeFar?r.getPropertyValue(t.fadeFar,e):o.FadingFeature.DEFAULT_FADE_FAR,l=void 0!==t.lineFadeNear?r.getPropertyValue(t.lineFadeNear,e):s,c=void 0!==t.lineFadeFar?r.getPropertyValue(t.lineFadeFar,e):a;return void 0===i&&(i=o.EdgeMaterial.DEFAULT_COLOR),{color:i,colorMix:n,fadeNear:s,fadeFar:a,lineFadeNear:l,lineFadeFar:c}}}t.TileGeometryCreator=T},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);class n{constructor(){this.m_map=new Map}static get instance(){return this.m_instance}getColor(e){"number"==typeof e&&(e="#"+e.toString(16).padStart(6,"0"));let t=this.m_map.get(e);return void 0!==t?t:(t=new r.Color(e),this.m_map.set(e,t),t)}get size(){return this.m_map.size}clear(){this.m_map.clear()}}t.ColorCache=n,n.m_instance=new n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.PoiLabel=0]="PoiLabel",e[e.PathLabel=1]="PathLabel",e[e.LineMarker=2]="LineMarker"}(t.TextElementType||(t.TextElementType={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(6),n=i(1),s=i(0),o=i(51),a=i(37),l=i(84),c=i(86),h=i(193),d=i(194),u=i(23),m=i(195),p=i(196),f=i(35),g=i(87),v=i(200),y=1/0;var _;!function(e){e[e.PersistentLabels=0]="PersistentLabels",e[e.NewLabels=1]="NewLabels"}(_||(_={})),t.DEFAULT_TEXT_DISTANCE_SCALE=.5;const x=2e4,T=100,S=5,w=10,b=5,M=n.LoggerManager.instance.create("TextElementsRenderer",{level:n.LogLevel.Log}),E=!1,P=E?new v.UpdateStats(M):void 0,C=E?new h.PlacementStats(M):void 0,A=new s.Box2,L=[],R=new n.Math2D.Box,F=new s.Vector3,D=new s.Vector2,O=[],I=new s.Vector2,U=new s.Vector2,z={};class k{constructor(e,t){this.tile=e,this.group=t}}class G{constructor(e){this.lists=e}get priority(){return n.assert(this.lists.length>0),this.lists[0].group.priority}count(){let e=0;for(const t of this.lists)e+=t.group.elements.length;return e}}function V(e){if(void 0===e||w<=0)return!1;return n.PerformanceTimer.now()-e>w&&(M.debug("Placement time limit exceeded."),!0)}t.TextElementsRenderer=class{constructor(e,t,i,r,n,o,a,l,c,h,d){this.m_viewState=e,this.m_viewCamera=t,this.m_viewUpdateCallback=i,this.m_screenCollisions=r,this.m_screenProjector=n,this.m_textCanvasFactory=o,this.m_poiManager=a,this.m_poiRendererFactory=l,this.m_fontCatalogLoader=c,this.m_theme=h,this.m_initialized=!1,this.m_glyphLoadingCount=0,this.m_initializedTextElementCount=0,this.m_textRenderers=[],this.m_tmpVector=new s.Vector2,this.m_overloaded=!1,this.m_cacheInvalidated=!1,this.m_forceNewLabelsPass=!1,this.m_textElementStateCache=new p.TextElementStateCache,this.m_textStyleCache=new g.TextStyleCache(this.m_theme),this.m_options=Object.assign({},d),m.initializeDefaultOptions(this.m_options),this.m_textCanvasFactory.setGlyphCountLimits(this.m_options.minNumGlyphs,this.m_options.maxNumGlyphs)}set disableFading(e){this.m_options.disableFading=e}get disableFading(){return!0===this.m_options.disableFading}get styleCache(){return this.m_textStyleCache}renderText(e){if(this.initialized){this.updateGlyphDebugMesh();for(const t of this.m_textRenderers)t.textCanvas.render(e)}}invalidateCache(){this.m_cacheInvalidated=!0}movementStarted(){}movementFinished(){this.invalidateCache()}get overloaded(){return this.m_overloaded}placeText(e,t,i){const r=function(e){let t=!1;return e.forEach(({renderedTiles:e})=>{e.forEach(e=>{e.textElementsChanged&&(e.textElementsChanged=!1,t=!0)})}),t}(e),n=this.hasOverlayText()||r;if(!this.initialize(n))return;const s=this.m_cacheInvalidated||r||this.m_viewState.renderedTilesChanged;M.debug(`FRAME: ${this.m_viewState.frameNumber}, ZOOM LEVEL: ${this.m_viewState.zoomLevel}`),s&&(this.m_textElementStateCache.clearVisited(),this.updateTextElements(e,t));const o=s,a=this.m_textElementStateCache.update(i,this.m_options.disableFading,o,this.m_viewState.zoomLevel);this.reset(),this.prepopulateScreenWithBlockingElements(e);const l=s||a;this.placeTextElements(i,l),this.placeOverlayTextElements(),this.updateTextRenderers()}addOverlayText(e){0!==e.length&&(this.m_overlayTextElements=void 0===this.m_overlayTextElements?e.slice():this.m_overlayTextElements.concat(e))}clearOverlayText(){this.m_overlayTextElements=[]}hasOverlayText(){return void 0!==this.m_overlayTextElements&&this.m_overlayTextElements.length>0}get overlayText(){return this.m_overlayTextElements}pickTextElements(e,t){const i=(i,r)=>{const n=i;if(void 0===n)return;let s=!1;if(void 0!==n.featureId&&(s=t.some(e=>void 0!==e&&r===e.type&&(void 0!==e.featureId&&e.featureId===n.featureId||void 0!==e.userData&&e.userData===n.userData)),!s)){const i={type:r,point:e,distance:0,featureId:n.featureId,userData:n.userData,text:n.text};t.push(i)}};for(const t of this.m_textRenderers)t.textCanvas.pickText(e,e=>{i(e,a.PickObjectType.Text)}),t.poiRenderer.pickTextElements(e,e=>{i(e,a.PickObjectType.Icon)})}get loading(){return this.m_fontCatalogLoader.loading||this.m_glyphLoadingCount>0}async waitLoaded(){return!!await this.waitInitialized()&&(void 0!==this.m_loadPromise&&(await this.m_loadPromise,!0))}clearRenderStates(){this.m_textElementStateCache.clear()}getMemoryUsage(){const e={heapSize:0,gpuSize:0};for(const t of this.m_textRenderers)t.textCanvas.getMemoryUsage(e),t.poiRenderer.getMemoryUsage(e);return e}get initialized(){return this.m_initialized}get initializing(){return void 0!==this.m_initPromise}async waitInitialized(){return!!this.initialized||!!this.initializing&&(await this.m_initPromise,!0)}initialize(e){return this.initialized||this.initializing||!e||(this.initializeDefaultAssets(),this.m_initPromise=this.initializeTextCanvases().then(()=>{this.m_initialized=!0,this.m_initPromise=void 0,this.invalidateCache(),this.m_viewUpdateCallback()})),this.initialized}reset(){this.m_screenCollisions.reset();for(const e of this.m_textRenderers)e.textCanvas.clear(),e.poiRenderer.reset();this.m_initializedTextElementCount=0}updateTextRenderers(){for(const e of this.m_textRenderers)e.poiRenderer.update()}prepopulateScreenWithBlockingElements(e){const t=[];e.forEach(e=>{const i=new s.Vector3,r=new s.Vector3;for(const n of e.renderedTiles.values())for(const e of n.blockingElements)if(!(e.points.length<2)){this.m_screenProjector.project3(e.points[0],i);for(let n=1;n<e.points.length;n++){this.m_screenProjector.project3(e.points[n],r);const s=e.screenSpaceLines[n-1];s.start.copy(i),s.end.copy(r);const o={minX:Math.min(i.x,r.x),maxX:Math.max(i.x,r.x),minY:Math.min(i.y,r.y),maxY:Math.max(i.y,r.y),type:"line",line:s};t.push(o),i.copy(r)}}}),this.m_screenCollisions.allocateIBoxes(t)}placeTextElementGroup(e,t,i,s){if(n.assert(e.visited),0===this.m_textRenderers.length)return M.warn("No text renderers initialized."),!1;const o=[],a={additionParams:{},poiMeasurementParams:{},measurementParams:{},bufferAdditionParams:{}},l=this.m_viewState.hiddenGeometryKinds;for(const n of e.textElementStates){if(s===_.PersistentLabels&&C&&++C.total,i>=0&&t.numRenderedTextElements>=i)return M.debug("Placement label limit exceeded."),!1;if(!n.initialized){C&&++C.uninitialized;continue}if(void 0===n.viewDistance){C&&++C.tooFar;continue}const e=n.visible;if(s===_.PersistentLabels&&!e||s===_.NewLabels&&e)continue;const c=n.element,h=this.m_textStyleCache.getTextElementStyle(c.style),d=h.textCanvas,u=h.poiRenderer;if(void 0===d||void 0===u){M.warn("Text canvas or poi renderer not ready.");continue}if(void 0!==l&&void 0!==c.kind&&l.hasOrIntersects(c.kind))continue;const m=c.type;if(m===f.TextElementType.PathLabel&&!this.checkForSmallLabels(c,O)){C&&C.numNotVisible++,!0===c.dbgPathTooSmall&&C&&C.numPathTooSmall++,n.reset();continue}if(!this.initializeGlyphs(c,h,a))continue;const p=d.getLayer(c.renderOrder||r.DEFAULT_TEXT_CANVAS_LAYER);if(void 0!==p&&p.storage.drawCount+c.glyphs.length>p.storage.capacity)C&&++C.numCannotAdd,M.warn("layer glyph storage capacity exceeded.");else switch(d.textRenderStyle=c.renderStyle,d.textLayoutStyle=c.layoutStyle,m){case f.TextElementType.PoiLabel:this.addPoiLabel(n,u,d,t,a);break;case f.TextElementType.LineMarker:this.addLineMarkerLabel(n,u,o,d,t,a);break;case f.TextElementType.PathLabel:this.addPathLabel(n,O,d,t,a)}}return!0}initializeGlyphs(e,t,i){if(e.loadingState===u.LoadingState.Initialized)return!0;n.assert(void 0!==t.textCanvas);const o=t.textCanvas;if(void 0===e.loadingState)if(e.loadingState=u.LoadingState.Requested,void 0===e.renderStyle&&(e.renderStyle=new r.TextRenderStyle(Object.assign(Object.assign({},t.renderParams),e.renderParams))),void 0===e.layoutStyle&&(e.layoutStyle=new r.TextLayoutStyle(Object.assign(Object.assign({},t.layoutParams),e.layoutParams))),""===e.text)e.loadingState=u.LoadingState.Loaded;else{const t=o.fontCatalog.loadCharset(e.text,e.renderStyle).then(()=>{--this.m_glyphLoadingCount,e.loadingState=u.LoadingState.Loaded,this.m_forceNewLabelsPass=!0,this.m_viewUpdateCallback()});0===this.m_glyphLoadingCount&&(this.m_loadPromise=void 0),++this.m_glyphLoadingCount,this.m_loadPromise=void 0===this.m_loadPromise?t:Promise.all([this.m_loadPromise,t])}return e.loadingState===u.LoadingState.Loaded&&this.m_initializedTextElementCount<y&&(o.textRenderStyle=e.renderStyle,o.textLayoutStyle=e.layoutStyle,e.glyphCaseArray=[],e.glyphs=o.fontCatalog.getGlyphs(e.text,o.textRenderStyle,e.glyphCaseArray),e.type!==f.TextElementType.PathLabel&&(e.bounds=new s.Box2,i.poiMeasurementParams.letterCaseArray=e.glyphCaseArray,o.measureText(e.glyphs,e.bounds,i.poiMeasurementParams)),e.loadingState=u.LoadingState.Initialized,++this.m_initializedTextElementCount),void 0!==e.glyphs}initializeDefaultAssets(){const e=this.m_fontCatalogLoader.initialize(this.m_options.fontCatalog);this.m_textStyleCache.initializeDefaultTextElementStyle(e)}async initializeTextCanvases(){return this.m_fontCatalogLoader.loadCatalogs((e,t)=>{const i=this.m_textCanvasFactory.createTextCanvas(t);this.m_textRenderers.push({fontCatalog:e,textCanvas:i,poiRenderer:this.m_poiRendererFactory.createPoiRenderer(i)})}).then(()=>{let e;this.m_textRenderers.forEach(t=>{void 0===e&&(e=t.textCanvas)});const t=this.m_poiRendererFactory.createPoiRenderer(e);this.m_textStyleCache.initializeTextElementStyles(t,e,this.m_textRenderers)})}updateGlyphDebugMesh(){const e=o.debugContext.getValue("DEBUG_GLYPHS");void 0!==e&&(e&&void 0===this.m_debugGlyphTextureCacheMesh&&this.initializeGlyphDebugMesh(),n.assert(void 0!==this.m_debugGlyphTextureCacheMesh),n.assert(void 0!==this.m_debugGlyphTextureCacheWireMesh),this.m_debugGlyphTextureCacheMesh.visible=e,this.m_debugGlyphTextureCacheWireMesh.visible=e)}initializeGlyphDebugMesh(){const e=this.m_textRenderers[0].textCanvas.fontCatalog,t=new s.PlaneGeometry(e.textureSize.width/2.5,e.textureSize.height/2.5,e.textureSize.width/e.maxWidth,e.textureSize.height/e.maxHeight),i=new s.MeshBasicMaterial({transparent:!0,depthWrite:!1,depthTest:!1,map:e.texture});this.m_debugGlyphTextureCacheMesh=new s.Mesh(t,i),this.m_debugGlyphTextureCacheMesh.renderOrder=1e4,this.m_debugGlyphTextureCacheMesh.visible=!1,this.m_debugGlyphTextureCacheMesh.name="glyphDebug";const n=new s.WireframeGeometry(t),o=new s.LineBasicMaterial({transparent:!0,color:10066329,depthWrite:!1,depthTest:!1});this.m_debugGlyphTextureCacheWireMesh=new s.LineSegments(n,o),this.m_debugGlyphTextureCacheWireMesh.renderOrder=9999,this.m_debugGlyphTextureCacheWireMesh.visible=!1,this.m_debugGlyphTextureCacheWireMesh.name="glyphDebug",this.m_textRenderers[0].textCanvas.getLayer(r.DEFAULT_TEXT_CANVAS_LAYER).storage.scene.add(this.m_debugGlyphTextureCacheMesh,this.m_debugGlyphTextureCacheWireMesh)}updateTextElements(e,t){M.debug("updateTextElements"),P&&P.clear(),this.m_textElementStateCache.clearTextCache(),this.m_cacheInvalidated=!1,this.checkIfOverloaded(e);const i=this.overloaded&&this.m_viewState.isDynamic?n.PerformanceTimer.now():void 0;e.forEach(e=>{this.updateTextElementsFromSource(e.dataSource,e.storageLevel,Array.from(e.renderedTiles.values()),t,i)}),P&&P.log()}updateTextElementsFromSource(e,t,i,r,s){P&&(P.tiles+=i.length);const o=i;o.sort((e,t)=>e.tileKey.mortonCode()-t.tileKey.mortonCode());for(const e of o)this.prepareTextElementGroup(e.userTextElements,r);const a=[];this.createSortedGroupsForSorting(e,t,o,a);let l=0;for(const e of a)if(this.selectTextElementsToUpdateByDistance(e,r),void 0!==s){if(S>0){if(n.PerformanceTimer.now()-s>S){M.debug("Update time limit exceeded.");break}}if(l+=e.count(),l>=T){M.debug("Update label limit exceeded.");break}}}prepareTextElementGroup(e,t,i){if(0===e.elements.length)return;const[,r]=this.m_textElementStateCache.getOrSet(e,e=>{let{result:r,viewDistance:n}=c.checkReadyForPlacement(e.element,this.m_viewState,this.m_viewCamera,this.m_poiManager,t.type,i);return r!==c.PrePlacementResult.Ok||this.m_textElementStateCache.deduplicateElement(this.m_viewState.zoomLevel,e)||(r=c.PrePlacementResult.Duplicate,n=void 0),P&&(P.totalLabels++,P.results[r]++),n});P&&(++P.totalGroups,r||++P.newGroups)}createSortedGroupsForSorting(e,t,i,r){if(0===i.length)return;const n=[];for(const r of i)e.shouldRenderText(t,r.tileKey)&&n.push(r);const s=new Map;for(const e of n)for(const t of e.textElementGroups.groups.values()){if(0===t.elements.length)continue;const i=s.get(t.priority);void 0===i?s.set(t.priority,new G([new k(e,t)])):i.lists.push(new k(e,t))}if(0===s.size)return;for(const e of s){const t=e[1];r.push(t)}r.sort((e,t)=>t.priority-e.priority)}selectTextElementsToUpdateByDistance(e,t){const i=Math.max(this.m_options.maxDistanceRatioForTextLabels,this.m_options.maxDistanceRatioForPoiLabels),r=c.getMaxViewDistance(this.m_viewState,i);for(const i of e.lists)this.prepareTextElementGroup(i.group,t,r)}placeTextElements(e,t){const i={numRenderedTextElements:0,fadeAnimationRunning:!1,time:e},r=this.overloaded&&this.m_viewState.isDynamic?n.PerformanceTimer.now():void 0;if(C&&C.clear(),0===this.m_textElementStateCache.size)return void M.debug("Text element cache empty.");const s=this.m_forceNewLabelsPass||t;this.m_forceNewLabelsPass&&(t||M.debug("Force new label pass"),this.m_forceNewLabelsPass=!1);const o=this.m_options.maxNumVisibleLabels,a=this.m_textElementStateCache.sortedGroupStates;let l=a[0].priority,c=0;for(let e=0;e<a.length;++e){const t=a[e];C&&++C.totalGroups;const n=t.priority;if(s&&l!==n){if(this.placeNewTextElements(c,e,i),V(r))break;l=n,c=e}if(!this.placeTextElementGroup(t,i,o,_.PersistentLabels))break;if(V(r))break}s&&this.placeNewTextElements(c,a.length,i),C&&(C.numRenderedTextElements=i.numRenderedTextElements,C.log()),!this.m_options.disableFading&&i.fadeAnimationRunning&&this.m_viewUpdateCallback()}placeNewTextElements(e,t,i){const r=this.m_textElementStateCache.sortedGroupStates;for(let n=e;n<t&&this.placeTextElementGroup(r[n],i,this.m_options.maxNumVisibleLabels,_.NewLabels);++n);}placeOverlayTextElements(){if(void 0===this.m_overlayTextElements||0===this.m_overlayTextElements.length)return;const e=this.m_tmpVector.set(this.m_screenProjector.width,this.m_screenProjector.height),t=-e.width/2,i=e.height/2,n={},o={};for(const a of this.m_overlayTextElements){const l=this.m_textStyleCache.getTextElementStyle(a.style),c=l.textCanvas;if(void 0===c)continue;const h=c.getLayer(a.renderOrder||r.DEFAULT_TEXT_CANVAS_LAYER);if(void 0===a.loadingState&&(a.loadingState=u.LoadingState.Requested,void 0===a.renderStyle&&(a.renderStyle=new r.TextRenderStyle(Object.assign(Object.assign({},l.renderParams),a.renderParams))),void 0===a.layoutStyle&&(a.layoutStyle=new r.TextLayoutStyle(Object.assign(Object.assign({},l.layoutParams),a.layoutParams))),""===a.text?a.loadingState=u.LoadingState.Loaded:c.fontCatalog.loadCharset(a.text,a.renderStyle).then(()=>{a.loadingState=u.LoadingState.Loaded,this.m_viewUpdateCallback()})),a.loadingState===u.LoadingState.Loaded&&this.m_initializedTextElementCount<y&&(c.textRenderStyle=a.renderStyle,c.textLayoutStyle=a.layoutStyle,a.glyphCaseArray=[],a.glyphs=c.fontCatalog.getGlyphs(a.text,c.textRenderStyle,a.glyphCaseArray),a.loadingState=u.LoadingState.Initialized,++this.m_initializedTextElementCount),a.loadingState!==u.LoadingState.Initialized)continue;if(void 0!==h&&h.storage.drawCount+a.glyphs.length>h.storage.capacity)continue;let m;if(c.textRenderStyle=a.renderStyle,c.textLayoutStyle=a.layoutStyle,a.type!==f.TextElementType.PathLabel)D.x=t+a.position.x*e.width,D.y=i-a.position.y*e.height,void 0!==a.xOffset&&(D.x+=a.xOffset),void 0!==a.yOffset&&(D.y-=a.yOffset),F.x=D.x,F.y=D.y,F.z=0,o.position=F,n.layer=a.renderOrder,n.letterCaseArray=a.glyphCaseArray,n.pickingData=a.userData?a:void 0,c.addText(a.glyphs,F,n);else{D.x=t,D.y=i,void 0!==a.xOffset&&(D.x+=a.xOffset),void 0!==a.yOffset&&(D.y-=a.yOffset);const r=[];for(const t of a.path){const i=D.x+t.x*e.width,n=D.y-t.y*e.height;r.push(new s.Vector2(i,n))}m=new d.SimplePath;for(let e=0;e<r.length-1;++e)m.add(new s.LineCurve(r[e],r[e+1]));n.path=m,n.pathOverflow=!0,n.layer=a.renderOrder,n.letterCaseArray=a.glyphCaseArray,n.pickingData=a.userData?a:void 0,c.addText(a.glyphs,F,n)}}}getDistanceScalingFactor(e,t,i){let r=i/t;return r=1+(r-1)*e.distanceScale,r=Math.max(r,this.m_options.labelDistanceScaleMin),r=Math.min(r,this.m_options.labelDistanceScaleMax),r}getDistanceFadingFactor(e,t,i){let r=1;const n=t.viewDistance;if(void 0!==n&&void 0!==e.fadeFar&&e.fadeFar>0){const t=void 0===e.fadeNear?0:e.fadeNear,o=e.fadeFar;o>t&&(r=1-s.Math.clamp((n/i-t)/(o-t),0,1))}return r}addPointLabel(e,t,i,r,s,o,a,h){const d=e.element,u=e.textRenderState;n.assert(void 0===h||void 0!==e.iconRenderStates);const m=void 0!==h?e.iconRenderStates[h]:e.iconRenderState;n.assert(void 0!==m);const p=c.getMaxViewDistance(this.m_viewState,this.m_options.maxDistanceRatioForPoiLabels),f=void 0!==u&&""!==d.text;D.x=I.x=i.x,D.y=I.y=i.y;let g=1,v=1;const y=this.m_viewState.worldCenter.distanceTo(t);if(void 0!==y){if(void 0!==d.fadeFar&&(d.fadeFar<=0||d.fadeFar*this.m_viewState.maxVisibilityDist<y))return C&&++C.tooFar,!1;e.setViewDistance(y),v=this.getDistanceScalingFactor(d,y,this.m_viewState.lookAtDistance),g*=v}const _=this.getDistanceFadingFactor(d,e,this.m_viewState.maxVisibilityDist),x=d.poiInfo;let T=!1;const S=void 0!==x&&n.MathUtils.isClamped(this.m_viewState.zoomLevel,x.iconMinZoomLevel,x.iconMaxZoomLevel)&&!1!==x.isValid,w=S&&r.prepareRender(d,this.m_viewState.zoomLevel);if(w){if(l.PoiRenderer.computeIconScreenBox(x,I,v,this.m_viewState.zoomLevel,R),!this.m_screenCollisions.isVisible(R))return m.reset(),C&&++C.numNotVisible,!1;const e=!0===x.mayOverlap||!this.m_screenCollisions.isAllocated(R);if(!e&&!m.isVisible())return C&&++C.numNotVisible,!1;T=!e}else S&&!1!==x.isValid&&(this.m_forceNewLabelsPass=!0);if(f&&(void 0===x||void 0===this.m_viewState.zoomLevel||n.MathUtils.isClamped(this.m_viewState.zoomLevel,x.iconMinZoomLevel,x.iconMaxZoomLevel))&&(!0===d.ignoreDistance||void 0===e.viewDistance||e.viewDistance<p)&&(void 0===x||!0===x.isValid||!1!==x.iconIsOptional)){if(D.add(c.computePointTextOffset(d,U)),F.x=D.x,F.y=D.y,F.z=e.renderDistance,R.x=D.x+d.bounds.min.x*g,R.y=D.y+d.bounds.min.y*g,R.w=(d.bounds.max.x-d.bounds.min.x)*g,R.h=(d.bounds.max.y-d.bounds.min.y)*g,R.x-=4*g,R.y-=2*g,R.w+=8*g,R.h+=4*g,!this.m_screenCollisions.isVisible(R))return C&&C.numPoiTextsInvisible++,e.reset(),!1;const t=void 0!==d.poiInfo&&!0===d.poiInfo.textIsOptional;let i=!0;if(T||(i=!d.textMayOverlap&&this.m_screenCollisions.isAllocated(R),T=i&&!t),i&&!e.visible)return C&&C.numPoiTextsInvisible++,!1;if(i&&u.startFadeOut(o.time),(!i||u.isFading())&&(d.textReservesSpace&&!i&&this.m_screenCollisions.allocate(R),(u.isFading()||!this.m_viewState.cameraIsMoving||void 0===x||!0===x.renderTextDuringMovements)&&!m.isFadedOut())){i||u.startFadeIn(o.time),o.fadeAnimationRunning=o.fadeAnimationRunning||u.isFading();const e=u.opacity*_*d.renderStyle.opacity;if(e>0){z.letterCaseArray=d.glyphCaseArray,void 0===d.textBufferObject&&(d.textBufferObject=s.createTextBufferObject(d.glyphs,z));const t=d.renderStyle.backgroundOpacity>0&&s.textRenderStyle.fontSize.backgroundSize>0;a.bufferAdditionParams.layer=d.renderOrder,a.bufferAdditionParams.position=F,a.bufferAdditionParams.scale=g,a.bufferAdditionParams.opacity=e,a.bufferAdditionParams.backgroundOpacity=t?a.bufferAdditionParams.opacity*d.renderStyle.backgroundOpacity:0,a.bufferAdditionParams.pickingData=d.userData?d:void 0,s.addTextBufferObject(d.textBufferObject,a.bufferAdditionParams),C&&C.numRenderedPoiTexts++}}}if(w){if(T?m.startFadeOut(o.time):m.startFadeIn(o.time),o.fadeAnimationRunning=o.fadeAnimationRunning||m.isFading(),m.opacity*_>0){const t=!1!==x.reserveSpace&&!T;r.renderPoi(x,I,this.m_screenCollisions,e.renderDistance,v,t,m.opacity*_,this.m_viewState.zoomLevel),C&&C.numRenderedPoiIcons++}}return o.numRenderedTextElements++,!0}addPoiLabel(e,t,i,r,n){const s=e.element.points;return void 0!==this.m_screenProjector.project(s,D)&&this.addPointLabel(e,s,D,t,i,r,n)}addLineMarkerLabel(e,t,i,r,s,o){const a=e.element,l=a.points,c=a.poiInfo;if(0===l.length||!t.prepareRender(a,this.m_viewState.zoomLevel))return;let h;void 0!==c.shieldGroupIndex&&(h=i[c.shieldGroupIndex],void 0===h&&(h=[],i[c.shieldGroupIndex]=h));const d=c.technique,u=void 0!==d.minDistance?d.minDistance*d.minDistance:0;if(u>0&&void 0!==h)for(let i=0;i<l.length;++i){const a=l[i];if(void 0!==this.m_screenProjector.project(a,D)){let l=!1;for(let e=0;e<h.length;e+=2){if(l=n.Math2D.distSquared(h[e],h[e+1],D.x,D.y)<u,l)break}l||this.addPointLabel(e,a,D,t,r,s,o,i)&&h.push(D.x,D.y)}}else for(let i=0;i<l.length;++i){const n=l[i];void 0!==this.m_screenProjector.project(n,D)&&this.addPointLabel(e,n,D,t,r,s,o,i)}}addPathLabel(e,t,i,r,n){const o=c.getMaxViewDistance(this.m_viewState,this.m_options.maxDistanceRatioForTextLabels),a=e.element;if(!(!0===a.ignoreDistance||void 0===e.viewDistance||e.viewDistance<o))return C&&++C.tooFar,e.reset(),!1;if(void 0!==a.fadeFar&&(a.fadeFar<=0||a.fadeFar*this.m_viewState.maxVisibilityDist<e.renderDistance))return C&&++C.tooFar,e.reset(),!1;let l=i.textRenderStyle.fontSize.size/100,h=a.renderStyle.opacity,u=new s.Path;D.copy(t[0]);for(let e=0;e<t.length-1;++e)u.add(new d.SimpleLineCurve(t[e],t[e+1]));if(u.getPoint(.5).x-u.getPoint(.51).x>0){D.copy(t[t.length-1]),u=new s.Path;for(let e=t.length-1;e>0;--e)u.add(new d.SimpleLineCurve(t[e],t[e-1]))}e.setViewDistance(c.computeViewDistance(this.m_viewState.worldCenter,a));const m=-e.renderDistance;l*=this.getDistanceScalingFactor(a,m,this.m_viewState.lookAtDistance);const p=i.textRenderStyle.fontSize.size;if(i.textRenderStyle.fontSize.size=100*l,n.measurementParams.path=u,n.measurementParams.outputCharacterBounds=L,n.measurementParams.letterCaseArray=a.glyphCaseArray,!i.measureText(a.glyphs,A,n.measurementParams))return i.textRenderStyle.fontSize.size=p,C&&++C.numNotVisible,e.reset(),!1;for(const e of L)if(R.x=D.x+e.min.x,R.y=D.y+e.min.y,R.w=e.max.x-e.min.x,R.h=e.max.y-e.min.y,!this.m_screenCollisions.isVisible(R)||!a.textMayOverlap&&this.m_screenCollisions.isAllocated(R))return i.textRenderStyle.fontSize.size=p,C&&++C.numNotVisible,!1;e.textRenderState.startFadeIn(r.time),e.textRenderState.isFading()&&(h=e.textRenderState.opacity*a.renderStyle.opacity,r.fadeAnimationRunning=!0);const f=i.textRenderStyle.opacity,g=i.textRenderStyle.backgroundOpacity,v=this.getDistanceFadingFactor(a,e,this.m_viewState.maxVisibilityDist);return i.textRenderStyle.opacity=h*v,i.textRenderStyle.backgroundOpacity=i.textRenderStyle.opacity*a.renderStyle.backgroundOpacity,F.z=e.renderDistance,n.additionParams.path=u,n.additionParams.layer=a.renderOrder,n.additionParams.letterCaseArray=a.glyphCaseArray,n.additionParams.pickingData=a.userData?a:void 0,i.addText(a.glyphs,F,n.additionParams),a.textReservesSpace&&(R.x=D.x+A.min.x,R.y=D.y+A.min.y,R.w=A.max.x-A.min.x,R.h=A.max.y-A.min.y,this.m_screenCollisions.allocate(R)),r.numRenderedTextElements++,i.textRenderStyle.fontSize.size=p,i.textRenderStyle.opacity=f,i.textRenderStyle.backgroundOpacity=g,!0}checkForSmallLabels(e,t){t.length=0;let i=!1;for(const r of e.points){void 0!==(i?this.m_screenProjector.project(r,D):this.m_screenProjector.projectOnScreen(r,D))&&(i=!0,t.push(D.clone()))}if(!i)return!1;const r=e.text.length*b;return A.setFromPoints(t),!(A.max.sub(A.min).lengthSq()<r*r)||(e.dbgPathTooSmall=!0,!1)}checkIfOverloaded(e){let t=0;e.forEach(e=>{for(const i of e.renderedTiles.values())t+=i.textElementGroups.count(),t+=i.userTextElements.elements.length});const i=t>x;return i&&!this.m_overloaded&&M.debug("Overloaded Mode enabled."),this.m_overloaded=i,this.m_overloaded}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(0),s=i(50),o=i(83);var a;!function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.Area=3]="Area",e[e.Text=4]="Text",e[e.Icon=5]="Icon",e[e.Object3D=6]="Object3D"}(a=t.PickObjectType||(t.PickObjectType={}));t.PickHandler=class{constructor(e,t,i=!0){this.mapView=e,this.camera=t,this.enableRoadPicking=i,this.m_plane=new n.Plane(new n.Vector3(0,0,1)),i&&(this.m_roadPicker=new o.RoadPicker(e))}registerTile(e){return void 0!==this.m_roadPicker?this.m_roadPicker.registerTile(e):void 0}intersectMapObjects(e,t){const i=this.mapView.getNormalizedScreenCoordinates(e,t),s=this.mapView.raycasterFromScreenPoint(e,t),o=[];if(void 0!==this.mapView.textElementsRenderer){const{clientWidth:e,clientHeight:t}=this.mapView.canvas,r=i.x*e*.5*this.mapView.pixelRatio,s=i.y*t*.5*this.mapView.pixelRatio,a=new n.Vector2(r,s);this.mapView.textElementsRenderer.pickTextElements(a,o)}const l=s.intersectObjects(this.mapView.worldRootObject.children,!0);for(const e of l){const t={type:a.Unspecified,point:e.point,distance:e.distance,intersection:e};if(void 0===e.object.userData||void 0===e.object.userData.feature){o.push(t);continue}const i=e.object.userData.feature;if(this.addObjInfo(i,e,t),void 0!==i.objInfos){const e=1===i.objInfos.length?r.getFeatureId(i.objInfos[0]):void 0;t.featureId=e}let n;switch(i.geometryType){case r.GeometryType.Point:case r.GeometryType.Text:n=a.Point;break;case r.GeometryType.Line:case r.GeometryType.ExtrudedLine:case r.GeometryType.SolidLine:case r.GeometryType.TextPath:n=a.Line;break;case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:n=a.Area;break;case r.GeometryType.Object3D:n=a.Object3D;break;default:n=a.Unspecified}t.type=n,o.push(t)}if(this.enableRoadPicking){const e=new n.Vector3,t=this.mapView.camera.position.clone();s.setFromCamera(i,this.mapView.camera),s.ray.intersectPlane(this.m_plane,e),this.mapView.forEachVisibleTile(i=>{this.m_roadPicker.intersectRoads(i,t,e,o)})}return o.sort((e,t)=>e.distance-t.distance),o}addObjInfo(e,t,i){if(i.intersection.object instanceof s.MapViewPoints)i.userData=e.objInfos[t.index];else if(void 0!==e.objInfos&&void 0!==e.starts&&void 0!==t.faceIndex)if(e.starts.length>1){let r=0;for(const i of e.starts){if(i>3*t.faceIndex)break;r++}i.userData=e.objInfos[r-1]}else i.userData=e.objInfos[0]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(3),n=i(1),s=i(0),o=i(24),a=i(201),l=i(202),c=i(9),h=n.LoggerManager.instance.create("Tile"),d=16,u=100;var m;t.getFeatureDataSize=function(e){let t=u;return void 0!==e.starts&&(t+=8*e.starts.length),void 0!==e.objInfos&&(t+=e.objInfos.length*d),t},function(e){e[e.Initialized=0]="Initialized",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded",e[e.Decoding=3]="Decoding",e[e.Ready=4]="Ready",e[e.Canceled=5]="Canceled",e[e.Failed=6]="Failed"}(m=t.TileLoaderState||(t.TileLoaderState={}));t.Tile=class{constructor(e,t,i=0,n){this.dataSource=e,this.tileKey=t,this.offset=i,this.objects=[],this.dependencies=new Array,this.boundingBox=new r.OrientedBox3,this.maxGeometryHeight=0,this.frameNumLastRequested=-1,this.frameNumVisible=-1,this.frameNumLastVisible=-1,this.numFramesVisible=0,this.visibilityCounter=-1,this.levelOffset=0,this.m_disposed=!1,this.m_localTangentSpace=!1,this.m_forceHasGeometry=void 0,this.m_userTextElements=new a.TextElementGroup(Number.MAX_SAFE_INTEGER),this.m_textElementGroups=new l.TextElementGroupPriorityList,this.m_pathBlockingElements=[],this.m_textElementsChanged=!1,this.m_visibleArea=0,this.m_minElevation=0,this.m_maxElevation=0,this.m_ownedTextures=new WeakSet,this.m_nextTextElementToOverlay={groupIndex:0,elementIndex:0},this.geoBox=this.dataSource.getTilingScheme().getGeoBox(this.tileKey),this.projection.projectBox(this.geoBox,this.boundingBox),this.m_localTangentSpace=void 0!==n&&n}get isVisible(){return this.frameNumLastRequested>=this.dataSource.mapView.frameNumber-1}set isVisible(e){this.frameNumLastRequested=e?this.dataSource.mapView.frameNumber:-1}get projection(){return this.dataSource.projection}get mapView(){return this.dataSource.mapView}get localTangentSpace(){return this.m_localTangentSpace}get memoryUsage(){return void 0===this.m_resourceInfo&&this.computeResourceInfo(),this.m_resourceInfo.heapSize}get center(){return this.boundingBox.position}getResourceInfo(){return void 0===this.m_resourceInfo&&this.computeResourceInfo(),this.m_resourceInfo}invalidateResourceInfo(){this.m_resourceInfo=void 0}addOwnedTexture(e){this.m_ownedTextures.add(e)}get userTextElements(){return this.m_userTextElements}addUserTextElement(e){this.m_userTextElements.elements.push(e),this.textElementsChanged=!0}removeUserTextElement(e){const t=this.m_userTextElements.elements.indexOf(e);return t>=0&&(this.m_userTextElements.elements.splice(t,1),this.textElementsChanged=!0,!0)}addTextElement(e){this.textElementGroups.add(e),this.textElementsChanged=!0}addBlockingElement(e){this.m_pathBlockingElements.push(e)}removeTextElement(e){return!!this.textElementGroups.remove(e)&&(this.textElementsChanged=!0,!0)}get textElementGroups(){return this.m_textElementGroups}get textElementsChanged(){return this.m_textElementsChanged}set textElementsChanged(e){this.m_textElementsChanged=e}hasTextElements(){return this.m_textElementGroups.count()>0||this.m_userTextElements.elements.length>0}get blockingElements(){return this.m_pathBlockingElements}prepareTileInfo(){void 0!==this.m_decodedTile&&!this.m_disposed&&this.isVisible&&void 0!==this.m_decodedTile.tileInfo&&(this.roadIntersectionData=this.dataSource.mapView.pickHandler.registerTile(this))}willRender(e){return!0}didRender(){}get visibleArea(){return this.m_visibleArea}set visibleArea(e){this.m_visibleArea=e,void 0!==this.tileLoader&&this.tileLoader.updatePriority(e)}get minElevation(){return this.m_minElevation}set minElevation(e){this.m_minElevation=e}get maxElevation(){return this.m_maxElevation}set maxElevation(e){this.m_maxElevation=e}get decodedTile(){return this.m_decodedTile}set decodedTile(e){if(this.m_decodedTile=e,this.invalidateResourceInfo(),void 0===e)return;0===e.geometries.length&&this.forceHasGeometry(!0),void 0!==e.boundingBox&&this.boundingBox.copy(e.boundingBox);const t=o.PerformanceStatistics.instance;t.enabled&&void 0!==e.decodeTime&&(t.currentFrame.addValue("decode.decodingTime",e.decodeTime),t.currentFrame.addValue("decode.decodedTiles",1)),void 0!==e.copyrightHolderIds&&(this.copyrightInfo=e.copyrightHolderIds.map(e=>({id:e}))),this.dataSource.requestUpdate()}removeDecodedTile(){this.m_decodedTile=void 0,this.invalidateResourceInfo()}loadingFinished(){}shouldDisposeObjectGeometry(e){return!0}shouldDisposeObjectMaterial(e){return!0}shouldDisposeTexture(e){return this.m_ownedTextures.has(e)}get disposed(){return this.m_disposed}get tileGeometryLoader(){return this.m_tileGeometryLoader}set tileGeometryLoader(e){this.m_tileGeometryLoader=e}get basicGeometryLoaded(){return void 0===this.m_tileGeometryLoader?this.hasGeometry:this.m_tileGeometryLoader.basicGeometryLoaded||this.m_tileGeometryLoader.isFinished}get allGeometryLoaded(){return void 0===this.m_tileGeometryLoader?this.hasGeometry:this.m_tileGeometryLoader.allGeometryLoaded||this.m_tileGeometryLoader.isFinished}get hasGeometry(){return void 0===this.m_forceHasGeometry?0!==this.objects.length:this.m_forceHasGeometry}forceHasGeometry(e){this.m_forceHasGeometry=e}resetVisibilityCounter(){this.visibilityCounter=-1}get tileLoader(){return this.m_tileLoader}set tileLoader(e){this.m_tileLoader=e}load(){const e=this.tileLoader;void 0!==e&&e.loadAndDecode().then(t=>{n.assert(t===m.Ready);const i=e.decodedTile;this.decodedTile=i}).catch(e=>{e!==m.Canceled&&e!==m.Failed&&h.error("Unknown error"+e)})}get animatedExtrusionTileHandler(){return this.m_animatedExtrusionTileHandler}set animatedExtrusionTileHandler(e){this.m_animatedExtrusionTileHandler=e}get allTextElementsOverlaid(){return this.allGeometryLoaded&&this.nextTextElementToOverlay.groupIndex>=this.m_textElementGroups.groups.size}get nextTextElementToOverlay(){return this.m_nextTextElementToOverlay}set nextTextElementToOverlay(e){this.m_nextTextElementToOverlay=e}clear(){const e=e=>{Object.getOwnPropertyNames(e).forEach(t=>{const i=e[t];if(void 0!==i&&i instanceof s.Texture){const e=i;this.shouldDisposeTexture(e)&&e.dispose()}}),e.dispose()},t=t=>{void 0!==t.geometry&&this.shouldDisposeObjectGeometry(t)&&t.geometry.dispose(),void 0!==t.material&&this.shouldDisposeObjectMaterial(t)&&(t.material instanceof Array?t.material.forEach(t=>{void 0!==t&&e(t)}):e(t.material))};this.objects.forEach(e=>{e.traverse(e=>{t(e)}),t(e)}),this.objects.length=0,this.preparedTextPaths&&(this.preparedTextPaths=[]),void 0!==this.m_animatedExtrusionTileHandler&&this.m_animatedExtrusionTileHandler.dispose(),this.clearTextElements(),this.invalidateResourceInfo()}clearTextElements(){this.textElementsChanged=this.hasTextElements(),this.m_pathBlockingElements.splice(0),this.textElementGroups.clear(),this.userTextElements.elements.length=0}dispose(){this.m_disposed||(this.m_tileLoader&&(this.m_tileLoader.cancel(),this.m_tileLoader=void 0),void 0!==this.m_tileGeometryLoader&&(this.m_tileGeometryLoader.dispose(),this.m_tileGeometryLoader=void 0),this.clear(),this.userTextElements.elements.length=0,this.m_disposed=!0,this.frameNumLastRequested=0)}computeWorldOffsetX(){return this.projection.worldExtent(0,0).max.x*this.offset}computeResourceInfo(){let e=0,t=0,i=0,r=0;const n={heapSize:0,gpuSize:0},s=new Map;for(const e of this.objects)e.visible&&t++,c.MapViewUtils.estimateObject3dSize(e,n,s);for(const e of this.textElementGroups.groups)i+=e[1].elements.length;r=this.userTextElements.elements.length,e+=312*(i+r),void 0!==this.m_decodedTile&&void 0!==this.m_decodedTile.tileInfo&&(n.heapSize+=this.m_decodedTile.tileInfo.numBytes),void 0!==this.roadIntersectionData&&(e+=function(e){let t=u;const i=32+u,r=e.techniqueIndex.length;return t+=e.techniqueIndex.length*i,void 0!==e.ids&&(t+=8*r),void 0!==e.objInfos&&(t+=r*d),t}(this.roadIntersectionData)),this.m_resourceInfo={heapSize:n.heapSize+e,gpuSize:n.gpuSize,num3dObjects:t,numTextElements:i,numUserTextElements:r}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),n=i(1),s=i(30);var o;!function(e){e[e.None=0]="None",e[e.Started=1]="Started",e[e.Playing=2]="Playing",e[e.Finished=3]="Finished"}(o=t.AnimatedExtrusionState||(t.AnimatedExtrusionState={}));t.AnimatedExtrusionHandler=class{constructor(e){this.m_mapView=e,this.enabled=!0,this.duration=750,this.forceEnabled=!1,this.m_tileHandlerMap=new Map,this.m_zoomDirection=0,this.m_zoomLevelPrevious=this.m_mapView.zoomLevel}get zoomDirection(){return this.m_zoomDirection}set zoom(e){this.m_zoomLevelPrevious!==e&&(this.m_tileHandlerMap.forEach(t=>{void 0!==this.m_mapView.getDataSourceByName(t.tile.dataSource.name)&&(this.m_zoomDirection=e>this.m_zoomLevelPrevious?1:-1,t.zoomLevelChanged(this.m_zoomDirection))}),this.m_zoomLevelPrevious=e)}get forceAnimatedExtrusion(){return this.m_forceAnimatedExtrusion}set forceAnimatedExtrusion(e){this.m_forceAnimatedExtrusion=e}get forceAnimatedExtrusionDuration(){return this.m_forceAnimatedExtrusionDuration}set forceAnimatedExtrusionDuration(e){this.m_forceAnimatedExtrusionDuration=e}add(e){this.m_tileHandlerMap.set(e.tile,e)}removeTile(e){this.m_tileHandlerMap.delete(e)}find(e){for(const t of this.m_tileHandlerMap)for(const i of e)if(void 0!==i&&t[0].tileKey.mortonCode()===i.mortonCode())return t[1]}get isAnimating(){for(const e of this.m_tileHandlerMap)if(e[1].isAnimating)return!0;return!1}};t.AnimatedExtrusionTileHandler=class{constructor(e,t,i){this.m_tile=e,this.m_animatedExtrusionDuration=i,this.m_extrudedObjects=[],this.m_animatedExtrusionRatio=r.ExtrusionFeature.DEFAULT_RATIO_MAX,this.m_animatedExtrusionState=o.None,this.m_animatedExtrusionStartTime=void 0,this.animateExtrusion=e=>{if(this.m_animatedExtrusionState!==o.Playing){if(this.m_animatedExtrusionState!==o.Started)return;this.m_animatedExtrusionState=o.Playing}const t=Date.now();(void 0===this.m_animatedExtrusionStartTime||this.m_animatedExtrusionStartTime<=0)&&(this.m_animatedExtrusionStartTime=t);const i=Math.min(t-this.m_animatedExtrusionStartTime,this.m_animatedExtrusionDuration);this.extrusionRatio=n.MathUtils.easeInOutCubic(r.ExtrusionFeature.DEFAULT_RATIO_MIN,r.ExtrusionFeature.DEFAULT_RATIO_MAX,i/this.m_animatedExtrusionDuration),i>=this.m_animatedExtrusionDuration&&(this.m_animatedExtrusionState=o.Finished,this.stopExtrusionAnimation()),this.m_tile.dataSource.requestUpdate()},this.m_mapView=e.mapView,this.m_animatedExtrusionHandler=this.m_mapView.animatedExtrusionHandler,t.forEach(e=>{e.materialFeature&&r.ExtrusionFeature.addRenderHelper(e.object),this.m_extrudedObjects.push(e.object)}),this.startExtrusionAnimationIfNeeded(this.m_animatedExtrusionHandler.zoomDirection)}set extrusionRatio(e){this.m_animatedExtrusionRatio=e,this.m_extrudedObjects.forEach(e=>{e.material.extrusionRatio=this.m_animatedExtrusionRatio})}get tile(){return this.m_tile}get animationState(){return this.m_animatedExtrusionState}get isAnimating(){return this.m_animatedExtrusionState!==o.Finished}dispose(){this.stopExtrusionAnimation(),this.m_animatedExtrusionHandler.removeTile(this.m_tile)}zoomLevelChanged(e){!1===this.m_tile.isVisible&&this.m_animatedExtrusionState!==o.None&&(this.m_animatedExtrusionState=o.None,this.stopExtrusionAnimation()),!0===this.m_tile.isVisible&&this.m_animatedExtrusionState===o.None&&this.startExtrusionAnimationIfNeeded(e)}getChildTiles(e){const t=[];return e.forEach(e=>{const i=this.tile.dataSource.getTilingScheme().getSubTileKeys(e);for(const e of i)t.push(e)}),t}startExtrusionAnimationIfNeeded(e){const{quadTreeSearchDistanceUp:t,quadTreeSearchDistanceDown:i}=this.tile.mapView.visibleTileSet.options,r=this.m_tile;let n;if(void 0!==e){let s;if(e<0){let e=0,t=[r.tileKey];for(;i>e&&void 0===n;){const i=this.getChildTiles(t);if(void 0!==i){if(s=this.m_animatedExtrusionHandler.find(i),void 0!==s){n=s.m_animatedExtrusionStartTime;break}t=i}e++}}if(e>0){let e=0,i=r.tileKey;for(;t>e&&void 0===n&&0!==i.level;){const t=i.parent();if(s=this.m_animatedExtrusionHandler.find([t]),void 0!==s){n=s.m_animatedExtrusionStartTime;break}i=t,e++}}}this.startExtrusionAnimation(n)}startExtrusionAnimation(e){this.m_animatedExtrusionState=o.Started,this.m_animatedExtrusionStartTime=e,this.animateExtrusion(),this.m_mapView.addEventListener(s.MapViewEventNames.AfterRender,this.animateExtrusion)}stopExtrusionAnimation(){this.m_mapView.removeEventListener(s.MapViewEventNames.AfterRender,this.animateExtrusion)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(18),s=i(0),o=i(146),a=i(147);function l(e,t){return e*t.maximum}var c,h,d;!function(e){e.updateDisplacementFeature=function(e){e.needsUpdate=!0,void 0===e.defines&&(e.defines={}),void 0!==e.displacementMap&&(e.displacementMap.needsUpdate=!0,e.defines.USE_DISPLACEMENTMAP="")},e.onBeforeCompile=function(e,t){if(void 0===e.displacementMap)return;const i=t.uniforms;i.displacementMap={value:e.displacementMap},i.displacementScale={value:1},i.displacementBias={value:0},t.vertexShader=t.vertexShader.replace("#include <skinbase_vertex>","#include <skinbase_vertex>\n#ifndef USE_ENVMAP\n    vec3 objectNormal = vec3( normal );\n#endif"),t.vertexShader=n.insertShaderInclude(t.vertexShader,"uv2_pars_vertex","displacementmap_pars_vertex"),t.vertexShader=n.insertShaderInclude(t.vertexShader,"skinning_vertex","displacementmap_vertex",!0)}}(c=t.DisplacementFeature||(t.DisplacementFeature={}));class u{getDisplacementMap(){return this.m_displacementMap}setDisplacementMap(e){this.needsUpdate=this.needsUpdate||e!==this.m_displacementMap,this.m_displacementMap=e,this.needsUpdate&&c.updateDisplacementFeature(this)}addDisplacementProperties(){Object.defineProperty(this,"displacementMap",{get:()=>this.getDisplacementMap(),set:e=>{this.setDisplacementMap(e)}})}applyDisplacementParameters(e){void 0!==e&&void 0!==e.displacementMap&&this.setDisplacementMap(e.displacementMap),this.onBeforeCompile=e=>{c.onBeforeCompile(this,e)}}copyDisplacementParameters(e){return this.setDisplacementMap(e.displacementMap),this}}t.DisplacementFeatureMixin=u,function(e){e.DEFAULT_FADE_NEAR=-1,e.DEFAULT_FADE_FAR=-1,e.patchGlobalShaderChunks=function(){void 0===s.ShaderChunk.fading_pars_vertex&&Object.assign(s.ShaderChunk,a.default)},e.updateDistanceFadeFeature=function(e){e.needsUpdate=!0,void 0===e.defines&&(e.defines={}),void 0!==e.fadeFar&&e.fadeFar>0&&(e.defines.FADING_MATERIAL="")},e.onBeforeCompile=function(e,t){if(void 0===e.fadeFar||e.fadeFar<=0)return;const i=t.uniforms;i.fadeNear={value:e.fadeNear},i.fadeFar={value:e.fadeFar},t.vertexShader=n.insertShaderInclude(t.vertexShader,"fog_pars_vertex","fading_pars_vertex"),t.vertexShader=n.insertShaderInclude(t.vertexShader,"fog_vertex","fading_vertex",!0),t.fragmentShader=n.insertShaderInclude(t.fragmentShader,"fog_pars_fragment","fading_pars_fragment"),t.fragmentShader=n.insertShaderInclude(t.fragmentShader,"fog_fragment","fading_fragment",!0)},e.addRenderHelper=function(t,i,n,s,o,a){t.onBeforeRender=r.chainCallbacks(t.onBeforeRender,(t,r,c,h,d,u)=>{const m=d;if(m.fadeNear=void 0===n?e.DEFAULT_FADE_NEAR:l(n,i),m.fadeFar=void 0===s?e.DEFAULT_FADE_FAR:l(s,i),o){const e=t.properties.get(d);void 0!==e.shader&&void 0!==e.shader.uniforms.fadeNear&&(e.shader.uniforms.fadeNear.value=m.fadeNear,e.shader.uniforms.fadeFar.value=m.fadeFar,m.uniformsNeedUpdate=!0)}void 0!==a&&a(t,d)})}}(h=t.FadingFeature||(t.FadingFeature={}));class m{constructor(){this.m_fadeNear=h.DEFAULT_FADE_NEAR,this.m_fadeFar=h.DEFAULT_FADE_FAR}getFadeNear(){return this.m_fadeNear}setFadeNear(e){this.needsUpdate=this.needsUpdate||e!==this.m_fadeNear,this.m_fadeNear=e,this.needsUpdate&&h.updateDistanceFadeFeature(this)}getFadeFar(){return this.m_fadeFar}setFadeFar(e){this.needsUpdate=this.needsUpdate||e!==this.m_fadeFar,this.m_fadeFar=e,this.needsUpdate&&h.updateDistanceFadeFeature(this)}addFadingProperties(){Object.defineProperty(this,"fadeNear",{get:()=>this.getFadeNear(),set:e=>{this.setFadeNear(e)}}),Object.defineProperty(this,"fadeFar",{get:()=>this.getFadeFar(),set:e=>{this.setFadeFar(e)}})}applyFadingParameters(e){void 0!==e&&(void 0!==e.fadeNear&&this.setFadeNear(e.fadeNear),void 0!==e.fadeFar&&this.setFadeFar(e.fadeFar)),this.onBeforeCompile=e=>{h.onBeforeCompile(this,e)}}copyFadingParameters(e){return this.setFadeNear(void 0===e.fadeNear?h.DEFAULT_FADE_NEAR:e.fadeNear),this.setFadeFar(void 0===e.fadeFar?h.DEFAULT_FADE_FAR:e.fadeFar),this}}t.FadingFeatureMixin=m,function(e){e.DEFAULT_RATIO_MIN=.001,e.DEFAULT_RATIO_MAX=1,e.patchGlobalShaderChunks=function(){void 0===s.ShaderChunk.extrusion_pars_vertex&&Object.assign(s.ShaderChunk,o.default)},e.updateExtrusionFeature=function(t){t.needsUpdate=!0,void 0===t.defines&&(t.defines={}),void 0!==t.extrusionRatio&&t.extrusionRatio>=e.DEFAULT_RATIO_MIN&&(t.defines.EXTRUSION_MATERIAL="")},e.onBeforeCompile=function(e,t){if(void 0===e.extrusionRatio)return;t.uniforms.extrusionRatio={value:e.extrusionRatio},t.vertexShader=n.insertShaderInclude(t.vertexShader,"common","extrusion_pars_vertex"),t.vertexShader=n.insertShaderInclude(t.vertexShader,"begin_vertex","extrusion_vertex",!0),t.fragmentShader=n.insertShaderInclude(t.fragmentShader,"fog_pars_fragment","extrusion_pars_fragment"),t.fragmentShader=t.fragmentShader.replace("#include <normal_fragment_begin>","#include <extrusion_normal_fragment_begin>"),t.fragmentShader=n.insertShaderInclude(t.fragmentShader,"fog_fragment","extrusion_fragment",!0)},e.addRenderHelper=function(t){t.onBeforeRender=r.chainCallbacks(t.onBeforeRender,e.onBeforeRender)},e.onBeforeRender=function(t,i,r,n,s,o){const a=s,l=t.properties.get(s);void 0!==l.shader&&void 0!==l.shader.uniforms.extrusionRatio&&(l.shader.uniforms.extrusionRatio.value=a.extrusionRatio||e.DEFAULT_RATIO_MAX,a.uniformsNeedUpdate=!0)}}(d=t.ExtrusionFeature||(t.ExtrusionFeature={}));class p{constructor(){this.m_extrusion=d.DEFAULT_RATIO_MAX}getExtrusionRatio(){return this.m_extrusion}setExtrusionRatio(e){this.needsUpdate=this.needsUpdate||e!==this.m_extrusion,this.m_extrusion=e,this.needsUpdate&&d.updateExtrusionFeature(this)}addExtrusionProperties(){Object.defineProperty(this,"extrusionRatio",{get:()=>this.getExtrusionRatio(),set:e=>{this.setExtrusionRatio(e)}})}applyExtrusionParameters(e){void 0!==e&&void 0!==e.extrusionRatio&&this.setExtrusionRatio(e.extrusionRatio),this.onBeforeCompile=e=>{d.onBeforeCompile(this,e)}}copyExtrusionParameters(e){return void 0!==e.extrusionRatio&&this.setExtrusionRatio(e.extrusionRatio),this}}t.ExtrusionFeatureMixin=p;class f extends s.MeshBasicMaterial{constructor(e){super(e),h.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),d.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(e),this.addDisplacementProperties(),this.applyDisplacementParameters(e)}clone(){return(new f).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this.copyDisplacementParameters(e),this}get fadeNear(){return h.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return h.DEFAULT_FADE_FAR}set fadeFar(e){}get extrusionRatio(){return d.DEFAULT_RATIO_MAX}set extrusionRatio(e){}get displacementMap(){}set displacementMap(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}addDisplacementProperties(){}applyDisplacementParameters(e){}copyDisplacementParameters(e){}}t.MapMeshBasicMaterial=f;class g extends s.MeshStandardMaterial{constructor(e){super(e),h.patchGlobalShaderChunks(),this.addFadingProperties(),this.applyFadingParameters(e),d.patchGlobalShaderChunks(),this.addExtrusionProperties(),this.applyExtrusionParameters(e)}clone(){return(new g).copy(this)}copy(e){return super.copy(e),this.copyFadingParameters(e),this.copyExtrusionParameters(e),this}get fadeNear(){return h.DEFAULT_FADE_NEAR}set fadeNear(e){}get fadeFar(){return h.DEFAULT_FADE_FAR}set fadeFar(e){}get extrusionRatio(){return d.DEFAULT_RATIO_MAX}set extrusionRatio(e){}addFadingProperties(){}applyFadingParameters(e){}copyFadingParameters(e){}addExtrusionProperties(){}applyExtrusionParameters(e){}copyExtrusionParameters(e){}}t.MapMeshStandardMaterial=g,r.applyMixinsWithoutProperties(f,[m]),r.applyMixinsWithoutProperties(g,[m]),r.applyMixinsWithoutProperties(f,[p]),r.applyMixinsWithoutProperties(g,[p]),r.applyMixinsWithoutProperties(f,[u])},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Log=2]="Log",e[e.Info=3]="Info",e[e.Warn=4]="Warn",e[e.Error=5]="Error"}(t.LogLevel||(t.LogLevel={}));t.LoggerOptions=class{}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveReferenceUri=function(e,t){if(r.test(t))return t;if(t.startsWith("/")){return s(e)+t}return t.startsWith("./")&&(t=t.substr(2)),n(e)+t};const r=new RegExp("^(?:[a-z]+:)?//","i");function n(e){if(void 0===e)return"./";let t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),t=e.indexOf("?"),-1!==t&&(e=e.slice(0,t)),t=e.lastIndexOf("/"),-1===t?"./":e.substring(0,t+1)}function s(e){if(void 0===e)return"";const t=o(e);return"file:"===t.protocol?"file://":t.host&&t.protocol?t.protocol+"//"+t.host:t.host?"//"+t.host:t.protocol?t.protocol+"//":""}function o(e){const t=new RegExp(/^(?:([a-z]+:))?\/\/([^\/]*)/,"i"),i=e.match(t);if(!i)throw new Error(`getUrlHostAndProtocol: unable to parse URL '${e}'`);return{protocol:i[1],host:i[2]}}t.baseUrl=n,t.getUrlOrigin=s,t.getUrlHostAndProtocol=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={extrude_line_vert_func:"\nvec3 extrudeLine(\n        in vec3 vertexPosition,\n        in float linePosition,\n        in float lineWidth,\n        in vec4 bitangent,\n        in vec3 tangent,\n        inout vec2 uv\n    ) {\n    vec3 result = vertexPosition;\n    // Retrieve the angle between this segment and the previous one (stored in the bitangent w\n    // component).\n    float angle = bitangent.w;\n    // Extrude according to the angle between segments to properly render narrow joints...\n    if (angle != 0.0) {\n        result += uv.y * lineWidth * bitangent.xyz / cos(angle / 2.0);\n        uv.x = linePosition + uv.x * lineWidth * uv.y * tan(angle / 2.0);\n    }\n    // ... or extrude in a simple manner for segments that keep the same direction.\n    else {\n        result += uv.y * lineWidth * bitangent.xyz + uv.x * lineWidth * tangent;\n        uv.x = linePosition + uv.x * lineWidth;\n    }\n    uv.y *= lineWidth;\n    return result;\n}\n",round_edges_and_add_caps:"\nfloat roundEdgesAndAddCaps(in vec4 coords, in vec3 range) {\n    // Compute the line's width to length ratio.\n    float widthRatio = range.y / range.x;\n\n    // Compute the inner segment distance (same for all cap mode).\n    float dist = abs(coords.y);\n    float segmentBeginMask = clamp(ceil(coords.z - coords.x), 0.0, 1.0);\n    float segmentEndMask = clamp(ceil(coords.x - coords.w), 0.0, 1.0);\n    dist = max(dist, segmentBeginMask * length(vec2((coords.x - coords.z) / widthRatio, coords.y)));\n    dist = max(dist, segmentEndMask * length(vec2((coords.x - coords.w) / widthRatio, coords.y)));\n\n    #if !CAPS_ROUND\n    // Compute the caps mask.\n    float capRangeMask = clamp(1.0 - ceil(range.z - drawRange.y), 0.0, 1.0);\n    float beginCapMask = clamp(ceil(drawRange.x - coords.x), 0.0, 1.0);\n    float endCapMask = clamp(ceil(coords.x - drawRange.y), 0.0, 1.0);\n    float capMask = capRangeMask * max(beginCapMask, endCapMask);\n\n    // Compute the outer segment distance (specific for each cap mode).\n    float capDist = max(coords.x - drawRange.y, drawRange.x - coords.x) / widthRatio;\n    #if CAPS_NONE\n    dist = mix(dist, max(abs(coords.y), (capDist + 0.1) / 0.1), capMask);\n    #elif CAPS_SQUARE\n    dist = mix(dist, max(abs(coords.y), capDist), capMask);\n    #elif CAPS_TRIANGLE_OUT\n    dist = mix(dist, abs(coords.y) + capDist, capMask);\n    #elif CAPS_TRIANGLE_IN\n    dist = mix(dist, max(abs(coords.y), (capDist - abs(coords.y)) + capDist), capMask);\n    #endif\n    #endif\n\n    return dist;\n}\n",tile_clip_func:"\nvoid tileClip(vec2 tilePos, vec2 tileSize) {\n    if (tileSize.x > 0.0 && (tilePos.x < -tileSize.x / 2.0 || tilePos.x > tileSize.x / 2.0))\n        discard;\n    if (tileSize.y > 0.0 && (tilePos.y < -tileSize.y / 2.0 || tilePos.y > tileSize.y / 2.0))\n        discard;\n}\n",high_precision_vert_func:"\nvec3 subtractDblEyePos( const in vec3 pos ) {\n    vec3 t1 = positionLow - u_eyepos_lowpart;\n    vec3 e = t1 - positionLow;\n    vec3 t2 = ((-u_eyepos_lowpart - e) + (positionLow - (t1 - e))) + pos - u_eyepos;\n    vec3 high_delta = t1 + t2;\n    vec3 low_delta = t2 - (high_delta - t1);\n    return (high_delta + low_delta);\n}\n"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(74),n=i(75);t.TEXTURE_PROPERTY_KEYS=["map","normalMap","displacementMap","roughnessMap","emissiveMap","alphaMap","metalnessMap","bumpMap"],t.TRANSPARENCY_PROPERTY_KEYS=["opacity","transparent"],t.techniqueDescriptors={},t.baseTechniqueParamsDescriptor={attrTransparencyColor:"color",attrScopes:{renderOrder:n.AttrScope.TechniqueGeometry,renderOrderOffset:n.AttrScope.TechniqueGeometry,enabled:n.AttrScope.TechniqueGeometry,kind:n.AttrScope.TechniqueGeometry,transient:n.AttrScope.TechniqueGeometry,fadeFar:n.AttrScope.TechniqueRendering,fadeNear:n.AttrScope.TechniqueRendering}},t.pointTechniquePropTypes=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{texture:n.AttrScope.TechniqueGeometry,enablePicking:n.AttrScope.TechniqueGeometry,color:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueGeometry}}),t.squaresTechniquePropTypes=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,t.pointTechniquePropTypes),t.techniqueDescriptors.squares=t.squaresTechniquePropTypes,t.circlesTechniquePropTypes=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,t.pointTechniquePropTypes),t.techniqueDescriptors.circles=t.circlesTechniquePropTypes;const s=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{text:n.AttrScope.FeatureGeometry,label:n.AttrScope.FeatureGeometry,useAbbreviation:n.AttrScope.FeatureGeometry,useIsoCode:n.AttrScope.FeatureGeometry,priority:n.AttrScope.TechniqueGeometry,textMinZoomLevel:n.AttrScope.TechniqueGeometry,textMaxZoomLevel:n.AttrScope.TechniqueGeometry,iconMinZoomLevel:n.AttrScope.TechniqueGeometry,iconMaxZoomLevel:n.AttrScope.TechniqueGeometry,distanceScale:n.AttrScope.TechniqueGeometry,textMayOverlap:n.AttrScope.TechniqueGeometry,iconMayOverlap:n.AttrScope.TechniqueGeometry,textReserveSpace:n.AttrScope.TechniqueGeometry,iconReserveSpace:n.AttrScope.TechniqueGeometry,renderTextDuringMovements:n.AttrScope.TechniqueGeometry,alwaysOnTop:n.AttrScope.TechniqueGeometry,textIsOptional:n.AttrScope.TechniqueGeometry,showOnMap:n.AttrScope.TechniqueGeometry,stackMode:n.AttrScope.TechniqueGeometry,minDistance:n.AttrScope.TechniqueGeometry,iconIsOptional:n.AttrScope.TechniqueGeometry,iconFadeTime:n.AttrScope.TechniqueGeometry,textFadeTime:n.AttrScope.TechniqueGeometry,xOffset:n.AttrScope.TechniqueGeometry,yOffset:n.AttrScope.TechniqueGeometry,iconXOffset:n.AttrScope.TechniqueGeometry,iconYOffset:n.AttrScope.TechniqueGeometry,iconScale:n.AttrScope.TechniqueGeometry,screenHeight:n.AttrScope.TechniqueGeometry,screenWidth:n.AttrScope.TechniqueGeometry,poiTable:n.AttrScope.TechniqueGeometry,poiName:n.AttrScope.FeatureGeometry,poiNameField:n.AttrScope.TechniqueGeometry,imageTexture:n.AttrScope.FeatureGeometry,imageTextureField:n.AttrScope.TechniqueGeometry,imageTexturePrefix:n.AttrScope.TechniqueGeometry,imageTexturePostfix:n.AttrScope.TechniqueGeometry,style:n.AttrScope.TechniqueGeometry,fontName:n.AttrScope.TechniqueGeometry,fontStyle:n.AttrScope.TechniqueGeometry,fontVariant:n.AttrScope.TechniqueGeometry,rotation:n.AttrScope.TechniqueGeometry,tracking:n.AttrScope.TechniqueGeometry,leading:n.AttrScope.TechniqueGeometry,maxLines:n.AttrScope.TechniqueGeometry,lineWidth:n.AttrScope.TechniqueGeometry,canvasRotation:n.AttrScope.TechniqueGeometry,lineRotation:n.AttrScope.TechniqueGeometry,wrappingMode:n.AttrScope.TechniqueGeometry,hAlignment:n.AttrScope.TechniqueGeometry,vAlignment:n.AttrScope.TechniqueGeometry,backgroundColor:n.AttrScope.TechniqueRendering,backgroundSize:n.AttrScope.TechniqueRendering,backgroundOpacity:n.AttrScope.TechniqueRendering,color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,size:n.AttrScope.TechniqueRendering}});t.techniqueDescriptors["line-marker"]=s,t.techniqueDescriptors["labeled-icon"]=s;const o={attrScopes:{polygonOffset:n.AttrScope.TechniqueRendering,polygonOffsetFactor:n.AttrScope.TechniqueRendering,polygonOffsetUnits:n.AttrScope.TechniqueRendering,lineColor:n.AttrScope.TechniqueRendering,lineFadeFar:n.AttrScope.TechniqueRendering,lineFadeNear:n.AttrScope.TechniqueRendering}};t.solidLineTechniqueDescriptor=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,o,{attrScopes:{clipping:n.AttrScope.TechniqueGeometry,secondaryRenderOrder:n.AttrScope.TechniqueGeometry,color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,lineWidth:n.AttrScope.TechniqueRendering,secondaryWidth:n.AttrScope.TechniqueRendering,secondaryColor:n.AttrScope.TechniqueRendering,dashSize:n.AttrScope.TechniqueRendering,gapSize:n.AttrScope.TechniqueRendering}}),t.techniqueDescriptors["solid-line"]=t.solidLineTechniqueDescriptor,t.techniqueDescriptors["dashed-line"]=t.solidLineTechniqueDescriptor,t.lineTechniqueDescriptor=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,lineWidth:n.AttrScope.FeatureGeometry}}),t.techniqueDescriptors.line=t.lineTechniqueDescriptor;const a=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,o,{attrScopes:{color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,lineWidth:n.AttrScope.TechniqueRendering}});t.techniqueDescriptors.fill=a;const l=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{color:n.AttrScope.FeatureGeometry,vertexColors:n.AttrScope.FeatureGeometry,wireframe:n.AttrScope.TechniqueRendering,roughness:n.AttrScope.TechniqueRendering,metalness:n.AttrScope.TechniqueRendering,alphaTest:n.AttrScope.TechniqueRendering,depthTest:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,emissive:n.AttrScope.TechniqueRendering,emissiveIntensity:n.AttrScope.TechniqueRendering,refractionRatio:n.AttrScope.TechniqueRendering,map:n.AttrScope.TechniqueGeometry,mapProperties:n.AttrScope.TechniqueGeometry,normalMap:n.AttrScope.TechniqueGeometry,normalMapProperties:n.AttrScope.TechniqueGeometry,displacementMap:n.AttrScope.TechniqueGeometry,displacementMapProperties:n.AttrScope.TechniqueGeometry,roughnessMap:n.AttrScope.TechniqueGeometry,roughnessMapProperties:n.AttrScope.TechniqueGeometry,emissiveMap:n.AttrScope.TechniqueGeometry,emissiveMapProperties:n.AttrScope.TechniqueGeometry,bumpMap:n.AttrScope.TechniqueGeometry,bumpMapProperties:n.AttrScope.TechniqueGeometry,metalnessMap:n.AttrScope.TechniqueGeometry,metalnessMapProperties:n.AttrScope.TechniqueGeometry,alphaMap:n.AttrScope.TechniqueGeometry,alphaMapProperties:n.AttrScope.TechniqueGeometry}});t.techniqueDescriptors.standard=l;const c=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,l,{attrScopes:{height:n.AttrScope.FeatureGeometry,floorHeight:n.AttrScope.FeatureGeometry,color:n.AttrScope.FeatureGeometry,defaultColor:n.AttrScope.FeatureGeometry,defaultHeight:n.AttrScope.FeatureGeometry,constantHeight:n.AttrScope.FeatureGeometry,boundaryWalls:n.AttrScope.FeatureGeometry,footprint:n.AttrScope.FeatureGeometry,maxSlope:n.AttrScope.FeatureGeometry,enableDepthPrePass:n.AttrScope.TechniqueGeometry,animateExtrusionDuration:n.AttrScope.TechniqueGeometry,animateExtrusion:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,transparent:n.AttrScope.TechniqueRendering,lineWidth:n.AttrScope.TechniqueRendering,lineFadeNear:n.AttrScope.TechniqueRendering,lineFadeFar:n.AttrScope.TechniqueRendering,lineColorMix:n.AttrScope.TechniqueGeometry,lineColor:n.AttrScope.TechniqueRendering}});t.techniqueDescriptors["extruded-polygon"]=c;const h=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{text:n.AttrScope.FeatureGeometry,label:n.AttrScope.FeatureGeometry,useAbbreviation:n.AttrScope.FeatureGeometry,useIsoCode:n.AttrScope.FeatureGeometry,minZoomLevel:n.AttrScope.TechniqueGeometry,maxZoomLevel:n.AttrScope.TechniqueGeometry,distanceScale:n.AttrScope.TechniqueGeometry,mayOverlap:n.AttrScope.TechniqueGeometry,reserveSpace:n.AttrScope.TechniqueGeometry,textFadeTime:n.AttrScope.TechniqueGeometry,xOffset:n.AttrScope.TechniqueGeometry,yOffset:n.AttrScope.TechniqueGeometry,style:n.AttrScope.TechniqueGeometry,fontName:n.AttrScope.TechniqueGeometry,fontStyle:n.AttrScope.TechniqueGeometry,fontVariant:n.AttrScope.TechniqueGeometry,rotation:n.AttrScope.TechniqueGeometry,tracking:n.AttrScope.TechniqueGeometry,leading:n.AttrScope.TechniqueGeometry,maxLines:n.AttrScope.TechniqueGeometry,lineWidth:n.AttrScope.TechniqueGeometry,canvasRotation:n.AttrScope.TechniqueGeometry,lineRotation:n.AttrScope.TechniqueGeometry,wrappingMode:n.AttrScope.TechniqueGeometry,hAlignment:n.AttrScope.TechniqueGeometry,vAlignment:n.AttrScope.TechniqueGeometry,backgroundColor:n.AttrScope.TechniqueRendering,backgroundSize:n.AttrScope.TechniqueRendering,backgroundOpacity:n.AttrScope.TechniqueRendering,color:n.AttrScope.TechniqueRendering,opacity:n.AttrScope.TechniqueRendering,priority:n.AttrScope.TechniqueRendering,size:n.AttrScope.TechniqueRendering}});t.techniqueDescriptors.text=h;const d=n.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{primitive:n.AttrScope.TechniqueGeometry,params:n.AttrScope.TechniqueRendering}});function u(e){return"extruded-line"===e.name}function m(e){return u(e)&&"standard"===e.shading}function p(e){return"fill"===e.name}function f(e){return"extruded-polygon"===e.name}function g(e){return"standard"===e.name}function v(e){return"terrain"===e.name}t.techniqueDescriptors.shader=d,t.isCirclesTechnique=function(e){return"circles"===e.name},t.isSquaresTechnique=function(e){return"squares"===e.name},t.isPoiTechnique=function(e){return"labeled-icon"===e.name},t.isLineMarkerTechnique=function(e){return"line-marker"===e.name},t.isLineTechnique=function(e){return"line"===e.name},t.isSolidLineTechnique=function(e){return"solid-line"===e.name||"dashed-line"===e.name},t.isSegmentsTechnique=function(e){return"segments"===e.name},t.isExtrudedLineTechnique=u,t.isBasicExtrudedLineTechnique=function(e){return u(e)&&"basic"===e.shading},t.isStandardExtrudedLineTechnique=m,t.isFillTechnique=p,t.isExtrudedPolygonTechnique=f,t.isStandardTechnique=g,t.isTerrainTechnique=v,t.isTextTechnique=function(e){return"text"===e.name},t.isShaderTechnique=function(e){return"shader"===e.name},t.isLabelRejectionLineTechnique=function(e){return"label-rejection-line"===e.name},t.needsVertexNormals=function(e){return p(e)||g(e)||v(e)||m(e)},t.textureCoordinateType=function(e){return g(e)?e.textureCoordinateType:f(e)?e.textureCoordinateType:v(e)?e.textureCoordinateType:void 0},t.addBuffersToTransferList=function(e,i){if(g(e)||f(e)||v(e))for(const n of t.TEXTURE_PROPERTY_KEYS){const t=e[n];r.isTextureBuffer(t)&&t.buffer instanceof ArrayBuffer&&i.push(t.buffer)}},t.composeTechniqueTextureName=function(e,t){let i=e;return"string"==typeof t.imageTexturePrefix&&(i=t.imageTexturePrefix+i),"string"==typeof t.imageTexturePostfix&&(i+=t.imageTexturePostfix),i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(0),s={type:"update"};class o extends n.EventDispatcher{constructor(e,t,i,r,n){super(),this.enabled=!0,this.cacheable=!1,this.useGeometryLoader=!1,this.addGroundPlane=!1,this.m_minZoomLevel=1,this.m_maxZoomLevel=20,this.m_maxGeometryHeight=0,this.m_storageLevelOffset=0,void 0!==e&&0!==e.length||(e=`anonymous-datasource#${++o.uniqueNameCounter}`),this.name=e,this.styleSetName=t,void 0!==i&&(this.m_minZoomLevel=i),void 0!==r&&(this.m_maxZoomLevel=r),void 0!==n&&(this.m_storageLevelOffset=n)}get styleSetName(){return this.m_styleSetName}set styleSetName(e){this.m_styleSetName=e,void 0!==this.m_mapView&&void 0!==e&&this.setTheme(this.m_mapView.theme)}dispose(){}clearCache(){}ready(){return!0}get mapView(){if(void 0===this.m_mapView)throw new Error("This DataSource was not added to MapView");return this.m_mapView}get projection(){return this.mapView.projection}async connect(){}attach(e){this.m_mapView=e}detach(e){r.assert(this.m_mapView===e),this.m_mapView=void 0}setStyleSet(e,t,i){}setTheme(e,t){}setLanguages(e){}updateTile(e){}shouldPreloadTiles(){return!1}get minZoomLevel(){return this.m_minZoomLevel}set minZoomLevel(e){this.m_minZoomLevel=e}get maxZoomLevel(){return this.m_maxZoomLevel}set maxZoomLevel(e){this.m_maxZoomLevel=e}get maxGeometryHeight(){return this.m_maxGeometryHeight}set maxGeometryHeight(e){this.m_maxGeometryHeight=e}get storageLevelOffset(){return this.m_storageLevelOffset}set storageLevelOffset(e){this.m_storageLevelOffset=e}setEnableElevationOverlay(e){}getDisplayZoomLevel(e){return n.Math.clamp(e+this.m_storageLevelOffset,this.m_minZoomLevel,this.m_maxZoomLevel)}shouldRender(e,t){return t.level===e}shouldSubdivide(e,t){return t.level<=e}shouldRenderText(e,t){return!0}requestUpdate(){this.dispatchEvent(s)}}t.DataSource=o,o.uniqueNameCounter=0},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(21);class s{constructor(e,t,i,s,o,a,l,c,h,d,u,m,p){this.codePoint=e,this.block=t,this.width=i,this.height=s,this.advanceX=o,this.offsetX=a,this.offsetY=l,this.texture=m,this.font=p,this.positions=[],this.sourceTextureCoordinates=[],this.dynamicTextureCoordinates=[],this.copyIndex=0,this.isInCache=!1,this.character=String.fromCodePoint(e),this.direction=n.UnicodeUtils.getDirection(e,t);const f=this.offsetX,g=f+this.width,v=p.metrics.lineHeight-this.offsetY,y=v-this.height;this.positions.push(new r.Vector3(f,y,1),new r.Vector3(g,y,1),new r.Vector3(f,v,1),new r.Vector3(g,v,1)),this.sourceTextureCoordinates.push(new r.Vector2(c,h),new r.Vector2(d,h),new r.Vector2(c,u),new r.Vector2(d,u)),this.dynamicTextureCoordinates.push(new r.Vector2(0,0),new r.Vector2(1,0),new r.Vector2(0,1),new r.Vector2(1,1))}clone(){return new s(this.codePoint,this.block,this.width,this.height,this.advanceX,this.offsetX,this.offsetY,this.sourceTextureCoordinates[0].x,this.sourceTextureCoordinates[0].y,this.sourceTextureCoordinates[3].x,this.sourceTextureCoordinates[3].y,this.texture,this.font)}}t.GlyphData=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i(185))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);t.MAX_CAPACITY=65536,t.VERTEX_BUFFER_STRIDE=16,t.INDEX_BUFFER_STRIDE=1,t.VERTICES_PER_QUAD=4,t.INDICES_PER_QUAD=6,t.QUAD_VERTEX_MEMORY_FOOTPRINT=t.VERTICES_PER_QUAD*t.VERTEX_BUFFER_STRIDE,t.QUAD_INDEX_MEMORY_FOOTPRINT=t.INDICES_PER_QUAD*t.INDEX_BUFFER_STRIDE;const n=4,s=4;t.TextGeometry=class{constructor(e,i,n,s,o){this.scene=e,this.capacity=Math.min(o,t.MAX_CAPACITY),this.m_currentCapacity=Math.min(s,o),this.m_drawCount=0,this.m_updateOffset=0,this.m_pickingCount=0,this.m_vertexBuffer=new r.InterleavedBuffer(new Float32Array(this.m_currentCapacity*t.QUAD_VERTEX_MEMORY_FOOTPRINT),t.VERTEX_BUFFER_STRIDE),this.m_vertexBuffer.setUsage(r.DynamicDrawUsage),this.m_positionAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,0),this.m_uvAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,4),this.m_colorAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,8),this.m_bgColorAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,12),this.m_indexBuffer=new r.BufferAttribute(new Uint32Array(this.m_currentCapacity*t.QUAD_INDEX_MEMORY_FOOTPRINT),t.INDEX_BUFFER_STRIDE),this.m_indexBuffer.setUsage(r.DynamicDrawUsage),this.m_geometry=new r.BufferGeometry,this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("bgColor",this.m_bgColorAttribute),this.m_geometry.setIndex(this.m_indexBuffer),this.m_pickingDataArray=new Array(this.m_currentCapacity),this.m_mesh=new r.Mesh(this.m_geometry,i),this.m_bgMesh=new r.Mesh(this.m_geometry,n),this.m_mesh.renderOrder=Number.MAX_SAFE_INTEGER,this.m_bgMesh.renderOrder=Number.MAX_SAFE_INTEGER-1,this.m_mesh.frustumCulled=!1,this.m_bgMesh.frustumCulled=!1,this.scene.add(this.m_bgMesh,this.m_mesh)}get drawCount(){return this.m_drawCount}get mesh(){return this.m_mesh}get backgroundMesh(){return this.m_bgMesh}dispose(){this.scene.remove(this.m_bgMesh,this.m_mesh),this.m_geometry.dispose()}clear(){this.m_drawCount=0,this.m_updateOffset=0,this.m_pickingCount=0}update(){this.drawCount>this.m_updateOffset&&(this.m_vertexBuffer.needsUpdate=!0,this.m_vertexBuffer.updateRange.offset=this.m_updateOffset*t.QUAD_VERTEX_MEMORY_FOOTPRINT,this.m_vertexBuffer.updateRange.count=(this.m_drawCount-this.m_updateOffset)*t.QUAD_VERTEX_MEMORY_FOOTPRINT,this.m_indexBuffer.needsUpdate=!0,this.m_indexBuffer.updateRange.offset=this.m_updateOffset*t.QUAD_INDEX_MEMORY_FOOTPRINT,this.m_indexBuffer.updateRange.count=(this.m_drawCount-this.m_updateOffset)*t.QUAD_INDEX_MEMORY_FOOTPRINT),this.m_updateOffset=this.m_drawCount,this.m_geometry.setDrawRange(0,this.m_drawCount*t.INDICES_PER_QUAD)}add(e,i,r,n,s,o){if(this.m_drawCount>=this.capacity)return!1;if(this.m_drawCount>=this.m_currentCapacity){const e=Math.min(2*this.m_currentCapacity,this.capacity);this.resizeBuffers(e)}const a=this.m_drawCount*t.VERTICES_PER_QUAD,l=this.m_drawCount*t.INDICES_PER_QUAD;for(let l=0;l<t.VERTICES_PER_QUAD;++l){this.m_positionAttribute.setXYZW(a+l,i[l].x,i[l].y,i[l].z,(s?-1:1)*o.rotation);const t=s?(l+1)%2+2*Math.floor(l/2):l;this.m_uvAttribute.setXYZW(a+l,e.dynamicTextureCoordinates[t].x,e.dynamicTextureCoordinates[t].y,r,n),this.m_colorAttribute.setXYZW(a+l,o.color.r,o.color.g,o.color.b,o.opacity),this.m_bgColorAttribute.setXYZW(a+l,o.backgroundColor.r,o.backgroundColor.g,o.backgroundColor.b,o.backgroundOpacity)}return this.m_indexBuffer.setX(l,a),this.m_indexBuffer.setX(l+1,a+1),this.m_indexBuffer.setX(l+2,a+2),this.m_indexBuffer.setX(l+3,a+2),this.m_indexBuffer.setX(l+4,a+1),this.m_indexBuffer.setX(l+5,a+3),++this.m_drawCount,!0}addToBuffer(e,i,r,n,s,o,a,l){for(let c=0;c<t.VERTICES_PER_QUAD;++c){const h=i+t.VERTEX_BUFFER_STRIDE*c;e[h]=n[c].x,e[h+1]=n[c].y,e[h+2]=n[c].z,e[h+3]=(a?-1:1)*l.rotation;const d=a?(c+1)%2+2*Math.floor(c/2):c;e[h+4]=r.dynamicTextureCoordinates[d].x,e[h+5]=r.dynamicTextureCoordinates[d].y,e[h+6]=s,e[h+7]=o,e[h+8]=l.color.r,e[h+9]=l.color.g,e[h+10]=l.color.b,e[h+11]=l.opacity,e[h+12]=l.backgroundColor.r,e[h+13]=l.backgroundColor.g,e[h+14]=l.backgroundColor.b,e[h+15]=l.backgroundOpacity}}addTextBufferObject(e,i,r,n,s,o,a,l){if(this.m_drawCount+e.glyphs.length>=this.capacity)return!1;if(this.m_drawCount+e.glyphs.length>=this.m_currentCapacity){const e=Math.min(2*this.m_currentCapacity,this.capacity);this.resizeBuffers(e)}const c=r||1,h=n||0,d=Math.cos(h),u=Math.sin(h),m=void 0!==i?i.x:0,p=void 0!==i?i.y:0,f=void 0!==i?i.z:0,g=e.buffer,v=g[3]<0?-1:1,y=void 0!==s?s.r:g[8],_=void 0!==s?s.g:g[9],x=void 0!==s?s.b:g[10],T=void 0!==o?o:g[11],S=void 0!==a?a.r:g[12],w=void 0!==a?a.g:g[13],b=void 0!==a?a.b:g[14],M=void 0!==l?l:g[15],E=this.m_drawCount*t.VERTICES_PER_QUAD;for(let i=0;i<e.glyphs.length;++i){const r=i*t.QUAD_VERTEX_MEMORY_FOOTPRINT,n=e.glyphs[i];if(!n.isInCache)return!1;const s=g[r+4]>g[r+t.VERTEX_BUFFER_STRIDE+4],o=g[r+6],a=g[r+7];for(let e=0;e<t.VERTICES_PER_QUAD;++e){const l=g[r+e*t.VERTEX_BUFFER_STRIDE],P=g[r+e*t.VERTEX_BUFFER_STRIDE+1];this.m_positionAttribute.setXYZW(E+i*t.VERTICES_PER_QUAD+e,l*c*d+P*c*-u+m,l*c*u+P*c*d+p,g[r+e*t.VERTEX_BUFFER_STRIDE+2]+f,g[r+e*t.VERTEX_BUFFER_STRIDE+3]+v*h);const C=s?(e+1)%2+2*Math.floor(e/2):e;this.m_uvAttribute.setXYZW(E+i*t.VERTICES_PER_QUAD+e,n.dynamicTextureCoordinates[C].x,n.dynamicTextureCoordinates[C].y,o,(a-o)/c+o),this.m_colorAttribute.setXYZW(E+i*t.VERTICES_PER_QUAD+e,y,_,x,T),this.m_bgColorAttribute.setXYZW(E+i*t.VERTICES_PER_QUAD+e,S,w,b,M)}this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD,(this.m_drawCount+i)*t.VERTICES_PER_QUAD),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+1,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+1),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+2,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+2),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+3,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+2),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+4,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+1),this.m_indexBuffer.setX((this.m_drawCount+i)*t.INDICES_PER_QUAD+5,(this.m_drawCount+i)*t.VERTICES_PER_QUAD+3)}return this.m_drawCount+=e.glyphs.length,!0}addPickingData(e,t,i){return!(this.m_pickingCount>=this.m_currentCapacity)&&(this.m_pickingDataArray[this.m_pickingCount]={start:Math.min(e,this.capacity),end:Math.min(t,this.capacity),data:i},++this.m_pickingCount,!0)}pick(e,i){for(const r of this.m_pickingDataArray){if(void 0===r)return;for(let n=r.start;n<r.end;++n){const s=n*t.VERTICES_PER_QUAD,o=Math.min(this.m_positionAttribute.getX(s+2),this.m_positionAttribute.getX(s+1));if(e.x<o)continue;const a=Math.max(this.m_positionAttribute.getX(s+2),this.m_positionAttribute.getX(s+1));if(e.x>a)continue;const l=Math.min(this.m_positionAttribute.getY(s+2),this.m_positionAttribute.getY(s+1));if(e.y<l)continue;const c=Math.max(this.m_positionAttribute.getY(s+2),this.m_positionAttribute.getY(s+1));if(!(e.y>c)){i(r.data);break}}}}updateMemoryUsage(e){const t=this.m_vertexBuffer.count*n+this.m_indexBuffer.count*s;e.heapSize+=t,e.gpuSize+=t}resizeBuffers(e){this.m_currentCapacity=e;const i=new Float32Array(e*t.QUAD_VERTEX_MEMORY_FOOTPRINT);i.set(this.m_vertexBuffer.array),this.m_vertexBuffer=new r.InterleavedBuffer(i,t.VERTEX_BUFFER_STRIDE),this.m_vertexBuffer.setUsage(r.DynamicDrawUsage),this.m_positionAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,0),this.m_uvAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,4),this.m_colorAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,8),this.m_bgColorAttribute=new r.InterleavedBufferAttribute(this.m_vertexBuffer,4,12);const n=new Uint32Array(e*t.QUAD_INDEX_MEMORY_FOOTPRINT);n.set(this.m_indexBuffer.array),this.m_indexBuffer=new r.BufferAttribute(n,t.INDEX_BUFFER_STRIDE),this.m_indexBuffer.setUsage(r.DynamicDrawUsage),this.m_geometry.dispose(),this.m_geometry=new r.BufferGeometry,this.m_geometry.setAttribute("position",this.m_positionAttribute),this.m_geometry.setAttribute("uv",this.m_uvAttribute),this.m_geometry.setAttribute("color",this.m_colorAttribute),this.m_geometry.setAttribute("bgColor",this.m_bgColorAttribute),this.m_geometry.setIndex(this.m_indexBuffer),this.m_pickingDataArray.length=this.m_currentCapacity,this.scene.remove(this.m_bgMesh,this.m_mesh),this.m_mesh=new r.Mesh(this.m_geometry,this.m_mesh.material),this.m_bgMesh=new r.Mesh(this.m_geometry,this.m_bgMesh.material),this.m_mesh.renderOrder=Number.MAX_SAFE_INTEGER,this.m_bgMesh.renderOrder=Number.MAX_SAFE_INTEGER-1,this.m_mesh.frustumCulled=!1,this.m_bgMesh.frustumCulled=!1,this.scene.add(this.m_bgMesh,this.m_mesh)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(14),s=i(21);!function(e){e.EM_TO_PX=16,e.PT_TO_PX=1.25,e.OBLIQUE_ANGLE=.174533,e.OBLIQUE_OFFSET=Math.tan(e.OBLIQUE_ANGLE),e.getPixelSize=function(t,i,r){let s=t;switch(i){case n.FontUnit.Em:s*=e.EM_TO_PX;break;case n.FontUnit.Point:s*=e.PT_TO_PX;break;case n.FontUnit.Percent:s*=.01*r}return s},e.getSmallCapsScale=function(e,t,i,r){return t[i]&&r===n.FontVariant.SmallCaps?e[i].font.metrics.xHeight/e[i].font.metrics.capHeight:1},e.getDirection=function(e,t){let i=s.UnicodeUtils.Direction.LTR,r=t;for(;e[r].direction!==s.UnicodeUtils.Direction.LTR&&e[r].direction!==s.UnicodeUtils.Direction.RTL&&r<e.length-1;)++r;return 1===Math.abs(e[r].direction)&&(i=e[r].direction),i},e.computeGlyphTransform=function(e,t,i,r,n){const s=Math.cos(r),o=Math.sin(r),a=Math.cos(n),l=Math.sin(n);e.set(i*a,i*-l,s*t.x-o*t.y,i*l,i*a,o*t.x+s*t.y,0,0,1)},e.updateBounds=function(e,t,i){const n=Math.min(e[0].x,e[1].x,e[2].x,e[3].x),s=Math.max(e[0].x,e[1].x,e[2].x,e[3].x),o=Math.min(e[0].y,e[1].y,e[2].y,e[3].y),a=Math.max(e[0].y,e[1].y,e[2].y,e[3].y);void 0!==i&&(void 0!==i.array[i.offset]?(i.array[i.offset].min.set(n,o),i.array[i.offset].max.set(s,a)):i.array.push(new r.Box2(new r.Vector2(n,o),new r.Vector2(s,a))),++i.offset),t.min.set(Math.min(t.min.x,n),Math.min(t.min.y,o)),t.max.set(Math.max(t.max.x,s),Math.max(t.max.y,a))}}(t.TypesettingUtils||(t.TypesettingUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);class n extends r.Points{constructor(){super(...arguments),this.enableRayTesting=!0}raycast(e,t){if(!this.enableRayTesting)return;const i=this.geometry,n=this.matrixWorld,o=e.ray.origin.clone().add(e.ray.direction).project(e.mapView.camera),{clientWidth:a,clientHeight:l}=e.mapView.canvas,c=new r.Vector2(Math.ceil((o.x+1)/2*a),Math.ceil((1-o.y)/2*l));if(i instanceof r.BufferGeometry){const o=new r.Vector3,h=i.index,d=i.attributes.position.array;if(null!==h){const i=h.array;for(let r=0,h=i.length;r<h;r++){const h=i[r];o.fromArray(d,3*h);const u=s(o,n,e,a,l);u.pointIsOnScreen&&this.testPoint(o,u.absoluteScreenPosition,c,r,u.distance,t)}}else for(let i=0,r=d.length/3;i<r;i++){o.fromArray(d,3*i);const r=s(o,n,e,a,l);r.pointIsOnScreen&&this.testPoint(o,r.absoluteScreenPosition,c,i,r.distance,t)}}else{const r=i.vertices;for(let i=0;i<r.length;i++){const o=r[i],h=s(o,n,e,a,l);h.pointIsOnScreen&&this.testPoint(o,h.absoluteScreenPosition,c,i,h.distance,t)}}}}function s(e,t,i,n,s){const o=e.clone();o.applyMatrix4(t);const a=o.distanceTo(i.ray.origin);o.project(i.mapView.camera);const l=new r.Vector2(o.x,o.y),c=l.x<1&&l.x>-1&&l.y<1&&l.y>-1;if(c){return o.x=(o.x+1)/2*n,o.y=(1-o.y)/2*s,{absoluteScreenPosition:new r.Vector2(o.x,o.y),pointIsOnScreen:c,distance:a}}return{pointIsOnScreen:c}}t.MapViewPoints=n;t.Circles=class extends n{testPoint(e,t,i,r,n,s){const o=t.x-i.x,a=t.y-i.y;Math.sqrt(o*o+a*a)<=this.material.size/2&&s.push({point:e,distance:n,index:r,object:this})}};t.Squares=class extends n{testPoint(e,t,i,r,n,s){const o=t.x-i.x,a=t.y-i.y,l=this.material.size/2;Math.abs(o)<=l&&Math.abs(a)<=l&&s.push({point:e,distance:n,index:r,object:this})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n="undefined"==typeof window;class s extends r.EventDispatcher{constructor(e){super(),this.value=e}set(e,t){this.value=e,this.dispatchEvent({type:s.SET_EVENT_TYPE,name:t,value:e})}}s.SET_EVENT_TYPE="set";class o{constructor(){if(this.m_optionsMap=new Map,!n&&"undefined"!=typeof window&&window){window.__debugContext=this}}setValue(e,t){let i=this.m_optionsMap.get(e);i?i.set(t,e):(i=new s(t),this.m_optionsMap.set(e,i))}getValue(e){const t=this.m_optionsMap.get(e);return t?t.value:void 0}hasOption(e){return void 0!==this.m_optionsMap.get(e)}addEventListener(e,t){const i=this.m_optionsMap.get(e);if(!i)throw Error("Unknown option: "+e);i.addEventListener(s.SET_EVENT_TYPE,t)}hasEventListener(e,t){const i=this.m_optionsMap.get(e);if(i)return i.hasEventListener(s.SET_EVENT_TYPE,t);throw Error("Unknown option: "+e)}removeEventListener(e,t){const i=this.m_optionsMap.get(e);if(!i)throw Error("Unknown option: "+e);i.removeEventListener(s.SET_EVENT_TYPE,t)}get options(){return this.m_optionsMap}clear(){this.m_optionsMap.forEach(e=>{e.set(void 0,"")})}}t.DebugContext=o,t.debugContext=new o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(1),s=i(24),o=i(33);var a;!function(e){function t(e){let t=e.kind;return void 0===t&&(t=r.isFillTechnique(e)?r.GeometryKind.Area:r.isLineTechnique(e)||r.isSolidLineTechnique(e)||r.isSegmentsTechnique(e)||r.isExtrudedLineTechnique(e)?r.GeometryKind.Line:r.isExtrudedPolygonTechnique(e)?r.GeometryKind.Building:r.isPoiTechnique(e)||r.isLineMarkerTechnique(e)||r.isTextTechnique(e)?r.GeometryKind.Label:r.GeometryKind.All,e.kind=t),t}e.prepareDecodedTile=function(e){const i=new r.GeometryKindSet;for(const n of e.techniques){let e=n.kind;if(void 0===e&&(e=t(n)),Array.isArray(e)&&(e=new r.GeometryKindSet(e)),e instanceof Set)for(const t of e)i.add(t);else i.add(e)}return i},e.setDefaultGeometryKind=t}(a=t.TileGeometryLoader||(t.TileGeometryLoader={}));t.SimpleTileGeometryLoader=class{constructor(e){this.m_tile=e,this.m_isFinished=!1}get tile(){return this.m_tile}get isFinished(){return this.m_isFinished}get basicGeometryLoaded(){return this.m_tile.hasGeometry}get allGeometryLoaded(){return this.m_isFinished}setDecodedTile(e){return this.m_decodedTile=e,void 0!==this.m_decodedTile&&(this.m_availableGeometryKinds=a.prepareDecodedTile(this.m_decodedTile)),this.m_decodedTile}get availableGeometryKinds(){return this.m_availableGeometryKinds}update(e,t){const i=this.tile;void 0===this.m_decodedTile&&void 0!==i.decodedTile&&(o.TileGeometryCreator.instance.processTechniques(i.decodedTile,e,t),this.setDecodedTile(i.decodedTile),this.prepareForRender(e,t))}dispose(){this.m_decodedTile=void 0}reset(){this.m_decodedTile=void 0,this.m_isFinished=!1,void 0!==this.m_availableGeometryKinds&&this.m_availableGeometryKinds.clear(),void 0!==this.m_timeout&&clearTimeout(this.m_timeout)}finish(){this.m_tile.loadingFinished(),this.m_tile.removeDecodedTile(),this.m_isFinished=!0,this.m_timeout=void 0}prepareForRender(e,t){const i=this.tile,r=this.m_decodedTile;this.m_decodedTile=void 0,void 0!==r&&!i.disposed&&i.isVisible?this.m_timeout=setTimeout(()=>{const a=s.PerformanceStatistics.instance;if(!i.isVisible)return i.mapView.visibleTileSet.disposeTile(i),a.enabled&&a.currentFrame.addMessage(`Decoded tile: ${i.dataSource.name} # lvl=${i.tileKey.level} col=${i.tileKey.column} row=${i.tileKey.row} DISCARDED - invisible`),void this.finish();let l=0;a.enabled&&(l=n.PerformanceTimer.now());const c=o.TileGeometryCreator.instance;if(i.clear(),c.initDecodedTile(r,e,t),c.createAllGeometries(i,r),a.enabled){const e=n.PerformanceTimer.now()-l,t=a.currentFrame;t.addValue("geometry.geometryCreationTime",e),t.addValue("geometryCount.numGeometries",r.geometries.length),t.addValue("geometryCount.numTechniques",r.techniques.length),t.addValue("geometryCount.numPoiGeometries",void 0!==r.poiGeometries?r.poiGeometries.length:0),t.addValue("geometryCount.numTextGeometries",void 0!==r.textGeometries?r.textGeometries.length:0),t.addValue("geometryCount.numTextPathGeometries",void 0!==r.textPathGeometries?r.textPathGeometries.length:0),t.addValue("geometryCount.numPathGeometries",void 0!==r.pathGeometries?r.pathGeometries.length:0),t.addMessage(`Decoded tile: ${i.dataSource.name} # lvl=${i.tileKey.level} col=${i.tileKey.column} row=${i.tileKey.row}`)}this.finish(),i.dataSource.requestUpdate()},0):this.finish()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(92),n=i(94);class s{static getTileDecoder(e,t,i){const r=this.getWorkerSet(t,i);return new n.WorkerBasedDecoder(r,e)}static getWorkerSet(e,t){void 0===e&&(e=this.defaultScriptUrl);let i=this.workerSets[e];return void 0===i&&(i=new r.ConcurrentWorkerSet({scriptUrl:e,workerCount:void 0===t?this.defaultWorkerCount:t}),this.workerSets[e]=i),i}static destroyWorkerSet(e){const t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])}static destroy(){Object.keys(this.workerSets).forEach(e=>{this.workerSets[e].destroy()}),this.workerSets={}}}t.ConcurrentDecoderFacade=s,s.defaultScriptUrl="./decoder.bundle.js",s.defaultWorkerCount=void 0,s.workerSets={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1);!function(e){e.mergeArrays=function(e,t){const i=[];for(const n of[e,t])if(void 0!==n)for(const e of n){const t=i.find(t=>t.id===e.id||void 0!==t.label&&t.label===e.label);void 0===t?i.push(Object.assign({},e)):(t.year=r.MathUtils.max2(e.year,t.year),t.label=r.getOptionValue(e.label,t.label),t.link=r.getOptionValue(e.link,t.link))}return i},e.formatAsHtml=function(e){if(0===e.length)return"";const t=e.filter(e=>""!==e.label);return 0===t.length?"":"© "+t.map(e=>{const t=void 0!==e.label?e.label:e.id,i=void 0!==e.year?`${e.year} ${t}`:t;return e.link?`<a href="${e.link}">${i}</a>`:`${i}`}).join(", ")}}(t.CopyrightInfo||(t.CopyrightInfo={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),n=i(0),s=i(113),o=i(232),a=i(112);!function(e){function t(e){return new n.Vector3(Math.fround(e.x),Math.fround(e.y),Math.fround(e.z))}function i(e,i){const r=(new n.Matrix4).copy(e.projectionMatrix).multiply(e.matrixWorldInverse),s=new n.Vector3(0,0,0).applyMatrix4(i),o=t(s);return{viewProjection:r,eyePosHi:o,eyePosLo:t(s.sub(o))}}function l(e){if(e.length>0){const t=e[0];if(null==t)throw Error("Empty element in positions");const i=new Array,r=new Array,s=(...e)=>{for(const t of e){const e=Math.fround(t);r.push(t-e),i.push(e)}},o=e=>{s(e.x,e.y,e.z)};if(void 0!==t.z)e.forEach(e=>{o(e)});else{if(i.length%3!=0)throw Error("Positions must be 3D, not 2D");e.forEach(e=>{s(e)})}return{positionHigh:new n.Float32BufferAttribute(i,3),positionLow:new n.Float32BufferAttribute(r,3)}}return{positionHigh:new n.Float32BufferAttribute([],3),positionLow:new n.Float32BufferAttribute([],3)}}function c(e,t,i=0){const r=new Array,n=e.length;for(let s=0;s<n;s+=t){for(let t=0;t<i;t++)r.push(e[s+t]);const n=e[s+i],o=e[s+i+1],a=e[s+i+2],l=Math.fround(n),c=n-l,h=Math.fround(o),d=o-h,u=Math.fround(a),m=a-u;r.push(l,h,u,c,d,m);for(let n=i+3;n<t;n++)r.push(e[s+n])}return r}function h(e,t){const i=l(t);return e.bufferGeometry.setAttribute("position",i.positionHigh),e.bufferGeometry.setAttribute("positionLow",i.positionLow),i.positionHigh.itemSize}e.doubleToFloatVec=t,e.makeFloatVec=function(e){const t=Math.fround(e.x),i=Math.fround(e.y),r=Math.fround(e.z),s=new n.Vector3(e.x-t,e.y-i,e.z-r);return e.x=Math.fround(t),e.y=Math.fround(i),e.z=Math.fround(r),s},e.createHighPrecisionCameraPos=i,e.updateHpUniforms=function(e,t,r){const n=i(t,e.matrixWorldInverse),s=n.viewProjection;if(void 0===r||!r.isMaterial)throw Error("High pecision line has no high precision material");if(!(r.uniforms&&r.uniforms.u_mvp&&r.uniforms.u_eyepos&&r.uniforms.u_eyepos_lowpart))throw Error("High pecision material has missing uniforms");r.uniforms.u_mvp.value=new Float32Array(s.elements),r.uniforms.u_eyepos.value=new Float32Array(n.eyePosHi.toArray()),r.uniforms.u_eyepos_lowpart.value=new Float32Array(n.eyePosLo.toArray())},e.createAttributes=l,e.addInterleavedAttributes3=c,e.setPositions=h,e.convertPositions=function(e){if(e.length<=0)return{positions:[]};const t=e[0];if(null==t)throw Error("Empty element in positions");const i=t;if(void 0===i.y&&void 0===i.z)return{positions:e};const r=new Array;return e.forEach(e=>{r.push(e.x,e.y,e.z)}),{positions:r}},e.createLine=function(e,t){const i=void 0!==t.lineWidth?t.lineWidth:5,o=void 0!==t.addCircles&&t.addCircles,l=void 0!==t.wireFrame&&t.wireFrame,h=[],d=[];a.triangulateLine(e,i,h,d,o);const u=new n.BufferGeometry,m=c(h,3),p=new n.InterleavedBuffer(new Float32Array(m),6),f=new n.InterleavedBufferAttribute(p,3,0,!1),g=new n.InterleavedBufferAttribute(p,3,3,!1);u.setAttribute("position",f),u.setAttribute("positionLow",g),u.setIndex(new n.BufferAttribute(new Uint32Array(d),1));const v=new r.HighPrecisionLineMaterial(t),y=l?new s.HighPrecisionWireFrameLine(u,v):new s.HighPrecisionLine(u,v);return y.setupForRendering(),y},e.createPoints=function(e,t){const i=[];for(let t=0;t<e.length;t++)i.push(i.length/3);const s=new n.BufferGeometry,a=r.isHighPrecisionPointMaterial(t)?t:new r.HighPrecisionPointMaterial(t),l=new o.HighPrecisionPoints(s,a);return h(l,e),l.setupForRendering(),l}}(t.HighPrecisionUtils||(t.HighPrecisionUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.tomTom=0]="tomTom"}(t.FeatureModifierId||(t.FeatureModifierId={})),function(e){let t;!function(e){e[e.Any=0]="Any",e[e.Match=1]="Match",e[e.StartsWith=2]="StartsWith",e[e.Contains=3]="Contains",e[e.EndsWith=4]="EndsWith"}(t=e.StringMatch||(e.StringMatch={})),e.matchString=function(t,i){switch(i.match){case e.StringMatch.Any:return!0;case e.StringMatch.Match:return t===i.value;case e.StringMatch.StartsWith:return i.value.startsWith(t);case e.StringMatch.EndsWith:return i.value.endsWith(t);default:return t.indexOf(i.value)>=0}}}(t.OmvFilterString||(t.OmvFilterString={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.POINT=1]="POINT",e[e.LINESTRING=2]="LINESTRING",e[e.POLYGON=3]="POLYGON"}(t.OmvGeometryType||(t.OmvGeometryType={})),t.OMV_TILE_DECODER_SERVICE_TYPE="omv-tile-decoder",t.OMV_TILER_SERVICE_TYPE="omv-tiler"},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(17);class n extends r.Tile{constructor(e,t){super(e,t)}}t.OmvTile=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordinatesLike=function(e){return e&&"number"==typeof e.latitude&&"number"==typeof e.longitude&&("number"==typeof e.altitude||void 0===e.altitude)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoPointLike=function(e){if(Array.isArray(e)){const[t,i,r]=e;return"number"==typeof t&&"number"==typeof i&&(void 0===r||"number"==typeof r)}return!1}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLatLngLike=function(e){return e&&"number"==typeof e.lat&&"number"==typeof e.lng}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(15),n=i(7),s=i(11),o=i(8),a=i(12),l=i(10),c=i(13),h=i(0);class d extends c.Projection{constructor(){super(...arguments),this.type=c.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,i){return i||(i=o.MathUtils.newEmptyBox3()),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale/2,i.max.z=t,i}projectPoint(e,t){return void 0===t&&(t={x:0,y:0,z:0}),t.x=(h.Math.degToRad(e.longitude)+Math.PI)*d.geoToWorldScale*this.unitScale,t.y=(h.Math.degToRad(e.latitude)+.5*Math.PI)*d.geoToWorldScale*this.unitScale,t.z=e.altitude||0,t}unprojectPoint(e){return n.GeoCoordinates.fromRadians(e.y*d.worldToGeoScale/this.unitScale-.5*Math.PI,e.x*d.worldToGeoScale/this.unitScale-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){const i=this.projectPoint(new n.GeoCoordinates(e.center.latitude,e.center.longitude,0)),{latitudeSpanInRadians:r,longitudeSpanInRadians:l,altitudeSpan:c}=e,h=l*d.geoToWorldScale,u=r*d.geoToWorldScale;return t||(t=o.MathUtils.newEmptyBox3()),s.isBox3Like(t)?(t.min.x=i.x-.5*h*this.unitScale,t.min.y=i.y-.5*u*this.unitScale,t.max.x=i.x+.5*h*this.unitScale,t.max.y=i.y+.5*u*this.unitScale,void 0!==c?(t.min.z=i.z-.5*c,t.max.z=i.z+.5*c):(t.min.z=0,t.max.z=0)):a.isOrientedBox3Like(t)&&(o.MathUtils.newVector3(1,0,0,t.xAxis),o.MathUtils.newVector3(0,1,0,t.yAxis),o.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=i.x,t.position.y=i.y,t.position.z=i.z,t.extents.x=.5*h*this.unitScale,t.extents.y=.5*u*this.unitScale,t.extents.z=Math.max(Number.EPSILON,.5*(c||0))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}d.geoToWorldScale=1/(2*Math.PI),d.worldToGeoScale=2*Math.PI/1,t.normalizedEquirectangularProjection=new d(1),t.equirectangularProjection=new d(l.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(15),n=i(7),s=i(11),o=i(8),a=i(12),l=i(10),c=i(13);class h extends c.Projection{constructor(e){super(e),this.unitScale=e,this.type=c.ProjectionType.Planar,this.m_phi0=0,this.m_lambda0=0}static clampGeoPoint(e,t){const i=e.latitude,r=e.longitude,s=d.POLE_RADIUS,o=d.POLE_RADIUS_SQ,a=Math.round(r/90),l=90*a-r;if(a%2==0||Math.abs(l)>s)return e;const c=i-0,h=l*l+c*c;if(h<o){const e=Math.sqrt(h),t=(s-e)/e,o=1,a=0===l&&0===c?s*o:l;return new n.GeoCoordinates(i+c*t,r+a*t)}return e}getScaleFactor(e){return Math.cosh(2*(e.x/this.unitScale-.5)*Math.PI)}worldExtent(e,t,i){return i||(i=o.MathUtils.newEmptyBox3()),i.min.x=0,i.min.y=0,i.min.z=e,i.max.x=this.unitScale,i.max.y=this.unitScale,i.max.z=t,i}projectPoint(e,t){t||(t={x:0,y:0,z:0});const i=h.clampGeoPoint(e,this.unitScale),r=i.longitude/360+.5,n=1===r?0:Math.floor(r),s=o.MathUtils.degToRad(i.latitude),a=o.MathUtils.degToRad(i.longitude-360*n)-this.m_lambda0,l=Math.cos(s)*Math.sin(a);t.x=Math.atanh(l),t.y=Math.atan2(Math.tan(s),Math.cos(a))-this.m_phi0;const c=.5/Math.PI;return t.x=this.unitScale*(o.MathUtils.clamp(t.x*c+.5,0,1)+n),t.y=this.unitScale*o.MathUtils.clamp(t.y*c+.5,0,1),t.z=e.altitude||0,t}unprojectPoint(e){const t=2*Math.PI,i=e.x/this.unitScale,r=e.y/this.unitScale,s=1===i?0:Math.floor(i),o=t*(i-.5-s),a=t*(r-.5),l=e.z||0,c=a+this.m_phi0,h=Math.asin(Math.sin(c)/Math.cosh(o)),d=this.m_lambda0+Math.atan2(Math.sinh(o),Math.cos(c))+s*t;return n.GeoCoordinates.fromRadians(h,d,l)}projectBox(e,t){const{north:i,south:r,east:l,west:c}=e,h=[e.center,e.northEast,e.southWest,new n.GeoCoordinates(r,l),new n.GeoCoordinates(i,c)],u=d.POLE_EDGE_DEG,m=c<90&&l>90,p=c<0&&l>0,f=c<u&&l>-u&&i>0&&r<0;c<-90&&l>-90&&(h.push(new n.GeoCoordinates(i,-90)),h.push(new n.GeoCoordinates(r,-90))),m&&(h.push(new n.GeoCoordinates(i,90)),h.push(new n.GeoCoordinates(r,90))),p&&(h.push(new n.GeoCoordinates(i,0)),h.push(new n.GeoCoordinates(r,0))),f&&(h.push(new n.GeoCoordinates(0,c)),h.push(new n.GeoCoordinates(0,l))),d.alignLatitude(h,h[0]);const g=h.map(e=>this.projectPoint(e)),v=g.map(e=>e.x),y=g.map(e=>e.y),_=g.map(e=>e.z),x=Math.min(...v),T=Math.min(...y),S=Math.min(..._),w=Math.max(...v),b=Math.max(...y),M=Math.max(..._);if(t||(t=o.MathUtils.newEmptyBox3()),s.isBox3Like(t))t.min.x=x,t.min.y=T,t.min.z=S,t.max.x=w,t.max.y=b,t.max.z=M;else{if(!a.isOrientedBox3Like(t))throw new Error("invalid bounding box");o.MathUtils.newVector3(1,0,0,t.xAxis),o.MathUtils.newVector3(0,1,0,t.yAxis),o.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=(x+w)/2,t.position.y=(T+b)/2,t.position.z=(S+M)/2,t.extents.x=(w-x)/2,t.extents.y=(b-T)/2,t.extents.z=(M-S)/2}return t}unprojectBox(e){const t=this.unitScale,i=e.min,s=e.max,o=[{x:(i.x+s.x)/2,y:(i.y+s.y)/2,z:0},i,s,{x:i.x,y:s.y,z:0},{x:s.x,y:i.y,z:0}],a=.5*t,l=.25*t,c=.75*t,h=i.x<a&&s.x>a,u=i.y<a&&s.y>a,m=i.y<l&&s.y>l,p=i.y<c&&s.y>c;u&&(o.push({x:i.x,y:a,z:0}),o.push({x:s.x,y:a,z:0}),h&&o.push({x:a,y:a,z:0})),m&&(o.push({x:i.x,y:l,z:0}),o.push({x:s.x,y:l,z:0}),h&&o.push({x:a,y:l,z:0})),p&&(o.push({x:i.x,y:c,z:0}),o.push({x:s.x,y:c,z:0}),h&&o.push({x:a,y:c,z:0}));const f=o.map(e=>this.unprojectPoint(e));d.alignLongitude(f,f[0]);const g=f.map(e=>e.latitude),v=f.filter(e=>Math.abs(e.latitude)<90).map(e=>e.longitude),y=f.map(e=>e.altitude||0),_=new n.GeoCoordinates(Math.min(...g),Math.min(...v),Math.min(...y)),x=new n.GeoCoordinates(Math.max(...g),Math.max(...v),Math.max(...y));return r.GeoBox.fromCoordinates(_,x)}unprojectAltitude(e){return e.z}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}}class d{static alignLatitude(e,t){for(const i of e)0===i.latitude&&(i.latitude=1e-9*t.latitude)}static alignLongitude(e,t){const i=t.longitude<0?180:-180,r=t.longitude<0?-180:180;for(const t of e)t.longitude===i&&(t.longitude=r)}}t.TransverseMercatorUtils=d,d.POLE_EDGE=1.4844222297453322,d.POLE_EDGE_DEG=o.MathUtils.radToDeg(d.POLE_EDGE),d.POLE_RADIUS=90-d.POLE_EDGE_DEG,d.POLE_RADIUS_SQ=Math.pow(d.POLE_RADIUS,2),t.transverseMercatorProjection=new h(l.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(8);t.FlatTileBoundingBoxGenerator=class{constructor(e,t=0,i=0){this.tilingScheme=e,this.minElevation=t,this.maxElevation=i,this.m_tilingScheme=e,this.m_worldBox=e.projection.worldExtent(t,i);const{min:r,max:n}=this.m_worldBox;this.m_worldDimensions={x:n.x-r.x,y:n.y-r.y,z:n.z-r.z}}get projection(){return this.m_tilingScheme.projection}get subdivisionScheme(){return this.m_tilingScheme.subdivisionScheme}getWorldBox(e,t){const i=e.level,n=this.subdivisionScheme.getLevelDimensionX(i),s=this.subdivisionScheme.getLevelDimensionY(i),o=this.m_worldDimensions.x/n,a=this.m_worldDimensions.y/s,l=this.m_worldBox.min.x+o*e.column,c=this.m_worldBox.min.y+a*e.row;return t||(t=r.MathUtils.newEmptyBox3()),t.min.x=l,t.min.y=c,t.min.z=this.m_worldBox.min.z,t.max.x=l+o,t.max.y=c+a,t.max.z=this.m_worldBox.max.z,t}getGeoBox(e){const t=this.getWorldBox(e);return this.projection.unprojectBox(t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.halfQuadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(e){return 0===e?1:2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 0!==e?1<<e-1:1}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(29);class n{constructor(e,t,i){this.tileKey=e,this.sizeX=t,this.sizeY=i}[Symbol.iterator](){return 2===this.sizeX&&2===this.sizeY?n.ZCurveIterator(this.tileKey):n.RowColumnIterator(this.tileKey,this.sizeX,this.sizeY)}}t.SubTiles=n,function(e){e.RowColumnIterator=function*(e,t,i){for(let n=0;n<i;n++)for(let s=0;s<t;s++)yield r.TileKey.fromRowColumnLevel(e.row*i+n,e.column*t+s,e.level+1)},e.ZCurveIterator=function*(e){for(let t=0;t<4;t++)yield r.TileKey.fromRowColumnLevel(e.row<<1|t>>1,e.column<<1|1&t,e.level+1)}}(n=t.SubTiles||(t.SubTiles={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(7),n=i(29);class s{static geoCoordinatesToTileKey(e,t,i){const r=e.projection.projectPoint(t);return this.worldCoordinatesToTileKey(e,r,i)}static worldCoordinatesToTileKey(e,t,i){const r=e.projection,s=e.subdivisionScheme,o=s.getLevelDimensionX(i),a=s.getLevelDimensionY(i),{min:l,max:c}=r.worldExtent(0,0),h=c.x-l.x,d=c.y-l.y;if(t.x<l.x||t.x>c.x)return null;if(t.y<l.y||t.y>c.y)return null;const u=Math.min(o-1,Math.floor(o*(t.x-l.x)/h)),m=Math.min(a-1,Math.floor(a*(t.y-l.y)/d));return n.TileKey.fromRowColumnLevel(m,u,i)}static geoRectangleToTileKeys(e,t,i){const o=(e,t,i)=>e<t?i-(t-e)%(i-t):t+(e-t)%(i-t),a=(e,t,i)=>Math.min(Math.max(e,t),i),l=o(t.southWest.longitudeInRadians,-Math.PI,Math.PI),c=a(t.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),h=o(t.northEast.longitudeInRadians,-Math.PI,Math.PI),d=a(t.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),u=s.geoCoordinatesToTileKey(e,r.GeoCoordinates.fromRadians(c,l),i),m=s.geoCoordinatesToTileKey(e,r.GeoCoordinates.fromRadians(d,h),i),p=e.subdivisionScheme.getLevelDimensionX(i);if(!u||!m)throw new Error("Invalid coordinates");const f=u.column;let g=m.column;l>h&&(g+=g!==f?p:p-1);const v=Math.min(u.row,m.row),y=Math.max(u.row,m.row),_=new Array;for(let e=v;e<=y;++e)for(let t=f;t<=g;++t)_.push(n.TileKey.fromRowColumnLevel(e,t%p,i));return _}}t.TileKeyUtils=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(65);t.TileTreeTraverse=class{constructor(e){this.m_subdivisionScheme=e}subTiles(e){const t=this.m_subdivisionScheme.getSubdivisionX(e.level),i=this.m_subdivisionScheme.getSubdivisionY(e.level);return new r.SubTiles(e,t,i)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);t.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform float opacity;\n    uniform sampler2D tDiffuse;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        gl_FragColor = opacity * texel;\n    }"};class n extends r.ShaderMaterial{constructor(e){super({name:"CopyMaterial",uniforms:e,vertexShader:t.CopyShader.vertexShader,fragmentShader:t.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!1,blending:r.NoBlending,depthTest:!1,depthWrite:!1})}}t.CopyMaterial=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ConsoleChannel=class{error(e,...t){console.error(e,...t)}debug(e,...t){console.debug(e,...t)}info(e,...t){console.info(e,...t)}log(e,...t){console.log(e,...t)}trace(e,...t){console.trace(e,...t)}warn(e,...t){console.warn(e,...t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(41);t.Logger=class{constructor(e,t,i){this.name=e,this.m_channel=t,this.enabled=!0,this.level=r.LogLevel.Trace,void 0!==i&&this.update(i)}error(e,...t){this.enabled&&this.level<=r.LogLevel.Error&&this.m_channel.error(this.prefix,e,...t)}debug(e,...t){this.enabled&&this.level<=r.LogLevel.Debug&&this.m_channel.debug(this.prefix,e,...t)}info(e,...t){this.enabled&&this.level<=r.LogLevel.Info&&this.m_channel.info(this.prefix,e,...t)}log(e,...t){this.enabled&&this.level<=r.LogLevel.Log&&this.m_channel.log(this.prefix,e,...t)}trace(e,...t){this.enabled&&this.level<=r.LogLevel.Trace&&this.m_channel.trace(this.prefix,e,...t)}warn(e,...t){this.enabled&&this.level<=r.LogLevel.Warn&&this.m_channel.warn(this.prefix,e,...t)}update(e){this.enabled=void 0===e.enabled?this.enabled:e.enabled,this.level=void 0===e.level?this.level:e.level}get prefix(){return this.name+":"}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(41);t.WORKERCHANNEL_MSG_TYPE="worker-channel-message";t.WorkerChannel=class{error(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Error};self.postMessage(n)}debug(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Debug};self.postMessage(n)}info(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Info};self.postMessage(n)}log(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Log};self.postMessage(n)}trace(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Trace};self.postMessage(n)}warn(e,...i){const n={message:[e,...i],type:t.WORKERCHANNEL_MSG_TYPE,level:r.LogLevel.Warn};self.postMessage(n)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{lookup(e){}unmap(){return{}}}t.Env=r;t.MapEnv=class extends r{constructor(e,t){super(),this.entries=e,this.parent=t}lookup(e){if(this.entries.hasOwnProperty(e)){const t=this.entries[e];if(void 0!==t)return t}return this.parent?this.parent.lookup(e):void 0}unmap(){const e=this.parent?this.parent.unmap():{};for(const t in this.entries)this.entries.hasOwnProperty(t)&&(e[t]=this.entries[t]);return e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(0),s=i(19),o=new n.Color;var a;!function(e){e[e.Meters=0]="Meters",e[e.Pixels=1]="Pixels",e[e.Hex=2]="Hex",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.HSL=5]="HSL"}(a=t.StringEncodedNumeralType||(t.StringEncodedNumeralType={}));const l={type:a.Meters,size:1,regExp:/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))m$/,decoder:(e,t)=>{const i=l.regExp.exec(e);return!!i&&void 0!==(t[0]=Number(i[1]))}},c={type:a.Pixels,size:1,mask:1,regExp:/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))px$/,decoder:(e,t)=>{const i=c.regExp.exec(e);return null!==i&&(t[0]=Number(i[1]),!0)}},h={type:a.Hex,size:4,regExp:/^\#((?:[0-9A-Fa-f][0-9A-Fa-f]){3,4}|[0-9A-Fa-f]{3,4})$/,decoder:(e,t)=>{const i=h.regExp.exec(e);if(null===i)return!1;const n=i[1],s=n.length;return r.assert(3===s||4===s||6===s||8===s,`Matched incorrect hex format: ${e}`),3===s||4===s?(t[0]=parseInt(n.charAt(0)+n.charAt(0),16)/255,t[1]=parseInt(n.charAt(1)+n.charAt(1),16)/255,t[2]=parseInt(n.charAt(2)+n.charAt(2),16)/255,t[3]=4===s?parseInt(n.charAt(3)+n.charAt(3),16)/255:1):6!==s&&8!==s||(t[0]=parseInt(n.charAt(0)+n.charAt(1),16)/255,t[1]=parseInt(n.charAt(2)+n.charAt(3),16)/255,t[2]=parseInt(n.charAt(4)+n.charAt(5),16)/255,t[3]=8===s?parseInt(n.charAt(6)+n.charAt(7),16)/255:1),!0}},d={type:a.RGB,size:3,regExp:/^rgb\( ?(?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5]), ?)(?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5]), ?)(?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5])) ?\)$/,decoder:(e,t)=>{const i=d.regExp.exec(e);return null!==i&&(t[0]=parseInt(i[1],10)/255,t[1]=parseInt(i[2],10)/255,t[2]=parseInt(i[3],10)/255,!0)}},u={type:a.RGBA,size:4,regExp:/^rgba\( ?(?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5]), ?)(?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5]), ?)(?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5]), ?)(?:(0(?:\.[0-9]+)?|1(?:\.0+)?)) ?\)$/,decoder:(e,t)=>{const i=u.regExp.exec(e);return null!==i&&(t[0]=parseInt(i[1],10)/255,t[1]=parseInt(i[2],10)/255,t[2]=parseInt(i[3],10)/255,t[3]=parseInt(i[4],10),!0)}},m={type:a.HSL,size:3,regExp:/^hsl\( ?((?:[0-9]|[1-9][0-9]|1[0-9]{1,2}|2[0-9]{1,2}|3[0-5][0-9]|360)), ?(?:([0-9]|[1-9][0-9]|100)%), ?(?:([0-9]|[1-9][0-9]|100)%) ?\)$/,decoder:(e,t)=>{const i=m.regExp.exec(e);return null!==i&&(o.setHSL(parseInt(i[1],10)/360,parseInt(i[2],10)/100,parseInt(i[3],10)/100),t[0]=o.r,t[1]=o.g,t[2]=o.b,!0)}};t.StringEncodedMetricFormats=[l,c];const p=t.StringEncodedMetricFormats.reduce((e,t)=>Math.max(e,t.size),0);t.StringEncodedColorFormats=[h,d,u,m];const f=t.StringEncodedColorFormats.reduce((e,t)=>Math.max(e,t.size),0);t.StringEncodedNumeralFormats=[...t.StringEncodedMetricFormats,...t.StringEncodedColorFormats],t.StringEncodedNumeralFormatMaxSize=Math.max(f,p);const g=new Array(t.StringEncodedNumeralFormatMaxSize);t.parseStringEncodedNumeral=function(e,i=1){let r;return t.StringEncodedNumeralFormats.some(t=>{if(t.decoder(e,g)){switch(t.type){case a.Meters:r=g[0];break;case a.Pixels:r=g[0]*i;break;case a.Hex:case a.RGBA:r=s.ColorUtils.getHexFromRgba(g[0],g[1],g[2],g[3]);case a.RGB:case a.HSL:r=s.ColorUtils.getHexFromRgb(g[0],g[1],g[2]);break;default:r=g[0]}return!0}return!1}),r},t.parseStringEncodedColor=function(e){const i=(r=t.StringEncodedColorFormats,n=e,o=g,r.find(e=>!!e.decoder(n,o)));var r,n,o;if(void 0!==i)switch(i.type){case a.Hex:case a.RGBA:return s.ColorUtils.getHexFromRgba(g[0],g[1],g[2],g[3]);case a.RGB:case a.HSL:return s.ColorUtils.getHexFromRgb(g[0],g[1],g[2]);default:return g[0]}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.All="_all_",e.Background="background",e.Terrain="terrain",e.Area="area",e.Line="line",e.Water="water",e.Border="border",e.Road="road",e.Building="building",e.Label="label",e.Detail="detail"}(t.GeometryKind||(t.GeometryKind={}));class r extends Set{isSuperset(e){for(const t of e)if(!this.has(t))return!1;return!0}hasIntersection(e){for(const t of e)if(this.has(t))return!0;return!1}hasOrIntersects(e){return e instanceof Set?this.hasIntersection(e):this.has(e)}hasOrIntersectsArray(e){for(const t of e)if(this.has(t))return!0;return!1}}t.GeometryKindSet=r,function(e){e.TileSpace="tile-space",e.EquirectangularSpace="equirectangular-space"}(t.TextureCoordinateType||(t.TextureCoordinateType={})),function(e){e.Show="show-in-stack",e.Hide="hide-in-stack",e.ShowParent="show-parent"}(t.PoiStackMode||(t.PoiStackMode={})),t.isTextureBuffer=function(e){return e&&e.buffer&&"string"==typeof e.type}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.FeatureGeometry=0]="FeatureGeometry",e[e.TechniqueGeometry=1]="TechniqueGeometry",e[e.TechniqueRendering=2]="TechniqueRendering"}(t.AttrScope||(t.AttrScope={})),t.mergeTechniqueDescriptor=function(...e){const t={attrScopes:{}};for(const i of e)void 0!==i.attrTransparencyColor&&(t.attrTransparencyColor=i.attrTransparencyColor),void 0!==i.attrScopes&&(t.attrScopes=Object.assign(Object.assign({},t.attrScopes),i.attrScopes));return t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(3);t.getArrayConstructor=function(e){switch(e){case"float":return Float32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array}},function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.SolidLine=3]="SolidLine",e[e.Text=4]="Text",e[e.TextPath=5]="TextPath",e[e.ExtrudedLine=6]="ExtrudedLine",e[e.Polygon=7]="Polygon",e[e.ExtrudedPolygon=8]="ExtrudedPolygon",e[e.Object3D=9]="Object3D",e[e.Other=1e3]="Other"}(t.GeometryType||(t.GeometryType={})),t.getProjection=function(e){switch(e){case"mercator":return r.mercatorProjection;case"webMercator":return r.webMercatorProjection;case"sphere":return r.sphereProjection;case"normalizedEquirectangular":return r.normalizedEquirectangularProjection;case"equirectangular":return r.equirectangularProjection;default:throw new Error(`Unknown projection ${e}`)}},t.getProjectionName=function(e){if(e===r.mercatorProjection)return"mercator";if(e===r.webMercatorProjection)return"webMercator";if(e===r.sphereProjection)return"sphere";if(e===r.normalizedEquirectangularProjection)return"normalizedEquirectangular";if(e===r.equirectangularProjection)return"equirectangular";throw new Error("Unknown projection")},t.getFeatureId=function(e){return void 0===e?0:"number"==typeof e?e:e.hasOwnProperty("$id")?e.$id:0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(5),s=i(177),o=i(20),a=i(31),l=i(75),c=i(44),h=i(32),d=r.LoggerManager.instance.create("StyleSetEvaluator"),u=l.mergeTechniqueDescriptor({});class m{classify(e){if(e._whenExpr){const t=this.switchStyle(e);e._whenExpr=e._whenExpr.accept(this,void 0),this._style=t}}visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){return e}visitHasAttributeExpr(e,t){return e}visitContainsExpr(e,t){return e}visitMatchExpr(e,t){return e}visitCaseExpr(e,t){return e}visitCallExpr(e,t){if("all"===e.op){const t=e.args.map(t=>t.accept(this,e)).filter(e=>void 0!==e);return new n.CallExpr(e.op,t)}if(t){const t=this.matchVarStringComparison(e);if(t){if(void 0===this._style.layer&&"$layer"===t.name)return void(this._style.layer=t.value);if(void 0===this._style._geometryType&&"$geometryType"===t.name)return void(this._style._geometryType=t.value)}}return e}matchVarStringComparison(e){if("=="===e.op){const t=e.args[0],i=e.args[1];if(t instanceof n.VarExpr&&i instanceof n.StringLiteralExpr)return{name:t.name,value:i.value};if(i instanceof n.VarExpr&&t instanceof n.StringLiteralExpr)return{name:i.name,value:t.value}}}switchStyle(e){const t=this._style;return this._style=e,t}}class p{constructor(e,t){this.key="",this.set(e,t)}set(e,t,i){let r=!1;if(void 0===e){const t=void 0!==i?i.lookup("$layer"):void 0;e="string"==typeof t?t:void 0}if(this.layer!==e&&(this.layer=e,r=!0),void 0===t){const e=void 0!==i?i.lookup("$geometryType"):void 0;t="string"==typeof e?e:void 0}return this.geometryType!==t&&(this.geometryType=t,r=!0),r&&this.updateKey(),this}updateKey(){void 0!==this.layer?void 0!==this.geometryType?this.key=`${this.layer}:${this.geometryType}`:this.key=`${this.layer}:`:void 0!==this.geometryType?this.key=`:${this.geometryType}`:this.key="all",this.cachedStyleSet=void 0}}function f(e){const t={};for(const i in e){if(!e.hasOwnProperty(i))continue;let r=e[i];n.Expr.isExpr(r)&&(r=r.toJSON()),t[i]=r}return t}t.StyleSetEvaluator=class{constructor(e,t){this.m_techniques=[],this.m_exprPool=new s.ExprPool,this.m_cachedResults=new Map,this.m_styleConditionClassifier=new m,this.m_subStyleSetCache=new Map,this.m_definitionExprCache=new Map,this.m_tmpOptimizedSubSetKey=new p,this.m_emptyEnv=new n.Env,this.m_definitions=t,this.styleSet=function(e,t){return e.map(e=>(function e(t,i){if(n.isJsonExpr(t)){if(!h.isJsonExprReference(t))throw new Error("invalid expression in this context, only 'ref's are supported");const r=t[1],n=i&&i[r];if(!n)throw new Error(`invalid reference '${r}' - not found`);if(!h.isActualSelectorDefinition(n))throw new Error(`invalid reference '${r}' - expected style definition`);return e(n,i)}return Object.assign({},t)})(e,t))}(e,t),function(e){let t=0,i=0;for(const r of e)r._styleSetIndex=i++,void 0!==r.technique&&void 0===r.renderOrder&&(r.renderOrder=t++)}(this.styleSet),this.compileStyleSet()}getMatchingTechniques(e,t,i){const r=[];this.m_cachedResults.clear();const n=this.m_tmpOptimizedSubSetKey;n.set(t,i,e),this.m_layer=n.layer,this.m_geometryType=n.geometryType,this.m_zoomLevel=e.lookup("$zoom");const s=this.getOptimizedStyleSet(n);for(const t of s)if(this.processStyle(e,t,r))break;return r}wantsLayer(e){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,void 0)).length>0}wantsFeature(e,t){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,t)).length>0}get expressionEvaluatorCache(){return this.m_cachedResults}resetTechniques(){for(const e of this.m_techniques)e._index=void 0;this.m_techniques.length=0}get techniques(){return this.m_techniques}get decodedTechniques(){return this.m_techniques.map(f)}getOptimizedStyleSet(e){if(void 0!==e.cachedStyleSet)return e.cachedStyleSet;let t=this.m_subStyleSetCache.get(e.key);return void 0!==t?(e.cachedStyleSet=t,t):(t=this.createPreFilteredStyleSet(e),this.m_subStyleSetCache.set(e.key,t),e.cachedStyleSet=t,t)}createPreFilteredStyleSet(e){const{layer:t,geometryType:i}=e;return this.styleSet.filter(e=>(void 0===t||void 0===e.layer||e.layer===t)&&(void 0===i||void 0===e._geometryType||e._geometryType===i))}compileStyleSet(){this.styleSet.forEach(e=>this.compileStyle(e)),this.styleSet.forEach(e=>{this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e.layer,e._geometryType))})}compileStyle(e){if(void 0!==e.when)try{e._whenExpr=Array.isArray(e.when)?n.Expr.fromJSON(e.when,this.m_definitions,this.m_definitionExprCache):n.Expr.parse(e.when),this.m_styleConditionClassifier.classify(e),void 0!==e._whenExpr&&(e._whenExpr=e._whenExpr.intern(this.m_exprPool)),n.isJsonExpr(e.minZoomLevel)&&(e._minZoomLevelExpr=n.Expr.fromJSON(e.minZoomLevel).intern(this.m_exprPool)),n.isJsonExpr(e.maxZoomLevel)&&(e._maxZoomLevelExpr=n.Expr.fromJSON(e.maxZoomLevel).intern(this.m_exprPool))}catch(t){d.log("failed to evaluate expression",JSON.stringify(e.when),"error",String(t))}}processStyle(e,t,i){if(!this.checkZoomLevel(e,t))return!1;if(void 0!==this.m_layer&&void 0!==t.layer&&t.layer!==this.m_layer)return!1;if(void 0!==this.m_geometryType&&void 0!==t._geometryType&&t._geometryType!==this.m_geometryType)return!1;if(t._whenExpr)try{if(!t._whenExpr.evaluate(e,n.ExprScope.Condition,this.m_cachedResults))return!1}catch(e){return d.error(`failed to evaluate expression '${JSON.stringify(t.when)}': ${e}`),!1}return void 0!==t.technique&&("none"!==t.technique&&i.push(this.getTechniqueForStyleMatch(e,t)),!0===t.final)}checkZoomLevel(e,t){if(void 0===t.minZoomLevel&&void 0===t.maxZoomLevel)return!0;const i=this.m_zoomLevel;if(void 0===i)return!0;if(void 0!==t.minZoomLevel){let r=t.minZoomLevel;if(t._minZoomLevelExpr)try{r=t._minZoomLevelExpr.evaluate(e,n.ExprScope.Condition,this.m_cachedResults)}catch(e){d.error(`failed to evaluate expression '${JSON.stringify(t._minZoomLevelExpr)}': ${e}`)}if("number"==typeof r&&i<r)return!1}if(void 0!==t.maxZoomLevel){let r=t.maxZoomLevel;if(t._maxZoomLevelExpr)try{r=t._maxZoomLevelExpr.evaluate(e,n.ExprScope.Condition,this.m_cachedResults)}catch(e){d.error(`failed to evaluate expression '${JSON.stringify(t._maxZoomLevelExpr)}': ${e}`)}if("number"==typeof r&&i>r)return!1}return!0}getTechniqueForStyleMatch(e,t){let i;if(this.checkStyleDynamicAttributes(t),void 0!==t._dynamicTechniques){const r=this.evaluateTechniqueProperties(t,e),n=this.getDynamicTechniqueKey(t,r);i=t._dynamicTechniques.get(n),void 0===i&&(i=this.createTechnique(t,n,r),t._dynamicTechniques.set(n,i))}else i=t._staticTechnique,void 0===i&&(t._staticTechnique=i=this.createTechnique(t,`${t._styleSetIndex}`,[]));return void 0===i._index&&(i._index=this.m_techniques.length,this.m_techniques.push(i)),i}getDynamicTechniqueKey(e,t){const i=t.map(([e,t])=>void 0===t?"U":JSON.stringify(t)).join(":");return`${e._styleSetIndex}:${i}`}checkStyleDynamicAttributes(e){if(void 0!==e._dynamicTechniqueAttributes||"none"===e.technique)return;e._dynamicTechniqueAttributes=[],e._dynamicFeatureAttributes=[],e._dynamicForwardedAttributes=[],e._staticAttributes=[];const t=e._dynamicFeatureAttributes,i=e._dynamicTechniqueAttributes,r=e._dynamicForwardedAttributes,s=e._staticAttributes,h=c.techniqueDescriptors[e.technique]||u,d=(e,c)=>{if(void 0!==c){if(n.isJsonExpr(c)?c=n.Expr.fromJSON(c,this.m_definitions,this.m_definitionExprCache).intern(this.m_exprPool):o.isInterpolatedPropertyDefinition(c)&&(c=n.Expr.fromJSON(a.interpolatedPropertyDefinitionToJsonExpr(c)).intern(this.m_exprPool)),n.Expr.isExpr(c)){const e=c.dependencies();e.zoom||0!==e.properties.size||(c=c.evaluate(this.m_emptyEnv))}if(n.Expr.isExpr(c)){let n=h.attrScopes[e];void 0===n&&(n=l.AttrScope.TechniqueGeometry);const s=c.dependencies();switch(n){case l.AttrScope.FeatureGeometry:t.push([e,c]);break;case l.AttrScope.TechniqueGeometry:i.push([e,c]);break;case l.AttrScope.TechniqueRendering:0===s.properties.size?r.push([e,c]):i.push([e,c])}}else null!=c&&s.push([e,c])}};if(d("renderOrder",e.renderOrder),d("label",e.labelProperty),d("secondaryRenderOrder",e.secondaryRenderOrder),void 0!==e.attr)for(const t in e.attr)e.attr.hasOwnProperty(t)&&d(t,e.attr[t]);i.length>0&&(e._dynamicTechniques=new Map)}evaluateTechniqueProperties(e,t){if(void 0===e._dynamicTechniqueAttributes)return[];const i={env:t};return e._dynamicTechniqueAttributes.map(([e,r])=>{try{if(r.isDynamic()){return[e,r.instantiate(i)]}return[e,r.evaluate(t,n.ExprScope.Value,this.m_cachedResults)]}catch(t){return d.error(`failed to evaluate expression '${r.toJSON()}': ${t}`),[e,null]}})}createTechnique(e,t,i){const r={};if(r.name=e.technique,void 0!==e._staticAttributes)for(const[t,i]of e._staticAttributes)null!==i&&(r[t]=i);for(const[e,t]of i)null!==t&&(r[e]=t);if(void 0!==e._dynamicFeatureAttributes)for(const[t,i]of e._dynamicFeatureAttributes)r[t]=i;if(void 0!==e._dynamicForwardedAttributes)for(const[t,i]of e._dynamicForwardedAttributes)n.Expr.isExpr(i)?r[t]=i.toJSON():r[t]=i;return r._index=this.m_techniques.length,r._styleSetIndex=e._styleSetIndex,r._key=t,this.m_techniques.push(r),r}},t.makeDecodedTechnique=f},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n={sdf_attributes:"\n        attribute vec4 position;\n        attribute vec4 uv;\n        attribute vec4 color;\n        attribute vec4 bgColor;\n        ",sdf_varying:"\n        varying vec4 vColor;\n        varying float vWeight;\n        varying vec2 vUv;\n        varying float vRotation;\n        ",sdf_varying_computation:"\n        #if BG_TEXT\n        vColor = bgColor;\n        vWeight = uv.w;\n        #else\n        vColor = color;\n        vWeight = uv.z;\n        #endif\n        vUv = vec2(uv.xy);\n        vRotation = position.w;\n        ",sdf_frag_uniforms:"\n        uniform sampler2D sdfTexture;\n        uniform vec4 sdfParams;\n        ",sdf_sampling_functions:"\n        float median(float r, float g, float b) {\n            return max(min(r, g), min(max(r, g), b));\n        }\n\n        float getDistance(vec2 uvOffset) {\n            vec3 sample = texture2D(sdfTexture, vUv.xy + uvOffset).rgb;\n            #if MSDF\n            return median(sample.r, sample.g, sample.b);\n            #else\n            return sample.r;\n            #endif\n        }\n\n        float getOpacity(vec2 uvOffset, float weight) {\n            vec2 uv = vUv + uvOffset;\n            vec2 rotatedUVs = abs(vec2(\n                cos(vRotation) * uv.x - sin(vRotation) * uv.y,\n                sin(vRotation) * uv.x + cos(vRotation) * uv.y));\n\n            float dx = dFdx(rotatedUVs.x) * sdfParams.x;\n            float dy = dFdy(rotatedUVs.y) * sdfParams.y;\n            float toPixels = sdfParams.w * inversesqrt( dx * dx + dy * dy );\n\n            float dist = getDistance(uvOffset) + min(weight, 0.5 - 1.0 / sdfParams.w) - 0.5;\n            return clamp(dist * toPixels + 0.5, 0.0, 1.0);\n        }\n        "};Object.assign(r.ShaderChunk,n);const s="\n    attribute vec2 position;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    }",o="\n    precision highp float;\n    precision highp int;\n\n    void main() {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n    }",a="\n    attribute vec3 position;\n    attribute vec2 uv;\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    varying vec3 vUv;\n\n    void main() {\n        vUv = vec3(uv.xy, position.z);\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xy, 0.0, 1.0);\n    }",l="\n    precision highp float;\n    precision highp int;\n\n    uniform float pageOffset;\n    uniform sampler2D page0;\n    uniform sampler2D page1;\n    uniform sampler2D page2;\n    uniform sampler2D page3;\n    uniform sampler2D page4;\n    uniform sampler2D page5;\n    uniform sampler2D page6;\n    uniform sampler2D page7;\n\n    varying vec3 vUv;\n\n    void main() {\n        vec4 sample = vec4(0.0);\n        if (vUv.z < pageOffset || vUv.z > (pageOffset + 7.0)) discard;\n        else if (vUv.z < pageOffset + 1.0) sample = texture2D(page0, vUv.xy);\n        else if (vUv.z < pageOffset + 2.0) sample = texture2D(page1, vUv.xy);\n        else if (vUv.z < pageOffset + 3.0) sample = texture2D(page2, vUv.xy);\n        else if (vUv.z < pageOffset + 4.0) sample = texture2D(page3, vUv.xy);\n        else if (vUv.z < pageOffset + 5.0) sample = texture2D(page4, vUv.xy);\n        else if (vUv.z < pageOffset + 6.0) sample = texture2D(page5, vUv.xy);\n        else if (vUv.z < pageOffset + 7.0) sample = texture2D(page6, vUv.xy);\n        else sample = texture2D(page7, vUv.xy);\n\n        gl_FragColor = sample;\n    }",c="\n    #include <sdf_attributes>\n    #include <sdf_varying>\n\n    uniform mat4 modelViewMatrix;\n    uniform mat4 projectionMatrix;\n\n    void main() {\n        #include <sdf_varying_computation>\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n    }",h="\n    precision highp float;\n    precision highp int;\n\n    #include <sdf_varying>\n    #include <sdf_frag_uniforms>\n    #include <sdf_sampling_functions>\n\n    void main() {\n        vec4 color = vColor;\n        color.a *= getOpacity(vec2(0.0), vWeight);\n        if (color.a < 0.05) {\n            discard;\n        }\n        gl_FragColor = color;\n    }";class d extends r.RawShaderMaterial{constructor(){super({name:"GlyphClearMaterial",vertexShader:s,fragmentShader:o,uniforms:{},depthTest:!1,depthWrite:!1})}}t.GlyphClearMaterial=d;class u extends r.RawShaderMaterial{constructor(){super({name:"GlyphCopyMaterial",vertexShader:a,fragmentShader:l,uniforms:{pageOffset:new r.Uniform(0),page0:new r.Uniform(r.Texture.DEFAULT_IMAGE),page1:new r.Uniform(r.Texture.DEFAULT_IMAGE),page2:new r.Uniform(r.Texture.DEFAULT_IMAGE),page3:new r.Uniform(r.Texture.DEFAULT_IMAGE),page4:new r.Uniform(r.Texture.DEFAULT_IMAGE),page5:new r.Uniform(r.Texture.DEFAULT_IMAGE),page6:new r.Uniform(r.Texture.DEFAULT_IMAGE),page7:new r.Uniform(r.Texture.DEFAULT_IMAGE)},depthTest:!1,depthWrite:!1})}}t.GlyphCopyMaterial=u;class m extends r.RawShaderMaterial{constructor(e){super({name:"SdfTextMaterial",vertexShader:void 0!==e.vertexSource?e.vertexSource:c,fragmentShader:void 0!==e.fragmentSource?e.fragmentSource:h,uniforms:{sdfTexture:new r.Uniform(e.texture),sdfParams:new r.Uniform(new r.Vector4(e.textureSize.x,e.textureSize.y,e.size,e.distanceRange))},defines:{MSDF:e.isMsdf?1:0,BG_TEXT:e.isBackground?1:0},depthTest:!0,depthWrite:!0,side:r.DoubleSide,transparent:!0}),this.extensions.derivatives=!0}}t.SdfTextMaterial=m},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TextBufferObject=class{constructor(e,t,i,r,n,s){this.glyphs=e,this.buffer=t,this.bounds=i,this.characterBounds=r,this.textRenderStyle=n,this.textLayoutStyle=s}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(78);t.createSdfTextMaterial=function(e){return new r.SdfTextMaterial({texture:e.fontCatalog.texture,textureSize:e.fontCatalog.textureSize,size:e.fontCatalog.size,distanceRange:e.fontCatalog.distanceRange,isMsdf:"msdf"===e.fontCatalog.type,isBackground:!0===e.isBackground,vertexSource:e.vertexSource,fragmentSource:e.fragmentSource})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);t.toPixelFormat=function(e){switch(e){case"Alpha":return r.AlphaFormat;case"RGB":return r.RGBFormat;case"RGBA":return r.RGBAFormat;case"Luminance":return r.LuminanceFormat;case"LuminanceAlpha":return r.LuminanceAlphaFormat;case"RGBE":return r.RGBEFormat;case"Depth":return r.DepthFormat;case"DepthStencil":return r.DepthStencilFormat;case"Red":return r.RedFormat;default:throw new Error(`invalid pixel format: ${e}`)}},t.toTextureDataType=function(e){switch(e){case"UnsignedByte":return r.UnsignedByteType;case"Byte":return r.ByteType;case"Short":return r.ShortType;case"UnsignedShort":return r.UnsignedShortType;case"Int":return r.IntType;case"UnsignedInt":return r.UnsignedIntType;case"Float":return r.FloatType;case"HalfFloat":return r.HalfFloatType;default:throw new Error(`invalid texture data type: ${e}`)}},t.toWrappingMode=function(e){switch(e){case"clamp":return r.ClampToEdgeWrapping;case"repeat":return r.RepeatWrapping;case"mirror":return r.MirroredRepeatWrapping;default:throw new Error(`invalid wrapping mode: ${e}`)}},t.toTextureFilter=function(e){switch(e){case"nearest":return r.NearestFilter;case"nearestMipMapNearest":return r.NearestMipMapNearestFilter;case"nearestMipMapLinear":return r.NearestMipMapLinearFilter;case"linear":return r.LinearFilter;case"linearMipMapNearest":return r.LinearMipMapNearestFilter;case"linearMipMapLinear":return r.LinearMipMapLinearFilter;default:throw new Error(`invalid texture filter: ${e}`)}},t.createLight=function(e){switch(e.type){case"ambient":{const t=new r.AmbientLight(e.color,e.intensity);return t.name=e.name,t}case"directional":{const t=new r.DirectionalLight(e.color,e.intensity);return t.name=e.name,void 0!==e.castShadow&&(t.castShadow=e.castShadow),t.position.set(e.direction.x,e.direction.y,e.direction.z),t.position.normalize(),t}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(19),s=i(4),o=i(22);t.DEPTH_PRE_PASS_STENCIL_MASK=1;const a=1e-6;function l(e){e.depthWrite=!1,e.depthFunc=r.EqualDepth,e.colorWrite=!0,s.enforceBlending(e);const t=e.clone();return t.depthWrite=!0,t.depthTest=!0,t.depthFunc=r.LessDepth,t.colorWrite=!1,t.opacity=1,t.blending=r.NoBlending,t}t.isRenderDepthPrePassEnabled=function(e){if(!1===e.enableDepthPrePass)return!1;let t=void 0!==e.opacity&&e.opacity>0&&e.opacity<1;if(!t){const i=o.evaluateBaseColorProperty(e);if(void 0!==i){const e=n.ColorUtils.getAlphaFromHex(i);t=e>0&&e<1}}return t},t.createDepthPrePassMaterial=l,t.createDepthPrePassMesh=function(e){const t=e.geometry;if(!(t instanceof r.BufferGeometry))throw new Error("#createDepthPassMesh only BufferGeometry is supported");const i=t.getAttribute("position");if(!i)throw new Error("#createDepthPassMesh position attribute not found");const n=new r.BufferGeometry;n.setAttribute("position",i);const s=t.getAttribute("uv");s&&n.setAttribute("uv",s);const o=t.getAttribute("normal");o&&n.setAttribute("normal",o);const c=t.getAttribute("extrusionAxis");c&&n.setAttribute("extrusionAxis",c),t.index&&n.setIndex(t.index);for(const e of t.groups){const{start:t,count:i,materialIndex:r}=e;n.addGroup(t,i,r)}const h=e.material instanceof Array?e.material.map(l):l(e.material),d=new r.Mesh(n,h);return d.renderOrder=e.renderOrder-a,d},t.setDepthPrePassStencil=function(e,i){const n=e.material;n.stencilWrite=!0,n.stencilFail=r.KeepStencilOp,n.stencilZFail=r.KeepStencilOp,n.stencilZPass=r.ReplaceStencilOp,n.stencilFunc=r.AlwaysStencilFunc,n.stencilRef=255,n.stencilFuncMask=t.DEPTH_PRE_PASS_STENCIL_MASK;const s=i.material;s.stencilWrite=!0,s.stencilFail=r.KeepStencilOp,s.stencilZFail=r.KeepStencilOp,s.stencilZPass=r.ZeroStencilOp,s.stencilFunc=r.EqualStencilFunc,s.stencilRef=255,s.stencilFuncMask=t.DEPTH_PRE_PASS_STENCIL_MASK}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(5),s=i(1),o=i(37),a=s.LoggerManager.instance.create("RoadPicker"),l=.01;t.RoadPicker=class{constructor(e){this.m_mapView=e}registerTile(e){if(s.assert(void 0!==e.decodedTile),void 0===e.decodedTile||void 0===e.decodedTile.tileInfo)return;const t=e.decodedTile.tileInfo,i=t.lineGroup;if(void 0===i||0===i.numFeatures)return;const o=[];o.length=i.numFeatures;const a=this.m_mapView;for(let e=0;e<i.numFeatures;e++){const s=t.techniqueCatalog[i.techniqueIndex[e]],l="Pixel"===s.metricUnit||n.Expr.isExpr(s.lineWidth)||"string"==typeof s.lineWidth;o[e]=void 0!==s.lineWidth?l?()=>{const e="Pixel"===s.metricUnit?a.pixelToWorld:1;return r.getPropertyValue(s.lineWidth,a.zoomLevel,a.pixelToWorld)*e*.5}:s.lineWidth:1}const l=t.lineGroup.userData;return{ids:i.featureIds,techniqueIndex:i.techniqueIndex,starts:i.positionIndex,widths:o,positions:i.positions,techniques:t.techniqueCatalog,objInfos:l}}intersectRoads(e,t,i,r){if(e.boundingBox.distanceToPoint(i)>l)return!1;const n=e.roadIntersectionData;if(void 0===n)return!1;const c=n.ids,h=n.techniques,d=n.techniqueIndex,u=c.length,m=n.positions,p=n.widths,f=i.x-e.center.x,g=i.y-e.center.y,v=i.distanceTo(t);if(p.length!==c.length||c.length!==d.length||d.length!==n.starts.length)return a.error("The amount of widths, ids, techniqueIndices and starts has to be the same"),!1;for(let e=0;e<u;e++){const t=h[d[e]];if(!0===t.transient)continue;const a=n.starts[e],l=e<u-1?n.starts[e+1]:n.positions.length;let y=m[a],_=m[a+1];const x=p[e],T=Math.max(1,"function"==typeof x?x():x),S=T*T;let w=Number.MAX_VALUE;for(let e=a+2;e<l;e+=2){const t=m[e],i=m[e+1],r=s.Math2D.distToSegmentSquared(f,g,y,_,t,i);r<S&&r<w&&(w=r),y=t,_=i}if(w<Number.MAX_VALUE){const s={type:o.PickObjectType.Line,point:i,distance:v,distFromCenter:Math.sqrt(w),featureId:c[e],positions:m.slice(a,l),technique:t};this.addUserData(s,e,n.objInfos),r.push(s)}}return!1}addUserData(e,t,i){void 0!==i&&i.length>0&&(e.userData=Object.assign({},i[t]))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(4),s=i(1),o=i(0),a=i(34),l=i(191),c=i(85),h=s.LoggerManager.instance.create("PoiRenderer"),d=-1,u=new o.Vector3(0);class m{constructor(e,t,i,r){this.mapView=e,this.scene=t,this.imageItem=i,this.renderOrder=r,this.color=a.ColorCache.instance.getColor("#000000")}init(){void 0===this.boxBuffer&&this.setup()}reset(){void 0===this.boxBuffer&&this.init(),this.boxBuffer.reset()}update(){void 0===this.boxBuffer&&this.init(),this.boxBuffer.updateBufferGeometry()}updateMemoryUsage(e){void 0!==this.boxBuffer&&this.boxBuffer.updateMemoryUsage(e)}setup(){const e=new c.IconTexture(this.imageItem),t=new o.Texture(e.image.imageData,o.UVMapping,void 0,void 0,o.LinearFilter,o.LinearFilter,o.RGBAFormat);t.needsUpdate=!0,t.premultiplyAlpha=!0,t.generateMipmaps=!1,this.m_material=new n.IconMaterial({map:t}),this.boxBuffer=new l.BoxBuffer(this.m_material,this.renderOrder);const i=this.boxBuffer.mesh;i.frustumCulled=!1,this.scene.add(i),this.mapView.update()}}class p{constructor(e,t){this.mapView=e,this.textCanvas=t,this.batches=[],this.m_batchMap=new Map}registerPoi(e){const{imageItem:t,imageTexture:i,imageTextureName:r}=e;if(void 0===t||void 0===r||void 0===i)return d;const n=e.renderOrder,s=i.image;let o,a,l=this.m_batchMap.get(s);if(void 0===l&&(l=new Map,this.m_batchMap.set(s,l)),o=l.get(n),void 0!==o)return o;o=this.batches.length;let c=this.textCanvas.getLayer(n);return void 0===c&&(this.textCanvas.addText("",u,{layer:n}),c=this.textCanvas.getLayer(n)),a=new m(this.mapView,c.storage.scene,t,n),a.init(),l.set(n,o),this.batches.push(a),o}addPoi(e,t,i,r){const n=void 0!==e.poiRenderBatch&&e.poiRenderBatch!==d?e.poiRenderBatch:this.registerPoi(e);return n===d?d:(s.assert(n>=0),s.assert(n<this.batches.length),s.assert(void 0!==e.uvBox),void 0===this.batches[n].boxBuffer&&this.batches[n].init(),this.batches[n].boxBuffer.addBox(t,e.uvBox,this.batches[n].color,r,i,e.textElement),n)}getBatch(e){if(e>=0)return s.assert(e<this.batches.length),this.batches[e]}reset(){for(const e of this.batches)e.reset()}update(){for(const e of this.batches)e.update()}pickTextElements(e,t){for(const i of this.batches)void 0===i.boxBuffer&&i.init(),i.boxBuffer.pickBoxes(e,t,i.imageItem.imageData)}updateMemoryUsage(e){for(const t of this.batches){if(void 0!==t.imageItem.imageData){const i=t.imageItem.imageData.width*t.imageItem.imageData.height*4;e.heapSize+=i,e.gpuSize+=i}void 0!==t.boxBuffer&&t.boxBuffer.updateMemoryUsage(e)}}}class f{constructor(e,t){this.mapView=e,this.textCanvas=t,this.m_tempScreenBox=new s.Math2D.Box,this.m_renderBuffer=new p(e,t)}static computeIconScreenBox(e,t,i,n,o=new s.Math2D.Box){s.assert(void 0!==e.poiRenderBatch),s.assert(e.poiRenderBatch!==d);const a=e.computedWidth*i,l=e.computedHeight*i,c=e.technique,h=r.getPropertyValue(c.iconXOffset,n),u=r.getPropertyValue(c.iconYOffset,n),m=t.x+("number"==typeof h?h:0),p=t.y+("number"==typeof u?u:0);return o.x=m-a/2,o.y=p-l/2,o.w=a,o.h=l,o}prepareRender(e,t){const i=e.poiInfo;return void 0!==i&&(void 0===i.poiRenderBatch&&this.preparePoi(e,t),void 0!==i.poiRenderBatch)}reset(){this.m_renderBuffer.reset()}renderPoi(e,t,i,r,n,o,a,l){s.assert(void 0!==e.poiRenderBatch),f.computeIconScreenBox(e,t,n,l,this.m_tempScreenBox),o&&i.allocate(this.m_tempScreenBox),this.m_renderBuffer.addPoi(e,this.m_tempScreenBox,r,a)}update(){this.m_renderBuffer.update()}pickTextElements(e,t){this.m_renderBuffer.pickTextElements(e,t)}getMemoryUsage(e){this.m_renderBuffer.updateMemoryUsage(e)}preparePoi(e,t){const i=e.poiInfo;if(void 0===i||!e.visible)return;if(void 0!==i.poiRenderBatch||!1===i.isValid)return;if(void 0!==i.poiTableName){if(!this.mapView.poiManager.updatePoiFromPoiTable(e))return;if(!e.visible)return}const r=i.imageTextureName,n=this.mapView.poiManager.getImageTexture(r);if(void 0===n)return void 0===f.m_missingTextureName.get(r)&&(f.m_missingTextureName.set(r,!0),h.error(`preparePoi: No imageTexture with name '${r}' found`)),void(i.isValid=!1);const s=n.image;let o=this.mapView.imageCache.findImageByName(s);if(void 0===o)return h.error(`init: No imageItem found with name '${s}'`),void(i.isValid=!1);if(!o.loaded){if(void 0!==o.loadingPromise)return;const e=o.url,r=this.mapView.imageCache.loadImage(o);if(r instanceof Promise)return void r.then(r=>{void 0!==r?this.setupPoiInfo(i,n,r,t):h.error(`preparePoi: Failed to load imageItem: '${e}`)}).catch(t=>{h.error(`preparePoi: Failed to load imageItem: '${e}`,t),i.isValid=!1});o=r}this.setupPoiInfo(i,n,o,t)}setupPoiInfo(e,t,i,n){if(s.assert(void 0===e.uvBox),void 0===i||void 0===i.imageData)return h.error("setupPoiInfo: No imageItem/imageData found"),e.poiRenderBatch=d,void(e.isValid=!1);const o=e.technique,a=i.imageData.width,l=i.imageData.height,c=void 0!==t.width?t.width:a,u=void 0!==t.height?t.height:l;let m=0,p=1,f=0,g=1,v=void 0!==o.iconScale?o.iconScale:1,y=void 0!==o.iconScale?o.iconScale:1;const _=void 0!==t.width?t.width:a,x=void 0!==t.height?t.height:l,T=void 0!==t.xOffset?t.xOffset:0,S=void 0!==t.yOffset?t.yOffset:0;m=T/a,p=(T+_)/a;f=(l-S)/l,g=(l-S-x)/l;const w=r.getPropertyValue(o.screenWidth,n);void 0!==w&&(y=v=w/c);const b=r.getPropertyValue(o.screenHeight,n);void 0!==b&&(y=b/u,void 0!==w&&(v=y)),e.computedWidth=c*v,e.computedHeight=u*y,e.uvBox={s0:m,t0:g,s1:p,t1:f},e.imageItem=i,e.imageTexture=t,e.poiRenderBatch=this.m_renderBuffer.registerPoi(e),e.isValid=!0,s.assert(void 0!==e.poiRenderBatch)}}t.PoiRenderer=f,f.m_missingTextureName=new Map},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.TopLeft=0]="TopLeft",e[e.BottomLeft=1]="BottomLeft"}(t.ImageOrigin||(t.ImageOrigin={}));t.IconTexture=class{constructor(e){this.image=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(3),n=i(6),s=i(1),o=i(0),a=i(23),l=i(35),c=new o.Vector3(0,0,0),h=new o.Vector3(0,0,0),d=.5877852522924731;function u(e,t){let i;if(Array.isArray(t.points)&&t.points.length>1){const r=e.distanceTo(t.points[0]),n=e.distanceTo(t.points[t.points.length-1]);i=Math.min(r,n)}else i=e.distanceTo(t.points);return i}var m;t.computeViewDistance=u,t.getMaxViewDistance=function(e,t){return e.maxVisibilityDist*t},function(e){e[e.Ok=0]="Ok",e[e.NotReady=1]="NotReady",e[e.Invisible=2]="Invisible",e[e.TooFar=3]="TooFar",e[e.Duplicate=4]="Duplicate",e[e.Count=5]="Count"}(m=t.PrePlacementResult||(t.PrePlacementResult={})),t.checkReadyForPlacement=function(e,t,i,n,o,a){let l;return e.visible?n.updatePoiFromPoiTable(e)?e.visible&&s.MathUtils.isClamped(t.zoomLevel,e.minZoomLevel,e.maxZoomLevel)?(l=void 0===a?u(t.worldCenter,e):function(e,t,i,n,s){const o=u(e,t);return i!==r.ProjectionType.Spherical?o<=s?o:void 0:(c.copy(t.position).normalize(),n.getWorldPosition(h).normalize(),c.dot(h)>d&&o<=s?o:void 0)}(t.worldCenter,e,o,i,a),void 0===l?{result:m.TooFar,viewDistance:l}:{result:m.Ok,viewDistance:l}):{result:m.Invisible,viewDistance:l}:{result:m.NotReady,viewDistance:l}:{result:m.Invisible,viewDistance:l}},t.computePointTextOffset=function(e,t=new o.Vector2){s.assert(e.type===l.TextElementType.PoiLabel),s.assert(void 0!==e.layoutStyle),s.assert(void 0!==e.bounds);const i=e.layoutStyle.horizontalAlignment,r=e.layoutStyle.verticalAlignment;switch(i){case n.HorizontalAlignment.Right:t.x=-e.xOffset;break;default:t.x=e.xOffset}switch(r){case n.VerticalAlignment.Below:t.y=-e.yOffset;break;case n.VerticalAlignment.Above:t.y=e.yOffset-e.bounds.min.y;break;default:t.y=e.yOffset}return void 0!==e.poiInfo&&a.poiIsRenderable(e.poiInfo)&&(s.assert(void 0!==e.poiInfo.computedWidth),s.assert(void 0!==e.poiInfo.computedHeight),t.x+=e.poiInfo.computedWidth*(.5+i),t.y+=e.poiInfo.computedHeight*(.5+r)),t}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(6),s=i(1),o=i(34),a=i(22),l=s.LoggerManager.instance.create("TextStyleCache");function c(e,t,i){return`${e}_${t._key}_${i}`}t.DEFAULT_TEXT_STYLE_CACHE_ID="Default",t.computeStyleCacheId=c;class h{constructor(){this.m_map=new Map,this.m_map.set(t.DEFAULT_TEXT_STYLE_CACHE_ID,new n.TextRenderStyle({fontSize:{unit:n.FontUnit.Pixel,size:32,backgroundSize:8},color:o.ColorCache.instance.getColor("#6d7477"),backgroundColor:o.ColorCache.instance.getColor("#f7fbfd"),backgroundOpacity:.5}))}get size(){return this.m_map.size}get(e){return this.m_map.get(e)}set(e,t){this.m_map.set(e,t)}clear(){this.m_map.clear(),this.m_map.set(t.DEFAULT_TEXT_STYLE_CACHE_ID,new n.TextRenderStyle({fontSize:{unit:n.FontUnit.Pixel,size:32,backgroundSize:8},color:o.ColorCache.instance.getColor("#6d7477"),backgroundColor:o.ColorCache.instance.getColor("#f7fbfd"),backgroundOpacity:.5}))}}t.TextRenderStyleCache=h;class d{constructor(){this.m_map=new Map,this.m_map.set(t.DEFAULT_TEXT_STYLE_CACHE_ID,new n.TextLayoutStyle({verticalAlignment:n.VerticalAlignment.Center,horizontalAlignment:n.HorizontalAlignment.Center}))}get size(){return this.m_map.size}get(e){return this.m_map.get(e)}set(e,t){this.m_map.set(e,t)}clear(){this.m_map.clear(),this.m_map.set(t.DEFAULT_TEXT_STYLE_CACHE_ID,new n.TextLayoutStyle({verticalAlignment:n.VerticalAlignment.Center,horizontalAlignment:n.HorizontalAlignment.Center}))}}t.TextLayoutStyleCache=d;const u="default";t.TextStyleCache=class{constructor(e){this.m_theme=e,this.m_textRenderStyleCache=new h,this.m_textLayoutStyleCache=new d,this.m_colorMap=new Map,this.m_textStyles=new Map,this.m_defaultStyle={name:u,fontCatalog:"",renderParams:this.m_textRenderStyleCache.get(t.DEFAULT_TEXT_STYLE_CACHE_ID).params,layoutParams:this.m_textLayoutStyleCache.get(t.DEFAULT_TEXT_STYLE_CACHE_ID).params}}initializeDefaultTextElementStyle(e){void 0===this.m_theme.textStyles&&(this.m_theme.textStyles=[]);const t=this.m_theme.textStyles,i=t.find(e=>e.name===u);void 0!==i?this.m_defaultStyle=this.createTextElementStyle(i,u):void 0!==this.m_theme.defaultTextStyle?this.m_defaultStyle=this.createTextElementStyle(this.m_theme.defaultTextStyle,u):t.length>0&&(this.m_defaultStyle=this.createTextElementStyle(t[0],u)),this.m_defaultStyle.fontCatalog=e}initializeTextElementStyles(e,t,i){if(void 0!==this.m_defaultStyle.fontCatalog){const e=i.find(e=>e.fontCatalog===this.m_defaultStyle.fontCatalog);this.m_defaultStyle.textCanvas=void 0!==e?e.textCanvas:void 0,this.m_defaultStyle.poiRenderer=void 0!==e?e.poiRenderer:void 0}void 0===this.m_defaultStyle.textCanvas&&(void 0!==this.m_defaultStyle.fontCatalog&&l.warn(`FontCatalog '${this.m_defaultStyle.fontCatalog}' set in TextStyle '${this.m_defaultStyle.name}' not found, using default fontCatalog(${t.fontCatalog.name}).`),this.m_defaultStyle.textCanvas=t,this.m_defaultStyle.poiRenderer=e),this.m_theme.textStyles.forEach(e=>{this.m_textStyles.set(e.name,this.createTextElementStyle(e,e.name))});for(const[,r]of this.m_textStyles)if(void 0===r.textCanvas){if(void 0!==r.fontCatalog){const e=i.find(e=>e.fontCatalog===r.fontCatalog);r.textCanvas=void 0!==e?e.textCanvas:void 0,r.poiRenderer=void 0!==e?e.poiRenderer:void 0}void 0===r.textCanvas&&(void 0!==r.fontCatalog&&l.warn(`FontCatalog '${r.fontCatalog}' set in TextStyle '${r.name}' not found, using default fontCatalog(${t.fontCatalog.name}).`),r.textCanvas=t,r.poiRenderer=e)}}getTextElementStyle(e){let t;return void 0===e?t=this.m_defaultStyle:(t=this.m_textStyles.get(e),void 0===t&&(t=this.m_defaultStyle)),t}getRenderStyle(e,t){const i=e.mapView,l=e.dataSource,h=i.zoomLevel,d=c(l.name,t,Math.floor(h));let u=this.m_textRenderStyleCache.get(d);if(void 0===u){const e=this.m_defaultStyle.renderParams;let i=r.getPropertyValue(s.getOptionValue(t.opacity,e.opacity),Math.floor(h));if(void 0!==t.color){let e=a.evaluateColorProperty(t.color,Math.floor(h));if(r.ColorUtils.hasAlphaInHex(e)){i*=r.ColorUtils.getAlphaFromHex(e),e=r.ColorUtils.removeAlphaFromHex(e)}this.m_colorMap.set(d,o.ColorCache.instance.getColor(e))}let l=void 0!==t.backgroundOpacity?r.getPropertyValue(t.backgroundOpacity,Math.floor(h)):void 0!==t.backgroundColor&&void 0!==t.backgroundSize&&r.getPropertyValue(t.backgroundSize,Math.floor(h))>0?1:e.backgroundOpacity;if(void 0!==t.backgroundColor){let e=a.evaluateColorProperty(t.backgroundColor,Math.floor(h));if(r.ColorUtils.hasAlphaInHex(e)){l*=r.ColorUtils.getAlphaFromHex(e),e=r.ColorUtils.removeAlphaFromHex(e)}this.m_colorMap.set(d+"_bg",o.ColorCache.instance.getColor(e))}const c={fontName:s.getOptionValue(t.fontName,e.fontName),fontSize:{unit:n.FontUnit.Pixel,size:void 0!==t.size?r.getPropertyValue(t.size,Math.floor(h)):e.fontSize.size,backgroundSize:void 0!==t.backgroundSize?r.getPropertyValue(t.backgroundSize,Math.floor(h)):e.fontSize.backgroundSize},fontStyle:"Regular"===t.fontStyle||"Bold"===t.fontStyle||"Italic"===t.fontStyle||"BoldItalic"===t.fontStyle?n.FontStyle[t.fontStyle]:e.fontStyle,fontVariant:"Regular"===t.fontVariant||"AllCaps"===t.fontVariant||"SmallCaps"===t.fontVariant?n.FontVariant[t.fontVariant]:e.fontVariant,rotation:s.getOptionValue(t.rotation,e.rotation),color:s.getOptionValue(this.m_colorMap.get(d),e.color),backgroundColor:s.getOptionValue(this.m_colorMap.get(d+"_bg"),e.backgroundColor),opacity:i,backgroundOpacity:l},m=this.getTextElementStyle(t.style).renderParams;u=new n.TextRenderStyle(Object.assign(Object.assign({},m),c)),this.m_textRenderStyleCache.set(d,u)}return u}getLayoutStyle(e,t){const i=Math.floor(e.mapView.zoomLevel),o=c(e.dataSource.name,t,i);let a=this.m_textLayoutStyleCache.get(o);if(void 0===a){const e=this.m_defaultStyle.layoutParams,l=r.getPropertyValue(t.hAlignment,i),c=r.getPropertyValue(t.vAlignment,i),h="Left"===l||"Center"===l||"Right"===l?n.HorizontalAlignment[l]:e.horizontalAlignment,d="Above"===c||"Center"===c||"Below"===c?n.VerticalAlignment[c]:e.verticalAlignment,u={tracking:s.getOptionValue(t.tracking,e.tracking),leading:s.getOptionValue(t.leading,e.leading),maxLines:s.getOptionValue(t.maxLines,e.maxLines),lineWidth:s.getOptionValue(t.lineWidth,e.lineWidth),canvasRotation:s.getOptionValue(t.canvasRotation,e.canvasRotation),lineRotation:s.getOptionValue(t.lineRotation,e.lineRotation),wrappingMode:"None"===t.wrappingMode||"Character"===t.wrappingMode||"Word"===t.wrappingMode?n.WrappingMode[t.wrappingMode]:e.wrappingMode,horizontalAlignment:h,verticalAlignment:d},m=this.getTextElementStyle(t.style);a=new n.TextLayoutStyle(Object.assign(Object.assign({},m),u)),this.m_textLayoutStyleCache.set(o,a)}return a}createTextElementStyle(e,t){return{name:t,fontCatalog:s.getOptionValue(e.fontCatalogName,this.m_defaultStyle.fontCatalog),renderParams:{fontName:e.fontName,fontSize:{unit:n.FontUnit.Pixel,size:32,backgroundSize:e.backgroundSize||8},fontStyle:"Regular"===e.fontStyle||"Bold"===e.fontStyle||"Italic"===e.fontStyle||"BoldItalic"===e.fontStyle?n.FontStyle[e.fontStyle]:void 0,fontVariant:"Regular"===e.fontVariant||"AllCaps"===e.fontVariant||"SmallCaps"===e.fontVariant?n.FontVariant[e.fontVariant]:void 0,rotation:e.rotation,color:void 0!==e.color?o.ColorCache.instance.getColor(e.color):void 0,backgroundColor:void 0!==e.backgroundColor?o.ColorCache.instance.getColor(e.backgroundColor):void 0,opacity:e.opacity,backgroundOpacity:e.backgroundOpacity},layoutParams:{tracking:e.tracking,leading:e.leading,maxLines:e.maxLines,lineWidth:e.lineWidth,canvasRotation:e.canvasRotation,lineRotation:e.lineRotation,wrappingMode:"None"===e.wrappingMode||"Character"===e.wrappingMode||"Word"===e.wrappingMode?n.WrappingMode[e.wrappingMode]:n.WrappingMode.Word,verticalAlignment:"Above"===e.vAlignment||"Center"===e.vAlignment||"Below"===e.vAlignment?n.VerticalAlignment[e.vAlignment]:n.VerticalAlignment.Center,horizontalAlignment:"Left"===e.hAlignment||"Center"===e.hAlignment||"Right"===e.hAlignment?n.HorizontalAlignment[e.hAlignment]:n.HorizontalAlignment.Center}}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(9),s=300;t.CameraMovementDetector=class{constructor(e,t,i){this.m_throttlingTimeout=e,this.m_movementStartedFunc=t,this.m_movementFinishedFunc=i,this.m_lastCameraPos=new r.Vector3,this.m_newCameraPos=new r.Vector3,this.m_throttlingTimerId=void 0,this.m_movementDetectorDeadline=0,this.onDeadlineTimer=()=>{this.m_throttlingTimerId=void 0;const e=performance.now();e>=this.m_movementDetectorDeadline?this.movementFinished():this.startMovementFinishedTimer(e)},void 0===this.m_throttlingTimeout&&(this.m_throttlingTimeout=s)}checkCameraMoved(e,t){const i=n.MapViewUtils.extractAttitude(e,e.camera),r=e.camera.getWorldPosition(this.m_newCameraPos);if(void 0===this.m_lastAttitude)return this.m_lastCameraPos.copy(r),this.m_lastAttitude=i,!1;const s=!this.m_lastCameraPos.equals(r)||i.yaw!==this.m_lastAttitude.yaw||i.pitch!==this.m_lastAttitude.pitch||i.roll!==this.m_lastAttitude.roll;return s&&(this.m_lastCameraPos.copy(r),this.m_lastAttitude=i),s!==this.m_cameraMovedLastFrame&&(s&&this.movementStarted(),this.m_cameraMovedLastFrame=s),s&&(this.m_movementDetectorDeadline=t+this.m_throttlingTimeout,this.startMovementFinishedTimer(t)),this.m_cameraMovedLastFrame}clear(e){const t=e.camera.getWorldPosition(this.m_newCameraPos);this.m_lastCameraPos.set(t.x,t.y,t.z);const i=n.MapViewUtils.extractAttitude(e,e.camera);this.m_lastAttitude=i}forceMoved(){this.m_lastCameraPos.set(Number.NaN,Number.NaN,Number.NaN)}get cameraIsMoving(){return void 0!==this.m_throttlingTimerId}dispose(){this.removeMovementFinishedTimer(),this.m_movementStartedFunc=void 0,this.m_movementFinishedFunc=void 0}get cameraMovedLastFrame(){return!0===this.m_cameraMovedLastFrame}movementStarted(){void 0!==this.m_movementStartedFunc&&this.m_movementStartedFunc()}movementFinished(){this.removeMovementFinishedTimer(),void 0!==this.m_movementFinishedFunc&&this.m_movementFinishedFunc()}startMovementFinishedTimer(e){if(void 0===this.m_throttlingTimerId){const t=Math.max(0,this.m_movementDetectorDeadline-e);this.m_throttlingTimerId=setTimeout(this.onDeadlineTimer,t)}}removeMovementFinishedTimer(){void 0!==this.m_throttlingTimerId&&(clearTimeout(this.m_throttlingTimerId),this.m_throttlingTimerId=void 0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(3),n=i(1),s=i(0),o=i(9),a=1e-6;t.InterpolatedClipPlanesEvaluator=class{constructor(e=.1,t=.1,i=50,r=200){this.nearMin=e,this.nearMultiplier=t,this.nearFarMultiplier=i,this.farOffset=r,this.m_tmpVectors=[new s.Vector3,new s.Vector3,new s.Vector3],this.m_tmpQuaternion=new s.Quaternion,n.assert(e>0),n.assert(i>=0),n.assert(r>=0),this.farMin=e*i+r}set minElevation(e){}get minElevation(){return 0}set maxElevation(e){}get maxElevation(){return 0}evaluateClipPlanes(e){const t=e.camera,i=e.projection;let s=this.nearMin,o=this.farMin;if(i.type===r.ProjectionType.Spherical){const e=r.EarthConstants.EQUATORIAL_RADIUS,n=t.position.length(),a=Math.asin(e/n);t.matrixWorld.extractBasis(this.m_tmpVectors[0],this.m_tmpVectors[1],this.m_tmpVectors[2]),this.m_tmpQuaternion.setFromAxisAngle(this.m_tmpVectors[0],a);const l=this.m_tmpVectors[2].negate(),c=this.m_tmpVectors[1].copy(l).applyQuaternion(this.m_tmpQuaternion),h=this.m_tmpVectors[0].copy(t.position);h.addScaledVector(c,Math.sqrt(n*n-e*e)),o=h.sub(t.position).dot(l),s=Math.max(this.nearMin,i.groundDistance(t.position)*this.nearMultiplier)}else if(i.type===r.ProjectionType.Planar){const e=i.groundDistance(t.position);s=Math.max(this.nearMin,e*this.nearMultiplier),o=s*this.nearFarMultiplier+this.farOffset}else n.assert(!1,"Unsupported projection type");return{near:s,far:o,minimum:this.nearMin,maximum:o}}};class l{constructor(e,t){n.assert(e>=t),this.m_minElevation=t,this.m_maxElevation=e}set maxElevation(e){this.m_maxElevation=e,this.m_minElevation=Math.min(e,this.m_minElevation)}get maxElevation(){return this.m_maxElevation}set minElevation(e){this.m_minElevation=e,this.m_maxElevation=Math.max(e,this.m_maxElevation)}get minElevation(){return this.m_minElevation}}t.ElevationBasedClipPlanesEvaluator=l;class c extends l{constructor(e=r.EarthConstants.MAX_BUILDING_HEIGHT,t=0,i=1,o=.05,l=1.8){super(e,t),this.nearMin=i,this.nearFarMarginRatio=o,this.farMaxRatio=l,this.m_tmpVectors=[new s.Vector3,new s.Vector3,new s.Vector3],this.m_tmpQuaternion=new s.Quaternion,n.assert(i>0),n.assert(o>a),n.assert(l>1);const c=o*i;this.m_minimumViewRange={near:i,far:i+c,minimum:this.nearMin,maximum:Math.max(i*l,i+c)}}evaluateClipPlanes(e){return e.projection.type===r.ProjectionType.Spherical?this.evaluateDistanceSphericalProj(e):e.projection.type===r.ProjectionType.Planar?this.evaluateDistancePlanarProj(e):(n.assert(!1,"Unsupported projection type"),Object.assign({},this.minimumViewRange))}get minimumViewRange(){return this.m_minimumViewRange}getCameraAltitude(e,t){return t.groundDistance(e.position)}evaluateDistancePlanarProj(e){const{camera:t,projection:i}=e;n.assert(i.type!==r.ProjectionType.Spherical);let s=this.nearMin,o=this.nearMin*this.farMaxRatio;const a=this.getCameraAltitude(t,i),l=a*this.farMaxRatio;s=a-this.maxElevation,o=a-this.minElevation,s=Math.max(s,this.nearMin),o=Math.min(o,l);const c=this.nearFarMarginRatio*(s+o)/2;return s=Math.max(s-c/2,this.nearMin),o=Math.max(o+c/2,s+c),{near:s,far:o,minimum:this.nearMin,maximum:Math.max(l,o)}}evaluateDistanceSphericalProj(e){const{camera:t,projection:i}=e;n.assert(i.type===r.ProjectionType.Spherical);let o=this.nearMin,l=this.nearMin*this.farMaxRatio;const c=this.getCameraAltitude(t,i);o=c-this.maxElevation;let h=c*this.farMaxRatio;const d=r.EarthConstants.EQUATORIAL_RADIUS;let u=t.position.length();if(u=0===u?a:u,"PerspectiveCamera"===t.type){const e=Math.asin(d/u),r=t,n=r.aspect>1?r.aspect:1/r.aspect,o=s.Math.degToRad(r.fov*n/2),a=this.getTangentBasedFarPlane(r,u,d,e);l=o>e?a:this.getFovBasedFarPlane(r,u,d,2*o,i),h=Math.max(h,a)}else l=this.getOrthoBasedFarPlane(u,d);const m=c-this.minElevation;o=Math.max(o,this.nearMin),l=Math.max(l,m);const p=this.nearFarMarginRatio*(o+l)/2;return o=Math.max(o-p/2,this.nearMin),l=Math.max(l+p/2,o+p),{near:o,far:l,minimum:this.nearMin,maximum:h}}getTangentDistance(e,t){return e-t<a?0:Math.sqrt(e*e-t*t)}getTangentBasedFarPlane(e,t,i,r){const n=this.getTangentDistance(t,i),s=this.getTangentDistance(i+this.maxElevation,i);return Math.cos(r)*(n+s)}getFovBasedFarPlane(e,t,i,r,s){const o=e.position;e.matrixWorld.extractBasis(this.m_tmpVectors[0],this.m_tmpVectors[1],this.m_tmpVectors[2]),this.m_tmpQuaternion.setFromAxisAngle(this.m_tmpVectors[0],r/2);const a=this.m_tmpVectors[2],l=this.m_tmpVectors[1].copy(a).applyQuaternion(this.m_tmpQuaternion),c=o.dot(l);if(c<0){return this.getCameraAltitude(e,s)*this.farMaxRatio}const h=o.dot(o)-c*c,d=i*i;return n.assert(h<=d,"Please use this evaluator only for top view camera poses."),c-Math.sqrt(d-h)}getOrthoBasedFarPlane(e,t){return e+(this.maxElevation<a?0:Math.sqrt(t+this.maxElevation)*(t+this.maxElevation)-t*t)}}t.TopViewClipPlanesEvaluator=c;class h extends c{getCameraLookAtDistance(e,t){n.assert(t.type!==r.ProjectionType.Spherical);const i=this.m_tmpVectors[0];e.getWorldDirection(i).normalize();const s=this.m_tmpVectors[1];t.surfaceNormal(e.position,s),s.negate();let o=i.dot(s);return o=0===o?a:o,this.getCameraAltitude(e,t)/o}getFrustumGroundIntersectionDist(e){n.assert(e.projection.type!==r.ProjectionType.Spherical);const t=e.camera,i=e.projection,l=Math.PI/2-a,c=this.getCameraAltitude(t,i),h=o.MapViewUtils.rayCastWorldCoordinates(e,0,0);if(null===h)throw new Error("MapView does not support a view pointing in the void.");const d=o.MapViewUtils.extractSphericalCoordinatesFromLocation(e,t,i.unprojectPoint(h)).tilt;let u,m,p,f;if("PerspectiveCamera"===t.type){const e=t,i=1,r=s.Math.degToRad(e.fov*i/2);u=s.Math.clamp(d+r,-l,l),m=s.Math.clamp(d-r,-l,l),p=f=c}else{const e=t;u=m=d;const i=Math.sin(d);f=c+i*e.top,p=c-i*e.bottom}const g=(f-this.minElevation)/Math.cos(u),v=(p-this.maxElevation)/Math.cos(m);return{top:Math.max(g,0),bottom:Math.max(v,0)}}evaluateDistancePlanarProj(e){n.assert(e.projection.type!==r.ProjectionType.Spherical);const t=Object.assign({},this.minimumViewRange),i=this.getFrustumGroundIntersectionDist(e),{camera:o,projection:a}=e;if("PerspectiveCamera"===o.type){const e=o,r=1,n=s.Math.degToRad(e.fov*r/2),a=Math.cos(n);t.near=i.bottom*a,t.far=i.top*a}else t.near=i.bottom,t.far=i.top;const l=this.getCameraLookAtDistance(o,a)*this.farMaxRatio;t.near=Math.max(t.near,this.nearMin),t.far=Math.min(t.far,l);const c=this.nearFarMarginRatio*(t.near+t.far)/2;return t.near=Math.max(t.near-c/2,this.nearMin),t.far=Math.max(t.far+c/2,t.near+c),t.minimum=this.nearMin,t.maximum=l,t}evaluateDistanceSphericalProj(e){const{camera:t,projection:i}=e;n.assert(i.type===r.ProjectionType.Spherical);const o=Object.assign({},this.minimumViewRange),a=this.getCameraAltitude(t,i);o.near=a-this.maxElevation;const l=t.aspect>1?t.aspect:1/t.aspect,c=s.Math.degToRad(t.fov*l/2);t instanceof s.PerspectiveCamera&&(o.near*=Math.cos(c));const h=this.m_tmpVectors[0].copy(t.position).negate(),d=r.EarthConstants.EQUATORIAL_RADIUS,u=h.length();let m,p=e.lookAtDistance*this.farMaxRatio;if(t instanceof s.PerspectiveCamera){const e=Math.asin(d/u),i=this.getCameraPitch(h,t),r=Math.abs(e-i),n=this.getTangentBasedFarPlane(t,u,d,r);m=c>=r?n:this.getTiltedFovBasedFarPlane(u,d,c,i),p=Math.max(p,n)}else m=this.getOrthoBasedFarPlane(u,d);o.far=m;const f=a-this.minElevation;o.near=Math.max(o.near,this.nearMin),o.far=Math.max(o.far,f);const g=this.nearFarMarginRatio*(o.near+o.far)/2;return o.near=Math.max(o.near-g/2,this.nearMin),o.far=Math.max(o.far+g/2,o.near+g),o.minimum=this.nearMin,o.maximum=p,o}getTiltedFovBasedFarPlane(e,t,i,r){const s=Math.cos(r+i),o=e*e,a=e*s-Math.sqrt(o*s*s-o+t*t);return n.assert(!isNaN(a),"Field of view does not intersect sphere. Use tangent based far plane instead."),Math.cos(i)*a}getCameraPitch(e,t){e.normalize();const i=t.getWorldDirection(this.m_tmpVectors[1]).normalize(),r=e.dot(i);return Math.acos(s.Math.clamp(r,-1,1))}}t.TiltViewClipPlanesEvaluator=h;t.FixedClipPlanesEvaluator=class{constructor(e=1,t=10){this.minNear=e,this.minFarOffset=t,this.minFar=e+t,this.m_nearPlane=e,this.m_farPlane=this.minFar}get nearPlane(){return this.m_nearPlane}set nearPlane(e){this.invalidatePlanes(e,this.m_farPlane)}get farPlane(){return this.m_farPlane}set farPlane(e){this.invalidatePlanes(this.m_nearPlane,e)}set minElevation(e){}get minElevation(){return 0}set maxElevation(e){}get maxElevation(){return 0}evaluateClipPlanes(e){return{near:this.m_nearPlane,far:this.m_farPlane,minimum:this.minNear,maximum:this.m_farPlane}}invalidatePlanes(e,t){const i=Math.max(this.minNear,e),r=Math.max(this.minFar,t,i+this.minFarOffset);this.m_nearPlane=i,this.m_farPlane=r}},t.createDefaultClipPlanesEvaluator=()=>new h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(203);t.MapRenderingManager=r.MapRenderingManager;var n=i(25);t.Pass=n.Pass;var s=i(91);t.MSAARenderPass=s.MSAARenderPass,t.MSAASampling=s.MSAASampling},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),n=i(0),s=i(25);var o;!function(e){e[e.Level_0=0]="Level_0",e[e.Level_1=1]="Level_1",e[e.Level_2=2]="Level_2",e[e.Level_3=3]="Level_3",e[e.Level_4=4]="Level_4",e[e.Level_5=5]="Level_5"}(o=t.MSAASampling||(t.MSAASampling={}));class a extends s.Pass{constructor(){super(),this.samplingLevel=o.Level_1,this.m_renderTarget=null,this.m_localCamera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_quadScene=new n.Scene,this.m_quadUniforms=r.CopyShader.uniforms,this.m_quadMaterial=new r.MSAAMaterial(this.m_quadUniforms),this.m_quad=new n.Mesh(new n.PlaneBufferGeometry(2,2),this.m_quadMaterial),this.m_quad.frustumCulled=!1,this.m_quadScene.add(this.m_quad)}dispose(){null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)}render(e,t,i,r,s){if(!this.enabled)return;null===this.m_renderTarget&&(this.m_renderTarget=new n.WebGLRenderTarget(s.width,s.height,{minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat}),this.m_renderTarget.texture.name="MSAARenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture;const o=a.OffsetVectors[this.samplingLevel],l=e.getClearColor(),c=void 0!==l?l.getHex():0,h={enabled:null!==i.view&&i.view.enabled,fullWidth:s.width,fullHeight:s.height,x:0,y:0,width:s.width,height:s.height};h.enabled&&null!==i.view&&(h.fullWidth=i.view.fullWidth,h.fullHeight=i.view.fullHeight,h.x=i.view.offsetX,h.y=i.view.offsetY,h.width=i.view.width,h.height=i.view.height);const d=e.getRenderTarget();for(let n=0;n<o.length;n++){const s=o[n];i.setViewOffset(h.fullWidth,h.fullHeight,h.x+s[0]/16,h.y+s[1]/16,h.width,h.height);const a=(n+.5)/o.length-.5,d=1/o.length+a/32;this.m_quadUniforms.opacity.value=d,e.setRenderTarget(this.m_renderTarget),e.clear(),e.render(t,i),e.setRenderTarget(this.renderToScreen?null:r),0===n&&(e.setClearColor(0),e.clear()),e.render(this.m_quadScene,this.m_localCamera),0===n&&void 0!==l&&e.setClearColor(c)}e.setRenderTarget(d),null!==i.view&&(i.view.enabled=h.enabled,i.view.offsetX=h.x,i.view.offsetY=h.y)}setSize(e,t){this.m_renderTarget&&this.m_renderTarget.setSize(e,t)}}t.MSAARenderPass=a,a.OffsetVectors=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]]},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(1),s=i(93),o=i(0),a=n.LoggerManager.instance.create("ConcurrentWorkerSet");function l(e){return e&&"number"==typeof e.level&&e.type===n.WORKERCHANNEL_MSG_TYPE}t.isLoggingMessage=l;const c=2;t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT=1e4;t.ConcurrentWorkerSet=class{constructor(e){this.m_options=e,this.m_workerChannelLogger=n.LoggerManager.instance.create("WorkerChannel"),this.m_eventListeners=new Map,this.m_workers=new Array,this.m_availableWorkers=new Array,this.m_workerPromises=new Array,this.m_readyPromises=new Map,this.m_requests=new Map,this.m_workerRequestQueue=[],this.m_nextMessageId=0,this.m_stopped=!0,this.m_referenceCount=0,this.onWorkerMessage=(e,t)=>{if(r.WorkerServiceProtocol.isResponseMessage(t.data)){const i=t.data;if(null===i.messageId)return void a.error(`[${this.m_options.scriptUrl}]: Bad ResponseMessage: no messageId`);const r=this.m_requests.get(i.messageId);if(void 0===r)return void a.error(`[${this.m_options.scriptUrl}]: Bad ResponseMessage: invalid messageId`);if(e>=0&&e<this.m_workers.length){const t=this.m_workers[e];this.m_availableWorkers.push(t),this.checkWorkerRequestQueue()}else a.error(`[${this.m_options.scriptUrl}]: onWorkerMessage: invalid workerId`);if(void 0!==i.errorMessage){const e=new Error(i.errorMessage);void 0!==i.errorStack&&(e.stack=i.errorStack),r.resolver(e)}else r.resolver(void 0,i.response)}else if(r.WorkerServiceProtocol.isInitializedMessage(t.data)){const e=this.getReadyPromise(t.data.service);++e.count===this.m_workerPromises.length&&e.resolve()}else if(l(t.data))switch(t.data.level){case n.LogLevel.Trace:this.m_workerChannelLogger.trace(...t.data.message);break;case n.LogLevel.Debug:this.m_workerChannelLogger.debug(...t.data.message);break;case n.LogLevel.Log:this.m_workerChannelLogger.log(...t.data.message);break;case n.LogLevel.Info:this.m_workerChannelLogger.info(...t.data.message);break;case n.LogLevel.Warn:this.m_workerChannelLogger.warn(...t.data.message);break;case n.LogLevel.Error:this.m_workerChannelLogger.error(...t.data.message)}else this.eventHandler(t)},this.start()}addReference(){this.m_referenceCount+=1,1===this.m_referenceCount&&this.m_stopped&&this.start()}removeReference(){this.m_referenceCount-=1,0===this.m_referenceCount&&this.destroy()}start(e){if(void 0!==e&&(this.m_options=e),!this.m_stopped)throw new Error("ConcurrentWorker set already started");this.m_workerCount=n.getOptionValue(this.m_options.workerCount,"undefined"!=typeof navigator&&void 0!==navigator.hardwareConcurrency?o.Math.clamp(navigator.hardwareConcurrency-1,1,2):void 0,c);const i=n.getOptionValue(this.m_options.workerConnectionTimeout,t.DEFAULT_WORKER_INITIALIZATION_TIMEOUT);for(let e=0;e<this.m_workerCount;++e){const t=s.WorkerLoader.startWorker(this.m_options.scriptUrl,i).then(t=>{const i=t=>{this.onWorkerMessage(e,t)};return t.addEventListener("message",i),this.m_workers.push(t),this.m_availableWorkers.push(t),{worker:t,listener:i}});this.m_workerPromises.push(t)}this.m_stopped=!1}get workerCount(){return this.m_workerCount}async stop(){this.m_stopped=!0,await this.waitForAllResponses().then(()=>{this.terminateWorkers()})}destroy(){this.m_stopped=!0,this.m_requests.forEach(e=>{e.resolver(new Error("worker destroyed"))}),this.m_requests.clear(),this.m_workerRequestQueue=[],this.terminateWorkers(),this.m_eventListeners.clear()}async connect(e){return this.ensureStarted(),await Promise.all(this.m_workerPromises),this.getReadyPromise(e).promise}addEventListener(e,t){this.m_eventListeners.set(e,t)}removeEventListener(e){this.m_eventListeners.delete(e)}invokeRequest(e,t,i,n){this.ensureStarted();const s=this.m_nextMessageId++;let o;const a=new Promise((e,t)=>{o=(i,r)=>{this.m_requests.delete(s),void 0!==i?t(i):e(r)}});this.m_requests.set(s,{promise:a,resolver:o});const l={service:e,type:r.WorkerServiceProtocol.ServiceMessageName.Request,messageId:s,request:t};return this.postRequestMessage(l,i,n),a}broadcastRequest(e,t,i){this.ensureStarted();const n=[];for(const s of this.m_workers){const o=this.m_nextMessageId++;let a;const l=new Promise((e,t)=>{a=(i,r)=>{this.m_requests.delete(o),void 0!==i?t(i):e(r)}});n.push(l),this.m_requests.set(o,{promise:l,resolver:a});const c={service:e,type:r.WorkerServiceProtocol.ServiceMessageName.Request,messageId:o,request:t};void 0!==i?s.postMessage(c,i):s.postMessage(c)}return Promise.all(n)}broadcastMessage(e,t){this.ensureStarted(),void 0!==t?this.m_workers.forEach(i=>i.postMessage(e,t)):this.m_workers.forEach(t=>t.postMessage(e))}get requestQueueSize(){return this.m_workerRequestQueue.length}get numWorkers(){return this.m_workers.length}get numIdleWorkers(){return this.m_availableWorkers.length}eventHandler(e){"string"==typeof e.data.type&&this.dispatchEvent(e.data.type,e)}postRequestMessage(e,t,i){if(this.ensureStarted(),0===this.m_workers.length)throw new Error("ConcurrentWorkerSet#postMessage: no workers started");if(void 0!==i&&i.signal.aborted){const t=this.m_requests.get(e.messageId);if(void 0===t)return void a.error(`[${this.m_options.scriptUrl}]: Bad RequestMessage: invalid messageId`);const i=new Error("Aborted");return i.name="AbortError",void t.resolver(i,void 0)}if(this.m_availableWorkers.length>0){const i=this.m_availableWorkers.pop();void 0!==t?i.postMessage(e,t):i.postMessage(e)}else void 0===i&&(i=new r.RequestController(0)),0===i.priority&&(i.priority=-this.m_nextMessageId),this.m_workerRequestQueue.unshift({message:e,buffers:t,requestController:i})}ensureStarted(){if(this.m_stopped)throw new Error("ConcurrentWorkerSet stopped")}async waitForAllResponses(){const e=new Array;this.m_requests.forEach(t=>{e.push(t.promise)}),await Promise.all(e)}dispatchEvent(e,t){const i=this.m_eventListeners.get(e);void 0!==i&&i(t)}terminateWorkers(){this.m_workerPromises.forEach(e=>{e.then(e=>{void 0!==e&&(e.worker.removeEventListener("message",e.listener),e.worker.terminate())})}),this.m_workers=[],this.m_workerPromises=[],this.m_availableWorkers=[],this.m_readyPromises.clear()}getReadyPromise(e){const t=this.m_readyPromises.get(e);if(void 0!==t)return t;const i={count:0,promise:void 0,resolve:()=>{},reject:e=>{i.error=e},error:void 0};return i.promise=new Promise((e,t)=>{const r=i;void 0!==r.error?t(r.error):r.count===this.m_workerPromises.length&&e(),r.resolve=e,r.reject=t}),this.m_readyPromises.set(e,i),i}checkWorkerRequestQueue(){if(0!==this.m_workerRequestQueue.length&&0!==this.m_availableWorkers.length)for(this.m_workerRequestQueue.sort((e,t)=>e.requestController.priority-t.requestController.priority);this.m_availableWorkers.length>0&&this.m_workerRequestQueue.length>0;){const e=this.m_workerRequestQueue.pop();this.postRequestMessage(e.message,e.buffers,e.requestController)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(26);const r=i(1),n=i(207),s=r.LoggerManager.instance.create("WorkerLoader");class o{static startWorker(e,t=1e4){return e.startsWith("blob:")?this.startWorkerImmediately(e,t):this.directlyFallbackToBlobBasedLoading?this.startWorkerBlob(e,t):this.startWorkerImmediately(e,t).catch(i=>{if("undefined"!=typeof window){const n=window.location.href,a=new URL(e,n).href;if(r.getUrlOrigin(a)===r.getUrlOrigin(n))throw i;return s.log("#startWorker: cross-origin worker construction failed, trying load with blob"),this.directlyFallbackToBlobBasedLoading=!0,o.startWorkerBlob(e,t)}throw i})}static startWorkerImmediately(e,t){try{const i=new Worker(e);return this.waitWorkerInitialized(i,t)}catch(e){return Promise.reject(e)}}static startWorkerBlob(e,t){return this.fetchScriptSourceToBlobUrl(e).then(e=>this.startWorkerImmediately(e,t))}static fetchScriptSourceToBlobUrl(e){let t=this.sourceLoaderCache.get(e);return void 0!==t?t:(t=fetch(e).then(e=>e.text()).catch(e=>{throw new Error(`WorkerLoader#fetchScriptSourceToBlob: failed to load worker script: ${e}`)}).then(t=>{this.sourceLoaderCache.delete(e);const i=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(i)}),this.sourceLoaderCache.set(e,t),t)}static waitWorkerInitialized(e,t){return new Promise((i,r)=>{const s=t=>{const s=t.data;if(n.isWorkerBootstrapRequest(s)){const t=s.dependencies,i=[];for(const e of t){const t=this.dependencyUrlMapping[e];if(!t)return a(),void r(new Error(`#waitWorkerInitialized: Unable to resolve '${e}'`+" as needed by worker script."));i.push(t)}const n={type:"worker-bootstrap-response",resolvedDependencies:i};e.postMessage(n)}else a(),i(e),setTimeout(()=>{e.dispatchEvent(t)},0)},o=e=>{a();let t="Error during worker initialization";e.message&&(t+=`: ${e.message}`),"string"==typeof e.filename&&"number"==typeof e.lineno&&(t+=` in ${e.filename}:${e.lineno}`),r(new Error(t))},a=()=>{clearTimeout(l),e.removeEventListener("message",s),e.removeEventListener("error",o)};e.addEventListener("error",o),e.addEventListener("message",s);const l=setTimeout(()=>{a(),r(new Error("Timeout exceeded when waiting for first message from worker."))},t)})}}t.WorkerLoader=o,o.directlyFallbackToBlobBasedLoading=!1,o.sourceLoaderCache=new Map,o.dependencyUrlMapping={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2);let n=0;t.WorkerBasedDecoder=class{constructor(e,t){this.workerSet=e,this.decoderServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=`${this.decoderServiceType}-${n++}`}dispose(){this.m_serviceCreated&&this.workerSet.broadcastRequest(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:r.WorkerServiceProtocol.Requests.DestroyService,targetServiceId:this.serviceId}).catch(()=>{}),this.workerSet.removeReference()}async connect(){await this.workerSet.connect(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID),this.m_serviceCreated||(await this.workerSet.broadcastRequest(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:r.WorkerServiceProtocol.Requests.CreateService,targetServiceType:this.decoderServiceType,targetServiceId:this.serviceId}),this.m_serviceCreated=!0)}decodeTile(e,t,i,n){const s=t.mortonCode(),o={type:r.WorkerDecoderProtocol.Requests.DecodeTileRequest,tileKey:s,data:e,projection:r.getProjectionName(i)},a=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,o,a,n)}getTileInfo(e,t,i,n){const s=t.mortonCode(),o={type:r.WorkerDecoderProtocol.Requests.TileInfoRequest,tileKey:s,data:e,projection:r.getProjectionName(i)},a=e instanceof ArrayBuffer?[e]:void 0;return this.workerSet.invokeRequest(this.serviceId,o,a,n)}configure(e,t,i,n){const s={service:this.serviceId,type:r.WorkerDecoderProtocol.DecoderMessageName.Configuration,styleSet:e,definitions:t,options:n,languages:i};this.workerSet.broadcastMessage(s)}get workerCount(){return this.workerSet.workerCount}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.PendingApproximate=0]="PendingApproximate",e[e.FinalPrecise=1]="FinalPrecise"}(t.CalculationStatus||(t.CalculationStatus={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(52);class s{constructor(e){this.mapView=e,this.enableFilterByKind=!0,this.enabledKinds=new r.GeometryKindSet,this.disabledKinds=new r.GeometryKindSet,this.hiddenKinds=new r.GeometryKindSet,this.m_visibilityCounter=1}get enabledGeometryKinds(){return this.enabledKinds}set enabledGeometryKinds(e){this.enabledKinds=e}get disabledGeometryKinds(){return this.disabledKinds}set disabledGeometryKinds(e){this.disabledKinds=e}get hiddenGeometryKinds(){return this.hiddenKinds}set hiddenGeometryKinds(e){this.hiddenKinds=e,this.incrementVisibilityCounter()}get visibilityCounter(){return this.m_visibilityCounter}clear(){this.enabledKinds.clear(),this.disabledKinds.clear(),this.hiddenKinds.clear()}enableKind(e,t=!0){this.enableDisableKinds(this.enabledKinds,e,t)}disableKind(e,t=!0){this.enableDisableKinds(this.disabledKinds,e,t)}hideKind(e,t=!0){let i=!1;if(Array.isArray(e))for(const r of e)i=i||this.addRemove(this.hiddenKinds,r,t);else if(e instanceof Set){const r=e;for(const e of r)i=i||this.addRemove(this.hiddenKinds,e,t)}else void 0!==e&&(i=i||this.addRemove(this.hiddenKinds,e,t));i&&this.incrementVisibilityCounter()}getAvailableKinds(e){const t=new r.GeometryKindSet;for(const i of e){const e=i.tileGeometryLoader;if(void 0!==e){const i=e.availableGeometryKinds;if(void 0!==i)for(const e of i)t.add(e)}}return t}updateTileObjectVisibility(e){let t=!1;for(const i of e)if(0!==i.objects.length&&i.visibilityCounter!==this.visibilityCounter){i.visibilityCounter=this.visibilityCounter;for(const e of i.objects){const i=void 0!==e.userData?e.userData.kind:void 0;if(void 0!==i){const r=!i.some(e=>this.hiddenKinds.has(e));t=t||e.visible!==r,e.visible=r}}}return t}setTileUpdateCallback(e){this.m_tileUpdateCallback=e}incrementVisibilityCounter(){return++this.m_visibilityCounter}enableDisableKinds(e,t,i){if(Array.isArray(t))for(const r of t)this.addRemove(e,r,i);else if(t instanceof Set){const r=t;for(const t of r)this.addRemove(e,t,i)}else void 0!==t&&this.addRemove(e,t,i)}addRemove(e,t,i){if(i){if(!e.has(t))return e.add(t),!0}else if(e.has(t))return e.delete(t),!0;return!1}}t.TileGeometryManagerBase=s;t.SimpleTileGeometryManager=class extends s{constructor(e){super(e)}initTile(e){e.dataSource.useGeometryLoader&&(e.tileGeometryLoader=new n.SimpleTileGeometryLoader(e))}updateTiles(e){for(const t of e){const e=t.tileGeometryLoader;void 0!==e&&(e.update(this.enableFilterByKind?this.enabledGeometryKinds:void 0,this.enableFilterByKind?this.disabledGeometryKinds:void 0),this.m_tileUpdateCallback&&this.m_tileUpdateCallback(t))}this.updateTileObjectVisibility(e)&&this.mapView.update()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(98);t.MapViewImageCache=class{constructor(e){this.mapView=e,this.m_name2Url=new Map,this.m_url2Name=new Map}registerImage(e,t,i){if(void 0!==e){if(this.hasName(e))throw new Error("duplicate name in cache");const i=this.m_url2Name.get(t);void 0!==i?i.indexOf(e)<0&&i.push(e):this.m_url2Name.set(t,[e]),this.m_name2Url.set(e,t)}const n=r.ImageCache.instance.findImage(t);return void 0===n?r.ImageCache.instance.registerImage(this.mapView,t,i):n}addImage(e,t,i=!0){const n=this.registerImage(e,t,void 0);return!0===i?r.ImageCache.instance.loadImage(n):n}findImageByName(e){const t=this.m_name2Url.get(e);if(void 0!==t)return r.ImageCache.instance.findImage(t)}findImageByUrl(e){return r.ImageCache.instance.findImage(e)}loadImage(e){return r.ImageCache.instance.loadImage(e)}clear(){r.ImageCache.instance.clear(this.mapView),this.m_name2Url=new Map,this.m_url2Name=new Map}get numberOfNames(){return this.m_name2Url.size}get numberOfUrls(){return this.m_url2Name.size}hasName(e){return void 0!==this.m_name2Url.get(e)}hasUrl(e){return void 0!==this.m_url2Name.get(e)}findNames(e){return this.m_url2Name.get(e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(0),s=r.LoggerManager.instance.create("ImageCache");class o{constructor(){this.m_images=new Map}static get instance(){return void 0===o.m_instance&&(o.m_instance=new o),o.m_instance}static dispose(){o.m_instance=void 0}registerImage(e,t,i){let r=this.findImageCacheItem(t);if(void 0!==r)return void 0!==e&&r.mapViews.indexOf(e)<0&&r.mapViews.push(e),r.imageItem;if(r=this.findImageCacheItem(t),void 0!==r)return void 0!==e&&r.mapViews.indexOf(e)<0&&r.mapViews.push(e),r.imageItem;const n=[];return void 0!==e&&n.push(e),r={imageItem:{url:t,imageData:i,loaded:!1},mapViews:n},this.m_images.set(t,r),r.imageItem}addImage(e,t,i=!0){const r=this.registerImage(e,t,void 0);return void 0!==r&&!0===i?this.loadImage(r):r}findImage(e){const t=this.m_images.get(e);if(void 0!==t)return t.imageItem}clear(e){const t=[];this.m_images.forEach(i=>{const r=i.mapViews.indexOf(e);r>=0&&i.mapViews.splice(r,1),0===i.mapViews.length&&t.push(i.imageItem.url)});for(const e of t)this.m_images.delete(e)}clearAll(){this.m_images=new Map}get size(){return this.m_images.size}loadImage(e){if(void 0!==e.imageData)return e;if(void 0!==e.loadingPromise)return e.loadingPromise;const t=new n.ImageLoader;return e.loadingPromise=new Promise(i=>{s.debug(`Loading image: ${e.url}`),t.load(e.url,t=>{s.debug(`... finished loading image: ${e.url}`),this.renderImage(e,t).then(()=>{e.loadingPromise=void 0,i(e)}).catch(t=>{s.error(`... loading image failed: ${e.url} : ${t}`),i(void 0)})},void 0,t=>{s.error(`... loading image failed: ${e.url} : ${t}`),e.loadingPromise=void 0,i(void 0)})}),e.loadingPromise}findImageCacheItem(e){return this.m_images.get(e)}renderImage(e,t){return new Promise((i,r)=>{if("function"==typeof createImageBitmap){const r={premultiplyAlpha:"default",imageOrientation:"flipY"};s.debug(`Creating bitmap image: ${e.url}`),createImageBitmap(t,0,0,t.width,t.height,r).then(t=>{s.debug(`... finished creating bitmap image: ${e.url}`),e.loadingPromise=void 0,e.imageData=t,e.loaded=!0,i(t)}).catch(t=>{s.error(`... loading image failed: ${e.url} : ${t}`),i(void 0)})}else try{"undefined"==typeof document&&(s.error("Error: document is not available, cannot generate image"),r(new Error("ImageCache#renderImage: document is not available, cannot render image to create texture")));const n=document.createElement("canvas");n.width=t.width,n.height=t.height;const o=n.getContext("2d");if(null!==o){s.debug(`... finished creating bitmap image in canvas: ${e.url} ${t}`),o.drawImage(t,0,0,t.width,t.height,0,0,n.width,n.height);const r=o.getImageData(0,0,t.width,t.height);e.imageData=r,e.loaded=!0,i(r)}else s.error("renderImage: no context found"),r(new Error("ImageCache#renderImage: no context found"))}catch(t){s.error(`renderImage failed: ${t}`),e.imageData=void 0,e.loaded=!0,r(new Error(`ImageCache#renderImage failed: ${t}`))}})}}t.ImageCache=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),n=i(1),s=i(0),o=i(9);t.MapViewFog=class{constructor(e){this.m_scene=e,this.m_enabled=!0,this.m_fog=new s.Fog(0),this.m_fogIsDefined=!1,this.m_cachedTheme={styles:{}}}set enabled(e){this.m_enabled=e,e&&this.m_fogIsDefined&&null===this.m_scene.fog?this.add():e||null===this.m_scene.fog||this.remove()}get enabled(){return this.m_enabled}reset(e){this.m_cachedTheme=e,void 0!==e&&void 0!==e.fog&&void 0!==e.fog.color&&void 0!==e.fog.startRatio?(this.m_fogIsDefined=!0,this.m_fog.color.set(e.fog.color),this.m_enabled&&null===this.m_scene.fog&&this.add()):(this.m_fogIsDefined=!1,null!==this.m_scene.fog&&this.remove())}update(e,t){if(null!==this.m_scene.fog&&void 0!==this.m_cachedTheme&&this.m_cachedTheme.fog&&void 0!==this.m_cachedTheme.fog.startRatio&&(void 0!==e.camera.far||void 0!==t)){const i=void 0!==t?t:e.camera.far,r=1,s=0,a=this.m_cachedTheme.fog.startRatio,l=1;n.assert(a<=l);const c=o.MapViewUtils.rayCastWorldCoordinates(e,0,0);if(null===c)throw new Error("MapView does not support a view pointing in the void.");const h=Math.abs(Math.cos(o.MapViewUtils.extractSphericalCoordinatesFromLocation(e,e.camera,e.projection.unprojectPoint(c)).tilt)),d=n.MathUtils.smoothStep(r,s,h);this.m_fog.near=n.MathUtils.lerp(i*a,i,1-d),this.m_fog.far=n.MathUtils.lerp(i*l,i,d),this.m_fog.near=Math.min(this.m_fog.near,e.camera.far),this.m_fog.far=Math.min(this.m_fog.far,e.camera.far)}}add(){this.m_scene.fog=this.m_fog,this.setFogInRawShaderMaterials(!0)}remove(){this.m_scene.fog=null,this.setFogInRawShaderMaterials(!1)}setFogInRawShaderMaterials(e){this.m_scene.traverse(t=>{t instanceof s.Mesh&&t.material instanceof s.Material&&(t.material instanceof r.SolidLineMaterial&&t.material.updateFog(e),t.material.fog!==e&&(t.material.fog=e,t.material.needsUpdate=!0))})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(6),s=i(1),o=i(0),a=i(23),l=i(36),c=s.LoggerManager.instance.create("PoiManager");class h{constructor(e){this.mapView=e,this.m_imageTextures=new Map,this.m_poiShieldGroups=new Map}static notifyMissingPoiTable(e,t){void 0===e&&(e="undefined"),void 0===h.m_missingPoiTableName.get(e)&&(h.m_missingPoiTableName.set(e,!0),void 0===t||t.loadedOk?c.error(`updatePoiFromPoiTable: No POI table with name '${e}' found!`):c.error(`updatePoiFromPoiTable: Could not load POI table '${e}'!`))}static notifyMissingPoi(e,t){void 0===e&&(e="undefined");const i=`${t}[${e}]`;void 0===h.m_missingPoiName.get(i)&&(h.m_missingPoiName.set(i,!0),c.warn("updatePoiFromPoiTable: "+`Cannot find POI info for '${e}' in table '${t}'.`))}addPois(e,t){const i=s.assertExists(t.poiGeometries),n=e.computeWorldOffsetX();for(const a of i){s.assert(void 0!==a.technique);const i=s.assertExists(a.technique),l=t.techniques[i];if(!1===l.enabled||!r.isLineMarkerTechnique(l)&&!r.isPoiTechnique(l))continue;if(!1===l.showOnMap)continue;const c=new o.BufferAttribute(new Float32Array(a.positions.buffer),a.positions.itemCount);r.isLineMarkerTechnique(l)&&c.count>0?this.addLineMarker(e,a,l,c,n):r.isPoiTechnique(l)&&this.addPoi(e,a,l,c,n)}}addTextureAtlas(e,t){fetch(t).then(e=>{if(!e.ok)throw new Error(`addTextureAtlas: Cannot load textureAtlas: ${e.statusText}`);return e.json()}).then(i=>{if(void 0!==i){try{c.debug(`addTextureAtlas: Loading textureAtlas '${t}' for image '${e}'`);for(const t of Object.getOwnPropertyNames(i)){const r=i[t],n={name:t,image:e,xOffset:r.x,yOffset:r.y,width:r.width,height:r.height};this.addImageTexture(n)}}catch(e){c.error("addTextureAtlas: Failed to load textureAtlas "+`'${t}' : ${e}`)}this.mapView.update()}else c.info(`addTextureAtlas: TextureAtlas empty: ${t}`)}).catch(e=>{c.error(`addTextureAtlas: Failed to load textureAtlas '${t}' : ${e}`)})}addImageTexture(e){void 0!==e.name?(void 0!==this.m_imageTextures.get(e.name)&&c.warn(`addImageTexture: Name already used: ${e.name}`+" (overriding it)"),this.m_imageTextures.set(e.name,e)):c.error("addImageTexture: Name required",e)}getImageTexture(e){return this.m_imageTextures.get(e)}updatePoiFromPoiTable(e){const t=e.poiInfo;if(void 0===t||void 0===t.poiTableName||void 0===t.poiName)return!0;const i=t.poiTableName,n=this.mapView.poiTableManager.getPoiTable(i);if(void 0!==n&&n.isLoading)return!1;if(t.poiTableName=void 0,void 0===n||!n.loadedOk)return h.notifyMissingPoiTable(i,n),!0;const s=t.poiName,o=n.getEntry(s);return void 0===o?(h.notifyMissingPoi(s,i),!0):(void 0!==o.iconName&&o.iconName.length>0&&(t.imageTextureName=r.composeTechniqueTextureName(o.iconName,t.technique)),e.visible=void 0!==o.visible?o.visible:e.visible,e.priority=void 0!==o.priority?o.priority:e.priority,t.iconMinZoomLevel=void 0!==o.iconMinLevel?o.iconMinLevel:t.iconMinZoomLevel,t.iconMaxZoomLevel=void 0!==o.iconMaxLevel?o.iconMaxLevel:t.iconMaxZoomLevel,t.textMinZoomLevel=void 0!==o.textMinLevel?o.textMinLevel:t.textMinZoomLevel,t.textMaxZoomLevel=void 0!==o.textMaxLevel?o.textMaxLevel:t.textMaxZoomLevel,e.updateMinMaxZoomLevelsFromPoiInfo(),!0)}clear(){this.m_imageTextures.clear(),this.m_poiShieldGroups.clear()}addLineMarker(e,t,i,n,a){let l,c,h=void 0!==i.imageTexture?r.composeTechniqueTextureName(i.imageTexture,i):void 0,d="";void 0!==t.stringCatalog&&(s.assert(t.texts.length>0),d=t.stringCatalog[t.texts[0]]||"",void 0!==t.objInfos&&(l=t.objInfos[0],c=r.getFeatureId(l)),void 0!==t.imageTextures&&(s.assert(t.imageTextures.length>0),h=t.stringCatalog[t.imageTextures[0]]));const u=String(h)+"-"+d;let m=this.m_poiShieldGroups.get(u);void 0===m&&(m=this.m_poiShieldGroups.size,this.m_poiShieldGroups.set(u,m));const p=[];for(let e=0;e<n.count;e+=3){const t=n.getX(e)+a,i=n.getY(e),r=n.getZ(e);p.push(new o.Vector3(t,i,r))}const f=this.checkCreateTextElement(e,d,i,h,void 0,void 0,m,c,p,void 0,void 0,l);f.ignoreDistance=!1,e.addTextElement(f)}addPoi(e,t,i,n,o){if(void 0===t.stringCatalog)return;const a=void 0!==i.imageTexture?r.composeTechniqueTextureName(i.imageTexture,i):void 0,l=i,c=l.poiTable;let h=l.poiName;for(let d=0;d<n.count;++d){const u=n.getX(d)+o,m=n.getY(d),p=n.getZ(d);s.assert(t.texts.length>d);let f=a;const g=t.stringCatalog[t.texts[d]]||"",v=void 0!==t.objInfos?t.objInfos[d]:void 0,y=r.getFeatureId(v);void 0!==t.imageTextures&&t.imageTextures[d]>=0&&(s.assert(t.imageTextures.length>d),f=t.stringCatalog[t.imageTextures[d]]),void 0!==c&&(h=void 0===l.poiName?f:l.poiName,f=void 0);const _=this.checkCreateTextElement(e,g,i,f,c,h,0,y,u,m,p,v);e.addTextElement(_)}}checkCreateTextElement(e,t,i,s,h,d,u,m,p,f,g,v){const y=this.mapView.textElementsRenderer,_=void 0!==i.priority?i.priority:0,x=Array.isArray(p)?p:new o.Vector3(p,f,g),T=this.mapView.zoomLevel,S=void 0!==i.fadeNear?r.getPropertyValue(i.fadeNear,T):i.fadeNear,w=void 0!==i.fadeFar?r.getPropertyValue(i.fadeFar,T):i.fadeFar,b=r.getPropertyValue(i.xOffset,T),M=r.getPropertyValue(i.yOffset,T),E=new a.TextElement(n.ContextualArabicConverter.instance.convert(t),x,y.styleCache.getRenderStyle(e,i),y.styleCache.getLayoutStyle(e,i),r.getPropertyValue(_,T),void 0!==b?b:0,void 0!==M?M:0,m,i.style,S,w,e.offset);if(E.mayOverlap=!0===i.textMayOverlap,E.reserveSpace=!1!==i.textReserveSpace,E.alwaysOnTop=!0===i.alwaysOnTop,E.userData=v,void 0===s&&void 0!==h?s="":void 0!==s&&void 0!==h&&c.warn("Possible duplicate POI icon definition via imageTextureName and poiTable!"),void 0!==s){const e=!0===i.textIsOptional,t=!1!==i.iconIsOptional,r=!(!1===i.renderTextDuringMovements),n=void 0===i.iconMayOverlap?E.textMayOverlap:!0===i.iconMayOverlap,o=void 0===i.iconReserveSpace?E.textReservesSpace:!1!==i.iconReserveSpace;E.poiInfo={technique:i,imageTextureName:s,poiTableName:h,poiName:d,shieldGroupIndex:u,textElement:E,textIsOptional:e,iconIsOptional:t,renderTextDuringMovements:r,mayOverlap:n,reserveSpace:o,featureId:m,iconMinZoomLevel:i.iconMinZoomLevel,iconMaxZoomLevel:i.iconMaxZoomLevel,textMinZoomLevel:i.textMinZoomLevel,textMaxZoomLevel:i.textMaxZoomLevel},E.updateMinMaxZoomLevelsFromPoiInfo()}else void 0===E.minZoomLevel&&(E.minZoomLevel=i.textMinZoomLevel),void 0===E.maxZoomLevel&&(E.maxZoomLevel=i.textMaxZoomLevel);return E.distanceScale=void 0!==i.distanceScale?i.distanceScale:l.DEFAULT_TEXT_DISTANCE_SCALE,E}}t.PoiManager=h,h.m_missingPoiTableName=new Map,h.m_missingPoiName=new Map},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(1).LoggerManager.instance.create("PoiTable");class s{static verifyJSON(e){let t="string"==typeof e.name&&e.name.length>0&&(void 0===e.altNames||Array.isArray(e.altNames))&&(void 0===e.stackMode||"yes"===e.stackMode||"no"===e.stackMode||"parent"===e.stackMode)&&(void 0===e.visible||"boolean"==typeof e.visible)&&(void 0===e.priority||"number"==typeof e.priority)&&(void 0===e.iconMinLevel||"number"==typeof e.iconMinLevel)&&(void 0===e.iconMaxLevel||"number"==typeof e.iconMaxLevel)&&(void 0===e.textMinLevel||"number"==typeof e.textMinLevel)&&(void 0===e.textMaxLevel||"number"==typeof e.textMaxLevel);if(t&&void 0!==e.altNames){const i=e.altNames;for(const e in i)if("string"!=typeof e){t=!1;break}}return t}setup(e){switch(this.name=e.name,this.altNames=e.altNames,this.iconName=e.iconName,this.visible=e.visible,this.priority=e.priority,this.iconMinLevel=e.iconMinLevel,this.iconMaxLevel=e.iconMaxLevel,this.textMinLevel=e.textMinLevel,this.textMaxLevel=e.textMaxLevel,e.stackMode){case"yes":this.stackMode=r.PoiStackMode.Show;break;case"no":this.stackMode=r.PoiStackMode.Hide;break;case"parent":this.stackMode=r.PoiStackMode.ShowParent}}}class o{constructor(e,t){this.name=e,this.useAltNamesForKey=t,this.poiList=new Array,this.poiDict=new Map,this.m_isLoading=!1,this.m_loadedOk=void 0}get isLoading(){return this.m_isLoading}get loadedOk(){return!0===this.m_loadedOk}getEntry(e){const t=this.poiDict.get(e);if(void 0!==t){if(t<this.poiList.length)return this.poiList[t];throw new Error("Poi table entry index out of stored list!")}}async load(e){if(void 0!==this.m_loadedOk)return!0;this.m_loadedOk=!1;const t=await fetch(e);if(!t.ok)throw new Error(`load: Cannot load POI table at ${e}:`+` ${t.statusText}`);const i=await t.json();if(void 0===i)return n.info(`load: TextureAtlas empty: ${e}`),!0;this.startLoading();try{if(n.debug(`load: Loading POI table '${e}' for table '${this.name}'`),void 0!==i.poiList&&Array.isArray(i.poiList))for(const t of i.poiList)if(s.verifyJSON(t)){const i=new s;i.setup(t);const r=this.poiList.push(i)-1;if(this.useAltNamesForKey)if(void 0!==i.altNames&&i.altNames.length>0)for(const e of i.altNames)this.poiDict.set(e,r);else n.warn(`load: Invalid entry in POI table '${e}' : `+`No alternative names set in entry: ${JSON.stringify(t)}.`);else void 0===i.name?n.warn(`load: Invalid entry in POI table '${e}' : `+`. No name set in entry: ${t}.`):this.poiDict.set(i.name,r)}else n.warn(`load: Invalid entry in POI table '${e}' : ${JSON.stringify(t)}`);this.m_loadedOk=!0,this.finishedLoading()}catch(t){return n.error("load: Failed to load POI table "+`'${e}' : ${t}`),this.m_loadedOk=!1,this.finishedLoading(),!1}return!0}startLoading(){this.m_isLoading=!0}finishedLoading(){this.m_isLoading=!1}}t.PoiTable=o;t.PoiTableManager=class{constructor(e){this.mapView=e,this.m_isLoading=!1,this.m_poiTables=new Map}async loadPoiTables(e){return new Promise(t=>{if(this.clear(),void 0!==e.poiTables){this.startLoading();const i=new Array;e.poiTables.forEach(e=>{if(void 0!==e&&void 0!==e.name&&"string"==typeof e.name){const t=new o(e.name,!1!==e.useAltNamesForKey);void 0!==e.url&&"string"==typeof e.url?(this.addTable(t),i.push(t.load(e.url))):n.error(`POI table definition has no valid url: ${e}`)}else n.error(`POI table definition has no valid name: ${e}`)}),i.length>0?Promise.all(i).finally(()=>{this.finishLoading(),t()}):(this.finishLoading(),t())}else this.finishLoading(),t()})}clear(){this.m_poiTables=new Map}get poiTables(){return this.m_poiTables}addTable(e){this.m_poiTables.set(e.name,e)}getPoiTable(e){return void 0===e?void 0:this.m_poiTables.get(e)}get finishedLoading(){return!this.m_isLoading}startLoading(){this.m_isLoading=!0}finishLoading(){this.m_isLoading=!1}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(214),s=i(3),o=i(45),a=i(22),l=i(38);class c extends o.DataSource{constructor({name:e="polar",styleSetName:t,minZoomLevel:i,maxZoomLevel:r,storageLevelOffset:n=-2,geometryLevelOffset:o=-1,debugTiles:a=!1}){super(e,t,i,r,n),this.m_tilingScheme=s.polarTilingScheme,this.m_maxLatitude=s.MathUtils.radToDeg(s.MercatorConstants.MAXIMUM_LATITUDE),this.m_geometryLevelOffset=o,this.m_debugTiles=a,this.cacheable=!1}dispose(){this.m_northPoleMaterial&&(this.m_northPoleMaterial.dispose(),delete this.m_northPoleMaterial),this.m_southPoleMaterial&&(this.m_southPoleMaterial.dispose(),delete this.m_southPoleMaterial),this.m_styleSetEvaluator&&delete this.m_styleSetEvaluator}createMaterial(e,t){const i=new n.MapEnv({$geometryType:"polygon",$layer:"earth",kind:e}),r=t.getMatchingTechniques(i);return 0!==r.length?a.createMaterial({technique:r[0],level:1}):void 0}setStyleSet(e,t,i){this.dispose(),void 0!==e&&(this.m_styleSetEvaluator=new n.StyleSetEvaluator(e,t),this.m_northPoleMaterial=this.createMaterial("north_pole",this.m_styleSetEvaluator),this.m_southPoleMaterial=this.createMaterial("south_pole",this.m_styleSetEvaluator)),this.mapView.markTilesDirty(this)}setTheme(e,t){const i=void 0!==this.styleSetName&&e.styles&&e.styles[this.styleSetName]||[];this.setStyleSet(i,e.definitions,t)}shouldRender(e,t){if(e!==t.level||t.level<1)return!1;const{north:i,south:r}=this.m_tilingScheme.getGeoBox(t);return i>this.m_maxLatitude||r<-this.m_maxLatitude}shouldSubdivide(e,t){if(e<=t.level)return!1;const{north:i,south:r}=this.m_tilingScheme.getGeoBox(t);return i>this.m_maxLatitude||r<-this.m_maxLatitude}getTilingScheme(){return this.m_tilingScheme}getTile(e){const t=new l.Tile(this,e);return this.createTileGeometry(t),t}get geometryLevelOffset(){return this.m_geometryLevelOffset}set geometryLevelOffset(e){this.m_geometryLevelOffset=e}intersectEdge(e,t,i){const r=t.latitude,n=i.latitude;let o=t.longitude,a=i.longitude;90===Math.abs(r)&&(o=a),90===Math.abs(n)&&(a=o);const l=a-o,c=(e-r)/(n-r);return new s.GeoCoordinates(e,o+l*c,0)}createTileGeometry(e){const{north:t,south:i}=e.geoBox,n=t>0&&i>=0,o=n?this.m_northPoleMaterial:this.m_southPoleMaterial;if(void 0===o)return void e.forceHasGeometry(!0);const a=this.m_tilingScheme.projection,l=this.projection,c=this.m_maxLatitude,h=n?c:-c,d=this.m_tilingScheme.boundingBoxGenerator.getWorldBox(e.tileKey),u=a.unprojectPoint(new r.Vector3(d.min.x,d.min.y,0)),m=a.unprojectPoint(new r.Vector3(d.max.x,d.min.y,0)),p=a.unprojectPoint(new r.Vector3(d.max.x,d.max.y,0)),f=a.unprojectPoint(new r.Vector3(d.min.x,d.max.y,0));let g,v=!1;if(1===e.tileKey.level){const e=0===d.min.x,t=e?d.max.x:d.min.x,i=(d.max.y+d.min.y)/2,s=a.unprojectPoint(new r.Vector3(t,i,0)),o=e?u:m;g=n?e?[s,p,o,m]:[s,u,o,f]:e?[s,m,o,p]:[s,f,o,u],v=!0}else{g=n?[u,m,p,f]:[u,f,p,m];const e=g.map(e=>e.latitude),t=Math.max(...e),i=Math.min(...e);if(n?t<h:i>h)return;if(v=n?i<h:t>h,v){const r=e.indexOf(n?t:i);if(0!==r)for(let e=0;e<r;e++)g.push(g.shift())}}if(v){const t=(d.min.x+d.max.x)/2,i=(d.min.y+d.max.y)/2,n=a.unprojectPoint(new r.Vector3(t,i,0));s.TransverseMercatorUtils.alignLongitude(g,n);const o=g[0],l=g[1],u=g[2],m=g[3],p=Math.abs(l.latitude)>=c,f=Math.abs(m.latitude)>=c,v=p?this.intersectEdge(h,l,u):this.intersectEdge(h,o,l),y=f?this.intersectEdge(h,m,u):this.intersectEdge(h,o,m);g.splice(p?2:1,4,v);const _=e.tileKey.level-this.storageLevelOffset+this.m_geometryLevelOffset,x=360/(1<<Math.max(0,_)),T=Math.floor((v.longitude+180)/x),S=Math.ceil((y.longitude+180)/x);for(let e=T+1;e<S;e++)g.push(new s.GeoCoordinates(h,e*x-180,0));g.push(y),f&&g.push(m)}const y=new r.Geometry;for(const t of g){const i=l.projectPoint(t,new r.Vector3);y.vertices.push(i.sub(e.center))}for(let e=1;e<g.length-1;e++)y.faces.push(n?new r.Face3(0,e,e+1):new r.Face3(0,e+1,e));const _=new r.BufferGeometry;_.fromGeometry(y),y.dispose();const x=new r.Mesh(_,o);if(x.userData={dataSource:this.name,tileKey:e.tileKey},this.m_debugTiles){const t=Math.round(16777215*Math.abs(Math.sin(11*e.tileKey.mortonCode())));x.material=new r.MeshBasicMaterial({color:t,transparent:!0,opacity:.5}),e.objects.push(new r.Mesh(_,new r.MeshBasicMaterial({color:t,wireframe:!0})))}e.objects.push(x)}}t.PolarTileDataSource=c},function(e,t,i){e.exports=function(){"use strict";function e(e,r,n,s,o){!function e(i,r,n,s,o){for(;s>n;){if(s-n>600){var a=s-n+1,l=r-n+1,c=Math.log(a),h=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*h*(a-h)/a)*(l-a/2<0?-1:1);e(i,r,Math.max(n,Math.floor(r-l*h/a+d)),Math.min(s,Math.floor(r+(a-l)*h/a+d)),o)}var u=i[r],m=n,p=s;for(t(i,n,r),o(i[s],u)>0&&t(i,n,s);m<p;){for(t(i,m,p),m++,p--;o(i[m],u)<0;)m++;for(;o(i[p],u)>0;)p--}0===o(i[n],u)?t(i,n,p):t(i,++p,s),p<=r&&(n=p+1),r<=p&&(s=p-1)}}(e,r,n||0,s||e.length-1,o||i)}function t(e,t,i){var r=e[t];e[t]=e[i],e[i]=r}function i(e,t){return e<t?-1:e>t?1:0}var r=function(e){void 0===e&&(e=9),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(e,t,i){if(!i)return t.indexOf(e);for(var r=0;r<t.length;r++)if(i(e,t[r]))return r;return-1}function s(e,t){o(e,0,e.children.length,t,e)}function o(e,t,i,r,n){n||(n=p(null)),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(var s=t;s<i;s++){var o=e.children[s];a(n,e.leaf?r(o):o)}return n}function a(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function l(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function d(e){return e.maxX-e.minX+(e.maxY-e.minY)}function u(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function m(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function p(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function f(t,i,r,n,s){for(var o=[i,r];o.length;)if(!((r=o.pop())-(i=o.pop())<=n)){var a=i+Math.ceil((r-i)/n/2)*n;e(t,a,i,r,s),o.push(i,a,a,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(e){var t=this.data,i=[];if(!m(e,t))return i;for(var r=this.toBBox,n=[];t;){for(var s=0;s<t.children.length;s++){var o=t.children[s],a=t.leaf?r(o):o;m(e,a)&&(t.leaf?i.push(o):u(e,a)?this._all(o,i):n.push(o))}t=n.pop()}return i},r.prototype.collides=function(e){var t=this.data;if(!m(e,t))return!1;for(var i=[];t;){for(var r=0;r<t.children.length;r++){var n=t.children[r],s=t.leaf?this.toBBox(n):n;if(m(e,s)){if(t.leaf||u(e,s))return!0;i.push(n)}}t=i.pop()}return!1},r.prototype.load=function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0;t<e.length;t++)this.insert(e[t]);return this}var i=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},r.prototype.insert=function(e){return e&&this._insert(e,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(e,t){if(!e)return this;for(var i,r,s,o=this.data,a=this.toBBox(e),l=[],c=[];o||l.length;){if(o||(o=l.pop(),r=l[l.length-1],i=c.pop(),s=!0),o.leaf){var h=n(e,o.children,t);if(-1!==h)return o.children.splice(h,1),l.push(o),this._condense(l),this}s||o.leaf||!u(o,a)?r?(i++,o=r.children[i],s=!1):o=null:(l.push(o),c.push(i),i=0,r=o,o=o.children[0])}return this},r.prototype.toBBox=function(e){return e},r.prototype.compareMinX=function(e,t){return e.minX-t.minX},r.prototype.compareMinY=function(e,t){return e.minY-t.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(e){return this.data=e,this},r.prototype._all=function(e,t){for(var i=[];e;)e.leaf?t.push.apply(t,e.children):i.push.apply(i,e.children),e=i.pop();return t},r.prototype._build=function(e,t,i,r){var n,o=i-t+1,a=this._maxEntries;if(o<=a)return s(n=p(e.slice(t,i+1)),this.toBBox),n;r||(r=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,r-1))),(n=p([])).leaf=!1,n.height=r;var l=Math.ceil(o/a),c=l*Math.ceil(Math.sqrt(a));f(e,t,i,c,this.compareMinX);for(var h=t;h<=i;h+=c){var d=Math.min(h+c-1,i);f(e,h,d,l,this.compareMinY);for(var u=h;u<=d;u+=l){var m=Math.min(u+l-1,d);n.children.push(this._build(e,u,m,r-1))}}return s(n,this.toBBox),n},r.prototype._chooseSubtree=function(e,t,i,r){for(;r.push(t),!t.leaf&&r.length-1!==i;){for(var n=1/0,s=1/0,o=void 0,a=0;a<t.children.length;a++){var l=t.children[a],c=h(l),d=(u=e,m=l,(Math.max(m.maxX,u.maxX)-Math.min(m.minX,u.minX))*(Math.max(m.maxY,u.maxY)-Math.min(m.minY,u.minY))-c);d<s?(s=d,n=c<n?c:n,o=l):d===s&&c<n&&(n=c,o=l)}t=o||t.children[0]}var u,m;return t},r.prototype._insert=function(e,t,i){var r=i?e:this.toBBox(e),n=[],s=this._chooseSubtree(r,this.data,t,n);for(s.children.push(e),a(s,r);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(r,n,t)},r.prototype._split=function(e,t){var i=e[t],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var o=this._chooseSplitIndex(i,n,r),a=p(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,s(i,this.toBBox),s(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)},r.prototype._splitRoot=function(e,t){this.data=p([e,t]),this.data.height=e.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(e,t,i){for(var r,n,s,a,l,c,d,u=1/0,m=1/0,p=t;p<=i-t;p++){var f=o(e,0,p,this.toBBox),g=o(e,p,i,this.toBBox),v=(n=f,s=g,a=Math.max(n.minX,s.minX),l=Math.max(n.minY,s.minY),c=Math.min(n.maxX,s.maxX),d=Math.min(n.maxY,s.maxY),Math.max(0,c-a)*Math.max(0,d-l)),y=h(f)+h(g);v<u?(u=v,r=p,m=y<m?y:m):v===u&&y<m&&(m=y,r=p)}return r||i-t},r.prototype._chooseSplitAxis=function(e,t,i){var r=e.leaf?this.compareMinX:l,n=e.leaf?this.compareMinY:c;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,n)&&e.children.sort(r)},r.prototype._allDistMargin=function(e,t,i,r){e.children.sort(r);for(var n=this.toBBox,s=o(e,0,t,n),l=o(e,i-t,i,n),c=d(s)+d(l),h=t;h<i-t;h++){var u=e.children[h];a(s,e.leaf?n(u):u),c+=d(s)}for(var m=i-t-1;m>=t;m--){var p=e.children[m];a(l,e.leaf?n(p):p),c+=d(l)}return c},r.prototype._adjustParentBBoxes=function(e,t,i){for(var r=i;r>=0;r--)a(t[r],e)},r.prototype._condense=function(e){for(var t=e.length-1,i=void 0;t>=0;t--)0===e[t].children.length?t>0?(i=e[t-1].children).splice(i.indexOf(e[t]),1):this.clear():s(e[t],this.toBBox)},r}()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(0),s=r.LoggerManager.instance.create("SkyCubemapTexture");var o;t.SKY_CUBEMAP_FACE_COUNT=6,function(e){e[e.positiveX=0]="positiveX",e[e.negativeX=1]="negativeX",e[e.positiveY=2]="positiveY",e[e.negativeY=3]="negativeY",e[e.positiveZ=4]="positiveZ",e[e.negativeZ=5]="negativeZ"}(o=t.SkyCubemapFaceId||(t.SkyCubemapFaceId={}));t.SkyCubemapTexture=class{constructor(e){const t=this.createCubemapFaceArray(e);this.m_skybox=void 0!==t?(new n.CubeTextureLoader).load(t):new n.CubeTexture}dispose(){this.m_skybox.dispose()}get texture(){return this.m_skybox}updateTexture(e){const t=this.createCubemapFaceArray(e);void 0!==t&&(this.m_skybox=(new n.CubeTextureLoader).load(t))}createCubemapFaceArray(e){const i=[void 0,void 0,void 0,void 0,void 0,void 0];for(let r=0;r<t.SKY_CUBEMAP_FACE_COUNT;++r){const t=e[o[r]];if(void 0===t)return void s.error(`Face "${o[r]}" was not defined.`);i[r]=t}return i}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(32),n=i(1),s=i(104);i(26),t.DEFAULT_MAX_THEME_INTHERITANCE_DEPTH=4;class o{static async load(e,t){if(t=t||{},"string"==typeof e){const i=t.uriResolver,r=void 0!==i?i.resolveUri(e):e,s=await fetch(r,{signal:t.signal});if(!s.ok)throw new Error(`ThemeLoader#load: cannot load theme: ${s.statusText}`);(e=await s.json()).url=n.resolveReferenceUri(n.getAppBaseUrl(),r),e=this.resolveUrls(e,i)}else void 0===e.url&&(e.url=n.getAppBaseUrl(),e=this.resolveUrls(e,t.uriResolver));if(null==e)throw new Error("ThemeLoader#load: loaded resource is not valid JSON");e=e,o.checkTechniqueSupport(e);const i=n.getOptionValue(t.resolveDefinitions,!1);if(e=await o.resolveBaseThemes(e,t),i){const i=new n.ContextLogger(t.logger||console,`when processing Theme ${e.url}:`);o.resolveThemeReferences(e,i)}return e}static isThemeLoaded(e){return void 0===e.extends}static async loadAsync(e){return o.load(e)}static resolveUrls(e,t){if(void 0===e.url)return e;const i=n.composeUriResolvers(new n.RelativeUriResolver(e.url),t);if(e.extends&&(e.extends=(Array.isArray(e.extends)?e.extends:[e.extends]).map(r=>"string"==typeof r?i.resolveUri(r):void 0!==r.url?r:(r.url=e.url,this.resolveUrls(r,t)))),e.sky&&"cubemap"===e.sky.type)for(let t=0;t<s.SKY_CUBEMAP_FACE_COUNT;++t){const r=e.sky[s.SkyCubemapFaceId[t]];void 0!==r&&(e.sky[s.SkyCubemapFaceId[t]]=i.resolveUri(r))}if(e.images)for(const t of Object.keys(e.images)){const r=e.images[t];r.url=i.resolveUri(r.url),void 0!==r.atlas&&(r.atlas=i.resolveUri(r.atlas))}if(e.fontCatalogs)for(const t of e.fontCatalogs)t.url=i.resolveUri(t.url);if(e.poiTables)for(const t of e.poiTables)t.url=i.resolveUri(t.url);if(e.styles)for(const t in e.styles){if(!e.styles.hasOwnProperty(t))continue;const r=e.styles[t];for(const e of r)e.attr&&["map","normalMap","displacementMap","roughnessMap"].forEach(t=>{const r=e.attr[t];r&&"string"==typeof r&&(e.attr[t]=i.resolveUri(r))})}return e}static checkTechniqueSupport(e){if(void 0!==e.styles)for(const t in e.styles)if(e.styles.hasOwnProperty(t))for(const i of e.styles[t])i.technique}static resolveThemeReferences(e,t){if(void 0!==e.definitions){t.pushAttr("definitions");for(const i in e.definitions){if(!e.definitions.hasOwnProperty(i))continue;const n=e.definitions[i];if(r.isActualSelectorDefinition(n)){t.pushAttr(i);const r=o.resolveStyle(n,e.definitions,t);t.pop(),void 0===r?(t.pushAttr(i),t.warn("skipping invalid style in definition"),t.pop(),delete e.definitions[i]):e.definitions[i]=r}}t.pop()}if(void 0!==e.styles)for(const i in e.styles)e.styles.hasOwnProperty(i)&&(t.pushAttr("styles"),t.pushAttr(i),e.styles[i]=o.resolveStyleSet(e.styles[i],e.definitions,t),t.pop(),t.pop());return e}static resolveStyleSet(e,t,i){const r=[];for(let n=0;n<e.length;++n){const s=e[n];i.pushIndex(n);const a=o.resolveStyle(s,t,i);void 0!==a?r.push(a):i.warn("invalid style, ignored"),i.pop()}return r}static resolveStyle(e,t,i){if(r.isJsonExprReference(e)){const s=t&&t[e[1]];if(!s)return void i.warn(`invalid reference '${e[1]}' - not found`);if(!r.isActualSelectorDefinition(s))return void i.warn(`invalid reference '${e[1]}' - expected style definition`);e=n.cloneDeep(s)}if(e=e,Array.isArray(e.when)){i.pushAttr("when");const r=this.resolveExpressionReferences(e.when,t,i);if(i.pop(),void 0===r)return;e.when=r}if(void 0!==e.attr){const r=e.attr;i.pushAttr("attr");for(const e in r){if(!r.hasOwnProperty(e))continue;const n=r[e];if(!Array.isArray(n))continue;i.pushAttr(e);const s=this.resolveExpressionReferences(n,t,i);i.pop(),void 0!==s?r[e]=s:delete r[e]}i.pop()}return e}static resolveExpressionReferences(e,t,i){let n=!1;const s=function e(s){if(r.isJsonExprReference(s)){const e=s[1],o=t&&t[e];return void 0===o?(i.warn(`invalid reference '${e}' - not found`),void(n=!0)):r.isValueDefinition(o)?o.value:(i.warn(`invalid reference '${e}' - expected value definition`),void(n=!0))}if(Array.isArray(s)){const t=[...s];for(let i=1;i<t.length;++i)t[i]=e(t[i]);return t}return s}(e);if(!n)return s}static async resolveBaseThemes(e,i){if(i=i||{},void 0===e.extends)return e;const r=n.getOptionValue(i.maxInheritanceDepth,t.DEFAULT_MAX_THEME_INTHERITANCE_DEPTH);if(r<=0)throw new Error("maxInheritanceDepth reached when attempting to load base theme");const s=Array.isArray(e.extends)?e.extends:[e.extends];delete e.extends;let a={};for(const e of s){const t=await o.load(e,Object.assign(Object.assign({},i),{resolveDefinitions:!1,maxInheritanceDepth:r-1}));a=o.mergeThemes(t,a)}return o.mergeThemes(e,a)}static mergeThemes(e,t){const i=Object.assign(Object.assign({},t.definitions),e.definitions),r=Object.assign(Object.assign({},t.styles),e.styles);return Object.assign(Object.assign(Object.assign({},t),e),{definitions:i,styles:r})}}t.ThemeLoader=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(3),n=i(47),s=i(1),o=i(0),a=i(9);var l;!function(e){e[e.EstimationInMb=0]="EstimationInMb",e[e.NumberOfTiles=1]="NumberOfTiles"}(l=t.ResourceComputationType||(t.ResourceComputationType={}));const c=1/1048576;class h{constructor(e,t=l.EstimationInMb){this.m_disposedTiles=[],this.m_resourceComputationType=t,this.m_tileCache=new n.LRUCache(e,e=>this.m_resourceComputationType===l.EstimationInMb?e.memoryUsage*c:1),this.m_tileCache.evictionCallback=(e,t)=>{void 0!==t.tileLoader&&t.tileLoader.cancel(),this.m_disposedTiles.push(t)},this.m_tileCache.canEvict=(e,t)=>!t.isVisible}static getKey(e,t,i){return`${i.name}_${e}_${t}`}static getKeyForTile(e){return h.getKey(e.tileKey.mortonCode(),e.offset,e.dataSource)}get resourceComputationType(){return this.m_resourceComputationType}get capacity(){return this.m_tileCache.capacity}get size(){return this.m_tileCache.size}setCapacity(e,t){this.m_resourceComputationType=t,this.m_tileCache.setCapacityAndMeasure(e,e=>this.m_resourceComputationType===l.EstimationInMb?e.memoryUsage*c:1)}get(e,t,i){return this.m_tileCache.get(h.getKey(e,t,i))}set(e,t,i,r){this.m_tileCache.set(h.getKey(e,t,i),r)}delete(e){const t=h.getKeyForTile(e);this.deleteByKey(t)}deleteByKey(e){this.m_tileCache.delete(e)}disposeTiles(){this.m_disposedTiles.forEach(e=>{e.dispose()}),this.m_disposedTiles.length=0}shrinkToCapacity(){this.m_tileCache.shrinkToCapacity()}evictAll(){this.m_tileCache.evictAll()}evictSelected(e){this.m_tileCache.evictSelected(e)}forEach(e,t){this.m_tileCache.forEach((i,r)=>{void 0!==t&&i.dataSource!==t||e(i,r)})}}t.VisibleTileSet=class{constructor(e,t,i){this.m_frustumIntersection=e,this.m_tileGeometryManager=t,this.dataSourceTileList=[],this.allVisibleTilesLoaded=!1,this.m_projectionMatrixOverride=new o.Matrix4,this.m_viewRange={near:.1,far:1/0,minimum:.1,maximum:1/0},this.m_resourceComputationType=l.EstimationInMb,this.options=i,this.m_resourceComputationType=void 0===i.resourceComputationType?l.EstimationInMb:i.resourceComputationType,this.m_dataSourceCache=new h(this.options.tileCacheSize,this.m_resourceComputationType)}getDataSourceCacheSize(){return this.options.tileCacheSize}setDataSourceCacheSize(e,t=l.EstimationInMb){this.options.tileCacheSize=e,this.resourceComputationType=t}getNumberOfVisibleTiles(){return this.options.maxVisibleDataSourceTiles}setNumberOfVisibleTiles(e){this.options.maxVisibleDataSourceTiles=e}get resourceComputationType(){return this.m_resourceComputationType}set resourceComputationType(e){this.m_resourceComputationType=e,this.m_dataSourceCache.setCapacity(this.options.tileCacheSize,e)}updateClipPlanes(e,t){return void 0!==e&&(this.options.clipPlanesEvaluator.maxElevation=e),void 0!==t&&(this.options.clipPlanesEvaluator.minElevation=t),this.m_viewRange=this.options.clipPlanesEvaluator.evaluateClipPlanes(this.m_frustumIntersection.mapView),this.m_viewRange}updateRenderList(e,t,i,r){let n=!0;const o=this.getVisibleTileKeysForDataSources(t,i,r);this.dataSourceTileList=[];for(const{dataSource:i,visibleTileKeys:r}of o.tileKeys){r.sort((e,t)=>{const i=t.area-e.area,r=.001*(e.area+t.area);return Math.abs(i)<r?t.tileKey.mortonCode()-e.tileKey.mortonCode():i});const s=[];let o=!0,a=0;const l=i.getDisplayZoomLevel(t);for(let e=0;e<r.length&&s.length<this.options.maxVisibleDataSourceTiles;e++){const t=r[e];if(!i.shouldRender(l,t.tileKey))continue;const n=this.getTile(i,t.tileKey,t.offset);void 0!==n&&(n.prepareTileInfo(),o=o&&n.allGeometryLoaded,n.allGeometryLoaded?(n.numFramesVisible++,n.frameNumVisible<0&&(n.frameNumVisible=i.mapView.frameNumber)):a++,n.visibleArea=t.area,n.minElevation=t.minElevation,n.maxElevation=t.maxElevation,s.push(n))}this.m_tileGeometryManager.updateTiles(s),this.dataSourceTileList.push({dataSource:i,storageLevel:e,zoomLevel:l,allVisibleTileLoaded:o,numTilesLoading:a,visibleTiles:s,renderedTiles:new Map}),n=n&&o}let a,l;this.allVisibleTilesLoaded=n&&o.allBoundingBoxesFinal,this.fillMissingTilesFromCache(),this.forEachCachedTile(e=>{e.isVisible||void 0===e.tileLoader||e.tileLoader.isFinished||this.disposeTile(e)}),this.m_dataSourceCache.shrinkToCapacity(),this.dataSourceTileList.forEach(e=>{e.renderedTiles.forEach(e=>{a=s.MathUtils.min2(a,e.minElevation),l=s.MathUtils.max2(l,e.maxElevation+e.maxGeometryHeight)})}),void 0===a&&(a=0),void 0===l&&(l=0);let c=!1;const h=this.m_viewRange,d=this.updateClipPlanes(l,a);var u,m;return c=!1==(m=h,(u=d).far===m.far&&u.maximum===m.maximum&&u.minimum===m.minimum&&u.near===m.near),{viewRanges:d,viewRangesChanged:c}}getTile(e,t,i=0){return this.getTileImpl(e,t,i,!1)}getCachedTile(e,t,i=0){s.assert(e.cacheable);return this.getTileImpl(e,t,i,!0)}getRenderedTile(e,t,i=0){const r=this.dataSourceTileList.find(t=>t.dataSource===e);if(void 0!==r)return r.renderedTiles.get(a.TileOffsetUtils.getKeyForTileKeyAndOffset(t,i))}getRenderedTileAtLocation(e,t,i=0){const n=this.dataSourceTileList.find(t=>t.dataSource===e);if(void 0===n)return;const s=e.getTilingScheme(),o=n.zoomLevel,l=s.getTileKey(t,o);if(!l)return;let c=n.renderedTiles.get(a.TileOffsetUtils.getKeyForTileKeyAndOffset(l,i));if(void 0!==c)return c;const{searchLevelsUp:h,searchLevelsDown:d}=this.getCacheSearchLevels(e,o);let u=l;for(let e=1;e<=h;++e)if(u=u.parent(),c=n.renderedTiles.get(a.TileOffsetUtils.getKeyForTileKeyAndOffset(u,i)),void 0!==c)return c;const m=s.projection.projectPoint(t);for(let e=1;e<=d;++e){const t=o+e,l=r.TileKeyUtils.worldCoordinatesToTileKey(s,m,t);if(l&&(c=n.renderedTiles.get(a.TileOffsetUtils.getKeyForTileKeyAndOffset(l,i)),void 0!==c))return c}}removeDataSource(e){this.clearTileCache(e),this.dataSourceTileList=this.dataSourceTileList.filter(t=>t.dataSource!==e)}clearTileCache(e){void 0!==e?this.m_dataSourceCache.evictSelected((t,i)=>t.dataSource===e):this.m_dataSourceCache.evictAll()}markTilesDirty(e){if(void 0===e)this.dataSourceTileList.forEach(e=>{this.markDataSourceTilesDirty(e)});else{const t=this.dataSourceTileList.find(t=>t.dataSource===e);if(void 0===t)return;this.markDataSourceTilesDirty(t)}}disposePendingTiles(){this.m_dataSourceCache.disposeTiles()}forEachVisibleTile(e){for(const t of this.dataSourceTileList)t.renderedTiles.forEach(e)}forEachCachedTile(e,t){this.m_dataSourceCache.forEach((t,i)=>e(t),t)}disposeTile(e){this.m_dataSourceCache.delete(e),e.dispose()}getCacheSearchLevels(e,t){return{searchLevelsUp:Math.min(this.options.quadTreeSearchDistanceUp,Math.max(0,t-e.minZoomLevel)),searchLevelsDown:Math.min(this.options.quadTreeSearchDistanceDown,Math.max(0,e.maxZoomLevel-t))}}fillMissingTilesFromCache(){this.dataSourceTileList.forEach(e=>{const t=e.dataSource,i=e.zoomLevel,r=e.renderedTiles;let n;!function(e){e[e.NONE=0]="NONE",e[e.UP=1]="UP",e[e.DOWN=2]="DOWN",e[e.BOTH=3]="BOTH"}(n||(n={}));let s=n.NONE;const{searchLevelsUp:o,searchLevelsDown:l}=this.getCacheSearchLevels(t,i);s=l>0&&o>0?n.BOTH:l>0?n.DOWN:o>0?n.UP:n.NONE;const c=new Map;if(e.visibleTiles.forEach(e=>{const t=a.TileOffsetUtils.getKeyForTileKeyAndOffset(e.tileKey,e.offset);e.levelOffset=0,e.hasGeometry||s===n.NONE?r.set(t,e):c.set(t,s)}),0===c.size)return;const h=new Map;for(const[e,s]of c)(s!==n.BOTH&&s!==n.UP||!this.findUp(e,i,r,h,t))&&(s!==n.BOTH&&s!==n.DOWN||this.findDown(e,i,r,t))})}findDown(e,t,i,n){const{offset:s,mortonCode:o}=a.TileOffsetUtils.extractOffsetAndMortonKeyFromKey(e),l=r.TileKey.fromMortonCode(o),c=n.getTilingScheme();for(const e of c.getSubTileKeys(l)){const r=a.TileOffsetUtils.getKeyForTileKeyAndOffset(e,s),o=this.m_dataSourceCache.get(e.mortonCode(),s,n),l=Math.abs(e.level-t);void 0!==o&&o.hasGeometry?(i.set(r,o),o.levelOffset=l):l<this.options.quadTreeSearchDistanceDown&&this.findDown(r,t,i,n)}}findUp(e,t,i,n,s){const o=a.TileOffsetUtils.getParentKeyFromKey(e);if(void 0!==i.get(o))return!0;const l=n.get(o);if(void 0!==l)return l;const{offset:c,mortonCode:h}=a.TileOffsetUtils.extractOffsetAndMortonKeyFromKey(o),d=this.m_dataSourceCache.get(h,c,s),u=d?d.tileKey:r.TileKey.fromMortonCode(h),m=Math.abs(t-u.level);if(void 0!==d&&d.hasGeometry)return n.set(o,!0),i.set(o,d),d.levelOffset=-m,!0;if(n.set(o,!1),m<this.options.quadTreeSearchDistanceUp&&0!==u.level){const e=this.findUp(o,t,i,n,s);if(n.set(o,e),e)return!0}return!1}getTileImpl(e,t,i,r){function n(t){void 0!==t&&(t.frameNumLastRequested=e.mapView.frameNumber)}if(!e.cacheable&&!r){const i=e.getTile(t);return n(i),i}const s=this.m_dataSourceCache;let o=s.get(t.mortonCode(),i,e);return void 0!==o&&o.offset===i?(n(o),o):r?void 0:(o=e.getTile(t),void 0!==o&&(o.offset=i,n(o),s.set(t.mortonCode(),i,e,o),this.m_tileGeometryManager.initTile(o)),o)}markDataSourceTilesDirty(e){const t=this.m_dataSourceCache,i=new Set;function r(e,t){const r=h.getKeyForTile(e);i.has(r)||(i.add(r),void 0!==e.tileGeometryLoader&&e.tileGeometryLoader.reset(),e.clearTextElements(),e.load())}e.visibleTiles.forEach(e=>{r(e,this.m_tileGeometryManager)}),e.renderedTiles.forEach(e=>{r(e,this.m_tileGeometryManager)}),t.forEach((e,r)=>{i.has(r)||(t.deleteByKey(r),e.dispose())},e.dataSource)}getVisibleTileKeysForDataSources(e,t,i){const r=Array();let n=!0;if(0===t.length)return{tileKeys:r,allBoundingBoxesFinal:n};const s=new Map;if(t.forEach(e=>{const t=e.getTilingScheme(),i=s.get(t);void 0===i?s.set(t,[e]):i.push(e)}),void 0!==i){const e=a.MapViewUtils.getCameraFrustumPlanes(this.m_frustumIntersection.camera);e.near=this.m_viewRange.minimum,e.far=this.m_viewRange.maximum,this.m_projectionMatrixOverride.makePerspective(e.left,e.right,e.bottom,e.top,e.near,e.far),this.m_frustumIntersection.updateFrustum(this.m_projectionMatrixOverride)}else this.m_frustumIntersection.updateFrustum();for(const[t,o]of s){const s=o.map(t=>t.getDisplayZoomLevel(e)),a=Math.max(...s),l=this.m_frustumIntersection.compute(t,a,i,s,o);n=n&&l.calculationFinal;for(const t of o){const i=[],n=t.getDisplayZoomLevel(e);for(const e of l.tileKeyEntries.values())t.shouldRender(n,e.tileKey)&&i.push(e);r.push({dataSource:t,visibleTileKeys:i})}}return{tileKeys:r,allBoundingBoxesFinal:n}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(92),n=i(108);class s{static getTiler(e,t,i){const r=this.getWorkerSet(t,i);return new n.WorkerBasedTiler(r,e)}static getWorkerSet(e,t){void 0===e&&(e=this.defaultScriptUrl);let i=this.workerSets[e];return void 0===i&&(i=new r.ConcurrentWorkerSet({scriptUrl:e,workerCount:void 0===t?this.defaultWorkerCount:t}),this.workerSets[e]=i),i}static destroyWorkerSet(e){const t=this.workerSets[e];void 0!==t&&(t.destroy(),delete this.workerSets[e])}static destroy(){Object.keys(this.workerSets).forEach(e=>{this.workerSets[e].destroy()}),this.workerSets={}}}t.ConcurrentTilerFacade=s,s.defaultScriptUrl="./decoder.bundle.js",s.defaultWorkerCount=1,s.workerSets={}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2);let n=0;t.WorkerBasedTiler=class{constructor(e,t){this.workerSet=e,this.tilerServiceType=t,this.m_serviceCreated=!1,this.workerSet.addReference(),this.serviceId=`${this.tilerServiceType}-${n++}`}dispose(){this.m_serviceCreated&&this.workerSet.broadcastRequest(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:r.WorkerServiceProtocol.Requests.DestroyService,targetServiceId:this.serviceId}).catch(()=>{}),this.workerSet.removeReference()}async connect(){await this.workerSet.connect(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID),this.m_serviceCreated||(await this.workerSet.broadcastRequest(r.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID,{type:r.WorkerServiceProtocol.Requests.CreateService,targetServiceType:this.tilerServiceType,targetServiceId:this.serviceId}),this.m_serviceCreated=!0)}registerIndex(e,t){const i={type:r.WorkerTilerProtocol.Requests.RegisterIndex,id:e,input:t instanceof URL?t.href:t};return this.workerSet.invokeRequest(this.serviceId,i)}updateIndex(e,t){const i={type:r.WorkerTilerProtocol.Requests.UpdateIndex,id:e,input:t instanceof URL?t.href:t};return this.workerSet.invokeRequest(this.serviceId,i)}getTile(e,t){const i=t.mortonCode(),n={type:r.WorkerTilerProtocol.Requests.TileRequest,index:e,tileKey:i};return this.workerSet.invokeRequest(this.serviceId,n)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(103);t.CopyrightCoverageProvider=class{constructor(){this.logger=r.LoggerManager.instance.create("CopyrightCoverageProvider")}getTree(){return void 0!==this.m_cachedTreePromise?this.m_cachedTreePromise:(this.m_cachedTreePromise=this.getCopyrightCoverageData().then(e=>this.initRBush(e)).catch(e=>(this.logger.error(e),new n)),this.m_cachedTreePromise)}async getCopyrights(e,t){const i=[],n=(await this.getTree()).search({minX:e.west,minY:e.south,maxX:e.east,maxY:e.north});for(const e of n){const n=r.getOptionValue(e.minLevel,0),s=r.getOptionValue(e.maxLevel,1/0);t>=n&&t<=s&&void 0===i.find(t=>t.id===e.label)&&i.push({id:e.label})}return i}initRBush(e){const t=new n;if(!e)return this.logger.warn("No copyright coverage data provided"),t;for(const i of e){const{minLevel:e,maxLevel:r,label:n,alt:s}=i;if(i.boxes)for(const o of i.boxes){const[i,a,l,c]=o;t.insert({minX:a,minY:i,maxX:c,maxY:l,minLevel:e,maxLevel:r,label:n,alt:s})}else t.insert({minX:-180,minY:-90,maxX:180,maxY:180,minLevel:e,maxLevel:r,label:n,alt:s})}return t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}(i(227))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(230),s=i(1),o=s.LoggerManager.instance.create("TileGeometry");t.isLineAccessor=function(e){return"function"==typeof e.isLineAccessor&&!0===e.isLineAccessor()},t.isObject3dAccessor=function(e){return"function"==typeof e.isObject3dAccessor&&!0===e.isObject3dAccessor()};class a{constructor(e,t,i){this.object=e,this.geometryType=t,this.bufferGeometry=i,this.start=-1,this.end=-1,this.startCapSize=0,this.endCapSize=0,s.assert(!!e),"BufferGeometry"!==i.type&&o.error("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),s.assert("BufferGeometry"===i.type,"IndexedBufferedGeometryAccessor#constructor: BufferGeometry has wrong type"),this.position=this.bufferGeometry.getAttribute("position"),this.itemSize=this.position.itemSize,this.position||o.warn("BufferedGeometryAccessor#constructor: BufferGeometry has no position attribute"),this.position.array.constructor!==Float32Array&&o.warn("BufferedGeometryAccessor#constructor: BufferGeometry.position: unsupported ArrayBuffer")}getCount(){return this.position.count}get renderOrder(){return this.object.renderOrder}setRange(e,t,i=0,r=0){s.assert(e>=0),s.assert(t>=0),s.assert(e<=t),this.start=e,this.end=t,this.startCapSize=i,this.endCapSize=r}get color(){const e=e=>{const t=e;if("MeshBasicMaterial"===t.type||"MeshStandardMaterial"===t.type)return t.color;if("RawShaderMaterial"===t.type){const t=e;if("SolidLineMaterial"===t.name)return t.uniforms.diffuse.value;o.warn("BufferedGeometryAccessor#color: unknown shader material name",t.name)}else o.warn("BufferedGeometryAccessor#color: unknown material type",t.type)};if(Array.isArray(this.object.material)){const t=new Array,i=this.object.material;for(const r of i)t.push(e(r));return t}return e(this.object.material)}}t.BufferedGeometryAccessorBase=a;class l extends a{constructor(e,t,i,r){super(e,t,i),this.object=e,this.geometryType=t,this.bufferGeometry=i,this.stride=r}clear(){s.assert(this.checkSetUp(),"BufferedGeometryAccessor not setup");const e=this.position.array,t=this.start*this.itemSize,i=this.end*this.itemSize;for(let r=t;r<i;r++)e[r]=0;this.position.needsUpdate=!0}getVertices(){s.assert(this.checkSetUp(),"BufferedGeometryAccessor not setup");const e=this.start,t=this.end;return this.position.array.subarray(e*this.itemSize,t*this.itemSize)}checkSetUp(){return void 0!==this.position&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.position.count&&this.start<=this.end}}t.BufferedGeometryAccessor=l;t.BufferedGeometryLineAccessor=class extends l{constructor(e,t,i){super(e,t,i,3),this.object=e,this.geometryType=t,this.bufferGeometry=i}isLineAccessor(){return!0}get width(){s.assert(this.checkSetUp(),"RoBufferedGeometryLineAccessor not setup")}};t.BufferedGeometryObject3dAccessor=class extends l{constructor(e,t,i){super(e,t,i,1),this.object=e,this.geometryType=t,this.bufferGeometry=i}isObject3dAccessor(){return!0}getVertices(){return super.getVertices()}};class c extends a{constructor(e,t,i,r,n){super(e,t,i),this.object=e,this.geometryType=t,this.bufferGeometry=i,this.indices=null!==this.bufferGeometry.index?this.bufferGeometry.index.array:void 0,this.indices?this.indices instanceof Uint32Array||(o.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry index has wrong type"),s.assert(this.indices instanceof Uint32Array)):(o.warn("IndexedBufferedGeometryAccessor#constructor: BufferGeometry has no index"),s.assert(!!this.indices))}getCount(){return this.indices.length}checkSetUp(){return!!this.indices&&void 0!==this.start&&void 0!==this.end&&this.start>=0&&this.end<=this.indices.length&&this.start<=this.end}}t.IndexedBufferedGeometryAccessor=c;t.IndexedBufferedGeometryLineAccessor=class extends c{constructor(e,t,i){super(e,t,i,3),this.object=e,this.geometryType=t,this.bufferGeometry=i}isLineAccessor(){return!0}get width(){if(s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup"),this.geometryType===r.GeometryType.ExtrudedLine){const e=this.start+this.startCapSize,t=this.position.array;return n.reconstructLineWidth(t,e)}}clear(){s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");const e=this.start,t=this.end;for(let i=e;i<t;i++)this.indices[i]=0;null!==this.bufferGeometry.index&&(this.bufferGeometry.index.needsUpdate=!0)}getVertices(){s.assert(this.checkSetUp(),"RoIndexedBufferedGeometryLineAccessor not setup");const e=this.itemSize,t=this.start,i=this.end,r=new Float32Array((i-t)*e),n=this.position.array;if(2===e)for(let s=t,o=0;s<i;s++,o+=e){const t=this.indices[s];r[o+0]=n[t*e+0],r[o+1]=n[t*e+1]}if(3===e)for(let s=t,o=0;s<i;s++,o+=e){const t=this.indices[s];r[o+0]=n[t*e+0],r[o+1]=n[t*e+1],r[o+2]=n[t*e+2]}else for(let s=t,o=0;s<i;s++,o++){const t=this.indices[s];for(let i=0;i<e;i++)r[o*e+i]=n[t*e+i]}return r}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=new r.Vector3(0,0,1),s=[0,1,2,1,3,2],o=[0,1,3,3,1,2,0,3,4,5,4,3],a=8,l=Math.PI/a;function c(e,t,i,r,n,s){const o=n.length/3;n.push(e,t,0);for(let c=0;c<a+1;++c){const h=l*c+Math.PI/2+i;n.push(e+r*Math.cos(h),t+r*Math.sin(h),0),s.push(o,o+c+1,o+(c+1)%(a+1)+1)}}t.numCirclePoints=function(e){return a+1},t.triangulateLine=function(e,t,i,a,l=!0,h=l){if(e.length<3)return;const d=new r.Vector2;if(l){const r=3!==e.length?d.set(e[3]-e[0],e[4]-e[1]).angle():0;c(e[0],e[1],r,t,i,a)}const u=i.length/3,m=new r.Vector3,p=new r.Vector3,f=new r.Vector3,g=new r.Vector3,v=new r.Vector3,y=new r.Vector3,_=new r.Vector3,x=new r.Vector3,T=new r.Vector3,S=e.length/3;let w=0;for(let r=0;r<S;++r){let l=!1;if(p.set(e[3*r],e[3*r+1],e[3*r+2]),r+1<S){if(f.set(e[3*(r+1)],e[3*(r+1)+1],e[3*(r+1)+2]),g.copy(f).sub(p).normalize().cross(n),v.copy(g),r>0&&(v.add(m).multiplyScalar(1-.5*g.dot(m)),l=m.angleTo(g)>Math.PI/2,l)){const e=t/Math.cos(g.angleTo(m)/2);y.copy(g).add(m).normalize().multiplyScalar(-e).add(p),_.copy(m).multiplyScalar(t).add(p),x.copy(g).add(m).normalize().multiplyScalar(e).add(p),T.copy(g).multiplyScalar(t).add(p)}l?i.push(y.x,y.y,y.z,_.x,_.y,_.z,x.x,x.y,x.z,T.x,T.y,T.z):(y.copy(v).multiplyScalar(-t).add(p),_.copy(v).multiplyScalar(t).add(p),i.push(y.x,y.y,y.z,_.x,_.y,_.z)),m.copy(g)}else y.copy(m).multiplyScalar(-t).add(p),_.copy(m).multiplyScalar(t).add(p),i.push(y.x,y.y,y.z,_.x,_.y,_.z);r!==S-1&&((l?o:s).forEach(e=>a.push(u+w+e)),w+=l?4:2)}if(h){const r=2!==e.length?d.set(e[3*(S-3)]-e[3*(S-2)],e[3*(S-3)+1]-e[3*(S-2)+1]).angle():Math.PI;c(e[3*(S-2)],e[3*(S-2)+1],r,t,i,a)}},t.reconstructLine=function(e,t){const i=new Float32Array(e.length/2);for(let r=3*t,n=2*r;r<i.length;r+=3,n+=6)i[r]=e[n]+.5*(e[n+3]-e[n]),i[r+1]=e[n+1]+.5*(e[n+3+1]-e[n+1]),i[r+2]=e[n+2]+.5*(e[n+3+2]-e[n+2]);return i},t.reconstructLineWidth=function(e,t){const i=e[2*t+3]-e[2*t],r=e[2*t+3+1]-e[2*t+1],n=e[2*t+3+2]-e[2*t+2];return.5*Math.sqrt(i*i+r*r+n*n)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),n=i(0),s=i(55);class o extends n.Line{constructor(e,t,i,s,o){super(void 0===e?new n.BufferGeometry:e,t),void 0===t&&(t=new r.HighPrecisionLineMaterial({color:s||r.HighPrecisionLineMaterial.DEFAULT_COLOR,opacity:void 0!==o?o:r.HighPrecisionLineMaterial.DEFAULT_OPACITY})),this.matrixWorldInverse=new n.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}get shaderMaterial(){return this.material}setPositions(e){s.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.onBeforeRender=(e,t,i,r,n,o)=>{s.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.getInverse(this.matrixWorld)}}t.HighPrecisionWireFrameLine=o;class a extends n.Mesh{constructor(e,t,i,s,o){super(void 0===e?new n.BufferGeometry:e,t),void 0===t&&(t=new r.HighPrecisionLineMaterial({color:s||r.HighPrecisionLineMaterial.DEFAULT_COLOR,opacity:void 0!==o?o:r.HighPrecisionLineMaterial.DEFAULT_OPACITY})),this.matrixWorldInverse=new n.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}get shaderMaterial(){return this.material}setPositions(e){s.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.onBeforeRender=(e,t,i,r,n,o)=>{s.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.getInverse(this.matrixWorld)}}t.HighPrecisionLine=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(26);const r=i(2),n=i(17),s=i(1).LoggerManager.instance.create("TileLoader");class o{constructor(e,t,i,r,s){this.dataSource=e,this.tileKey=t,this.dataProvider=i,this.tileDecoder=r,this.priority=s,this.state=n.TileLoaderState.Initialized,this.loadAbortController=new AbortController,this.countRequests=0}loadAndDecode(){switch(this.state){case n.TileLoaderState.Loading:case n.TileLoaderState.Loaded:case n.TileLoaderState.Decoding:return this.countRequests++,this.donePromise;case n.TileLoaderState.Ready:case n.TileLoaderState.Failed:case n.TileLoaderState.Initialized:case n.TileLoaderState.Canceled:return this.countRequests++,this.startLoading(),this.donePromise}}waitSettled(){return this.donePromise?this.donePromise:Promise.resolve(this.state)}cancel(){if(0==--this.countRequests){switch(this.state){case n.TileLoaderState.Loading:this.loadAbortController.abort(),this.loadAbortController=new AbortController;break;case n.TileLoaderState.Decoding:this.requestController&&(this.requestController.abort(),this.requestController=void 0)}this.onDone(n.TileLoaderState.Canceled)}}get isFinished(){return this.state===n.TileLoaderState.Ready||this.state===n.TileLoaderState.Canceled||this.state===n.TileLoaderState.Failed}updatePriority(e){this.priority=e,void 0!==this.requestController&&(this.requestController.priority=e)}startLoading(){const e=this.loadAbortController.signal;this.dataProvider.getTile(this.tileKey,e).then(t=>{if(e.aborted){const e=new Error("Aborted");throw e.name="AbortError",e}this.onLoaded(t)}).catch(e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&this.onError(e)}),void 0===this.donePromise&&(this.donePromise=new Promise((e,t)=>{this.resolveDonePromise=e,this.rejectedDonePromise=t})),this.state=n.TileLoaderState.Loading}onLoaded(e){this.state=n.TileLoaderState.Loaded,this.payload=e,(void 0===e.byteLength||0!==e.byteLength)&&e!=={}?this.startDecodeTile():this.onDone(n.TileLoaderState.Ready)}startDecodeTile(){const e=this.payload;if(void 0===e)return void s.error("TileLoader#startDecodeTile: Cannot decode without payload");this.state=n.TileLoaderState.Decoding,this.payload=void 0;const t=new r.RequestController(this.priority);this.requestController=t;const i=this.dataSource;this.tileDecoder.decodeTile(e,this.tileKey,i.projection,t).then(e=>{t.signal.aborted||this.onDecoded(e)}).catch(e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&this.onError(e)})}onDecoded(e){this.decodedTile=e,this.onDone(n.TileLoaderState.Ready)}cancelDecoding(){void 0!==this.requestController&&(this.requestController.abort(),this.requestController=void 0)}onDone(e){this.resolveDonePromise&&e===n.TileLoaderState.Ready?this.resolveDonePromise(e):this.rejectedDonePromise&&this.rejectedDonePromise(e),this.resolveDonePromise=void 0,this.rejectedDonePromise=void 0,this.donePromise=void 0,this.state=e}onError(e){if(this.state===n.TileLoaderState.Canceled)return;const t=this.dataSource;s.error(`[${t.name}]: failed to load tile ${this.tileKey.mortonCode()}`,e),this.error=e,this.onDone(n.TileLoaderState.Failed)}}t.TileLoader=o;t.TileInfoLoader=class extends o{startDecodeTile(){const e=this.payload;if(void 0===e)return void s.error("TileInfoLoader#startDecodeTile: Cannot decode without payload");this.state=n.TileLoaderState.Decoding,this.payload=void 0;const t=new r.RequestController(this.priority);this.requestController=t;const i=this.dataSource;this.tileDecoder.getTileInfo(e,this.tileKey,i.projection,t).then(e=>{t.signal.aborted||(this.tileInfo=e,this.onDone(n.TileLoaderState.Ready))}).catch(e=>{"AbortError"!==e.name&&"AbortError: Aborted"!==e.message&&this.onError(e)})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(26);const r=i(110),n=i(1).LoggerManager.instance.create("OmvRestClient");var s,o;!function(e){e[e.HereV1=0]="HereV1",e[e.MapboxV4=1]="MapboxV4",e[e.XYZMVT=2]="XYZMVT",e[e.XYZJson=3]="XYZJson",e[e.XYZOMV=4]="XYZOMV",e[e.TomtomV1=5]="TomtomV1",e[e.XYZSpace=6]="XYZSpace"}(s=t.APIFormat||(t.APIFormat={})),function(e){e[e.QueryString=0]="QueryString",e[e.AuthorizationHeader=1]="AuthorizationHeader"}(o=t.AuthenticationMethod||(t.AuthenticationMethod={})),t.AuthenticationTypeBearer={method:o.AuthorizationHeader,name:"Bearer"},t.AuthenticationTypeTomTomV1={method:o.QueryString,name:"key"},t.AuthenticationTypeAccessToken={method:o.QueryString,name:"access_token"};t.OmvRestClient=class{constructor(e){this.params=e,this.downloadManager=void 0===e.downloadManager?r.TransferManager.instance():e.downloadManager,this.urlParams=void 0===e.urlParams?{}:e.urlParams}async connect(){}ready(){return!0}async getTile(e,t){const i={signal:t};let r=this.dataUrl(e);const n=await this.getActualAuthenticationCode();return r=this.applyAuthCode(r,i,n),r=this.addQueryParams(r,this.urlParams),this.params.apiFormat===s.XYZJson?this.downloadManager.downloadJson(r,i):this.downloadManager.downloadArrayBuffer(r,i)}async getActualAuthenticationCode(){return"string"==typeof this.params.authenticationCode?this.params.authenticationCode:void 0!==this.params.authenticationCode?this.params.authenticationCode():void 0!==this.params.getBearerToken?this.params.getBearerToken():void 0}getDefaultAuthMethod(){if(void 0!==this.params.getBearerToken)return t.AuthenticationTypeBearer;switch(this.params.apiFormat){case s.HereV1:return t.AuthenticationTypeBearer;case s.MapboxV4:case s.XYZOMV:case s.XYZMVT:case s.XYZSpace:case s.XYZJson:return t.AuthenticationTypeAccessToken;case s.TomtomV1:return t.AuthenticationTypeTomTomV1;default:return void n.warn(`#getDefaultAuthMethod: Not supported API format: ${this.params.apiFormat}`)}}applyAuthCode(e,t,i){if(void 0===i)return e;const r=this.params.authenticationMethod||this.getDefaultAuthMethod();if(void 0===r)return e;if(r.method===o.AuthorizationHeader){void 0===t.headers&&(t.headers=new Headers);const e=r.name||"Bearer";t.headers.append("Authorization",`${e} ${i}`)}else if(r.method===o.QueryString){const t={};t[r.name||"access_token"]=i,e=this.addQueryParams(e,t)}return e}dataUrl(e){if(void 0!==this.params.url)return this.params.url.replace("{x}",String(e.column)).replace("{y}",String(e.row)).replace("{z}",String(e.level));let t=[`/${e.level}`,e.column,e.row].join(this.params.apiFormat===s.XYZSpace?"_":"/");switch(this.params.apiFormat){case s.HereV1:case s.XYZOMV:t+="/omv";break;case s.MapboxV4:case s.XYZMVT:t+=".mvt";break;case s.XYZJson:t+=".json";break;case s.XYZSpace:t+=".mvt";break;case s.TomtomV1:t+=".pbf";break;default:n.warn(`Not supported API format: ${this.params.apiFormat}`)}return this.params.baseUrl+t}addQueryParams(e,t){let i="",r=-1!==e.indexOf("?")?"&":"?";return Object.getOwnPropertyNames(t).forEach(e=>{i+=r+e+"="+t[e],"?"===r&&(r="&")}),e+i}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(117);const r=i(3),n=i(17),s=i(233),o=i(239),a="https://www.harp.gl/docs/";document.querySelector(".examples-link").href=a+"master/examples/",document.querySelector(".docs-link").href=a+"master/doc/",document.querySelector("#docs-nav").href=a+"master/doc/",document.querySelector("#examples-nav").href=a+"master/examples/",document.querySelector("#docs-nav-mobile").href=a+"master/doc/",document.getElementById("year").innerText=`${(new Date).getFullYear()}`;const l=[{date:"latest",hash:"master",version:"latest-dev"}],c=document.querySelector("select[name=versions]");fetch("./releases.json").then(e=>e.json()).then(e=>{l.push(...e),l.forEach(e=>{const t=document.createElement("option");t.innerText=e.version,c.appendChild(t)}),c.onchange=()=>{const e=c.querySelector("option:checked"),t=l.find(t=>t.version===e.innerText);if(!t)return;const i=t.hash,r=t.version;document.querySelector(".examples-link").href=a+i+"/examples/",document.querySelector(".examples-link").innerText="Examples"+("master"!==i?` (${r})`:""),document.querySelector(".docs-link").href=a+i+"/doc/",document.querySelector(".docs-link").innerText="Documentation"+("master"!==i?` (${r})`:"")}}).catch(()=>{const e=document.createElement("option");e.innerText="master",c.appendChild(e)});const h=document.getElementById("map"),d=new n.MapView({canvas:h,decoderUrl:"decoder.bundle.js",theme:"resources/theme.json",preserveDrawingBuffer:!0,maxVisibleDataSourceTiles:40,tileCacheSize:100});d.resize(window.innerWidth,500),window.addEventListener("resize",()=>d.resize(window.innerWidth,500));const u=new s.OmvDataSource({baseUrl:"https://xyz.api.here.com/tiles/herebase.02",apiFormat:s.APIFormat.XYZOMV,styleSetName:"tilezen",authenticationCode:o.accessToken});d.addDataSource(u);const m=34.3,p=1400,f=new r.GeoCoordinates(42.361145,-71.057083);let g=135;d.lookAt(f,p,m,g),d.addEventListener(n.MapViewEventNames.FrameComplete,()=>{h.style.opacity="1",d.addEventListener(n.MapViewEventNames.Render,()=>d.lookAt(f,p,m,g+=.1)),setTimeout(()=>{d.beginAnimation()},.5)}),window.map=d},function(e,t,i){},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(15),n=i(7),s=i(11),o=i(8),a=i(12),l=i(13),c=i(0);class h extends l.Projection{constructor(){super(...arguments),this.type=l.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,i){return i||(i=o.MathUtils.newEmptyBox3()),i.min.x=-Math.PI,i.min.y=.5*-Math.PI,i.min.z=e,i.max.x=Math.PI,i.max.y=.5*Math.PI,i.max.z=t,i}projectPoint(e,t){return t||(t={x:0,y:0,z:0}),t.x=c.Math.degToRad(e.longitude),t.y=c.Math.degToRad(e.latitude),t.z=e.altitude||0,t}unprojectPoint(e){return n.GeoCoordinates.fromRadians(e.y,e.x,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){t||(t=o.MathUtils.newEmptyBox3());const i=this.projectPoint(new n.GeoCoordinates(e.south,e.west,e.minAltitude)),r=this.projectPoint(new n.GeoCoordinates(e.north,e.east,e.maxAltitude));return s.isBox3Like(t)?(t.min.x=i.x,t.min.y=i.y,t.min.z=i.z,t.max.x=r.x,t.max.y=r.y,t.max.z=r.z):a.isOrientedBox3Like(t)&&(o.MathUtils.newVector3(1,0,0,t.xAxis),o.MathUtils.newVector3(0,1,0,t.yAxis),o.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(i.x+r.x),t.position.y=.5*(i.y+r.y),t.position.z=.5*(i.z+r.z),t.extents.x=.5*(r.x-i.x),t.extents.y=.5*(r.y-i.y),t.extents.z=Math.max(Number.EPSILON,.5*(r.z-i.z))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),i=this.unprojectPoint(e.max);return r.GeoBox.fromCoordinates(t,i)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}t.identityProjection=new h(1)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(7),n=i(11),s=i(8),o=i(12),a=i(10),l=i(27),c=i(13),h=i(0);function d(e){const t=1/Math.PI,i=Math.floor(2*(e*t+1));return h.Math.clamp(i,0,4)}function u(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}function m(e,t,i){const r=.5*(i+(e.maxAltitude||0)),n=h.Math.degToRad(e.west),s=h.Math.degToRad(e.east),o=d(n),a=d(s);let l=Math.cos(n),c=l,u=Math.sin(n),m=u;for(let e=o+1;e<=a;e++){const t=(e+1&1)*((2&e)-1);l=Math.min(t,l),c=Math.max(t,c);const i=(1&e)*((2&e)-1);u=Math.min(i,u),m=Math.max(i,m)}const p=Math.cos(s);l=Math.min(p,l),c=Math.max(p,c);const f=Math.sin(s);u=Math.min(f,u),m=Math.max(f,m);const g=(c+l)*r,v=(c-l)*r,y=(m+u)*r,_=(m-u)*r,x=h.Math.degToRad(e.south),T=h.Math.degToRad(e.north),S=Math.sin(T),w=Math.sin(x),b=(S+w)*r,M=(S-w)*r;return t.min.x=g-v,t.min.y=y-_,t.min.z=b-M,t.max.x=g+v,t.max.y=y+_,t.max.z=b+M,t}class p extends c.Projection{constructor(){super(...arguments),this.type=c.ProjectionType.Spherical}worldExtent(e,t,i=s.MathUtils.newEmptyBox3()){const r=this.unitScale+t;return i.min.x=-r,i.min.y=-r,i.min.z=-r,i.max.x=r,i.max.y=r,i.max.z=r,i}projectPoint(e,t=s.MathUtils.newVector3(0,0,0)){return function(e,t,i){const r=i+(e.altitude||0),n=h.Math.degToRad(e.latitude),s=h.Math.degToRad(e.longitude),o=Math.cos(n);return t.x=r*o*Math.cos(s),t.y=r*o*Math.sin(s),t.z=r*Math.sin(n),t}(e,t,this.unitScale)}unprojectPoint(e){const t=e.x*e.x+e.y*e.y,i=Math.sqrt(t),n=e.z/i;if(isNaN(n))return r.GeoCoordinates.fromRadians(0,0,-this.unitScale);const s=Math.sqrt(t+e.z*e.z);return r.GeoCoordinates.fromRadians(Math.atan(n),Math.atan2(e.y,e.x),s-this.unitScale)}unprojectAltitude(e){const t=e.x*e.x+e.y*e.y+e.z*e.z;return Math.sqrt(t)-a.EarthConstants.EQUATORIAL_RADIUS}projectBox(e,t=s.MathUtils.newEmptyBox3()){if(n.isBox3Like(t))return m(e,t,this.unitScale);if(o.isOrientedBox3Like(t)){if(e.longitudeSpan>=90){const i=m(e,s.MathUtils.newEmptyBox3(),this.unitScale);return s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,1,0,t.yAxis),s.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(i.max.x+i.min.x),t.position.y=.5*(i.max.y+i.min.y),t.position.z=.5*(i.max.z+i.min.z),t.extents.x=.5*(i.max.x-i.min.x),t.extents.y=.5*(i.max.y-i.min.y),t.extents.z=.5*(i.max.z-i.min.z),t}const{south:i,west:r,north:n,east:o,center:a}=e,l=a.longitude,c=a.latitude,d=Math.cos(h.Math.degToRad(i)),u=Math.sin(h.Math.degToRad(i)),p=Math.cos(h.Math.degToRad(r)),f=Math.sin(h.Math.degToRad(r)),g=Math.cos(h.Math.degToRad(n)),v=Math.sin(h.Math.degToRad(n)),y=Math.cos(h.Math.degToRad(o)),_=Math.sin(h.Math.degToRad(o)),x=Math.cos(h.Math.degToRad(l)),T=Math.sin(h.Math.degToRad(l)),S=Math.cos(h.Math.degToRad(c)),w=Math.sin(h.Math.degToRad(c));let b,M,E;s.MathUtils.newVector3(x*S,T*S,w,t.zAxis),s.MathUtils.newVector3(-T,x,0,t.xAxis),s.MathUtils.newVector3(-x*w,-T*w,S,t.yAxis),i>=0?(b=Math.abs(d*(x*(f-_)+T*(y-p))),M=S*u-w*d,E=S*v-w*g*(x*y+T*_)):(n<=0?(b=Math.abs(g*(x*(f-_)+T*(y-p))),E=S*v-w*g):(b=Math.abs(x*(f-_)+T*(y-p)),E=S*v-w*g*(T*_+x*y)),M=S*u-w*d*(x*y+T*_));const P=.5*(this.unitScale+(e.maxAltitude||0)),C=.5*(this.unitScale+(e.minAltitude||0)),A=S*(x*y+T*_),L=Math.min(g*A+v*w,d*A+u*w);return s.MathUtils.newVector3(b*P,(E-M)*P,P-L*C,t.extents),s.MathUtils.newVector3(0,(M+E)*P,P+P,t.position),function(e,t,i,r){const n=e.x*r.x+t.x*r.y+i.x*r.z,s=e.y*r.x+t.y*r.y+i.y*r.z,o=e.z*r.x+t.z*r.y+i.z*r.z;r.x=n,r.y=s,r.z=o}(t.xAxis,t.yAxis,t.zAxis,t.position),t.position.x=t.position.x-t.zAxis.x*t.extents.z,t.position.y=t.position.y-t.zAxis.y*t.extents.z,t.position.z=t.position.z-t.zAxis.z*t.extents.z,t}throw new Error("Invalid bounding box")}unprojectBox(e){throw new Error("Method not implemented.")}getScaleFactor(e){return 1}groundDistance(e){return u(e)-this.unitScale}scalePointToSurface(e){const t=this.unitScale/(u(e)||1);return e.x*=t,e.y*=t,e.z*=t,e}surfaceNormal(e,t){void 0===t&&(t={x:0,y:0,z:0});const i=1/(u(e)||1);return t.x=e.x*i,t.y=e.y*i,t.z=e.z*i,t}reprojectPoint(e,t,i){if(e===l.mercatorProjection||e===l.webMercatorProjection){const{x:r,y:n,z:s}=t,o=this.unitScale,a=r/o-Math.PI,c=n/o-Math.PI,h=Math.exp(c),d=h*h,u=2*h/(d+1),m=(d-1)/(d+1),p=o+s;return void 0===i&&(i={}),i.x=Math.cos(a)*u*p,i.y=Math.sin(a)*u*p,i.z=m*p,e===l.webMercatorProjection&&(i.z=-i.z),i}return super.reprojectPoint(e,t,i)}localTangentSpace(e,t){const i=h.Math.degToRad(e.latitude),r=h.Math.degToRad(e.longitude),n=Math.cos(r),o=Math.sin(r),a=Math.cos(i),l=Math.sin(i);return s.MathUtils.newVector3(n*a,o*a,l,t.zAxis),s.MathUtils.newVector3(-o,n,0,t.xAxis),s.MathUtils.newVector3(-n*l,-o*l,a,t.yAxis),this.projectPoint(e,t.position),t}}t.sphereProjection=new p(a.EarthConstants.EQUATORIAL_RADIUS)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(29);t.QuadTree=class{constructor(e){this.tilingScheme=e}visit(e){this.visitTileKey(r.TileKey.fromRowColumnLevel(0,0,0),e)}visitTileKey(e,t){if(t(e,this.tilingScheme.getGeoBox(e)))for(const i of this.tilingScheme.getSubTileKeys(e))this.visitTileKey(i,t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(61),n=i(64),s=i(16);t.hereTilingScheme=new s.TilingScheme(n.halfQuadTreeSubdivisionScheme,r.normalizedEquirectangularProjection)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(27),n=i(28),s=i(16);t.webMercatorTilingScheme=new s.TilingScheme(n.quadTreeSubdivisionScheme,r.webMercatorProjection)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(27),n=i(28),s=i(16);t.mercatorTilingScheme=new s.TilingScheme(n.quadTreeSubdivisionScheme,r.mercatorProjection)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(62),n=i(28),s=i(16);t.polarTilingScheme=new s.TilingScheme(n.quadTreeSubdivisionScheme,r.transverseMercatorProjection)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector3Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTransformLike=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);class n{constructor(e,t,i){this.position=new r.Vector3,this.xAxis=new r.Vector3(1,0,0),this.yAxis=new r.Vector3(0,1,0),this.zAxis=new r.Vector3(0,0,1),this.extents=new r.Vector3,void 0!==e&&this.position.copy(e),void 0!==t&&t.extractBasis(this.xAxis,this.yAxis,this.zAxis),void 0!==i&&this.extents.copy(i)}clone(){const e=new n;return e.copy(this),e}copy(e){this.position.copy(e.position),this.xAxis.copy(e.xAxis),this.yAxis.copy(e.yAxis),this.zAxis.copy(e.zAxis),this.extents.copy(e.extents)}getCenter(e=new r.Vector3){return e.copy(this.position)}getSize(e=new r.Vector3){return e.copy(this.extents).multiplyScalar(2)}getRotationMatrix(e=new r.Matrix4){return e.makeBasis(this.xAxis,this.yAxis,this.zAxis)}intersects(e){const t=Array.isArray(e)?e:e.planes;for(const e of t){const t=Math.abs(e.normal.dot(this.xAxis)*this.extents.x)+Math.abs(e.normal.dot(this.yAxis)*this.extents.y)+Math.abs(e.normal.dot(this.zAxis)*this.extents.z);if(e.distanceToPoint(this.position)+t<0)return!1}return!0}contains(e){const t=e.x-this.position.x,i=e.y-this.position.y,r=e.z-this.position.z,n=Math.abs(t*this.xAxis.x+i*this.xAxis.y+r*this.xAxis.z),s=Math.abs(t*this.yAxis.x+i*this.yAxis.y+r*this.yAxis.z),o=Math.abs(t*this.zAxis.x+i*this.zAxis.y+r*this.zAxis.z);return!(n>this.extents.x||s>this.extents.y||o>this.extents.z)}distanceToPoint(e){return Math.sqrt(this.distanceToPointSquared(e))}distanceToPointSquared(e){const t=new r.Vector3;t.subVectors(e,this.position);const i=[t.dot(this.xAxis),t.dot(this.yAxis),t.dot(this.zAxis)];let n=0;for(let e=0;e<3;++e){const t=i[e],r=this.extents.getComponent(e);if(t<-r){const e=r+t;n+=e*e}else if(t>r){const e=t-r;n+=e*e}}return n}}t.OrientedBox3=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(18),s="\nuniform float size;\n\nvoid main() {\n    vec3 transformed = vec3(position);\n    vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.0);\n\n    gl_Position = projectionMatrix * mvPosition;\n    gl_PointSize = size;\n}\n",o="\nuniform vec3 diffuse;\n\nvoid main() {\n    float alpha = 1.0;\n\n    float radius = 0.5;\n    vec2 coords = gl_PointCoord.xy - vec2(0.5);\n    float len = length(coords);\n    float falloff = fwidth(len);\n    float threshold = 1.0 - smoothstep(radius - falloff, radius, len);\n    alpha *= threshold;\n\n    gl_FragColor = vec4(diffuse, alpha);\n}",a=1;class l extends r.ShaderMaterial{constructor(e={}){e.depthTest=!1,super(e),n.enforceBlending(this),this.isCirclePointsMaterial=!0,this.type="CirclePointsMaterial",this.vertexShader=s,this.fragmentShader=o,this.m_size=e.size||a,this.m_color=new r.Color,this.uniforms={diffuse:new r.Uniform(this.m_color),size:new r.Uniform(this.m_size)},this.extensions.derivatives=!0}get size(){return this.m_size}set size(e){this.m_size=e,this.uniforms.size.value=e}get color(){return"#"+this.m_color.getHexString()}set color(e){this.m_color.set(e),this.uniforms.diffuse.value.set(this.m_color)}}t.CirclePointsMaterial=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(40),s=i(18),o="\n#define EDGE_DEPTH_OFFSET 0.0001\n\nattribute vec3 position;\nattribute vec4 color;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 edgeColor;\nuniform float edgeColorMix;\n\n#ifdef USE_DISPLACEMENTMAP\nattribute vec3 normal;\nattribute vec2 uv;\nuniform sampler2D displacementMap;\n#endif\n\nvarying vec3 vColor;\n\n#ifdef USE_EXTRUSION\n#include <extrusion_pars_vertex>\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\nvoid main() {\n\n    #ifdef USE_COLOR\n    vColor = mix(edgeColor.rgb, color.rgb, edgeColorMix);\n    #else\n    vColor = edgeColor.rgb;\n    #endif\n\n    vec3 transformed = vec3( position );\n\n    #ifdef USE_EXTRUSION\n    #include <extrusion_vertex>\n    #endif\n\n    #ifdef USE_DISPLACEMENTMAP\n    transformed += normalize( normal ) * texture2D( displacementMap, uv ).x;\n    #endif\n\n    vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\n\n    gl_Position = projectionMatrix * mvPosition;\n    // After projection gl_Position contains clip space coordinates of each vertex\n    // before perspective division (1 / w), thus only vertexes with -w < z < w should\n    // be displayed and offset. We offset only those edges which z coordinate in NDC\n    // space is between: -inf < z < 1\n    float depthOffset = step(-1.0, -gl_Position.z / gl_Position.w) * EDGE_DEPTH_OFFSET;\n    gl_Position.z -= depthOffset;\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n}",a="\nprecision highp float;\nprecision highp int;\n\nvarying vec3 vColor;\n\n#ifdef USE_EXTRUSION\n#include <extrusion_pars_fragment>\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\nvoid main() {\n    float alphaValue = 1.0;\n    gl_FragColor = vec4(vColor, alphaValue);\n\n    #ifdef USE_EXTRUSION\n    #include <extrusion_fragment>\n    #endif\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}";class l extends r.RawShaderMaterial{constructor(e){const t={},i=void 0!==e&&void 0!==e.displacementMap;i&&(t.USE_DISPLACEMENTMAP=""),super({name:"EdgeMaterial",vertexShader:o,fragmentShader:a,uniforms:{edgeColor:new r.Uniform(new r.Color(l.DEFAULT_COLOR)),edgeColorMix:new r.Uniform(l.DEFAULT_COLOR_MIX),fadeNear:new r.Uniform(n.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new r.Uniform(n.FadingFeature.DEFAULT_FADE_FAR),extrusionRatio:new r.Uniform(n.ExtrusionFeature.DEFAULT_RATIO_MIN),displacementMap:new r.Uniform(i?e.displacementMap:new r.Texture)},depthWrite:!1,defines:t}),s.enforceBlending(this),n.FadingFeature.patchGlobalShaderChunks(),n.ExtrusionFeature.patchGlobalShaderChunks(),void 0!==e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.colorMix&&(this.colorMix=e.colorMix),void 0!==e.fadeNear&&(this.fadeNear=e.fadeNear),void 0!==e.fadeFar&&(this.fadeFar=e.fadeFar),void 0!==e.displacementMap&&(this.displacementMap=e.displacementMap))}get color(){return this.uniforms.edgeColor.value}set color(e){this.uniforms.edgeColor.value=e}get colorMix(){return this.uniforms.edgeColorMix.value}set colorMix(e){if(this.uniforms.edgeColorMix.value===e)return;this.uniforms.edgeColorMix.value=e,e>0?(this.needsUpdate=void 0===this.defines.USE_COLOR,this.defines.USE_COLOR=""):(this.needsUpdate=void 0!==this.defines.USE_COLOR,delete this.defines.USE_COLOR)}get fadeNear(){return this.uniforms.fadeNear.value}set fadeNear(e){this.uniforms.fadeNear.value=e}get fadeFar(){return this.uniforms.fadeFar.value}set fadeFar(e){if(this.uniforms.fadeFar.value===e)return;this.uniforms.fadeFar.value=e,e>0?(this.needsUpdate=void 0===this.defines.USE_FADING,this.defines.USE_FADING=""):(this.needsUpdate=void 0!==this.defines.USE_FADING,delete this.defines.USE_FADING)}get extrusionRatio(){return this.uniforms.extrusionRatio.value}set extrusionRatio(e){if(this.uniforms.extrusionRatio.value===e)return;this.uniforms.extrusionRatio.value=e,e>=n.ExtrusionFeature.DEFAULT_RATIO_MIN?(this.needsUpdate=void 0===this.defines.USE_EXTRUSION,this.defines.USE_EXTRUSION=""):(this.needsUpdate=void 0!==this.defines.USE_EXTRUSION,delete this.defines.USE_EXTRUSION)}get displacementMap(){return this.uniforms.displacementMap.value}set displacementMap(e){this.uniforms.displacementMap.value!==e&&(this.uniforms.displacementMap.value=e,void 0!==e?(this.uniforms.displacementMap.value.needsUpdate=!0,this.needsUpdate=void 0===this.defines.USE_DISPLACEMENTMAP,this.defines.USE_DISPLACEMENTMAP=""):(this.needsUpdate=void 0!==this.defines.USE_DISPLACEMENTMAP,delete this.defines.USE_DISPLACEMENTMAP))}}t.EdgeMaterial=l,l.DEFAULT_COLOR=0,l.DEFAULT_COLOR_MIX=0},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t=new Array){this.priority=e,this.elements=t}clone(){return new r(this.priority,this.elements.slice())}}t.PriorityListGroup=r;t.GroupedPriorityList=class{constructor(){this.groups=new Map}add(e){this.getGroup(e.priority).elements.push(e)}remove(e){const t=this.getGroup(e.priority);if(void 0!==t){const i=t.elements.indexOf(e);if(i>=0){if(t.elements.splice(i,1),0===t.elements.length){const t=Math.floor(e.priority);this.groups.delete(t),this.m_sortedGroups&&(this.m_sortedGroups=[])}return!0}}return!1}clear(){this.groups.clear(),this.m_sortedGroups&&(this.m_sortedGroups=[])}merge(e){for(const t of e.groups){const e=this.findGroup(t[1].priority);void 0!==e?e.elements=e.elements.concat(t[1].elements):(this.groups.set(Math.floor(t[1].priority),t[1].clone()),this.m_sortedGroups&&(this.m_sortedGroups=[]))}return this}get sortedGroups(){if(this.m_sortedGroups&&this.m_sortedGroups.length>0)return this.m_sortedGroups;this.m_sortedGroups||(this.m_sortedGroups=[]);for(const e of this.groups)this.m_sortedGroups.push(e[1]);return this.m_sortedGroups.sort((e,t)=>t.priority-e.priority),this.m_sortedGroups}forEach(e){for(const t of this.groups)t[1].elements.forEach(e)}count(){let e=0;for(const t of this.groups)e+=t[1].elements.length;return e}findGroup(e){const t=Math.floor(e);return this.groups.get(t)}getGroup(e){let t=this.findGroup(e);if(void 0===t){const i=Math.floor(e);t=new r(i),this.groups.set(i,t),this.m_sortedGroups&&(this.m_sortedGroups=[])}return t}}},function(e,t,i){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i(69)),r(i(41)),r(i(70)),r(i(132)),r(i(134)),r(i(71))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(133);t.LoggerManager=class{static get instance(){return this.m_instance||(this.m_instance=new r.LoggerManagerImpl)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(69),n=i(70),s=i(71);t.LoggerManagerImpl=class{constructor(){this.m_loggers=[],this.channel="undefined"==typeof self||void 0!==self.document?new r.ConsoleChannel:new s.WorkerChannel}getLoggerNames(){return this.m_loggers.map(e=>e.name)}getLogger(e){return this.m_loggers.find(t=>t.name===e)}create(e,t={}){void 0!==this.m_levelSetForAll&&(void 0===t.level||t.level<this.m_levelSetForAll)&&(t.level=this.m_levelSetForAll);const i=new n.Logger(e,this.channel,t);return this.m_loggers.push(i),i}dispose(e){const t=this.m_loggers.indexOf(e);if(t<0)throw new Error(`Cannot unregister "${e}" : no such logger registered.`);this.m_loggers.splice(t,1)}updateAll(e){for(const t of this.m_loggers)t.update(e)}update(e,t){for(const i of this.m_loggers)i.name===e&&i.update(t)}enableAll(e){for(const t of this.m_loggers)t.enabled=e}enable(e,t){this.update(e,{enabled:t})}setLogLevelForAll(e){this.m_levelSetForAll=e;for(const t of this.m_loggers)t.level=e}setLogLevel(e,t){this.update(e,{level:t})}setChannel(e){this.channel=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MultiChannel=class{constructor(...e){this.channels=[],this.channels=e}error(e,...t){for(const i of this.channels)i.error(e,...t)}debug(e,...t){for(const i of this.channels)i.debug(e,...t)}info(e,...t){for(const i of this.channels)i.info(e,...t)}log(e,...t){for(const i of this.channels)i.log(e,...t)}trace(e,...t){for(const i of this.channels)i.trace(e,...t)}warn(e,...t){for(const i of this.channels)i.warn(e,...t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,i,r){return(e-i)*(e-i)+(t-r)*(t-r)}e.Box=class{constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.w=i,this.h=r}set(e,t,i,r){this.x=e,this.y=t,this.w=i,this.h=r}contains(e,t){return this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t}intersects(e){return this.x<=e.x+e.w&&this.x+this.w>=e.x&&this.y<=e.y+e.h&&this.y+this.h>=e.y}},e.distSquared=t,e.computeSquaredLineLength=function(e){let t=0;const i=e.length-4;for(let r=0;r<i;r+=3){const i=e[r+3]-e[r],n=e[r+4]-e[r+1];t+=i*i+n*n}return t},e.distToSegmentSquared=function(e,i,r,n,s,o){const a=t(r,n,s,o);if(0===a)return t(e,i,r,n);let l=((e-r)*(s-r)+(i-n)*(o-n))/a;return l=Math.max(0,Math.min(1,l)),t(e,i,r+l*(s-r),n+l*(o-n))}}(t.Math2D||(t.Math2D={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,i){return e<t?t:e>i?i:e}e.clamp=t,e.lerp=function(e,t,i){return e*(1-i)+t*i},e.smoothStep=function(e,i,r){return(r=t((r-e)/(i-e),0,1))*r*(3-2*r)},e.smootherStep=function(e,i,r){return(r=t((r-e)/(i-e),0,1))*r*r*(r*(6*r-15)+10)},e.map=function(e,t,i,r,n){return(e-t)*(n-r)/(i-t)+r},e.min2=function(e,t){let i;return void 0!==e&&(i=e),void 0!==t&&(i=void 0===i?t:Math.min(i,t)),i},e.max2=function(e,t){let i;return void 0!==e&&(i=e),void 0!==t&&(i=void 0===i?t:Math.max(i,t)),i},e.isClamped=function(e,t,i){return!(void 0!==t&&e<t)&&!(void 0!==i&&e>i)},e.easeInOutCubic=function(e,t,i){return e+(t-e)*(i<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1)}}(t.MathUtils||(t.MathUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixins=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(i=>{e.prototype[i]=t.prototype[i]})})},t.applyMixinsWithoutProperties=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(i=>{const r=Object.getOwnPropertyDescriptor(t.prototype,i);void 0!==r&&void 0===r.get&&(e.prototype[i]=t.prototype[i])})})}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=!0;t.assert=function(e,t){if(!r&&!e)throw new Error(void 0!==t?t:"ASSERTION failed")},t.assertExists=function(e,t){if(!r&&null==e)throw new Error(void 0!==t?t:"ASSERTION failed: Element is undefined or null");return e}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContextLogger=class{constructor(e,t){this.m_logger=e,this.headerMessage=t,this.context=[],this.m_headerLogged=!1,this.warn=this.createLogMethod("warn"),this.info=this.createLogMethod("info"),this.error=this.createLogMethod("error")}pushAttr(e){this.context.push(`${this.context.length>0?".":""}${e}`)}pushIndex(e){this.context.push(`[${e}]`)}pop(){this.context.pop()}createLogMethod(e){return(t,...i)=>{this.m_headerLogged||(this.m_logger.info(this.headerMessage),this.m_headerLogged=!0),this.m_logger[e](`${this.context.join("")}: ${t}`,...i)}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static now(){return r.nowFunc()}static getNowFunc(){return"undefined"!=typeof performance&&void 0!==performance.now?()=>performance.now():()=>(new Date).getTime()}}t.PerformanceTimer=r,r.instance=new r,r.nowFunc=r.getNowFunc()},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cloneDeep=function(e){const t=new Map,i=function e(i){if(null===i)return null;if("object"==typeof i){const r=t.get(i);if(void 0!==r)return r;if(Array.isArray(i)){const r=[];t.set(i,r),r.length=i.length;for(let t=0;t<r.length;++t)r[t]=e(i[t]);return r}if(i instanceof Date){const e=new Date(i.getTime());return t.set(i,e),e}if(i instanceof RegExp){const e=new RegExp(i.source,i.flags);return t.set(i,e),e}if(i.constructor!==Object)throw new Error("cloneDeep doesn't support objects with custom prototypes");{const r={};t.set(i,r);for(const t in i)i.hasOwnProperty(t)&&(r[t]=e(i[t]));return r}}return i}(e);return t.clear(),i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOptionValue=function(...e){for(const t of e)if(null!=t)return t},t.mergeWithOptions=function(e,t){const i=Object.assign({},e);if(null==t)return i;for(const r in e)if(e.hasOwnProperty(r)){const e=t[r];null!=e&&(i[r]=e)}return i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(42);t.PrefixMapUriResolver=class{constructor(e){this.definitions=e}resolveUri(e){return Object.keys(this.definitions).reduce((e,t)=>{if(t.endsWith("/")&&e.startsWith(t)){return this.definitions[t]+e.substr(t.length)}return e===t?this.definitions[t]:e},e)}};t.RelativeUriResolver=class{constructor(e){this.parentUri=e}resolveUri(e){return r.resolveReferenceUri(this.parentUri,e)}},t.composeUriResolvers=function(...e){return{resolveUri:t=>e.reduce((e,t)=>void 0!==t?t.resolveUri(e):e,t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(42);t.getAppBaseUrl=function(){return r.baseUrl(window.location.href)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chainCallbacks=function(e,t){return function(...i){return e&&e.apply(this,i),t.apply(this,i)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={extrusion_pars_vertex:"\n// Extrusion axis (xyz: vector, w: factor).\nattribute vec4 extrusionAxis;\nuniform float extrusionRatio;\nvarying vec4 vExtrusionAxis;\n",extrusion_vertex:"\ntransformed = transformed + extrusionAxis.xyz * (extrusionRatio - 1.0);\nvExtrusionAxis = vec4(normalMatrix * extrusionAxis.xyz, extrusionAxis.w);\n",extrusion_normal_fragment_begin:"\n#ifdef FLAT_SHADED\n    // Flattened this divergent path to prevent undefined behaviour in the following derivatives\n    // functions. For more info:\n    // http://www.aclockworkberry.com/shader-derivative-functions/#Derivatives_and_branches\n\n    // Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\n    vec3 fdx = vec3(dFdx(vViewPosition.x), dFdx(vViewPosition.y), dFdx(vViewPosition.z));\n    vec3 fdy = vec3(dFdy(vViewPosition.x), dFdy(vViewPosition.y), dFdy(vViewPosition.z));\n    vec3 normal = cross( fdx, fdy );\n    if (vExtrusionAxis.w > 0.999999) {\n        normal = vExtrusionAxis.xyz;\n    }\n    normal = normalize(normal);\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t\tbitangent = bitangent * (float(gl_FrontFacing) * 2.0 - 1.0);\n\t\t#endif\n\t#endif\n#endif\n// non perturbed normal for clearcoat among others\nvec3 geometryNormal = normal;\n",extrusion_pars_fragment:"\nuniform float extrusionRatio;\nvarying vec4 vExtrusionAxis;\n",extrusion_fragment:"\ngl_FragColor.a *= smoothstep( 0.0, 0.25, extrusionRatio );\n"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={fading_pars_vertex:"\nvarying float fadingDepth;\n",fading_vertex:"\nfadingDepth = -mvPosition.z;\n",fading_pars_fragment:"\nvarying float fadingDepth;\nuniform float fadeNear;\nuniform float fadeFar;\n",fading_fragment:'\n\n// lerp with "hard" edges\n//float fadingFactor = 1.0 - clamp((fadingDepth - fadeNear) / (fadeFar - fadeNear), 0.0, 1.0);\n\n// smooth transitions\nfloat fadingFactor = smoothstep( fadeNear, fadeFar, fadingDepth );\n\ngl_FragColor.a *= 1.0 - fadingFactor;\n\n// debugging color:\n// gl_FragColor = vec4(1., fadingFactor, fadingFactor, 1.0);\n'}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(43),s="\n#ifdef USE_COLOR\nattribute vec4 color;\nvarying vec3 vColor;\n#endif\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 position;        // high part\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n}",o="\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifdef USE_COLOR\nvarying vec3 color;\n#endif\n\nvoid main() {\n    #ifdef USE_COLOR\n    gl_FragColor = vec4( diffuse * vColor, opacity );\n    #else\n    gl_FragColor = vec4( diffuse, opacity );\n    #endif\n}";class a extends r.RawShaderMaterial{constructor(e){Object.assign(r.ShaderChunk,n.default);const t={name:"HighPrecisionLineMaterial",vertexShader:s,fragmentShader:o,uniforms:{diffuse:new r.Uniform(new r.Color(a.DEFAULT_COLOR)),opacity:new r.Uniform(a.DEFAULT_OPACITY),u_mvp:new r.Uniform(new r.Matrix4),u_eyepos:new r.Uniform(new r.Vector3),u_eyepos_lowpart:new r.Uniform(new r.Vector3)}};Object.assign(t,e),super(t),this.type="HighPrecisionLineMaterial",this.isHighPrecisionLineMaterial=!0,void 0!==e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.opacity&&(this.opacity=e.opacity)),this.updateTransparencyFeature()}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}updateTransparencyFeature(){this.transparent=this.opacity<1}}t.HighPrecisionLineMaterial=a,a.DEFAULT_COLOR=80,a.DEFAULT_OPACITY=1},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(43),s="\n#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif\n\nuniform float size;\n\n// uniforms to implement double-precision\nuniform mat4 u_mvp;             // combined modelView and projection matrix\nuniform vec3 u_eyepos;          // eye position major\nuniform vec3 u_eyepos_lowpart;  // eye position minor ((double) eyepos - (float) eyepos)\n\n// vertex attributes\nattribute vec3 positionLow;     // low part\n\n#include <high_precision_vert_func>\n\nvoid main() {\n    #ifdef USE_COLOR\n    vColor = color.rgb;\n    #endif\n\n    vec3 pos = subtractDblEyePos(position);\n    gl_Position = u_mvp * vec4(pos, 1.0);\n\n    // ignore sizeAttenuation for now!\n    gl_PointSize = size;\n}";class o extends r.PointsMaterial{constructor(e){Object.assign(r.ShaderChunk,n.default),super(e),this.type="HighPrecisionPointMaterial",this.vertexShader=s,this.fragmentShader=r.ShaderChunk.points_frag,this.fog=!1,this.uniforms={diffuse:new r.Uniform(new r.Color(o.DEFAULT_COLOR)),opacity:new r.Uniform(o.DEFAULT_OPACITY),size:new r.Uniform(o.DEFAULT_SIZE),scale:new r.Uniform(o.DEFAULT_SCALE),map:new r.Uniform(new r.Texture),uvTransform:new r.Uniform(new r.Matrix3),u_mvp:new r.Uniform(new r.Matrix4),u_eyepos:new r.Uniform(new r.Vector3),u_eyepos_lowpart:new r.Uniform(new r.Vector3)},this.isHighPrecisionPointMaterial=!0,void 0!==e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.opacity&&(this.opacity=e.opacity),void 0!==e.size&&(this.size=e.size),void 0!==e.scale&&(this.scale=e.scale),void 0!==e.uvTransform&&(this.uvTransform=e.uvTransform),void 0!==e.map&&(this.map=e.map))}get scale(){return this.uniforms.scale.value}set scale(e){this.uniforms.scale.value=e}get uvTransform(){return this.uniforms.uvTransform.value}set uvTransform(e){this.uniforms.uvTransform.value=e}}t.HighPrecisionPointMaterial=o,o.DEFAULT_COLOR=80,o.DEFAULT_OPACITY=1,o.DEFAULT_SIZE=1,o.DEFAULT_SCALE=1,t.isHighPrecisionPointMaterial=function(e){return void 0!==e&&!0===e.isHighPrecisionPointMaterial}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n="\nattribute vec4 position;\nattribute vec4 color;\nattribute vec2 uv;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    vColor = color;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n}",s="\nprecision highp float;\nprecision highp int;\n\nuniform sampler2D map;\n\nvarying vec4 vColor;\nvarying vec2 vUv;\n\nvoid main() {\n\n    vec4 color = texture2D(map, vUv.xy);\n    color *= vColor.a;\n    if (color.a < 0.05) {\n        discard;\n    }\n    gl_FragColor = color;\n}";class o extends r.RawShaderMaterial{constructor(e){super({name:"IconMaterial",vertexShader:n,fragmentShader:s,uniforms:{map:new r.Uniform(e.map)},depthTest:!0,depthWrite:!0,transparent:!0,vertexColors:r.VertexColors,premultipliedAlpha:!0,blending:r.NormalBlending})}get map(){return this.uniforms.map.value}}t.IconMaterial=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);t.LuminosityHighPassShader={uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new r.Color(0)},defaultOpacity:{value:0}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    }",fragmentShader:"\n    uniform sampler2D tDiffuse;\n    uniform vec3 defaultColor;\n    uniform float defaultOpacity;\n    uniform float luminosityThreshold;\n    uniform float smoothWidth;\n    varying vec2 vUv;\n    void main() {\n        vec4 texel = texture2D( tDiffuse, vUv );\n        vec3 luma = vec3( 0.299, 0.587, 0.114 );\n        float v = dot( texel.xyz, luma );\n        vec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );\n        float alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );\n        gl_FragColor = mix( outputColor, texel, alpha );\n    }"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(68);class s extends r.ShaderMaterial{constructor(e){super({uniforms:e,vertexShader:n.CopyShader.vertexShader,fragmentShader:n.CopyShader.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:r.AdditiveBlending,depthTest:!1,depthWrite:!1})}}t.MSAAMaterial=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SepiaShader={uniforms:{tDiffuse:{value:null},amount:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform float amount;\n        uniform sampler2D tDiffuse;\n        varying vec2 vUv;\n        void main() {\n            vec4 color = texture2D( tDiffuse, vUv );\n            vec3 c = color.rgb;\n            color.r = dot( c, vec3( 1.0 - 0.607 * amount, 0.769 * amount, 0.189 * amount ) );\n            color.g = dot( c, vec3( 0.349 * amount, 1.0 - 0.314 * amount, 0.168 * amount ) );\n            color.b = dot( c, vec3( 0.272 * amount, 0.534 * amount, 1.0 - 0.869 * amount ) );\n            gl_FragColor = vec4( min( vec3( 1.0 ), color.rgb ), color.a );\n        }"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(40),s=i(43),o=i(18);t.LineCapsDefinitions={Square:"CAPS_SQUARE",Round:"CAPS_ROUND",None:"CAPS_NONE",TriangleIn:"CAPS_TRIANGLE_IN",TriangleOut:"CAPS_TRIANGLE_OUT"};const a="\n#define SEGMENT_OFFSET 0.1\n\nattribute vec3 extrusionCoord;\nattribute vec3 position;\nattribute vec4 bitangent;\nattribute vec3 tangent;\nattribute vec2 uv;\nattribute vec3 normal;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float lineWidth;\nuniform float outlineWidth;\nuniform vec2 drawRange;\n\n#ifdef USE_DISPLACEMENTMAP\nuniform sampler2D displacementMap;\n#endif\n\nvarying vec3 vPosition;\nvarying vec3 vRange;\nvarying vec4 vCoords;\n#if USE_COLOR\nattribute vec3 color;\nvarying vec3 vColor;\n#endif\n\n#ifdef USE_FADING\n#include <fading_pars_vertex>\n#endif\n\n#include <fog_pars_vertex>\n\n#include <extrude_line_vert_func>\n\nvoid main() {\n    // Calculate the segment.\n    vec2 segment = abs(extrusionCoord.xy) - SEGMENT_OFFSET;\n    float segmentPos = sign(extrusionCoord.x) / 2.0 + 0.5;\n\n    // Calculate the vertex position inside the line (segment) and extrusion direction and factor.\n    float linePos = mix(segment.x, segment.y, segmentPos);\n    vec2 extrusionDir = sign(extrusionCoord.xy);\n    float extrusionFactor = extrusionDir.y * tan(bitangent.w / 2.0);\n\n    // Calculate the extruded vertex position (and scale the extrusion direction).\n    vec3 pos = extrudeLine(\n        position, linePos, lineWidth + outlineWidth, bitangent, tangent, extrusionDir);\n\n    // Store the normalized extrusion coordinates in vCoords (with their ranges in vRange).\n    vRange = vec3(extrusionCoord.z, lineWidth, extrusionFactor);\n    vCoords = vec4(extrusionDir / vRange.xy, segment / vRange.x);\n\n    // Adjust the segment to fit the drawRange.\n    float capDist = (lineWidth + outlineWidth) / extrusionCoord.z;\n    if ((vCoords.w + capDist) < drawRange.x || (vCoords.z - capDist) > drawRange.y) {\n        vCoords.zw += 1.0;\n    }\n    if (vCoords.z < drawRange.x) {\n        vCoords.zw += vec2(drawRange.x - vCoords.z, 0.0);\n    }\n    if (vCoords.w > drawRange.y) {\n        vCoords.zw -= vec2(0.0, vCoords.w - drawRange.y);\n    }\n\n    // Transform position.\n    #ifdef USE_DISPLACEMENTMAP\n    pos += normalize( normal ) * texture2D( displacementMap, uv ).x;\n    #endif\n    vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\n    gl_Position = projectionMatrix * mvPosition;\n\n    // Pass extruded position to fragment shader.\n    vPosition = pos;\n\n    #if USE_COLOR\n    // Pass vertex color to fragment shader.\n    vColor = color;\n    #endif\n\n    #ifdef USE_FADING\n    #include <fading_vertex>\n    #endif\n\n    #include <fog_vertex>\n}",l="\nprecision highp float;\nprecision highp int;\n\nuniform vec3 diffuse;\nuniform vec3 outlineColor;\nuniform float opacity;\nuniform float lineWidth;\nuniform float outlineWidth;\nuniform vec2 tileSize;\nuniform vec2 drawRange;\n\n#if DASHED_LINE\nuniform float dashSize;\nuniform float gapSize;\nuniform vec3 dashColor;\n#endif\n\nvarying vec3 vPosition;\nvarying vec3 vRange;\nvarying vec4 vCoords;\n#if USE_COLOR\nvarying vec3 vColor;\n#endif\n\n#include <round_edges_and_add_caps>\n#include <tile_clip_func>\n\n#ifdef USE_FADING\n#include <fading_pars_fragment>\n#endif\n\n#include <fog_pars_fragment>\n\nvoid main() {\n    float alpha = opacity;\n    vec3 outputDiffuse = diffuse;\n\n    #if TILE_CLIP\n    tileClip(vPosition.xy, tileSize);\n    #endif\n\n    // Calculate distance to center (0.0: lineCenter, 1.0: lineEdge).\n    float distToCenter = roundEdgesAndAddCaps(vCoords, vRange);\n    // Calculate distance to edge (-1.0: lineCenter, 0.0: lineEdge).\n    float distToEdge = distToCenter - (lineWidth + outlineWidth) / lineWidth;\n\n    // Decrease the line opacity by the distToEdge, making the transition steeper when the slope\n    // of distToChange increases (i.e. the line is further away).\n    float width = fwidth(distToEdge);\n    alpha *= (1.0 - smoothstep(-width, width, distToEdge));\n\n    #if DASHED_LINE\n    // Compute the distance to the dash origin (0.0: dashOrigin, 1.0: dashEnd, (d+g)/d: gapEnd).\n    float d = dashSize / vRange.x;\n    float g = gapSize / vRange.x;\n    float distToDashOrigin = mod(vCoords.x, d + g) / d;\n\n    // Compute distance to dash edge (0.5: dashCenter, 0.0: dashEdge) and compute the\n    // dashBlendFactor similarly on how we did it for the line opacity.\n    float distToDashEdge = 0.5 - distance(distToDashOrigin, (d + g) / d * 0.5);\n    float dashWidth = fwidth(distToDashEdge);\n    float dashBlendFactor = 1.0 - smoothstep(-dashWidth, dashWidth, distToDashEdge);\n\n    #if USE_DASH_COLOR\n    outputDiffuse = mix(diffuse, dashColor, dashBlendFactor);\n    #endif\n    #endif\n\n    #ifdef USE_OUTLINE\n    // Calculate distance to outline (0.0: lineEdge, outlineWidth/lineWidth: outlineEdge) and\n    // compute the outlineBlendFactor (used to mix line and outline colors).\n    float distToOutline = distToCenter - 1.0;\n    float outlineWidth = fwidth(distToOutline);\n    float outlineBlendFactor = smoothstep(-outlineWidth, outlineWidth, distToOutline);\n\n    // Mix the colors using the different computed factors.\n    #if DASHED_LINE && USE_DASH_COLOR == 0\n    float colorBlendFactor = smoothstep(-1.0, 1.0, dashBlendFactor - outlineBlendFactor);\n    outputDiffuse = mix(\n      mix(\n        mix(outlineColor, diffuse, colorBlendFactor),\n        outputDiffuse,\n        dashBlendFactor\n      ),\n      outlineColor,\n      outlineBlendFactor\n    );\n    #else\n    outputDiffuse = mix(outputDiffuse, outlineColor, outlineBlendFactor);\n    #endif\n    #endif\n\n    // Multiply the alpha by the dashBlendFactor.\n    #if DASHED_LINE && defined(USE_OUTLINE) && USE_DASH_COLOR == 0\n    alpha *= clamp(dashBlendFactor + outlineBlendFactor, 0.0, 1.0);\n    #elif DASHED_LINE && USE_DASH_COLOR == 0\n    alpha *= 1.0 - dashBlendFactor;\n    #endif\n\n    #if USE_COLOR\n    gl_FragColor = vec4( outputDiffuse * vColor, alpha );\n    #else\n    gl_FragColor = vec4( outputDiffuse, alpha );\n    #endif\n\n    #include <fog_fragment>\n\n    #ifdef USE_FADING\n    #include <fading_fragment>\n    #endif\n}";class c extends r.RawShaderMaterial{constructor(e){Object.assign(r.ShaderChunk,s.default),n.FadingFeature.patchGlobalShaderChunks();const t={DASHED_LINE:0,TILE_CLIP:0,USE_COLOR:0,USE_DASH_COLOR:0,CAPS_SQUARE:0,CAPS_ROUND:1,CAPS_NONE:0,CAPS_TRIANGLE_IN:0,CAPS_TRIANGLE_OUT:0},i=void 0!==e&&!0===e.fog;i&&(t.USE_FOG="");const h=void 0!==e&&void 0!==e.displacementMap;h&&(t.USE_DISPLACEMENTMAP=""),void 0!==e&&void 0!==e.outlineWidth&&e.outlineWidth>0&&(t.USE_OUTLINE=""),super({name:"SolidLineMaterial",vertexShader:a,fragmentShader:l,uniforms:r.UniformsUtils.merge([{diffuse:new r.Uniform(new r.Color(c.DEFAULT_COLOR)),dashColor:new r.Uniform(new r.Color(c.DEFAULT_COLOR)),outlineColor:new r.Uniform(new r.Color(c.DEFAULT_COLOR)),lineWidth:new r.Uniform(c.DEFAULT_WIDTH),outlineWidth:new r.Uniform(c.DEFAULT_OUTLINE_WIDTH),opacity:new r.Uniform(c.DEFAULT_OPACITY),tileSize:new r.Uniform(new r.Vector2),fadeNear:new r.Uniform(n.FadingFeature.DEFAULT_FADE_NEAR),fadeFar:new r.Uniform(n.FadingFeature.DEFAULT_FADE_FAR),displacementMap:new r.Uniform(h?e.displacementMap:new r.Texture),drawRange:new r.Uniform(new r.Vector2(c.DEFAULT_DRAW_RANGE_START,c.DEFAULT_DRAW_RANGE_END)),dashSize:new r.Uniform(c.DEFAULT_DASH_SIZE),gapSize:new r.Uniform(c.DEFAULT_GAP_SIZE)},r.UniformsLib.fog]),defines:t,fog:!0}),o.enforceBlending(this),this.extensions.derivatives=!0,void 0!==e&&(void 0!==e.color&&this.color.set(e.color),void 0!==e.outlineColor&&this.outlineColor.set(e.outlineColor),void 0!==e.lineWidth&&(this.lineWidth=e.lineWidth),void 0!==e.outlineWidth&&(this.outlineWidth=e.outlineWidth),void 0!==e.opacity&&(this.opacity=e.opacity),void 0!==e.depthTest&&(this.depthTest=e.depthTest),void 0!==e.depthWrite&&(this.depthWrite=e.depthWrite),void 0!==e.fadeNear&&(this.fadeNear=e.fadeNear),void 0!==e.fadeFar&&(this.fadeFar=e.fadeFar),void 0!==e.displacementMap&&(this.displacementMap=e.displacementMap),void 0!==e.caps&&(this.caps=e.caps),void 0!==e.drawRangeStart&&(this.drawRangeStart=e.drawRangeStart),void 0!==e.drawRangeEnd&&(this.drawRangeEnd=e.drawRangeEnd),void 0!==e.dashColor&&(this.dashColor.set(e.dashColor),this.defines.USE_DASH_COLOR=1),void 0!==e.dashSize&&(this.dashSize=e.dashSize),void 0!==e.gapSize&&(this.gapSize=e.gapSize),this.fog=i)}updateFog(e){e?(this.needsUpdate=void 0===this.defines.USE_FOG,this.defines.USE_FOG=""):(this.needsUpdate=void 0!==this.defines.USE_FOG,delete this.defines.USE_FOG)}updateOutline(e){e?this.defines.USE_OUTLINE="":delete this.defines.USE_OUTLINE}get opacity(){return this.uniforms.opacity.value}set opacity(e){void 0!==this.uniforms&&(this.uniforms.opacity.value=e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get outlineColor(){return this.uniforms.outlineColor.value}set outlineColor(e){this.uniforms.outlineColor.value=e}get dashColor(){return this.uniforms.dashColor.value}set dashColor(e){this.uniforms.dashColor.value=e,this.defines.USE_DASH_COLOR=1}get lineWidth(){return this.uniforms.lineWidth.value}set lineWidth(e){this.uniforms.lineWidth.value=e}get outlineWidth(){return this.uniforms.outlineWidth.value}set outlineWidth(e){this.uniforms.outlineWidth.value=e,this.updateOutline(e>0)}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e,this.defines.DASHED_LINE=this.gapSize>0?1:0}get caps(){let e="Round";return 1===this.defines.CAPS_SQUARE?e="Square":1===this.defines.CAPS_NONE?e="None":1===this.defines.CAPS_ROUND?e="Round":1===this.defines.CAPS_TRIANGLE_IN?e="TriangleIn":1===this.defines.CAPS_TRIANGLE_OUT&&(e="TriangleOut"),e}set caps(e){this.defines.CAPS_SQUARE=0,this.defines.CAPS_ROUND=0,this.defines.CAPS_NONE=0,this.defines.CAPS_TRIANGLE_IN=0,this.defines.CAPS_TRIANGLE_OUT=0,this.defines[t.LineCapsDefinitions[e]]=1}get fadeNear(){return this.uniforms.fadeNear.value}set fadeNear(e){this.uniforms.fadeNear.value=e}get fadeFar(){return this.uniforms.fadeFar.value}set fadeFar(e){const t=this.uniforms.fadeFar.value;this.uniforms.fadeFar.value=e,void 0!==t&&t>0?this.defines.USE_FADING="":delete this.defines.USE_FADING}get displacementMap(){return this.uniforms.displacementMap.value}set displacementMap(e){this.uniforms.displacementMap.value=e,void 0!==e?(this.uniforms.displacementMap.value.needsUpdate=!0,this.defines.USE_DISPLACEMENTMAP=""):delete this.defines.USE_DISPLACEMENTMAP,this.needsUpdate=!0}get drawRangeStart(){return this.uniforms.drawRange.value.x}set drawRangeStart(e){this.uniforms.drawRange.value.x=e}get drawRangeEnd(){return this.uniforms.drawRange.value.y}set drawRangeEnd(e){this.uniforms.drawRange.value.y=e}}t.SolidLineMaterial=c,c.DEFAULT_COLOR=16711680,c.DEFAULT_WIDTH=1,c.DEFAULT_OUTLINE_WIDTH=0,c.DEFAULT_OPACITY=1,c.DEFAULT_DRAW_RANGE_START=0,c.DEFAULT_DRAW_RANGE_END=1,c.DEFAULT_DASH_SIZE=1,c.DEFAULT_GAP_SIZE=1},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VignetteShader={uniforms:{tDiffuse:{value:null},offset:{value:1},darkness:{value:1}},vertexShader:"\n        varying vec2 vUv;\n        void main() {\n            vUv = uv;\n            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n        }",fragmentShader:"\n        uniform float offset;\n        uniform float darkness;\n        uniform sampler2D tDiffuse;\n        varying vec2 vUv;\n        void main() {\n            vec4 texel = texture2D( tDiffuse, vUv );\n            vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );\n            gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );\n        }"}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(5),n=i(157),s=i(158),o=i(159),a=i(160),l=i(161),c=i(162),h=i(163),d=i(165),u=i(166),m=i(167),p=i(168),f=i(169),g=i(170),v=new Map;t.ExprEvaluatorContext=class{constructor(e,t,i,r){this.evaluator=e,this.env=t,this.scope=i,this.cache=r,this.m_partialEvaluation=!1}get partialEvaluation(){return this.m_partialEvaluation}evaluate(e){if(void 0!==e)return e.accept(this.evaluator,this);throw new Error("Failed to evaluate expression")}partiallyEvaluate(e){if(void 0===e)throw new Error("Failed to evaluate expression");const t=this.m_partialEvaluation;this.m_partialEvaluation=!0;try{const i=e.accept(this.evaluator,this);return this.m_partialEvaluation=t,i instanceof r.Expr?i:r.LiteralExpr.fromValue(i)}catch(e){throw e}finally{this.m_partialEvaluation=t}}};class y{static defineOperator(e,t){v.set(e,t)}static defineOperators(e){Object.getOwnPropertyNames(e).forEach(t=>{this.defineOperator(t,e[t])})}static getOperator(e){return v.get(e)}visitVarExpr(e,t){const i=t.env.lookup(e.name);return void 0!==i?i:null}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value}visitHasAttributeExpr(e,t){return void 0!==t.env.lookup(e.name)}visitContainsExpr(e,t){const i=e.value.accept(this,t),r=e.elements.includes(i);return void 0!==t.cache&&t.cache.set(e,r),r}visitMatchExpr(e,t){const i=t.evaluate(e.value);for(const[r,n]of e.branches){if(Array.isArray(r)&&r.includes(i))return t.evaluate(n);if(r===i)return t.evaluate(n)}return t.evaluate(e.fallback)}visitCaseExpr(e,t){for(const[i,r]of e.branches)if(t.evaluate(i))return t.evaluate(r);return t.evaluate(e.fallback)}visitCallExpr(e,t){if(void 0!==t.cache){const i=t.cache.get(e);if(void 0!==i)return i}const i=e.descriptor||v.get(e.op);if(i){e.descriptor=i;const r=i.call(t,e);return t.cache&&t.cache.set(e,r),r}throw new Error(`undefined operator '${e.op}`)}}t.ExprEvaluator=y,y.defineOperators(s.CastOperators),y.defineOperators(a.ComparisonOperators),y.defineOperators(u.MathOperators),y.defineOperators(f.StringOperators),y.defineOperators(o.ColorOperators),y.defineOperators(g.TypeOperators),y.defineOperators(m.MiscOperators),y.defineOperators(c.FlowOperators),y.defineOperators(n.ArrayOperators),y.defineOperators(h.InterpolationOperators),y.defineOperators(p.ObjectOperators),y.defineOperators(l.FeatureOperators),y.defineOperators(d.MapOperators)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r={at:{call:(e,t)=>{const i=t.args,r=e.evaluate(i[0]);if("number"!=typeof r)throw new Error("expected the index of the element to retrieve");const n=e.evaluate(i[1]);if(!Array.isArray(n))throw new Error("expected an array");return r>=0&&r<n.length?n[r]:null}}};t.ArrayOperators=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r={"to-boolean":{call:(e,t)=>Boolean(e.evaluate(t.args[0]))},"to-string":{call:(e,t)=>String(e.evaluate(t.args[0]))},"to-number":{call:(e,t)=>{for(const i of t.args){const t=Number(e.evaluate(i));if(!isNaN(t))return t}throw new Error("cannot convert the value to a number")}}};t.CastOperators=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(19),s={rgba:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]),a=e.evaluate(t.args[3]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&"number"==typeof a&&i>=0&&s>=0&&o>=0&&a>=0&&a<=1)return function(e,t,i,s){return n.ColorUtils.getHexFromRgba(r.Math.clamp(e,0,255)/255,r.Math.clamp(t,0,255)/255,r.Math.clamp(i,0,255)/255,r.Math.clamp(s,0,1))}(i,s,o,a);throw new Error(`unknown color 'rgba(${i},${s},${o},${a})'`)}},rgb:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&i>=0&&s>=0&&o>=0)return function(e,t,i){return n.ColorUtils.getHexFromRgb(r.Math.clamp(e,0,255)/255,r.Math.clamp(t,0,255)/255,r.Math.clamp(i,0,255)/255)}(i,s,o);throw new Error(`unknown color 'rgb(${i},${s},${o})'`)}},hsl:{call:(e,t)=>{const i=e.evaluate(t.args[0]),s=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if("number"==typeof i&&"number"==typeof s&&"number"==typeof o&&i>=0&&s>=0&&o>=0)return function(e,t,i){return n.ColorUtils.getHexFromHsl(r.Math.euclideanModulo(e,360)/360,r.Math.clamp(t,0,100)/100,r.Math.clamp(i,0,100)/100)}(i,s,o);throw new Error(`unknown color 'hsl(${i},${s}%,${o}%)'`)}}};t.ColorOperators=s},function(e,t,i){"use strict";function r(e,t,i=!1){const r=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if(!("number"==typeof r&&"number"==typeof n||"string"==typeof r&&"string"==typeof n)&&i)throw new Error(`invalid operands '${r}' and '${n}' for operator '${t.op}'`);switch(t.op){case"<":return r<n;case">":return r>n;case"<=":return r<=n;case">=":return r>=n;default:throw new Error(`invalid comparison operator '${t.op}'`)}}Object.defineProperty(t,"__esModule",{value:!0});const n={"!":{call:(e,t)=>!e.evaluate(t.args[0])},"==":{call:(e,t)=>{return e.evaluate(t.args[0])===e.evaluate(t.args[1])}},"!=":{call:(e,t)=>{return e.evaluate(t.args[0])!==e.evaluate(t.args[1])}},"<":{call:(e,t)=>r(e,t)},">":{call:(e,t)=>r(e,t)},"<=":{call:(e,t)=>r(e,t)},">=":{call:(e,t)=>r(e,t)}};t.ComparisonOperators=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FeatureOperators={"geometry-type":{call:(e,t)=>{switch(e.env.lookup("$geometryType")){case"point":return"Point";case"line":return"LineString";case"polygon":return"Polygon";default:return null}}}}},function(e,t,i){"use strict";function r(e,t,i){switch(t){case"boolean":case"number":case"string":for(const r of i){const i=e.evaluate(r);if(typeof i===t)return i}throw new Error(`expected a '${t}'`);default:throw new Error(`invalid type '${t}'`)}}Object.defineProperty(t,"__esModule",{value:!0});const n={all:{call:(e,t)=>{for(const i of t.args)if(!e.evaluate(i))return!1;return!0}},any:{call:(e,t)=>{for(const i of t.args)if(e.evaluate(i))return!0;return!1}},none:{call:(e,t)=>{for(const i of t.args)if(e.evaluate(i))return!1;return!0}},boolean:{call:(e,t)=>r(e,"boolean",t.args)},number:{call:(e,t)=>r(e,"number",t.args)},string:{call:(e,t)=>r(e,"string",t.args)}};t.FlowOperators=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(5),n=i(20);const s={interpolate:{isDynamicOperator:e=>e.args[1]&&e.args[1].isDynamic(),call:(e,t)=>{if(function(e){if(e._interpolatedProperty||void 0!==e._mode)return;const t=e.args[0];if(!(t instanceof r.CallExpr))throw new Error("expected an interpolation type");let i,s;if("linear"===t.op)i="Linear";else if("discrete"===t.op)i="Discrete";else if("cubic"===t.op)i="Cubic";else{if("exponential"!==t.op)throw new Error("unrecognized interpolation type");{i="Exponential";const e=t.args[0];if(!(e instanceof r.NumberLiteralExpr))throw new Error("expected the base of the exponential interpolation");s=e.value}}const o=e.args[1];if(!(o instanceof r.CallExpr))throw new Error("expected the input of the interpolation");if("zoom"!==o.op)throw new Error("only 'zoom' is supported");if(2===e.args.length||e.args.length%2)throw new Error("invalid number of samples");const a=[],l=[];let c=!0;for(let t=2;t<e.args.length;t+=2){const i=e.args[t];if(!(i instanceof r.NumberLiteralExpr))throw new Error("expected a numeric literal");if(a.push(i.value),c){const i=e.args[t+1];i instanceof r.LiteralExpr?l.push(i.value):c=!1}}if(c){const t=n.createInterpolatedProperty({interpolation:i,exponent:s,zoomLevels:a,values:l});if(!t)throw new Error("failed to create interpolation");e._interpolatedProperty=t}else e._mode=i,e._exponent=s,e._stops=a}(t),e.scope!==r.ExprScope.Dynamic)return t;let i=t._interpolatedProperty;if(!i){const r=[];for(let i=2;i<t.args.length;i+=2){const n=e.evaluate(t.args[i+1]);r.push(n)}if(i=n.createInterpolatedProperty({interpolation:t._mode,exponent:t._exponent,zoomLevels:t._stops,values:r}),void 0===i)throw new Error("failed to create interpolator")}return n.getPropertyValue(i,e.env)}},step:{isDynamicOperator:e=>e.args[0]&&e.args[0].isDynamic(),call:(e,t)=>{if(function(e){if(void 0!==e._inputIsZoom)return;if(void 0===e.args[0])throw new Error("expected the input of the 'step' operator");if(e.args.length<3||e.args.length%2)throw new Error("not enough arguments");const t=e.args[0];t instanceof r.CallExpr&&"zoom"===t.op?e._inputIsZoom=!0:e._inputIsZoom=!1;for(let t=2;t<e.args.length;t+=2){if(!(e.args[t]instanceof r.NumberLiteralExpr))throw new Error("expected a numeric literal")}}(t),e.scope===r.ExprScope.Value)return t;if(e.scope===r.ExprScope.Condition||!1===t._inputIsZoom)return function(e,t){const{args:i}=t,n=e.evaluate(i[0]);if(null===n)return e.evaluate(i[1]);if("number"!=typeof n)throw new Error("the input of a 'step' operator must have type 'number'");let s=1,o=i.length/2-1;for(;s<o;){const e=s+o>>>1,t=i[2*e].value;n<t?o=e-1:n>t?s=e+1:o=e}const a=i[2*s];if(!(a instanceof r.NumberLiteralExpr))throw new Error("expected a numeric literal");const l=a.value<=n?s:s-1;return e.evaluate(i[2*l+1])}(e,t);!function(e){if(e._stops||e._interpolatedProperty)return;const t=[Number.MIN_SAFE_INTEGER];for(let i=2;i<e.args.length;i+=2){const r=e.args[i];t.push(r.value)}const i=[];let s=!0;for(let t=1;s&&t<e.args.length;t+=2){const n=e.args[t];n instanceof r.LiteralExpr?i.push(n.value):s=!1}if(s){const r=n.createInterpolatedProperty({interpolation:"Discrete",zoomLevels:t,values:i});if(void 0===r)throw new Error("failed to create interpolator");e._interpolatedProperty=r}else e._stops=t}(t);let i=t._interpolatedProperty;if(!i){const r=[];for(let i=1;i<t.args.length;i+=2){const n=e.evaluate(t.args[i]);r.push(n)}if(i=n.createInterpolatedProperty({interpolation:"Discrete",zoomLevels:t._stops,values:r}),void 0===i)throw new Error("failed to create interpolator")}return n.getPropertyValue(i,e.env)}}};t.InterpolationOperators=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);class n extends r.Interpolant{constructor(){super(...arguments),this.exponent=2}interpolate_(e,t,i,r){const n=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=Math.pow((i-t)/(r-t),this.exponent),h=1-c;for(let e=0;e!==o;++e)n[e]=s[l+e]*h+s[a+e]*c;return n}}t.ExponentialInterpolant=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(5),n={ppi:{call:e=>{const t=e.env.lookup("$ppi");return"number"==typeof t?t:72}},zoom:{isDynamicOperator:()=>!0,call:e=>{if(e.scope===r.ExprScope.Condition){const t=e.env.lookup("$zoom");if(void 0!==t)return t;throw new Error("failed to get the zoom level.")}throw new Error("invalid usage of the 'zoom' operator.")}}};t.MapOperators=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n={"^":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof r)throw new Error(`invalid operands '${typeof i}' and '${typeof r}' for operator '^'`);return Math.pow(i,r)}},"-":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof r)throw new Error(`invalid operands '${typeof i}' and '${typeof r}' for operator '-'`);return i-r}},"/":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof r)throw new Error(`invalid operands '${typeof i}' and '${typeof r}' for operator '/'`);return i/r}},"%":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);if("number"!=typeof i||"number"!=typeof r)throw new Error(`invalid operands '${typeof i}' and '${typeof r}' for operator '%'`);return i%r}},"+":{call:(e,t)=>t.args.reduce((t,i)=>Number(t)+Number(e.evaluate(i)),0)},"*":{call:(e,t)=>t.args.reduce((t,i)=>Number(t)*Number(e.evaluate(i)),1)},abs:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'abs'`);return Math.abs(i)}},acos:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'acos'`);return Math.acos(i)}},asin:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'asin'`);return Math.asin(i)}},atan:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'atan'`);return Math.atan(i)}},ceil:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ceil'`);return Math.ceil(i)}},cos:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'cos'`);return Math.cos(i)}},e:{call:()=>Math.E},floor:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'floor'`);return Math.floor(i)}},ln:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ln'`);return Math.log(i)}},ln2:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'ln2'`);return Math.log2(i)}},log10:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'log10'`);return Math.log10(i)}},max:{call:(e,t)=>Math.max(...t.args.map(t=>Number(e.evaluate(t))))},min:{call:(e,t)=>Math.min(...t.args.map(t=>Number(e.evaluate(t))))},clamp:{call:(e,t)=>{const i=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]);if("number"!=typeof i||"number"!=typeof n||"number"!=typeof s)throw new Error(`invalid operands '${i}', ${n}, ${s} for operator 'clamp'`);return r.Math.clamp(i,n,s)}},pi:{call:()=>Math.PI},round:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'round'`);return Math.round(i)}},sin:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'sin'`);return Math.sin(i)}},sqrt:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'sqrt'`);return Math.sqrt(i)}},tan:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if("number"!=typeof i)throw new Error(`invalid operand '${i}' for operator 'tan'`);return Math.tan(i)}}};t.MathOperators=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r={length:{call:(e,t)=>{const i=e.evaluate(t.args[0]);if(Array.isArray(i)||"string"==typeof i)return i.length;throw new Error(`invalid operand '${i}' for operator 'length'`)}},coalesce:{call:(e,t)=>{for(const i of t.args){const t=e.evaluate(i);if(null!==t)return t}return null}}};t.MiscOperators=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=Object.prototype.hasOwnProperty;var n;function s(e,t,i){const s=e.evaluate(t[0]);if("string"!=typeof s)throw new Error("expected the name of an attribute");const o=e.evaluate(t[1]);return o&&"object"==typeof o&&r.call(o,s)?i!==n.get||o[s]:i===n.get&&null}!function(e){e[e.get=0]="get",e[e.has=1]="has"}(n||(n={}));const o={get:{call:(e,t)=>s(e,t.args,n.get)},has:{call:(e,t)=>s(e,t.args,n.has)}};t.ObjectOperators=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r={concat:{call:(e,t)=>"".concat(...t.args.map(t=>String(e.evaluate(t))))},downcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleLowerCase()},upcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleUpperCase()},"~=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof r&&-1!==i.indexOf(r)}},"^=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof r&&i.startsWith(r)}},"$=":{call:(e,t)=>{const i=e.evaluate(t.args[0]),r=e.evaluate(t.args[1]);return"string"==typeof i&&"string"==typeof r&&i.endsWith(r)}}};t.StringOperators=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TypeOperators={typeof:{call:(e,t)=>typeof e.evaluate(t.args[0])}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(5);t.ExprInstantiator=class{visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const i=t.env.lookup(e.name);return r.LiteralExpr.fromValue(void 0!==i?i:null)}visitHasAttributeExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const i=void 0!==t.env.lookup(e.name);return r.LiteralExpr.fromValue(i)}visitContainsExpr(e,t){const i=e.value.accept(this,t);if(i instanceof r.LiteralExpr){const t=e.elements.includes(i.value);return r.LiteralExpr.fromValue(t)}return i===e.value?e:new r.ContainsExpr(i,e.elements)}visitCallExpr(e,t){const i=e.args.map(e=>e.accept(this,t));return i.some((t,i)=>t!==e.args[i])?new r.CallExpr(e.op,i):e}visitMatchExpr(e,t){const i=e.value.accept(this,t);if(i instanceof r.LiteralExpr){const r=i.value;for(const[i,n]of e.branches){if(Array.isArray(i)&&i.includes(r))return n.accept(this,t);if(i===r)return n.accept(this,t)}return e.fallback.accept(this,t)}let n=e.value!==i;const s=e.branches.map(([e,i])=>{const r=i.accept(this,t);return r!==i&&(n=!0),[e,r]}),o=e.fallback.accept(this,t);return o!==e.fallback&&(n=!0),n?new r.MatchExpr(i,s,o):e}visitCaseExpr(e,t){const i=[];let n=!1;for(const[s,o]of e.branches){const e=s.accept(this,t);if(e instanceof r.LiteralExpr){if(e.value)return o.accept(this,t)}else e!==s&&(n=!0),i.push([e,o])}if(0===i.length)return e.fallback.accept(this,t);i.length!==e.branches.length&&(n=!0),i.forEach(e=>{const i=e[1].accept(this,t);i!==e[1]&&(n=!0),e[1]=i});const s=e.fallback.accept(this,t);return s!==e.fallback&&(n=!0),n?new r.CaseExpr(i,s):e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(5);var n,s;function o(e){switch(e){case n.Tab:case n.Lf:case n.Cr:case n.Space:return!0;default:return!1}}function a(e){return e>=n._0&&e<=n._9}function l(e){return e>=n.a&&e<=n.z||e>=n.A&&e<=n.Z}function c(e){return function(e){return l(e)||a(e)}(e)||e===n._||e===n.Dollar||e===n.Dot||e===n.LBracket||e===n.RBracket}function h(e){switch(e){case s.Eof:return"eof";case s.Error:return"error";case s.Identifier:return"identifier";case s.Number:return"number";case s.String:return"string";case s.Comma:return",";case s.LParen:return"(";case s.RParen:return")";case s.LBracket:return"[";case s.RBracket:return"]";case s.Exclaim:return"!";case s.TildeEqual:return"~=";case s.CaretEqual:return"^=";case s.DollarEqual:return"$=";case s.EqualEqual:return"==";case s.ExclaimEqual:return"!=";case s.Less:return"<";case s.Greater:return">";case s.LessEqual:return"<=";case s.GreaterEqual:return">=";case s.BarBar:return"||";case s.AmpAmp:return"&&";default:throw new Error(`invalid token ${e}`)}}!function(e){e[e.Tab=9]="Tab",e[e.Lf=10]="Lf",e[e.Cr=13]="Cr",e[e.Space=32]="Space",e[e.LParen=40]="LParen",e[e.RParen=41]="RParen",e[e.Comma=44]="Comma",e[e.Dot=46]="Dot",e[e.LBracket=91]="LBracket",e[e.Backslash=92]="Backslash",e[e.RBracket=93]="RBracket",e[e._0=48]="_0",e[e._9=57]="_9",e[e._=95]="_",e[e.A=64]="A",e[e.Z=90]="Z",e[e.a=97]="a",e[e.z=122]="z",e[e.DoubleQuote=34]="DoubleQuote",e[e.SingleQuote=39]="SingleQuote",e[e.Exclaim=33]="Exclaim",e[e.Equal=61]="Equal",e[e.Caret=94]="Caret",e[e.Tilde=126]="Tilde",e[e.Dollar=36]="Dollar",e[e.Less=60]="Less",e[e.Greater=62]="Greater",e[e.Bar=124]="Bar",e[e.Amp=38]="Amp"}(n||(n={})),function(e){e[e.Eof=0]="Eof",e[e.Error=1]="Error",e[e.Identifier=2]="Identifier",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Comma=5]="Comma",e[e.LParen=6]="LParen",e[e.RParen=7]="RParen",e[e.LBracket=8]="LBracket",e[e.RBracket=9]="RBracket",e[e.Exclaim=10]="Exclaim",e[e.TildeEqual=11]="TildeEqual",e[e.CaretEqual=12]="CaretEqual",e[e.DollarEqual=13]="DollarEqual",e[e.EqualEqual=14]="EqualEqual",e[e.ExclaimEqual=15]="ExclaimEqual",e[e.Less=16]="Less",e[e.Greater=17]="Greater",e[e.LessEqual=18]="LessEqual",e[e.GreaterEqual=19]="GreaterEqual",e[e.BarBar=20]="BarBar",e[e.AmpAmp=21]="AmpAmp"}(s||(s={}));class d{constructor(e){this.code=e,this.m_token=s.Error,this.m_index=0,this.m_char=n.Lf}token(){return this.m_token}text(){return this.m_text||""}next(){if(this.m_token=this.yylex(),this.m_token===s.Error)throw new Error(`unexpected character ${this.m_char}`);return this.m_token}yyinp(){this.m_char=this.code.codePointAt(this.m_index++)||0}yylex(){for(this.m_text=void 0;o(this.m_char);)this.yyinp();if(0===this.m_char)return s.Eof;const e=this.m_char;switch(this.yyinp(),e){case n.LParen:return s.LParen;case n.RParen:return s.RParen;case n.LBracket:return s.LBracket;case n.RBracket:return s.RBracket;case n.Comma:return s.Comma;case n.SingleQuote:case n.DoubleQuote:{const t=this.m_index-1;for(;this.m_char&&this.m_char!==e;)this.yyinp();if(this.m_char!==e)throw new Error("Unfinished string literal");return this.yyinp(),this.m_text=this.code.substring(t,this.m_index-2),s.String}case n.Exclaim:return this.m_char===n.Equal?(this.yyinp(),s.ExclaimEqual):s.Exclaim;case n.Caret:return this.m_char===n.Equal?(this.yyinp(),s.CaretEqual):s.Error;case n.Tilde:return this.m_char===n.Equal?(this.yyinp(),s.TildeEqual):s.Error;case n.Equal:return this.m_char===n.Equal?(this.yyinp(),s.EqualEqual):s.Error;case n.Less:return this.m_char===n.Equal?(this.yyinp(),s.LessEqual):s.Less;case n.Greater:return this.m_char===n.Equal?(this.yyinp(),s.GreaterEqual):s.Greater;case n.Bar:return this.m_char===n.Bar?(this.yyinp(),s.BarBar):s.Error;case n.Amp:return this.m_char===n.Amp?(this.yyinp(),s.AmpAmp):s.Error;default:{const t=this.m_index-2;if(l(e)||e===n._||e===n.Dollar&&c(this.m_char)){for(;c(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),s.Identifier}if(a(e)){for(;a(this.m_char);)this.yyinp();if(this.m_char===n.Dot)for(this.yyinp();a(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),s.Number}if(e===n.Dollar)return this.m_char===n.Equal?(this.yyinp(),s.DollarEqual):s.Error}}return s.Error}}function u(e){switch(e){case s.TildeEqual:return"~=";case s.CaretEqual:return"^=";case s.DollarEqual:return"$=";case s.EqualEqual:return"==";case s.ExclaimEqual:return"!=";default:return}}function m(e){switch(e){case s.Less:return"<";case s.Greater:return">";case s.LessEqual:return"<=";case s.GreaterEqual:return">=";default:return}}t.ExprParser=class{constructor(e){this.lex=new d(e),this.lex.next()}parse(){return this.parseLogicalOr()}yyexpect(e){if(this.lex.token()!==e)throw new Error(`Syntax error: Expected token '${h(e)}' but `+`found '${h(this.lex.token())}'`);this.lex.next()}parsePrimary(){switch(this.lex.token()){case s.Identifier:{const e=this.lex.text();switch(e){case"has":this.lex.next(),this.yyexpect(s.LParen);const t=this.lex.text();return this.yyexpect(s.Identifier),this.yyexpect(s.RParen),new r.HasAttributeExpr(t);case"length":this.lex.next(),this.yyexpect(s.LParen);const i=this.parseLogicalOr();return this.yyexpect(s.RParen),new r.CallExpr("length",[i]);default:const n=new r.VarExpr(e);return this.lex.next(),n}}case s.LParen:{this.lex.next();const e=this.parseLogicalOr();return this.yyexpect(s.RParen),e}default:return this.parseLiteral()}}parseLiteral(){switch(this.lex.token()){case s.Number:{const e=new r.NumberLiteralExpr(parseFloat(this.lex.text()));return this.lex.next(),e}case s.String:{const e=new r.StringLiteralExpr(this.lex.text());return this.lex.next(),e}default:throw new Error("Syntax error")}}parseUnary(){return this.lex.token()===s.Exclaim?(this.lex.next(),new r.CallExpr("!",[this.parseUnary()])):this.parsePrimary()}parseRelational(){let e=this.parseUnary();for(;;)if(this.lex.token()===s.Identifier&&"in"===this.lex.text()){this.lex.next(),this.yyexpect(s.LBracket);const t=[this.parseLiteral()];for(;this.lex.token()===s.Comma;)this.lex.next(),t.push(this.parseLiteral());this.yyexpect(s.RBracket),e=new r.ContainsExpr(e,t.map(e=>e.value))}else{const t=m(this.lex.token());if(void 0===t)break;this.lex.next();const i=this.parseUnary();e=new r.CallExpr(t,[e,i])}return e}parseEquality(){let e=this.parseRelational();for(;;){const t=u(this.lex.token());if(void 0===t)break;this.lex.next();const i=this.parseRelational();e=new r.CallExpr(t,[e,i])}return e}parseLogicalAnd(){const e=this.parseEquality();if(this.lex.token()!==s.AmpAmp)return e;const t=[e];do{this.lex.next(),t.push(this.parseEquality())}while(this.lex.token()===s.AmpAmp);return new r.CallExpr("all",t)}parseLogicalOr(){const e=this.parseLogicalAnd();if(this.lex.token()!==s.BarBar)return e;const t=[e];do{this.lex.next(),t.push(this.parseLogicalAnd())}while(this.lex.token()===s.BarBar);return new r.CallExpr("any",t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t,i;e.WORKER_SERVICE_MANAGER_SERVICE_ID="worker-service-manager",function(e){e.Initialized="initialized",e.Request="request",e.Response="response"}(t=e.ServiceMessageName||(e.ServiceMessageName={})),e.isInitializedMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Initialized},function(e){e.CreateService="create-service",e.DestroyService="destroy-service"}(i=e.Requests||(e.Requests={})),e.isUnknownServiceError=function(e){return/unknown targetServiceType requested: /.test(e.message)},e.isRequestMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Request},e.isResponseMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Response}}(t.WorkerServiceProtocol||(t.WorkerServiceProtocol={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t;!function(e){e.RegisterIndex="register-index",e.UpdateIndex="update-index",e.TileRequest="tile-request"}(t=e.Requests||(e.Requests={})),e.isRegisterIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.RegisterIndex},e.isUpdateIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.UpdateIndex},e.isTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.TileRequest}}(t.WorkerTilerProtocol||(t.WorkerTilerProtocol={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RequestController=class{constructor(e=0,t=new AbortController){this.priority=e,this.abortController=t}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}},function(e){let t,i;!function(e){e.Configuration="configuration"}(t=e.DecoderMessageName||(e.DecoderMessageName={})),e.isConfigurationMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Configuration},function(e){e.DecodeTileRequest="decode-tile-request",e.TileInfoRequest="tile-info-request"}(i=e.Requests||(e.Requests={})),e.isDecodeTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.DecodeTileRequest},e.isTileInfoRequest=function(e){return e&&"string"==typeof e.type&&e.type===i.TileInfoRequest}}(t.WorkerDecoderProtocol||(t.WorkerDecoderProtocol={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(5),s=i(77),o=i(178),a=i(44);var l;!function(e){e[e.Point=0]="Point",e[e.Line=1]="Line",e[e.Polygon=2]="Polygon"}(l=t.FeatureGroupType||(t.FeatureGroupType={}));const c=100;class h{constructor(e,t=5e3){this.featureIds=new Array,this.numFeatures=0,this.numPositions=0,this.featureIds=new Array(t),this.featureIds.length=t,this.techniqueIndex=new Array(t),this.techniqueIndex.length=t,this.textIndex=new Array(t),this.textIndex.length=t,this.positionIndex=new Array(t),this.positionIndex.length=t,this.positions=new Array(10*t),this.positions.length=10*t,e&&(this.layerIndex=new Array(t),this.layerIndex.length=t,this.classIndex=new Array(t),this.classIndex.length=t,this.typeIndex=new Array(t),this.typeIndex.length=t)}getNumBytes(){return 8*(this.featureIds.length+this.techniqueIndex.length+this.textIndex.length+this.positionIndex.length+this.positions.length+(void 0!==this.layerIndex?this.layerIndex.length:0)+(void 0!==this.classIndex?this.classIndex.length:0)+(void 0!==this.typeIndex?this.typeIndex.length:0))}}t.FeatureGroup=h;class d extends h{constructor(){super(...arguments),this.userData=[]}getNumBytes(){return super.getNumBytes()+8*((void 0!==this.segmentIds?this.segmentIds.length:0)+(void 0!==this.segmentStartOffsets?this.segmentStartOffsets.length:0)+(void 0!==this.segmentEndOffsets?this.segmentEndOffsets.length:0))}}t.LineFeatureGroup=d;class u extends h{constructor(e,t=5e3){super(e,t),this.groupNumRings=0,this.outerRingStartIndex=new Array(t),this.outerRingStartIndex.length=t,this.innerRingIsOuterContour=new Array(t),this.innerRingIsOuterContour.length=t,this.innerRingStartIndex=new Array(t),this.innerRingStartIndex.length=t}getNumBytes(){return super.getNumBytes()+8*((void 0!==this.outerRingStartIndex?this.outerRingStartIndex.length:0)+(void 0!==this.innerRingIsOuterContour?this.innerRingIsOuterContour.length:0)+(void 0!==this.innerRingStartIndex?this.innerRingStartIndex.length:0))}}t.PolygonFeatureGroup=u;class m{constructor(e,t){this.tileKey=e,this.textCatalog=new Array,this.techniqueCatalog=new Array,this.setupTime=0,this.numBytes=0,this.pointGroup=new h(t),this.lineGroup=new d(t),this.polygonGroup=new u(t),t&&(this.layerCatalog=new Array,this.classCatalog=new Array,this.typeCatalog=new Array)}getNumBytes(){let e=c;for(const t of this.textCatalog)e+=2*t.length;if(e+=this.techniqueCatalog.length*c,e+=this.pointGroup.getNumBytes(),e+=this.lineGroup.getNumBytes(),e+=this.polygonGroup.getNumBytes(),void 0!==this.layerCatalog){for(const t of this.layerCatalog)e+=2*t.length;for(const t of this.classCatalog)e+=2*t.length;for(const t of this.typeCatalog)e+=2*t.length}return e}}t.ExtendedTileInfo=m,function(e){function t(e){e.featureIds.length=e.numFeatures,e.techniqueIndex.length=e.numFeatures,e.textIndex.length=e.numFeatures,e.positionIndex.length=e.numFeatures,e.positions.length=e.numPositions,void 0!==e.layerIndex&&(e.layerIndex.length=e.numFeatures),void 0!==e.classIndex&&(e.classIndex.length=e.numFeatures),void 0!==e.typeIndex&&(e.typeIndex.length=e.numFeatures)}function i(e){return e.numPositions===e.positions.length}function r(e,t,i,r){let n;if(t){const t=e.lookup("name:short");if("string"==typeof t&&t.length>0)return t}if(i){const t=e.lookup("iso_code");if("string"==typeof t&&t.length>0)return t}if(void 0!==r)for(const t of r)if(n=e.lookup(`name:${t}`)||e.lookup(`name_${t}`),"string"==typeof n&&n.length>0)return n;if(n=e.lookup("name"),"string"==typeof n)return n}e.finish=function(e){var i,r;t(e.pointGroup),t(i=e.lineGroup),void 0!==i.segmentIds&&(i.segmentIds.length=i.numFeatures,i.segmentStartOffsets.length=i.numFeatures,i.segmentEndOffsets.length=i.numFeatures),t(r=e.polygonGroup),r.outerRingStartIndex.length=r.numFeatures,r.innerRingIsOuterContour.length=r.groupNumRings,r.innerRingStartIndex.length=r.groupNumRings,e.numBytes=e.getNumBytes()},e.featureGroupSize=function(e){return e.numFeatures},e.featureGroupFinished=i,e.tileInfoFinished=function(e){return i(e.pointGroup)&&i(e.lineGroup)&&i(e.polygonGroup)},e.getFeatureName=r,e.getFeatureText=function(e,t,i){let s,l;const c=e instanceof n.Env?e:e.env;if(a.isTextTechnique(t)||a.isPoiTechnique(t)||a.isLineMarkerTechnique(t)){if(void 0!==t.text)return o.evaluateTechniqueAttr(e,t.text);if(void 0!==t.label){const e=c.lookup(t.label);return"string"==typeof e?e:void 0}s=t.useAbbreviation,l=t.useIsoCode}return r(c,s,l,i)}}(m=t.ExtendedTileInfo||(t.ExtendedTileInfo={}));t.ExtendedTileInfoWriter=class{constructor(e,t){this.tileInfo=e,this.storeExtendedTags=t,this.techniqueIndexMap=new Map,this.stringMap=new Map,this.layerMap=new Map,this.classMap=new Map,this.typeMap=new Map}addTechnique(e){let t=this.techniqueIndexMap.get(e._index);if(void 0!==t)return t;const i=s.makeDecodedTechnique(e);return t=this.tileInfo.techniqueCatalog.length,this.techniqueIndexMap.set(i._index,t),this.tileInfo.techniqueCatalog.push(i),t}addFeature(e,t,i,n,s,o){let a=-1;switch(void 0!==n&&n.length>0&&(a=this.addText(n)),e.featureIds[e.numFeatures]=i,e.techniqueIndex[e.numFeatures]=s,e.textIndex[e.numFeatures]=a,e.positionIndex[e.numFeatures]=e.numPositions,o){case l.Polygon:const i=e;r.assert(void 0!==i.outerRingStartIndex),r.assert(void 0!==i.innerRingStartIndex),r.assert(void 0!==i.innerRingIsOuterContour),i.outerRingStartIndex[e.numFeatures]=i.groupNumRings;break;case l.Line:e.userData[e.numFeatures]=t.entries}this.storeExtendedTags&&(e.layerIndex[e.numFeatures]=this.addLayer(t.lookup("$layer")),e.classIndex[e.numFeatures]=this.addClass(t.lookup("class")),e.typeIndex[e.numFeatures]=this.addType(t.lookup("type"))),e.numFeatures++}addFeaturePoint(e,t,i){e.positions[e.numPositions++]=t,e.positions[e.numPositions++]=i}addFeaturePoints(e,t){const i=e.numPositions,r=t.length,n=e.positions;for(let e=0;e<r;e++)n[i+e]=t[e];e.numPositions+=t.length}addRoadSegments(e,t,i,r){void 0===e.segmentIds&&(e.segmentIds=new Array,e.segmentStartOffsets=new Array,e.segmentEndOffsets=new Array),e.segmentIds[e.numFeatures-1]=t,e.segmentStartOffsets[e.numFeatures-1]=i,e.segmentEndOffsets[e.numFeatures-1]=r}addRingPoints(e,t,i){e.innerRingStartIndex[e.groupNumRings]=e.numPositions,e.innerRingIsOuterContour[e.groupNumRings]=i?1:0,e.groupNumRings++;const r=e.numPositions,n=t.length,s=e.positions;for(let e=0;e<n;e++)s[r+e]=t[e];e.numPositions+=t.length}finish(){m.finish(this.tileInfo)}addText(e){return this.addStringValue(e,this.tileInfo.textCatalog,this.stringMap)}addLayer(e){return this.addStringValue(e,this.tileInfo.layerCatalog,this.layerMap)}addClass(e){return this.addStringValue(e,this.tileInfo.classCatalog,this.classMap)}addType(e){return this.addStringValue(e,this.tileInfo.typeCatalog,this.typeMap)}addStringValue(e,t,i){if(null==e)return-1;const r=e.toString();let n=i.get(r);return void 0!==n?n:(n=t.length,t.push(r),i.set(r,n),n)}};class p{constructor(e){this.tileInfo=e}visitAll(e){this.visitAllPointFeatures(e),this.visitAllLineFeatures(e),this.visitAllPolygonFeatures(e)}visitFeature(e,t){let i=0;const r=this.tileInfo.pointGroup.numFeatures,n=this.tileInfo.pointGroup.featureIds;for(let s=0;s<r;s++)n[s]===e&&(i++,this.visitPointFeature(s,t));const s=this.tileInfo.lineGroup.numFeatures,o=this.tileInfo.lineGroup.featureIds;for(let r=0;r<s;r++)o[r]===e&&(i++,this.visitLineFeature(r,t));const a=this.tileInfo.polygonGroup.numFeatures,l=this.tileInfo.polygonGroup.featureIds;for(let r=0;r<a;r++)l[r]===e&&(i++,this.visitPolygonFeature(r,t));return i}visitAllPointFeatures(e){const t=this.tileInfo.pointGroup.numFeatures;for(let i=0;i<t;i++)this.visitPointFeature(i,e)}visitAllLineFeatures(e){const t=this.tileInfo.lineGroup.numFeatures;for(let i=0;i<t;i++)this.visitLineFeature(i,e)}visitAllPolygonFeatures(e){const t=this.tileInfo.polygonGroup.numFeatures;for(let i=0;i<t;i++)this.visitPolygonFeature(i,e)}getTag(e,t){return void 0!==t&&t[e]>=0?t[e]:-1}visitPointFeature(e,t){const i=this.tileInfo.pointGroup,r=i.positionIndex[e],n=i.positions[r],s=i.positions[r+1];t.acceptPoint&&t.acceptPoint(i.featureIds[e],i.techniqueIndex[e],n,s,i.textIndex[e],this.getTag(e,i.layerIndex),this.getTag(e,i.classIndex),this.getTag(e,i.typeIndex))}visitLineFeature(e,t){const i=this.tileInfo,r=i.lineGroup,n=r.numFeatures,s=r.positionIndex[e],o=e===n-1?r.positions.length-s:r.positionIndex[e+1]-s;let a,l,c;void 0!==r.segmentIds&&(a=r.segmentIds[e],l=r.segmentStartOffsets[e],c=r.segmentEndOffsets[e]),t.acceptLine&&t.acceptLine(r.featureIds[e],r.techniqueIndex[e],r.textIndex[e],this.getTag(e,r.layerIndex),this.getTag(e,r.classIndex),this.getTag(e,r.typeIndex),i.lineGroup.positions,s,o,a,l,c)}visitPolygonFeature(e,t){if(void 0===t.acceptPolygon)return;const i=this.tileInfo.polygonGroup,r=i.numFeatures,n=i.outerRingStartIndex[e],s=e===r-1?i.innerRingStartIndex.length-n:i.outerRingStartIndex[e+1]-n;p.polygonAccessor.setup(i,e,n,s),t.acceptPolygon(i.featureIds[e],i.techniqueIndex[e],i.textIndex[e],this.getTag(e,i.layerIndex),this.getTag(e,i.classIndex),this.getTag(e,i.typeIndex),p.polygonAccessor),p.polygonAccessor.reset()}}t.ExtendedTileInfoVisitor=p,p.polygonAccessor=new class{constructor(){this.featureIndex=0,this.ringStart=0,this.numRings=0}setup(e,t,i,r){this.polygons=e,this.featureIndex=t,this.ringStart=i,this.numRings=r}reset(){this.polygons=void 0,this.featureIndex=0,this.ringStart=0,this.numRings=0}isOuterRing(e){if(r.assert(e>=0),r.assert(e<this.numRings),r.assert(void 0!==this.polygons),e<0||e>=this.numRings||void 0===this.polygons)throw new Error("ExtendedTileInfoPolygonAccessor: Invalid ring index");return 0!==this.polygons.innerRingIsOuterContour[this.ringStart+e]}getPoints(e){if(r.assert(e>=0),r.assert(e<this.numRings),r.assert(void 0!==this.polygons),e<0||e>=this.numRings||void 0===this.polygons)throw new Error("ExtendedTileInfoPolygonAccessor: Invalid ring index");const t=this.polygons.innerRingStartIndex[this.ringStart+e];let i;return i=e<this.numRings-1?this.polygons.innerRingStartIndex[this.ringStart+e+1]-t:this.ringStart+e<this.polygons.innerRingStartIndex.length-1?this.polygons.innerRingStartIndex[this.ringStart+e+1]-t:this.polygons.positions.length-t,{points:this.polygons.positions,pointsStart:t,numPointValues:i}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(5);t.ExprPool=class{constructor(){this.m_booleanLiterals=new Map,this.m_numberLiterals=new Map,this.m_stringLiterals=new Map,this.m_objectLiterals=new Map,this.m_varExprs=new Map,this.m_hasAttributeExprs=new Map,this.m_inExprs=new Map,this.m_callExprs=new Map}add(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return r.NullLiteralExpr.instance}visitBooleanLiteralExpr(e,t){const i=this.m_booleanLiterals.get(e.value);return i||(this.m_booleanLiterals.set(e.value,e),e)}visitNumberLiteralExpr(e,t){const i=this.m_numberLiterals.get(e.value);return i||(this.m_numberLiterals.set(e.value,e),e)}visitStringLiteralExpr(e,t){const i=this.m_stringLiterals.get(e.value);return i||(this.m_stringLiterals.set(e.value,e),e)}visitObjectLiteralExpr(e,t){const i=this.m_objectLiterals.get(e.value);return i||(this.m_objectLiterals.set(e.value,e),e)}visitVarExpr(e,t){const i=this.m_varExprs.get(e.name);return i||(this.m_varExprs.set(e.name,e),e)}visitHasAttributeExpr(e,t){const i=this.m_hasAttributeExprs.get(e.name);return i||(this.m_hasAttributeExprs.set(e.name,e),e)}visitContainsExpr(e,t){const i=e.value.accept(this,t);this.m_inExprs.has(i)||this.m_inExprs.set(i,[]);const n=this.m_inExprs.get(i);for(const t of n){if(t.elements.length!==e.elements.length)continue;if(-1===t.elements.findIndex(t=>!e.elements.includes(t)))return t}const s=new r.ContainsExpr(i,e.elements);return this.m_inExprs.set(i,[s]),s}visitMatchExpr(e,t){const i=e.value.accept(this,t),n=e.branches.map(([e,i])=>[e,i.accept(this,t)]),s=e.fallback.accept(this,t);return new r.MatchExpr(i,n,s)}visitCaseExpr(e,t){const i=e.branches.map(([e,i])=>[e.accept(this,t),i.accept(this,t)]),n=e.fallback.accept(this,t);return new r.CaseExpr(i,n)}visitCallExpr(e,t){const i=e.args.map(e=>e.accept(this,t));this.m_callExprs.has(e.op)||this.m_callExprs.set(e.op,[]);const n=this.m_callExprs.get(e.op);for(const e of n){if(e.args.length!==i.length)continue;let t=0;for(;t<e.args.length&&e.args[t]===i[t];++t);if(t===e.args.length)return e}const s=new r.CallExpr(e.op,i);return n.push(s),s}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(5),s=i(20),o=r.LoggerManager.instance.create("TechniqueAttr");t.evaluateTechniqueAttr=function(e,t,i){const r=e instanceof n.Env?e:e.env;let a;if(n.Expr.isExpr(t))try{a=t.evaluate(r,n.ExprScope.Dynamic,e instanceof n.Env?void 0:e.cachedExprResults)}catch(e){o.error(`failed to evaluate expression '${JSON.stringify(t)}': ${e}`),a=void 0}else if(s.isInterpolatedProperty(t)){const i=e instanceof n.Env?e.lookup("$zoom"):e.zoomLevel;a=s.getPropertyValue(t,i)}else a=t;return null==a?i:a}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(5);t.ThemeVisitor=class{constructor(e){this.theme=e}visitStyles(e){const t=t=>!r.isJsonExpr(t)&&!!e(t);if(void 0!==this.theme.styles)for(const e in this.theme.styles)if(void 0!==this.theme.styles[e])for(const i of this.theme.styles[e])if(t(i))return!0;return!1}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(3),n=i(45),s=i(33),o=i(38);class a extends n.DataSource{constructor(){super("background"),this.m_tilingScheme=a.DEFAULT_TILING_SCHEME,this.cacheable=!0}updateStorageLevelOffset(){let e;this.mapView.dataSources.forEach(t=>{if(t===this)return;t.getTilingScheme()===this.m_tilingScheme&&(e=void 0===e?t.storageLevelOffset:Math.max(e,t.storageLevelOffset))}),void 0===e&&(e=0),e!==this.storageLevelOffset&&(this.storageLevelOffset=e,this.mapView.clearTileCache(this.name))}setTheme(e,t){this.mapView.clearTileCache(this.name)}setTilingScheme(e){const t=e||a.DEFAULT_TILING_SCHEME;t!==this.m_tilingScheme&&(this.m_tilingScheme=t,this.updateStorageLevelOffset(),this.mapView.clearTileCache(this.name))}getTilingScheme(){return this.m_tilingScheme}getTile(e){const t=new o.Tile(this,e);return t.forceHasGeometry(!0),t.removeDecodedTile(),s.TileGeometryCreator.instance.addGroundPlane(t,Number.MIN_SAFE_INTEGER),t}}t.BackgroundDataSource=a,a.DEFAULT_TILING_SCHEME=r.webMercatorTilingScheme},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(3),n=i(0),s=i(182),o=[new n.Vector3,new n.Vector3,new n.Vector3];class a extends s.SubdivisionModifier{constructor(e,t=r.sphereProjection){super(),this.angle=e,this.projection=t}shouldSplitTriangle(e,t,i){const n=r.sphereProjection.reprojectPoint(this.projection,e,o[0]),s=r.sphereProjection.reprojectPoint(this.projection,t,o[1]),a=r.sphereProjection.reprojectPoint(this.projection,i,o[2]),l=n.angleTo(s),c=s.angleTo(a),h=a.angleTo(n),d=Math.max(l,Math.max(c,h));if(!(d<this.angle)){if(d===l)return 0;if(d===c)return 1;if(d===h)return 2;throw new Error("failed to split triangle")}}}t.SphericalGeometrySubdivisionModifier=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=new r.Vector3,s=new r.Vector3,o=new r.Vector3;t.SubdivisionModifier=class{constructor(){}modify(e){const t=e.getAttribute("position"),i=Array.from(t.array),r=e.getAttribute("uv"),a=void 0!==r?Array.from(r.array):void 0,l=e.getAttribute("edge"),c=void 0!==l?Array.from(l.array):void 0,h=e.getAttribute("wall"),d=void 0!==h?Array.from(h.array):void 0,u=e.getIndex(),m=Array.from(u.array),p=new Map;function f(e,t){const r=`${Math.min(e,t)}_${Math.max(e,t)}`,l=p.get(r);if(void 0!==l)return l;n.set(i[3*e],i[3*e+1],i[3*e+2]),s.set(i[3*t],i[3*t+1],i[3*t+2]),o.lerpVectors(n,s,.5);const h=i.length/3;return i.push(...o.toArray()),p.set(r,h),void 0!==a&&(n.set(a[2*e],a[2*e+1],0),s.set(a[2*t],a[2*t+1],0),o.lerpVectors(n,s,.5),a.push(o.x,o.y)),void 0!==c&&(c[e]===t?(c.push(t),c[e]=h):c[t]===e?(c.push(e),c[t]=h):c.push(-1)),void 0!==d&&(d[e]===t?(d.push(t),d[e]=h):d[t]===e?(d.push(e),d[t]=h):d.push(-1)),h}const g=[];for(;m.length>=3;){const e=m.shift(),t=m.shift(),r=m.shift();switch(n.set(i[3*e],i[3*e+1],i[3*e+2]),s.set(i[3*t],i[3*t+1],i[3*t+2]),o.set(i[3*r],i[3*r+1],i[3*r+2]),this.shouldSplitTriangle(n,s,o)){case 0:{const i=f(e,t);m.push(e,i,r,i,t,r);break}case 1:{const i=f(t,r);m.push(e,t,i,e,i,r);break}case 2:{const i=f(r,e);m.push(e,t,i,i,t,r);break}case void 0:g.push(e,t,r);break;default:throw new Error("failed to subdivide the given geometry")}}return t.array=new Float32Array(i),t.count=i.length/t.itemSize,t.needsUpdate=!0,e.setIndex(g),void 0!==a&&(r.array=new Float32Array(a),r.count=a.length/r.itemSize,r.needsUpdate=!0),void 0!==c&&(l.array=new Float32Array(c),l.count=c.length/l.itemSize,l.needsUpdate=!0),e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(46),s=i(184),o=i(14),a="_Assets/",l="_BoldAssets/",c="_ItalicAssets/",h="_BoldItalicAssets/",d="_Assets/Extra/";class u{constructor(e,t,i,r,n,o,a,l,c,h,d){this.url=e,this.name=t,this.type=i,this.size=r,this.maxWidth=n,this.maxHeight=o,this.distanceRange=a,this.fonts=l,this.unicodeBlocks=c,this.maxCodePointCount=h,this.m_replacementGlyph=d,this.m_glyphTextureCache=new s.GlyphTextureCache(h,this.maxWidth+1,this.maxHeight+1),this.m_loadingJson=new Map,this.m_loadingPages=new Map,this.m_loadingGlyphs=new Map,this.m_loadedJson=new Map,this.m_loadedPages=new Map,this.m_loadedGlyphs=new Map}static async load(e,t){const i=new URL(e,window.location.href),s=await u.loadJSON(i.href),o=new URL(`${s.name}${d}`,i),a=await u.loadJSON(o.href+"Specials.json"),l=await u.loadTexture(o.href+"Specials.png");l.wrapS=r.ClampToEdgeWrapping,l.wrapT=r.ClampToEdgeWrapping,l.minFilter=r.NearestFilter,l.needsUpdate=!0;const c=s.fonts.find(e=>"Extra"===e.name),h=new n.GlyphData(65533,"Specials",a.chars[0].width,a.chars[0].height,a.chars[0].xadvance,a.chars[0].xoffset,a.chars[0].yoffset,0,0,1,1,l,c);return new u(i.href.substr(0,i.href.lastIndexOf("/")),s.name,s.type,s.size,s.maxWidth,s.maxHeight,s.distanceRange,s.fonts,s.supportedBlocks,t,h)}static async loadTexture(e){return new Promise(t=>{(new r.TextureLoader).load(e,t)})}static async loadJSON(e){const t=await fetch(e);if(!t.ok)throw new Error(`${e} Status Text:  ${t.statusText}`);const i=await t.text();return JSON.parse(i)}dispose(){this.fonts.length=0,this.unicodeBlocks.length=0,this.m_glyphTextureCache.dispose(),this.m_loadingJson.clear(),this.m_loadingPages.clear(),this.m_loadingGlyphs.clear(),this.m_loadedJson.clear(),this.m_loadedPages.clear(),this.m_loadedGlyphs.clear()}clear(){this.m_glyphTextureCache.clear(),this.m_loadingJson.clear(),this.m_loadingPages.clear(),this.m_loadingGlyphs.clear(),this.m_loadedJson.clear(),this.m_loadedPages.clear(),this.m_loadedGlyphs.clear()}update(e){this.m_glyphTextureCache.update(e)}get texture(){return this.m_glyphTextureCache.texture}get textureSize(){return this.m_glyphTextureCache.textureSize}get isLoading(){return this.m_loadingJson.size>0||this.m_loadingPages.size>0||this.m_loadingGlyphs.size>0}async loadBlock(e,t,i,r){const n=this.getAssetsPath(i,t),s=`${n}/${e.name.replace(/ /g,"_")}.json`;let o=this.m_loadedJson.get(s);if(void 0===o){let e=this.m_loadingJson.get(s);if(void 0===e)try{e=u.loadJSON(s),this.m_loadingJson.set(s,e),o=await e,this.m_loadingJson.delete(s),this.m_loadedJson.set(s,o)}catch(e){console.error(e),this.m_loadingJson.delete(s)}else o=await e}const a=[];if(!0===r)for(const e of o.pages)a.push(this.loadPage(`${n}/${e}`));return await Promise.all(a),o}removeBlock(e,t,i){const r=this.getAssetsPath(i,t),n=`${r}/${e.name.replace(/ /g,"_")}.json`,s=this.m_loadedJson.get(n);if(void 0!==s){for(const e of s.pages){const t=`${r}/${e}`;this.m_loadingPages.delete(t),this.m_loadedPages.delete(t)}this.m_loadingJson.delete(n),this.m_loadedJson.delete(n)}}async loadCharset(e,t){const i=t.fontName,r=t.fontStyle,n=(t.fontVariant===o.FontVariant.AllCaps||t.fontVariant===o.FontVariant.SmallCaps?e.toUpperCase():e).replace(/[\s\S](?=([\s\S]+))/g,(e,t)=>t.indexOf(e)+1?"":e),s=[];for(const e of n){const t=e.codePointAt(0),n=this.getFont(t,i),o=`${n.name}_${r}`,a=`${o}_${t}`;let l=this.m_loadedGlyphs.get(o);void 0===l&&(l=new Map,this.m_loadedGlyphs.set(o,l));const c=l.get(t);if(void 0===c){let i=this.m_loadingGlyphs.get(a);if(void 0===i){if(-1===n.charset.indexOf(String.fromCodePoint(t))){const i=this.createReplacementGlyph(t,e,n);l.set(t,i),this.m_glyphTextureCache.add(a,i);continue}let s;for(const e of this.unicodeBlocks)if(t>=e.min&&t<=e.max){s=e;break}i=this.loadAssets(t,r,s,n),this.m_loadingGlyphs.set(a,i),i.then(e=>{this.m_loadingGlyphs.delete(a),l.set(t,e),this.m_glyphTextureCache.add(a,e)})}s.push(i)}else this.m_glyphTextureCache.has(a)||(s.push(Promise.resolve(c)),this.m_glyphTextureCache.add(a,c))}return Promise.all(s)}getGlyph(e,t,i){const r=this.m_loadedGlyphs.get(`${t.name}_${i}`);if(void 0!==r)return r.get(e)}getGlyphs(e,t,i){const r=[],n=t.fontName,s=t.fontStyle,a=t.fontVariant,l=a===o.FontVariant.AllCaps||a===o.FontVariant.SmallCaps;for(const t of e){const e=l?t.toUpperCase():t;for(const o of e){const e=o.codePointAt(0),a=this.getFont(e,n),l=this.getGlyph(e,a,s);if(void 0===l)return;r.push(l),void 0!==i&&i.push(o!==t)}}return r}getFont(e,t){let i=this.fonts[0].name;for(const r of this.unicodeBlocks)if(e>=r.min&&e<=r.max){i=void 0!==t&&void 0!==r.fonts.find(e=>e===t)?t:r.fonts[0];break}return this.fonts.find(e=>e.name===i)}updateMemoryUsage(e){let t=0;for(const e of this.unicodeBlocks)t+=2*(e.max-e.min);let i=this.m_glyphTextureCache.textureSize.x*this.m_glyphTextureCache.textureSize.y*4;for(const e in this.m_loadedPages.entries)if(void 0!==this.m_loadedPages.get(e)){const t=this.m_loadedPages.get(e);void 0!==t&&(i+=t.image.width*t.image.height*4)}e.heapSize+=t+i,e.gpuSize+=i}createReplacementGlyph(e,t,i){const r=this.m_replacementGlyph.clone();return r.codePoint=e,r.character=t,r.font=i,r}async loadAssets(e,t,i,r){const s=await this.loadBlock(i,r,t);if(void 0===s)return this.m_replacementGlyph;const o=s.chars.find(t=>t.id===e),a=`${this.getAssetsPath(t,r)}/${s.pages[o.page]}`,l=await this.loadPage(a);return new n.GlyphData(o.id,i.name,o.width,o.height,o.xadvance,o.xoffset,o.yoffset,o.x/l.image.width,1-(o.y+o.height)/l.image.height,(o.x+o.width)/l.image.width,1-o.y/l.image.height,l,r)}async loadPage(e){let t=this.m_loadedPages.get(e);if(void 0===t){let i=this.m_loadingPages.get(e);void 0===i?(i=u.loadTexture(e),this.m_loadingPages.set(e,i),t=await i,t.wrapS=r.ClampToEdgeWrapping,t.wrapT=r.ClampToEdgeWrapping,t.minFilter=r.NearestFilter,t.needsUpdate=!0,this.m_loadingPages.delete(e)&&this.m_loadedPages.set(e,t),this.m_loadingPages.delete(e)):t=await i}return t}getAssetsPath(e,t){let i=a;switch(e){case o.FontStyle.Bold:void 0!==t.bold&&(i=l);break;case o.FontStyle.Italic:void 0!==t.italic&&(i=c);break;case o.FontStyle.BoldItalic:void 0!==t.boldItalic?i=h:void 0!==t.italic?i=c:void 0!==t.bold&&(i=l)}return`${this.url}/${this.name}${i}${t.name}`}}t.FontCatalog=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(47),n=i(0),s=i(46),o=i(78),a=8,l=4096;t.GlyphTextureCache=class{constructor(e,t,i){this.capacity=e,this.entryWidth=t,this.entryHeight=i;const s=Math.floor(Math.sqrt(e));this.m_cacheHeight=s*s<e?s+1:s,this.m_cacheWidth=s*this.m_cacheHeight<e?s+1:s,this.m_textureSize=new n.Vector2(this.m_cacheWidth*t,this.m_cacheHeight*i),(this.m_textureSize.y>l||this.m_textureSize.x>l)&&console.warn("GlyphTextureCache texture size ("+this.m_textureSize.x+", "+this.m_textureSize.y+") exceeds WebGL's widely supported MAX_TEXTURE_SIZE ("+l+").\nThis could result in rendering errors on some devices.\nPlease consider reducing its capacity or input assets size."),this.m_entryCache=new r.LRUCache(e),this.initCacheEntries(),this.m_scene=new n.Scene,this.m_camera=new n.OrthographicCamera(0,this.m_textureSize.x,this.m_textureSize.y,0),this.m_camera.position.z=1,this.m_camera.updateMatrixWorld(!1),this.m_rt=new n.WebGLRenderTarget(this.m_textureSize.x,this.m_textureSize.y,{wrapS:n.ClampToEdgeWrapping,wrapT:n.ClampToEdgeWrapping,depthBuffer:!1,stencilBuffer:!1}),this.m_copyTextureSet=new Set,this.m_copyTransform=new n.Matrix3,this.m_copyPositions=[],this.m_copyPositions.push(new n.Vector2,new n.Vector2,new n.Vector2,new n.Vector2),this.m_copyMaterial=new o.GlyphCopyMaterial,this.m_copyVertexBuffer=new n.InterleavedBuffer(new Float32Array(20*e),5),this.m_copyVertexBuffer.setUsage(n.DynamicDrawUsage),this.m_copyPositionAttribute=new n.InterleavedBufferAttribute(this.m_copyVertexBuffer,3,0),this.m_copyUVAttribute=new n.InterleavedBufferAttribute(this.m_copyVertexBuffer,2,3),this.m_copyGeometry=new n.BufferGeometry,this.m_copyGeometry.setAttribute("position",this.m_copyPositionAttribute),this.m_copyGeometry.setAttribute("uv",this.m_copyUVAttribute);const a=new n.BufferAttribute(new Uint32Array(6*e),1);a.setUsage(n.DynamicDrawUsage),this.m_copyGeometry.setIndex(a),this.m_copyMesh=new n.Mesh(this.m_copyGeometry,this.m_copyMaterial),this.m_copyMesh.frustumCulled=!1,this.m_copyGeometryDrawCount=0,this.m_clearMaterial=new o.GlyphClearMaterial,this.m_clearPositionAttribute=new n.BufferAttribute(new Float32Array(8*e),2),this.m_clearPositionAttribute.setUsage(n.DynamicDrawUsage),this.m_clearGeometry=new n.BufferGeometry,this.m_clearGeometry.setAttribute("position",this.m_clearPositionAttribute);const c=new n.BufferAttribute(new Uint32Array(6*e),1);c.setUsage(n.DynamicDrawUsage),this.m_clearGeometry.setIndex(c),this.m_clearMesh=new n.Mesh(this.m_clearGeometry,this.m_clearMaterial),this.m_clearMesh.frustumCulled=!1,this.m_clearGeometryDrawCount=0,this.m_scene.add(this.m_clearMesh,this.m_copyMesh)}dispose(){this.m_entryCache.clear(),this.m_scene.remove(this.m_clearMesh,this.m_copyMesh),this.m_rt.dispose(),this.m_clearMaterial.dispose(),this.m_copyMaterial.dispose(),this.m_copyTextureSet.clear(),this.m_clearGeometry.dispose(),this.m_copyGeometry.dispose()}get texture(){return this.m_rt.texture}get textureSize(){return this.m_textureSize}add(e,t){if(void 0!==this.m_entryCache.get(e))return;const i=this.m_entryCache.oldest;if(null===i)throw new Error("GlyphTextureCache is uninitialized!");this.clearCacheEntry(i.value),this.copyGlyphToCache(e,t,i.value.location)}has(e){return this.m_entryCache.has(e)}get(e){return this.m_entryCache.get(e)}clear(){this.m_copyGeometryDrawCount=0,this.m_clearGeometryDrawCount=0,this.m_entryCache.clear(),this.m_copyTextureSet.clear(),this.initCacheEntries()}update(e){let t=null;const i=this.m_clearGeometryDrawCount>0,r=this.m_copyGeometryDrawCount>0;if((i||r)&&(t=e.getRenderTarget(),e.setRenderTarget(this.m_rt)),i){if(null===this.m_clearGeometry.index)throw new Error("GlyphTextureCache clear geometry index is uninitialized!");this.m_clearPositionAttribute.needsUpdate=!0,this.m_clearPositionAttribute.updateRange.offset=0,this.m_clearPositionAttribute.updateRange.count=8*this.m_clearGeometryDrawCount,this.m_clearGeometry.index.needsUpdate=!0,this.m_clearGeometry.index.updateRange.offset=0,this.m_clearGeometry.index.updateRange.count=6*this.m_clearGeometryDrawCount,this.m_clearGeometry.setDrawRange(0,6*this.m_clearGeometryDrawCount),this.m_clearMesh.visible=!0,this.m_copyMesh.visible=!1,e.render(this.m_scene,this.m_camera),this.m_clearGeometryDrawCount=0,this.m_clearMesh.visible=!1}if(r){if(null===this.m_copyGeometry.index)throw new Error("GlyphTextureCache copy geometry index is uninitialized!");this.m_copyVertexBuffer.needsUpdate=!0,this.m_copyVertexBuffer.updateRange.offset=0,this.m_copyVertexBuffer.updateRange.count=20*this.m_copyGeometryDrawCount,this.m_copyGeometry.index.needsUpdate=!0,this.m_copyGeometry.index.updateRange.offset=0,this.m_copyGeometry.index.updateRange.count=6*this.m_copyGeometryDrawCount,this.m_copyGeometry.setDrawRange(0,6*this.m_copyGeometryDrawCount),this.m_copyMesh.visible=!0;const t=Array.from(this.m_copyTextureSet),i=Math.ceil(this.m_copyTextureSet.size/a);for(let r=0;r<i;r++){const i=r*a;this.m_copyMaterial.uniforms.pageOffset.value=i;for(let e=0;e<a;e++){const r=i+e;r<this.m_copyTextureSet.size&&(this.m_copyMaterial.uniforms["page"+e].value=t[r])}e.render(this.m_scene,this.m_camera)}this.m_copyTextureSet.clear(),this.m_copyGeometryDrawCount=0}(i||r)&&e.setRenderTarget(t)}initCacheEntries(){const e={name:"",metrics:{size:0,distanceRange:0,base:0,lineHeight:0,lineGap:0,capHeight:0,xHeight:0},charset:""},t=new s.GlyphData(0,"",0,0,0,0,0,0,0,0,0,n.Texture.DEFAULT_IMAGE,e);for(let e=0;e<this.m_cacheHeight;e++)for(let i=0;i<this.m_cacheWidth;i++){const r={glyphData:t,location:new n.Vector2(i,e)};this.m_entryCache.set(`Dummy_${e*this.m_cacheHeight+i}`,r)}}copyGlyphToCache(e,t,i){this.m_copyTextureSet.add(t.texture);let r=0;for(const e of this.m_copyTextureSet.values()){if(e===t.texture)break;r++}t.copyIndex=r,this.m_copyTransform.set(1,0,i.x*this.entryWidth-t.offsetX,0,1,i.y*this.entryHeight-t.positions[0].y,0,0,0);for(let e=0;e<4;++e)this.m_copyPositions[e].set(t.positions[e].x,t.positions[e].y),this.m_copyPositions[e].applyMatrix3(this.m_copyTransform);if(this.m_copyGeometryDrawCount>=this.capacity)return;const n=4*this.m_copyGeometryDrawCount,s=6*this.m_copyGeometryDrawCount;for(let e=0;e<4;++e)this.m_copyPositionAttribute.setXYZ(n+e,this.m_copyPositions[e].x,this.m_copyPositions[e].y,t.copyIndex),this.m_copyUVAttribute.setXY(n+e,t.sourceTextureCoordinates[e].x,t.sourceTextureCoordinates[e].y);if(null===this.m_copyGeometry.index)throw new Error("GlyphTextureCache copy geometry index is uninitialized!");this.m_copyGeometry.index.setX(s,n),this.m_copyGeometry.index.setX(s+1,n+1),this.m_copyGeometry.index.setX(s+2,n+2),this.m_copyGeometry.index.setX(s+3,n+2),this.m_copyGeometry.index.setX(s+4,n+1),this.m_copyGeometry.index.setX(s+5,n+3),++this.m_copyGeometryDrawCount;const o=this.m_copyPositions[0].x/this.m_textureSize.x,a=this.m_copyPositions[0].y/this.m_textureSize.y,l=this.m_copyPositions[3].x/this.m_textureSize.x,c=this.m_copyPositions[3].y/this.m_textureSize.y;t.dynamicTextureCoordinates[0].set(o,a),t.dynamicTextureCoordinates[1].set(l,a),t.dynamicTextureCoordinates[2].set(o,c),t.dynamicTextureCoordinates[3].set(l,c),t.isInCache=!0,this.m_entryCache.set(e,{glyphData:t,location:i})}clearCacheEntry(e){if(e.glyphData.isInCache=!1,this.m_copyPositions[0].set(e.location.x*this.entryWidth,e.location.y*this.entryHeight),this.m_copyPositions[1].set((e.location.x+1)*this.entryWidth,e.location.y*this.entryHeight),this.m_copyPositions[2].set(e.location.x*this.entryWidth,(e.location.y+1)*this.entryHeight),this.m_copyPositions[3].set((e.location.x+1)*this.entryWidth,(e.location.y+1)*this.entryHeight),this.m_clearGeometryDrawCount>=this.capacity)return;const t=4*this.m_clearGeometryDrawCount,i=6*this.m_clearGeometryDrawCount;for(let e=0;e<4;++e)this.m_clearPositionAttribute.setXY(t+e,this.m_copyPositions[e].x,this.m_copyPositions[e].y);if(null===this.m_clearGeometry.index)throw new Error("GlyphTextureCache clear geometry index is uninitialized!");this.m_clearGeometry.index.setX(i,t),this.m_clearGeometry.index.setX(i+1,t+1),this.m_clearGeometry.index.setX(i+2,t+2),this.m_clearGeometry.index.setX(i+3,t+2),this.m_clearGeometry.index.setX(i+4,t+1),this.m_clearGeometry.index.setX(i+5,t+3),++this.m_clearGeometryDrawCount}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1);class n{constructor(e,t,i,r,n){this.key=e,this.value=t,this.size=i,this.newer=r,this.older=n}}t.Entry=n;t.LRUCache=class{constructor(e,t=(()=>1)){this.m_size=0,this.m_map=new Map,this.m_newest=null,this.m_oldest=null,this.m_capacity=e,this.m_sizeFunction=t}forEach(e,t){let i=this.m_newest;for(;null!==i;){const r=i.older;e.call(t,i.value,i.key,this),i=r}}get size(){return this.m_size}get capacity(){return this.m_capacity}get map(){return this.m_map}get newest(){return this.m_newest}get oldest(){return this.m_oldest}setCapacity(e){this.m_capacity=e,this.evict()}setCapacityAndMeasure(e,t=(()=>1)){this.m_capacity=e,this.m_sizeFunction=t,this.shrinkToCapacity()}shrinkToCapacity(){let e=0;const t=this.m_sizeFunction;let i=this.m_newest;for(;null!==i;){const r=t(i.value);i.size=r,e+=r,i=i.older}this.m_size=e,this.evict()}set(e,t){const i=this.m_sizeFunction(t);let s=this.m_map.get(e);if(void 0!==s)this.m_size=this.m_size-s.size+i,s.value=t,s.size=i,this.promoteEntry(s),this.evict();else{if(i>this.m_capacity)return;if(s=new n(e,t,i,null,null),0===this.m_map.size)this.m_newest=this.m_oldest=s;else{r.assert(null!==this.m_newest);const e=this.m_newest;s.older=this.m_newest,e.newer=s,this.m_newest=s}this.m_map.set(e,s),this.m_size+=i,this.evict()}}get(e){const t=this.m_map.get(e);if(void 0!==t)return this.promoteEntry(t),t.value}has(e){return this.m_map.has(e)}clear(){this.m_newest=this.m_oldest=null,this.m_size=0,this.m_map.clear()}evictAll(){const e=this.evictionCallback;void 0!==e&&this.forEach((t,i)=>e(i,t)),this.clear()}evictSelected(e,t){const i=this.evictionCallback;let r=this.m_newest;for(;null!==r;){const n=r.older;e.call(t,r.value,r.key)&&(void 0!==i&&i(r.key,r.value),this.deleteEntry(r),this.m_map.delete(r.key)),r=n}}delete(e){const t=this.m_map.get(e);return void 0!==t&&(this.deleteEntry(t),this.m_map.delete(e))}evict(){for(;null!==this.m_oldest&&this.m_size>this.m_capacity;){if(void 0===this.evictOldest())return}}evictOldest(){r.assert(null!==this.m_oldest);const e=this.m_oldest;r.assert(null===e.older);let t=e;if(void 0!==this.canEvict)for(;!this.canEvict(t.key,t.value);){if(null===t.newer)return;t=t.newer}if(t===e)this.m_oldest=t.newer,null!==t.newer&&(r.assert(t.newer.older===t),t.newer.older=null);else{if(null===t.newer)return;r.assert(t.newer.older===t),t.newer.older=t.older,null!==t.older&&(t.older.newer=t.newer)}const i=this.m_map.delete(t.key);return r.assert(!0===i),i&&void 0!==this.evictionCallback&&this.evictionCallback(t.key,t.value),this.m_size-=t.size,t}deleteEntry(e){e===this.m_newest?this.m_newest=e.older:e.newer?e.newer.older=e.older:r.assert(!1),e===this.m_oldest?this.m_oldest=e.newer:e.older?e.older.newer=e.newer:r.assert(!1),this.m_size-=e.size}promoteEntry(e){if(e===this.m_newest)return;e.newer&&(r.assert(e.newer.older===e),e.newer.older=e.older),e.older&&(r.assert(e.older.newer===e),e.older.newer=e.newer),e===this.m_oldest&&(this.m_oldest=e.newer),e.newer=null,e.older=this.m_newest,r.assert(null!==this.m_newest);const t=this.m_newest;r.assert(null===t.newer),t.newer=e,this.m_newest=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(79),s=i(48),o=i(14),a=i(187),l=i(188),c=i(80),h=new r.Vector3,d={array:[new r.Box2],offset:0};let u=new Float32Array;t.DEFAULT_TEXT_CANVAS_LAYER=0;t.TextCanvas=class{constructor(e){this.m_renderer=e.renderer,this.m_fontCatalog=e.fontCatalog,this.minGlyphCount=e.minGlyphCount,this.maxGlyphCount=e.maxGlyphCount,void 0===e.material?(this.m_ownsMaterial=!0,this.m_material=c.createSdfTextMaterial({fontCatalog:e.fontCatalog})):(this.m_ownsMaterial=!1,this.m_material=e.material),void 0===e.backgroundMaterial?(this.m_ownsBgMaterial=!0,this.m_bgMaterial=c.createSdfTextMaterial({fontCatalog:e.fontCatalog,isBackground:!0})):(this.m_ownsBgMaterial=!1,this.m_bgMaterial=e.backgroundMaterial),this.m_defaultLayer={id:t.DEFAULT_TEXT_CANVAS_LAYER,storage:new s.TextGeometry(new r.Scene,this.m_material,this.m_bgMaterial,this.minGlyphCount,this.maxGlyphCount)},this.m_layers=[this.m_defaultLayer],this.m_defaultTextRenderStyle=new o.TextRenderStyle,this.m_currentTextRenderStyle=this.m_defaultTextRenderStyle,this.m_defaultTextLayoutStyle=new o.TextLayoutStyle,this.m_currentTextLayoutStyle=this.m_defaultTextLayoutStyle,this.m_lineTypesetter=new a.LineTypesetter,this.m_pathTypesetter=new l.PathTypesetter}get fontCatalog(){return this.m_fontCatalog}set fontCatalog(e){this.m_fontCatalog=e;const t=this.m_material;t.uniforms.sdfTexture.value=this.m_fontCatalog.texture,t.uniforms.sdfParams.value=new r.Vector4(this.m_fontCatalog.textureSize.x,this.m_fontCatalog.textureSize.y,this.m_fontCatalog.size,this.m_fontCatalog.distanceRange),t.defines.MSDF="msdf"===this.m_fontCatalog.type?1:0;const i=this.m_bgMaterial;i.uniforms.sdfTexture.value=this.m_fontCatalog.texture,i.uniforms.sdfParams.value=new r.Vector4(this.m_fontCatalog.textureSize.x,this.m_fontCatalog.textureSize.y,this.m_fontCatalog.size,this.m_fontCatalog.distanceRange),i.defines.MSDF="msdf"===this.m_fontCatalog.type?1:0}get material(){return this.m_material}set material(e){this.m_ownsMaterial&&(this.m_material.dispose(),this.m_ownsMaterial=!1),this.m_material=e;for(const e of this.m_layers)e.storage.mesh.material=this.m_material}get backgroundMaterial(){return this.m_bgMaterial}set backgroundMaterial(e){this.m_ownsBgMaterial&&(this.m_bgMaterial.dispose(),this.m_ownsBgMaterial=!1),this.m_bgMaterial=e;for(const e of this.m_layers)e.storage.backgroundMesh.material=this.m_bgMaterial}get textRenderStyle(){return this.m_currentTextRenderStyle}set textRenderStyle(e){this.m_currentTextRenderStyle=e}get textLayoutStyle(){return this.m_currentTextLayoutStyle}set textLayoutStyle(e){this.m_currentTextLayoutStyle=e}clear(){for(const e of this.m_layers)e.storage.clear();this.m_currentTextRenderStyle=this.m_defaultTextRenderStyle}render(e,t,i){this.m_fontCatalog.update(this.m_renderer);let r=null;void 0!==t&&(r=this.m_renderer.getRenderTarget(),this.m_renderer.setRenderTarget(t)),!0===i&&this.m_renderer.clear(!0);for(const t of this.m_layers)t.storage.update(),this.m_renderer.clear(!1,!0),this.m_renderer.render(t.storage.scene,e);void 0!==t&&this.m_renderer.setRenderTarget(r)}addLayer(e){let t=this.getLayer(e);return void 0===t&&(t={id:e,storage:new s.TextGeometry(new r.Scene,this.m_material,this.m_bgMaterial,this.minGlyphCount,this.maxGlyphCount)},this.m_layers.push(t),this.m_layers.sort((e,t)=>e.id-t.id)),t}getLayer(e){return this.m_layers.find(t=>t.id===e)}getAllLayers(){return this.m_layers}measureText(e,t,i){let r,n,s,o;if(h.set(0,0,0),void 0!==i){if(r=i.path,n=i.pathOverflow,o=i.outputCharacterBounds,void 0!==i.path){const e=i.path.getPoint(0);if(null===e)return!1;h.set(e.x,e.y,0)}i.letterCaseArray&&(s=i.letterCaseArray)}return this.placeText({input:e,layer:this.m_defaultLayer,textPath:r,textPathOverflow:n,bounds:t,individualBounds:o,letterCaseArray:s})}addText(e,t,i){let r,n,s;h.copy(t);let o=this.m_defaultLayer;if(void 0!==i){if(r=i.path,n=i.pathOverflow,void 0!==i.layer){let e=this.getLayer(i.layer);void 0===e&&(e=this.addLayer(i.layer)),o=e}void 0!==i.path&&h.set(0,0,h.z),i.letterCaseArray&&(s=i.letterCaseArray)}const a=o.storage.drawCount,l=this.placeText({input:e,textPath:r,textPathOverflow:n,layer:o,letterCaseArray:s});return l&&void 0!==i?(!0===i.updatePosition&&t.copy(h),void 0!==i.pickingData&&o.storage.addPickingData(a,o.storage.drawCount,i.pickingData)):l||(o.storage.m_drawCount=a),l}createTextBufferObject(e,t){let i,s;h.set(0,0,0);const a=this.m_currentTextRenderStyle.fontVariant===o.FontVariant.SmallCaps;if("string"!=typeof e)i=e,void 0!==t&&t.letterCaseArray&&(s=t.letterCaseArray);else if(s=[],i=this.m_fontCatalog.getGlyphs(e,this.m_currentTextRenderStyle,a?s:void 0),void 0===i)return;let l,c,d,m,p,f;return void 0!==t&&(l=t.path,c=t.pathOverflow,!0===t.outputBounds&&(d=new r.Box2),!0===t.outputCharacterBounds&&(m=[]),!0===t.storeStyles&&(p=this.m_currentTextRenderStyle,f=this.m_currentTextLayoutStyle)),this.placeText({input:e,layer:this.m_defaultLayer,computeTextBuffer:!0,textPath:l,textPathOverflow:c,bounds:d,individualBounds:m,letterCaseArray:s}),new n.TextBufferObject(i,new Float32Array(u),d,m,p,f)}addTextBufferObject(e,t){let i,r,n,s,o,a,l,c=this.m_defaultLayer;if(void 0!==t){if(void 0!==t.layer){let e=this.getLayer(t.layer);void 0===e&&(e=this.addLayer(t.layer)),c=e}i=t.position,r=t.scale,n=t.rotation,s=t.color,o=t.opacity,a=t.backgroundColor,l=t.backgroundOpacity}const h=c.storage.drawCount,d=c.storage.addTextBufferObject(e,i,r,n,s,o,a,l);return d&&void 0!==t?void 0!==t.pickingData&&c.storage.addPickingData(h,c.storage.drawCount,t.pickingData):d||(c.storage.m_drawCount=h),d}pickText(e,t){for(const i of this.m_layers)i.storage.pick(e,t)}getMemoryUsage(e){this.m_fontCatalog.updateMemoryUsage(e);for(const t of this.m_layers)t.storage.updateMemoryUsage(e)}placeText(e){if(0===e.input.length||0===this.m_currentTextLayoutStyle.maxLines)return void 0!==e.bounds&&(e.bounds.min.set(0,0),e.bounds.max.set(0,0)),void 0!==e.individualBounds&&(e.individualBounds.length=0),!0;let t,i;const r=this.m_currentTextRenderStyle.fontVariant===o.FontVariant.SmallCaps;if("string"!=typeof e.input)t=e.input,e.letterCaseArray&&(i=e.letterCaseArray);else if(i=[],t=this.m_fontCatalog.getGlyphs(e.input,this.m_currentTextRenderStyle,r?i:void 0),void 0===t)return!1;let n;void 0!==e.individualBounds&&(d.array=e.individualBounds,d.offset=0,n=d),void 0!==e.bounds&&(e.bounds.min.set(1/0,1/0),e.bounds.max.set(-1/0,-1/0)),!0===e.computeTextBuffer&&(u=new Float32Array(t.length*s.QUAD_VERTEX_MEMORY_FOOTPRINT));const a=void 0!==e.textPath,l={glyphs:t,fontCatalog:this.m_fontCatalog,textRenderStyle:this.m_currentTextRenderStyle,textLayoutStyle:this.m_currentTextLayoutStyle,position:h,geometry:e.layer.storage,smallCapsArray:r?i:void 0,globalBounds:e.bounds,individualBounds:n,vertexBuffer:!0===e.computeTextBuffer?u:void 0};let c=!0;return a?(Object.assign(l,{path:e.textPath,pathOverflow:!0===e.textPathOverflow}),c=this.m_pathTypesetter.arrangeGlyphs(l)):c=this.m_lineTypesetter.arrangeGlyphs(l),void 0!==n&&(n.array.length=n.offset),c}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(48),s=i(14),o=i(49),a=i(21);t.LineTypesetter=class{constructor(){this.m_tempTransform=new r.Matrix3,this.m_tempCorners=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3],this.m_tempLineDirection=a.UnicodeUtils.Direction.LTR,this.m_tempRunDirection=a.UnicodeUtils.Direction.LTR,this.m_tempPixelSize=1,this.m_tempPixelBgSize=1,this.m_tempScale=1,this.m_tempSmallCaps=!1}arrangeGlyphs(e){this.m_currentParams=e,this.m_tempLineDirection=o.TypesettingUtils.getDirection(this.m_currentParams.glyphs,0),this.m_tempRunDirection=this.m_tempLineDirection,this.m_tempPixelSize=o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_tempScale=this.m_tempPixelSize/this.m_currentParams.fontCatalog.size,this.m_tempPixelBgSize=Math.min(o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_currentParams.fontCatalog.distanceRange*this.m_tempScale),this.m_tempSmallCaps=void 0!==this.m_currentParams.smallCapsArray,this.m_currentParams.position.y+=this.m_currentParams.textLayoutStyle.verticalAlignment*this.m_currentParams.glyphs[0].font.metrics.capHeight*this.m_tempScale;const t=void 0!==this.m_currentParams.globalBounds&&void 0===this.m_currentParams.vertexBuffer,i=this.m_currentParams.position.x,r=this.m_currentParams.glyphs[0].font.metrics.lineHeight+this.m_currentParams.textLayoutStyle.leading;let n=0,l=0,c=0,h=0,d=0,u=0,m=0,p=0,f=!1;for(let e=0;e<this.m_currentParams.glyphs.length&&!(p>this.m_currentParams.textLayoutStyle.maxLines-1);++e){const g=this.m_currentParams.glyphs[e];if(!g.isInCache&&!t)return!1;const v=a.UnicodeUtils.isNewLine(g.codePoint),y=a.UnicodeUtils.isWhiteSpace(g.codePoint);if(f||g.direction!==-this.m_tempLineDirection||(f=!0),a.UnicodeUtils.isPrintable(g.codePoint)&&(d+=(g.advanceX+this.m_currentParams.textLayoutStyle.tracking)*this.m_tempScale*(this.m_tempSmallCaps?o.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs,this.m_currentParams.smallCapsArray,e,this.m_currentParams.textRenderStyle.fontVariant):1)),e===n&&(h=d,u=d,m=d),v||this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Character&&d>this.m_currentParams.textLayoutStyle.lineWidth||this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Word&&d>this.m_currentParams.textLayoutStyle.lineWidth&&m!==h){if(this.m_currentParams.textLayoutStyle.wrappingMode!==s.WrappingMode.None){let t=l,i=u;this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Word&&m!==h&&(t=c,i=m),d=i,e=Math.min(v?n===e?t:e:t,this.m_currentParams.glyphs.length-1)}const t=this.m_tempLineDirection===a.UnicodeUtils.Direction.RTL&&f?1+this.m_currentParams.textLayoutStyle.horizontalAlignment:this.m_currentParams.textLayoutStyle.horizontalAlignment;if(this.m_currentParams.position.x=this.m_currentParams.position.x+d*t,!this.placeLine(n,e,this.m_tempLineDirection,f))return!1;for(this.m_currentParams.position.y-=r*this.m_tempScale,this.m_currentParams.position.x=i;e!==n&&e+1<this.m_currentParams.glyphs.length&&a.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[e+1].codePoint);)++e;if(n=e+1,n===this.m_currentParams.glyphs.length)break;v&&(this.m_tempLineDirection=o.TypesettingUtils.getDirection(this.m_currentParams.glyphs,n),this.m_tempRunDirection=this.m_tempLineDirection),h=0,d=0,l=n,u=0,c=n,m=0,f=!1,p++}else this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.None||y||(l=e,u=d,this.m_currentParams.textLayoutStyle.wrappingMode===s.WrappingMode.Word&&e+1<this.m_currentParams.glyphs.length&&(a.UnicodeUtils.isWhiteSpace(this.m_currentParams.glyphs[e+1].codePoint)||a.UnicodeUtils.isNewLine(this.m_currentParams.glyphs[e+1].codePoint))&&(c=e,m=d))}if(p<=this.m_currentParams.textLayoutStyle.maxLines-1&&n<=this.m_currentParams.glyphs.length-1){const e=this.m_tempLineDirection===a.UnicodeUtils.Direction.RTL&&f?1+this.m_currentParams.textLayoutStyle.horizontalAlignment:this.m_currentParams.textLayoutStyle.horizontalAlignment;if(this.m_currentParams.position.setX(this.m_currentParams.position.x+d*e),!this.placeLine(n,this.m_currentParams.glyphs.length-1,this.m_tempLineDirection,f))return!1}return!0}placeLine(e,t,i,r){if(!r)return this.placeRun(e,t,i);const n=this.m_currentParams.glyphs,s=this.m_currentParams.smallCapsArray,l=this.m_currentParams.textRenderStyle,c=this.m_currentParams.textLayoutStyle,h=this.m_currentParams.position,d=i===a.UnicodeUtils.Direction.RTL,u=h.x;let m=0,p=e;for(let r=e;r<=t;++r){const e=n[r];if(e.direction===-this.m_tempRunDirection){if(d&&(h.x=u+m),!this.placeRun(p,r-1,this.m_tempRunDirection))return!1;d||(h.x=u+m),p=r,this.m_tempRunDirection*=-1}else if(e.direction===a.UnicodeUtils.Direction.Neutral&&this.m_tempRunDirection===-i){let e=r;for(;e+1<n.length&&1!==Math.abs(n[e].direction);)++e;if(n[e].direction!==this.m_tempRunDirection){if(d&&(h.x=u+m),!this.placeRun(p,r-1,this.m_tempRunDirection))return!1;d||(h.x=u+m),p=r,this.m_tempRunDirection*=-1}}m+=(e.advanceX+c.tracking)*this.m_tempScale*(this.m_tempSmallCaps?o.TypesettingUtils.getSmallCapsScale(n,s,r,l.fontVariant):1)*i}if(p<=t){if(d&&(h.x=u+m),!this.placeRun(p,t,this.m_tempRunDirection))return!1;d||(h.x=u+m)}return!0}placeRun(e,t,i){const r=this.m_currentParams.glyphs,l=this.m_currentParams.smallCapsArray,c=this.m_currentParams.fontCatalog,h=this.m_currentParams.textRenderStyle,d=this.m_currentParams.textLayoutStyle,u=this.m_currentParams.position,m=this.m_currentParams.geometry,p=this.m_currentParams.globalBounds,f=this.m_currentParams.individualBounds,g=this.m_currentParams.vertexBuffer,v=i===a.UnicodeUtils.Direction.LTR?e:t,y=i===a.UnicodeUtils.Direction.LTR?t:e;for(let _=v;i===a.UnicodeUtils.Direction.RTL?_>=y:_<=y;_+=i){const v=r[_];if(!a.UnicodeUtils.isPrintable(v.codePoint))continue;if(e!==t&&0!==_&&i===a.UnicodeUtils.Direction.RTL&&v.direction===a.UnicodeUtils.Direction.Weak){let t=_,i=r[t-1];for(;t!==e&&(i.direction===a.UnicodeUtils.Direction.Weak||i.direction===a.UnicodeUtils.Direction.Neutral&&!a.UnicodeUtils.isWhiteSpace(i.codePoint));)--t,i=r[t-1];this.placeRun(Math.max(t,e),_,a.UnicodeUtils.Direction.LTR),_=t;continue}const y=v.font,x=y.metrics,T=h.fontStyle,S=T===s.FontStyle.Bold&&void 0===y.bold||T===s.FontStyle.BoldItalic&&void 0===y.bold&&void 0===y.boldItalic,w=T===s.FontStyle.Italic&&void 0===y.italic||T===s.FontStyle.BoldItalic&&void 0===y.italic&&void 0===y.boldItalic,b=!!this.m_tempSmallCaps&&(l[_]&&h.fontVariant===s.FontVariant.SmallCaps),M=b?x.xHeight/x.capHeight:1,E=this.m_tempScale*M,P=((S?.02:0)+(b?.01:0))*(c.size/c.distanceRange),C=.5*this.m_tempPixelBgSize/(c.distanceRange*Math.max(E,1)),A=a.UnicodeUtils.isRtlMirrored(v.codePoint)&&i===a.UnicodeUtils.Direction.RTL,L=x.lineHeight-x.base-.5*x.distanceRange;o.TypesettingUtils.computeGlyphTransform(this.m_tempTransform,u,E,d.canvasRotation,h.rotation);for(let e=0;e<4;++e){const t=v.positions[e],i=w&&e>1?o.TypesettingUtils.OBLIQUE_OFFSET*x.size:0;this.m_tempCorners[e].set(t.x+i,t.y-L,t.z),this.m_tempCorners[e].applyMatrix3(this.m_tempTransform)}if(void 0===p&&void 0===g){if(!m.add(v,this.m_tempCorners,P,P+C,A,h))return!1}else void 0!==p&&o.TypesettingUtils.updateBounds(this.m_tempCorners,p,f),void 0!==g&&m.addToBuffer(g,_*n.QUAD_VERTEX_MEMORY_FOOTPRINT,v,this.m_tempCorners,P,P+C,A,h);u.set(u.x+(v.advanceX+d.tracking)*E*Math.cos(d.lineRotation),u.y+(v.advanceX+d.tracking)*E*Math.sin(d.lineRotation),u.z)}return!0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(48),s=i(14),o=i(49),a=i(21);t.PathTypesetter=class{constructor(){this.m_tempTransform=new r.Matrix3,this.m_tempCorners=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3],this.m_tempLineDirection=a.UnicodeUtils.Direction.LTR,this.m_tempRunDirection=a.UnicodeUtils.Direction.LTR,this.m_tempPixelSize=1,this.m_tempPixelBgSize=1,this.m_tempScale=1,this.m_tempSmallCaps=!1,this.m_tempPathPosition=new r.Vector3,this.m_tempPathLength=0,this.m_tempPathOffset=0}arrangeGlyphs(e){this.m_currentParams=e,this.m_tempLineDirection=o.TypesettingUtils.getDirection(this.m_currentParams.glyphs,0),this.m_tempRunDirection=this.m_tempLineDirection,this.m_tempPixelSize=o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.size,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_tempScale=this.m_tempPixelSize/this.m_currentParams.fontCatalog.size,this.m_tempPixelBgSize=Math.min(o.TypesettingUtils.getPixelSize(this.m_currentParams.textRenderStyle.fontSize.backgroundSize,this.m_currentParams.textRenderStyle.fontSize.unit,this.m_currentParams.fontCatalog.size),this.m_currentParams.fontCatalog.distanceRange*this.m_tempScale),this.m_tempSmallCaps=void 0!==this.m_currentParams.smallCapsArray,this.m_tempPathLength=this.m_currentParams.path.getLength(),this.m_tempPathOffset=0;const t=void 0!==this.m_currentParams.globalBounds&&void 0===this.m_currentParams.vertexBuffer;let i=!1,r=0;for(let e=0;e<this.m_currentParams.glyphs.length;++e){const n=this.m_currentParams.glyphs[e];if(!n.isInCache&&!t)return!1;a.UnicodeUtils.isPrintable(n.codePoint)&&(i||n.direction!==-this.m_tempLineDirection||(i=!0),r+=(n.advanceX+this.m_currentParams.textLayoutStyle.tracking)*this.m_tempScale*(this.m_tempSmallCaps?o.TypesettingUtils.getSmallCapsScale(this.m_currentParams.glyphs,this.m_currentParams.smallCapsArray,e,this.m_currentParams.textRenderStyle.fontVariant):1))}return this.m_tempPathOffset=Math.min(Math.max(-this.m_currentParams.textLayoutStyle.horizontalAlignment+this.m_currentParams.textLayoutStyle.horizontalAlignment*r/this.m_tempPathLength,0),1),this.placeLine(this.m_tempLineDirection,i)}placeLine(e,t){if(!t)return this.placeRun(0,this.m_currentParams.glyphs.length-1,e);const i=this.m_currentParams.glyphs;let r=0;for(let t=r;t<i.length;++t){const n=i[t];if(n.direction===-this.m_tempRunDirection){if(!this.placeRun(r,t-1,this.m_tempRunDirection))return!1;r=t,this.m_tempRunDirection*=-1}else if(n.direction===a.UnicodeUtils.Direction.Neutral&&this.m_tempRunDirection===-e){let e=t;for(;e+1<i.length&&1!==Math.abs(i[e].direction);)++e;if(i[e].direction!==this.m_tempRunDirection){if(!this.placeRun(r,t-1,this.m_tempRunDirection))return!1;r=t,this.m_tempRunDirection*=-1}}}return!(r<i.length&&!this.placeRun(r,i.length-1,this.m_tempRunDirection))}placeRun(e,t,i){const l=this.m_currentParams.glyphs,c=this.m_currentParams.smallCapsArray,h=this.m_currentParams.fontCatalog,d=this.m_currentParams.textRenderStyle,u=this.m_currentParams.textLayoutStyle,m=this.m_currentParams.position,p=this.m_currentParams.geometry,f=this.m_currentParams.globalBounds,g=this.m_currentParams.individualBounds,v=this.m_currentParams.vertexBuffer,y=this.m_currentParams.path,_=d.rotation,x=u.verticalAlignment*l[0].font.metrics.capHeight*this.m_tempScale,T=i===a.UnicodeUtils.Direction.LTR?e:t,S=i===a.UnicodeUtils.Direction.LTR?t:e;for(let w=T;i===a.UnicodeUtils.Direction.RTL?w>=S:w<=S;w+=i){const T=l[w];if(!a.UnicodeUtils.isPrintable(T.codePoint))continue;if(e!==t&&0!==w&&i===a.UnicodeUtils.Direction.RTL&&T.direction===a.UnicodeUtils.Direction.Weak){let t=w,i=l[t-1];for(;t!==e&&(i.direction===a.UnicodeUtils.Direction.Weak||i.direction===a.UnicodeUtils.Direction.Neutral&&!a.UnicodeUtils.isWhiteSpace(i.codePoint));)--t,i=l[t-1];this.placeRun(Math.max(t,e),w,a.UnicodeUtils.Direction.LTR),w=t;continue}const S=T.font,b=S.metrics,M=d.fontStyle,E=M===s.FontStyle.Bold&&void 0===S.bold||M===s.FontStyle.BoldItalic&&void 0===S.bold&&void 0===S.boldItalic,P=M===s.FontStyle.Italic&&void 0===S.italic||M===s.FontStyle.BoldItalic&&void 0===S.italic&&void 0===S.boldItalic,C=!!this.m_tempSmallCaps&&(c[w]&&d.fontVariant===s.FontVariant.SmallCaps),A=C?b.xHeight/b.capHeight:1,L=this.m_tempScale*A,R=((E?.02:0)+(C?.01:0))*(h.size/h.distanceRange),F=.5*this.m_tempPixelBgSize/(h.distanceRange*Math.max(L,1)),D=a.UnicodeUtils.isRtlMirrored(T.codePoint)&&i===a.UnicodeUtils.Direction.RTL,O=b.lineHeight-b.base-.5*b.distanceRange,I=y.getPoint(this.m_tempPathOffset);if(null===I)return this.m_currentParams.pathOverflow;const U=y.getTangent(this.m_tempPathOffset),z=new r.Vector2(-U.y,U.x).multiplyScalar(x),k=Math.atan2(U.y,U.x);this.m_tempPathPosition.set(z.x+I.x,z.y+I.y,m.z),d.rotation=_+k,o.TypesettingUtils.computeGlyphTransform(this.m_tempTransform,this.m_tempPathPosition,L,0,d.rotation);for(let e=0;e<4;++e){const t=T.positions[e],i=P&&e>1?o.TypesettingUtils.OBLIQUE_OFFSET*b.size:0;this.m_tempCorners[e].set(t.x+i,t.y-O,t.z),this.m_tempCorners[e].applyMatrix3(this.m_tempTransform),this.m_tempCorners[e].x-=m.x,this.m_tempCorners[e].y-=m.y}if(void 0===f&&void 0===v){if(!p.add(T,this.m_tempCorners,R,R+F,D,d))return!1}else void 0!==f&&o.TypesettingUtils.updateBounds(this.m_tempCorners,f,g),void 0!==v&&p.addToBuffer(v,w*n.QUAD_VERTEX_MEMORY_FOOTPRINT,T,this.m_tempCorners,R,R+F,D,d);d.rotation=_,this.m_tempPathOffset+=(T.advanceX+u.tracking)*L/this.m_tempPathLength}return!0}}},function(e,t,i){"use strict";var r,n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Initial=0]="Initial",e[e.Medial=1]="Medial",e[e.Final=2]="Final"}(r||(r={})),function(e){e[e.Isolated=0]="Isolated",e[e.Connected=1]="Connected"}(n||(n={}));class s{constructor(){this.m_singleCharactersMap=new Map,this.m_combinedCharactersMap=new Map,this.m_singleCharactersMap.set(1569,[void 0,void 0,void 0]),this.m_singleCharactersMap.set(1570,[void 0,void 0,65154]),this.m_singleCharactersMap.set(1571,[void 0,void 0,65156]),this.m_singleCharactersMap.set(1572,[void 0,void 0,65158]),this.m_singleCharactersMap.set(1573,[void 0,void 0,65160]),this.m_singleCharactersMap.set(1574,[65163,65164,65162]),this.m_singleCharactersMap.set(1575,[void 0,void 0,65166]),this.m_singleCharactersMap.set(1576,[65169,65170,65168]),this.m_singleCharactersMap.set(1577,[void 0,void 0,65172]),this.m_singleCharactersMap.set(1578,[65175,65176,65174]),this.m_singleCharactersMap.set(1579,[65179,65180,65178]),this.m_singleCharactersMap.set(1580,[65183,65184,65182]),this.m_singleCharactersMap.set(1581,[65187,65188,65186]),this.m_singleCharactersMap.set(1582,[65191,65192,65190]),this.m_singleCharactersMap.set(1583,[void 0,void 0,65194]),this.m_singleCharactersMap.set(1584,[void 0,void 0,65196]),this.m_singleCharactersMap.set(1585,[void 0,void 0,65198]),this.m_singleCharactersMap.set(1586,[void 0,void 0,65200]),this.m_singleCharactersMap.set(1587,[65203,65204,65202]),this.m_singleCharactersMap.set(1588,[65207,65208,65206]),this.m_singleCharactersMap.set(1589,[65211,65212,65210]),this.m_singleCharactersMap.set(1590,[65215,65216,65214]),this.m_singleCharactersMap.set(1591,[65219,65220,65218]),this.m_singleCharactersMap.set(1592,[65223,65224,65222]),this.m_singleCharactersMap.set(1593,[65227,65228,65226]),this.m_singleCharactersMap.set(1594,[65231,65232,65230]),this.m_singleCharactersMap.set(1600,[1600,1600,1600]),this.m_singleCharactersMap.set(1601,[65235,65236,65234]),this.m_singleCharactersMap.set(1602,[65239,65240,65238]),this.m_singleCharactersMap.set(1603,[65243,65244,65242]),this.m_singleCharactersMap.set(1604,[65247,65248,65246]),this.m_singleCharactersMap.set(1605,[65251,65252,65250]),this.m_singleCharactersMap.set(1606,[65255,65256,65254]),this.m_singleCharactersMap.set(1607,[65259,65260,65258]),this.m_singleCharactersMap.set(1608,[void 0,void 0,65262]),this.m_singleCharactersMap.set(1609,[void 0,void 0,65264]),this.m_singleCharactersMap.set(1610,[65267,65268,65266]),this.m_singleCharactersMap.set(1662,[64344,64345,64343]),this.m_singleCharactersMap.set(1740,[64510,64511,64509]),this.m_singleCharactersMap.set(1670,[64380,64381,64379]),this.m_singleCharactersMap.set(1705,[64400,64401,64399]),this.m_singleCharactersMap.set(1711,[64404,64405,64403]),this.m_singleCharactersMap.set(1688,[void 0,void 0,64395]),this.m_combinedCharactersMap.set(1604,new Map),this.m_combinedCharactersMap.get(1604).set(1570,[65269,65270]),this.m_combinedCharactersMap.get(1604).set(1571,[65271,65272]),this.m_combinedCharactersMap.get(1604).set(1573,[65273,65274]),this.m_combinedCharactersMap.get(1604).set(1575,[65275,65276]),this.m_neutralCharacters=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}static get instance(){return void 0===this.m_instance&&(this.m_instance=new s),this.m_instance}convert(e){let t="";for(let i=0;i<e.length;++i){const s=e.charCodeAt(i);if(this.isArabicCharacter(s)){let o=i-1;for(;o>=0&&this.isNeutral(e.charCodeAt(o));--o);let a=o>=0?e.charCodeAt(o):void 0;if(void 0!==a){const e=this.getCharacterMap(a);(void 0===e||void 0===e[r.Initial]&&void 0===e[r.Medial])&&(a=void 0)}let l=i+1;for(;l<e.length&&this.isNeutral(e.charCodeAt(l));++l);let c=l<e.length?e.charCodeAt(l):void 0;if(void 0!==c){const e=this.getCharacterMap(c);(void 0===e||void 0===e[r.Medial]&&void 0===e[r.Final])&&(c=void 0)}if(1604===s&&void 0!==c&&(1570===c||1571===c||1573===c||1575===c)){const e=this.getCombinedCharacterMap(s,c);t+=void 0!==a?String.fromCharCode(e[n.Connected]):String.fromCharCode(e[n.Isolated]),++i;continue}const h=this.getCharacterMap(s);void 0!==a&&void 0!==c&&void 0!==h[r.Medial]?t+=String.fromCharCode(h[r.Medial]):void 0!==a&&void 0!==h[r.Final]?t+=String.fromCharCode(h[r.Final]):void 0!==c&&void 0!==h[r.Initial]?t+=String.fromCharCode(h[r.Initial]):t+=String.fromCharCode(s)}else t+=String.fromCharCode(s)}return t}isArabicCharacter(e){return this.m_singleCharactersMap.has(e)}getCharacterMap(e){return this.m_singleCharactersMap.get(e)}getCombinedCharacterMap(e,t){const i=this.m_combinedCharactersMap.get(e);if(void 0!==i)return i.get(t)}isNeutral(e){for(const t of this.m_neutralCharacters)if(t===e)return!0;return!1}}t.ContextualArabicConverter=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);t.PathBlockingElement=class{constructor(e){this.points=e,this.screenSpaceLines=new Array(e.length>=2?e.length-1:0);for(let e=0;e<this.screenSpaceLines.length;e++)this.screenSpaceLines[e]=new r.Line3(new r.Vector3,new r.Vector3)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(0),s=i(192),o=0,a=32768,l=4,c=6,h=3,d=4,u=4,m=1,p=4,f=4;class g extends n.Mesh{constructor(e,t){super(e,t),this.type="BoxBufferMesh"}get isEmpty(){if(void 0===this.geometry)return!0;{const e=this.geometry;return null===e.index||0===e.index.count}}}t.BoxBufferMesh=g;class v{constructor(e,t=0,i=o,r=a){this.material=e,this.renderOrder=t,this.startElementCount=i,this.maxElementCount=r,this.m_size=0,this.resizeBuffer(i),this.pickInfos=new Array}clone(){return new v(this.material,this.renderOrder)}dispose(){void 0!==this.geometry&&(this.geometry.dispose(),this.geometry=void 0),this.internalMesh=void 0}get size(){return this.m_size}reset(){void 0!==this.positionAttribute&&(this.positionAttribute.count=0,this.colorAttribute.count=0,this.uvAttribute.count=0,this.indexAttribute.count=0,this.pickInfos.length=0)}canAddElements(e=1){const t=this.indexAttribute;if(t.count+e*c>=t.array.length){if(t.array.length>=this.maxElementCount*c)return!1;const e=Math.min(this.maxElementCount,0===this.size?256:2*this.size);this.resize(e)}return!0}saveState(){return{positionAttributeCount:this.positionAttribute.count,colorAttributeCount:this.colorAttribute.count,uvAttributeCount:this.uvAttribute.count,indexAttributeCount:this.indexAttribute.count,pickInfoCount:this.pickInfos.length}}restoreState(e){this.positionAttribute.count=e.positionAttributeCount,this.colorAttribute.count=e.colorAttributeCount,this.uvAttribute.count=e.uvAttributeCount,this.indexAttribute.count=e.indexAttributeCount,this.pickInfos.length=e.pickInfoCount}addBox(e,t,i,r,n,s){if(!this.canAddElements())return!1;const{s0:o,t0:a,s1:h,t1:d}=t,{x:u,y:m,w:p,h:f}=e,g=Math.round(255*i.r),v=Math.round(255*i.g),y=Math.round(255*i.b),_=Math.round(255*r),x=this.positionAttribute,T=this.colorAttribute,S=this.uvAttribute,w=this.indexAttribute,b=x.count,M=w.count;return x.setXYZ(b,u,m,n),x.setXYZ(b+1,u+p,m,n),x.setXYZ(b+2,u,m+f,n),x.setXYZ(b+3,u+p,m+f,n),T.setXYZW(b,g,v,y,_),T.setXYZW(b+1,g,v,y,_),T.setXYZW(b+2,g,v,y,_),T.setXYZW(b+3,g,v,y,_),S.setXY(b,o,a),S.setXY(b+1,h,a),S.setXY(b+2,o,d),S.setXY(b+3,h,d),w.setX(M,b),w.setX(M+1,b+1),w.setX(M+2,b+2),w.setX(M+3,b+2),w.setX(M+4,b+1),w.setX(M+5,b+3),x.count+=l,T.count+=l,S.count+=l,w.count+=c,this.pickInfos.push(s),!0}updateBufferGeometry(){const e=this.positionAttribute,t=this.colorAttribute,i=this.uvAttribute,r=this.indexAttribute;e.count>0&&(e.needsUpdate=!0,e.updateRange.offset=0,e.updateRange.count=e.count*l),t.count>0&&(t.needsUpdate=!0,t.updateRange.offset=0,t.updateRange.count=t.count*l),i.count>0&&(i.needsUpdate=!0,i.updateRange.offset=0,i.updateRange.count=i.count*l),r.count>0&&(r.needsUpdate=!0,r.updateRange.offset=0,r.updateRange.count=r.count),void 0!==this.geometry&&(this.geometry.clearGroups(),this.geometry.addGroup(0,this.indexAttribute.count))}cleanUp(){0===this.indexAttribute.count&&this.size>o&&this.clearAttributes()}get isEmpty(){return this.internalMesh.isEmpty}get mesh(){return void 0===this.internalMesh&&this.resize(),this.internalMesh}pickBoxes(e,t,i){const n=this.pickInfos.length,s=this.pickInfos,o=this.positionAttribute,a=e.x,c=e.y,h=document.createElement("canvas");for(let e=0;e<n;e++){const n=e*l,d=o.getX(n);if(a<d)continue;const u=o.getX(n+1);if(a>u)continue;const m=o.getY(n);if(c<m)continue;const p=o.getY(n+2);if(c>p)continue;const f=new r.Math2D.Box(d,m,u-d,p-m);void 0!==i&&void 0!==s[e].poiInfo&&void 0!==s[e].poiInfo.uvBox&&this.isPixelTransparent(i,a,c,f,s[e].poiInfo.uvBox,h)||void 0!==s[e]&&t(s[e])}}resize(e,t){return void 0!==this.geometry&&this.geometry.dispose(),this.geometry=new n.BufferGeometry,void 0!==e&&(!0===t||e>this.size)&&this.resizeBuffer(e),this.geometry.setAttribute("position",this.positionAttribute),this.geometry.setAttribute("color",this.colorAttribute),this.geometry.setAttribute("uv",this.uvAttribute),this.geometry.setIndex(this.indexAttribute),this.geometry.addGroup(0,this.indexAttribute.count),void 0===this.internalMesh?(this.internalMesh=new g(this.geometry,this.material),this.internalMesh.renderOrder=this.renderOrder):this.internalMesh.geometry=this.geometry,this.internalMesh}updateMemoryUsage(e){const t=this.positionAttribute.count*h*p+this.colorAttribute.count*d+this.uvAttribute.count*u*p+this.indexAttribute.count*f;e.heapSize+=t,e.gpuSize+=t}isPixelTransparent(e,t,i,r,n,o){let a=!1;const{u:l,v:c}=s.screenToUvCoordinates(t,i,r,n),h=e.width*l,d=e.height*c,u=s.getPixelFromImage(h,d,e,o);return void 0!==u&&0===u[3]&&(a=!0),a}clearAttributes(){this.positionAttribute=void 0,this.colorAttribute=void 0,this.uvAttribute=void 0,this.indexAttribute=void 0,this.resize(o,!0)}resizeBuffer(e){const t=new Float32Array(e*l*h);if(void 0!==this.positionAttribute&&this.positionAttribute.array.length>0){const e=this.positionAttribute.count;t.set(this.positionAttribute.array),this.positionAttribute.array=t,this.positionAttribute.count=e}else this.positionAttribute=new n.BufferAttribute(t,h),this.positionAttribute.count=0,this.positionAttribute.setUsage(n.DynamicDrawUsage);const i=new Uint8Array(e*l*d);if(void 0!==this.colorAttribute){const e=this.colorAttribute.count;i.set(this.colorAttribute.array),this.colorAttribute.array=i,this.colorAttribute.count=e}else this.colorAttribute=new n.BufferAttribute(i,d,!0),this.colorAttribute.count=0,this.colorAttribute.setUsage(n.DynamicDrawUsage);const r=new Float32Array(e*l*u);if(void 0!==this.uvAttribute){const e=this.uvAttribute.count;r.set(this.uvAttribute.array),this.uvAttribute.array=r,this.uvAttribute.count=e}else this.uvAttribute=new n.BufferAttribute(r,u),this.uvAttribute.count=0,this.uvAttribute.setUsage(n.DynamicDrawUsage);const s=e*c*m,o=s>65535?new Uint32Array(s):new Uint16Array(s);if(void 0!==this.indexAttribute){const e=this.indexAttribute.count;o.set(this.indexAttribute.array),this.indexAttribute.array=o,this.indexAttribute.count=e}else this.indexAttribute=new n.BufferAttribute(o,m),this.indexAttribute.count=0,this.indexAttribute.setUsage(n.DynamicDrawUsage);this.m_size=e}}t.BoxBuffer=v},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1);function n(e,t,i,r){if(t>e.width||t<0||i>e.height||i<0)return;let n;r.width=e.width,r.height=e.height;const s=r.getContext("2d");return null!==s&&(s.drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),n=s.getImageData(t,i,1,1).data),n}function s(e,t,i,r){if(!(t>e.width||t<0||i>e.height||i<0))return((e,t,i)=>{const r=t*i,n=e.data,s=new Uint8ClampedArray(i);for(let e=0;e<i;e++)s[0]=n[r+e];return s})(e,i*e.width+t,r)}t.getPixelFromImage=function(e,t,i,r){let o;if((e=>void 0!==e.close)(i))void 0===r&&(r=document.createElement("canvas")),o=n(i,e,t,r);else{const r=i;o=s(r,e,t,r.data.length/(r.height*r.width))}return o},t.screenToUvCoordinates=function(e,t,i,n){const s=i.x,o=i.x+i.w,a=i.y,l=i.y+i.h;return{u:r.MathUtils.map(e,s,o,n.s0,n.s1),v:r.MathUtils.map(t,a,l,n.t0,n.t1)}},t.getPixelFromImageBitmap=n,t.getPixelFromImageData=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PlacementStats=class{constructor(e){this.m_logger=e,this.totalGroups=0,this.resortedGroups=0,this.total=0,this.uninitialized=0,this.tooFar=0,this.numNotVisible=0,this.numPathTooSmall=0,this.numCannotAdd=0,this.numRenderedPoiIcons=0,this.numRenderedPoiTexts=0,this.numPoiTextsInvisible=0,this.numRenderedTextElements=0}clear(){this.totalGroups=0,this.resortedGroups=0,this.total=0,this.uninitialized=0,this.tooFar=0,this.numNotVisible=0,this.numPathTooSmall=0,this.numCannotAdd=0,this.numRenderedPoiIcons=0,this.numRenderedPoiTexts=0,this.numPoiTextsInvisible=0,this.numRenderedTextElements=0}log(){const e=this.uninitialized+this.numPoiTextsInvisible+this.tooFar+this.numNotVisible+this.numCannotAdd;this.m_logger.debug("Total groups",this.totalGroups),this.m_logger.debug("Resorted groups",this.resortedGroups),this.m_logger.debug("Total labels",this.total),this.m_logger.debug("Rendered labels",this.numRenderedTextElements),this.m_logger.debug("Rejected labels",e),this.m_logger.debug("Unitialized labels",this.uninitialized),this.m_logger.debug("Rendered poi icons",this.numRenderedPoiIcons),this.m_logger.debug("Rendered poi texts",this.numRenderedPoiTexts),this.m_logger.debug("Poi text invisible",this.numPoiTextsInvisible),this.m_logger.debug("Too far",this.tooFar),this.m_logger.debug("Not visible",this.numNotVisible),this.m_logger.debug("Path too small",this.numPathTooSmall),this.m_logger.debug("Rejected, max glyphs reached",this.numCannotAdd)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);class n extends r.LineCurve{constructor(e,t){super(e,t)}getLengths(){return void 0===this.m_lengths&&(this.m_lengths=[0,this.v2.distanceTo(this.v1)]),this.m_lengths}}t.SimpleLineCurve=n;class s{constructor(e,t,i){this.path=e,this.index=t,this.t=i}get curve(){return this.path.curves[this.index]}get point(){return void 0===this.m_point&&(this.m_point=this.curve.getPoint(this.t)),this.m_point}}t.PathParam=s;class o extends r.Path{constructor(){super()}getLengths(){if(this.m_cache)return this.m_cache;let e=0;const t=new Array;return t.push(0),this.curves.forEach(i=>{const r=i;e+=r.v1.distanceTo(r.v2),t.push(e)}),this.m_cache=t,t}getParamAt(e){const t=e*this.getLength(),i=this.getCurveLengths();for(let e=0;e<i.length;++e){if(i[e]<t)continue;const r=i[e]-t,n=this.curves[e].getLength();return new s(this,e,0===n?0:1-r/n)}return null}}t.SimplePath=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r="./resources/fonts/Default_FontCatalog.json",n=500,s=300,o=.99,a=.7,l=1.5,c=1024,h=32768;t.initializeDefaultOptions=function(e){void 0===e.fontCatalog&&(e.fontCatalog=r),void 0===e.minNumGlyphs&&(e.minNumGlyphs=c),void 0===e.maxNumGlyphs&&(e.maxNumGlyphs=h),void 0===e.maxNumVisibleLabels&&(e.maxNumVisibleLabels=n),void 0===e.numSecondChanceLabels&&(e.numSecondChanceLabels=s),void 0===e.labelDistanceScaleMin&&(e.labelDistanceScaleMin=a),void 0===e.labelDistanceScaleMax&&(e.labelDistanceScaleMax=l),void 0===e.maxDistanceRatioForTextLabels&&(e.maxDistanceRatioForTextLabels=o),void 0===e.maxDistanceRatioForPoiLabels&&(e.maxDistanceRatioForPoiLabels=o),void 0===e.disableFading&&(e.disableFading=!1)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(197),s=r.LoggerManager.instance.create("TextElementsStateCache",{level:r.LogLevel.Log});const o={entries:[],index:-1};function a(e){return e.hasFeatureId()?e.featureId:e.text}t.TextElementStateCache=class{constructor(){this.m_referenceMap=new Map,this.m_textMap=new Map}getOrSet(e,t){let i=this.get(e);return void 0!==i?(r.assert(i.size===e.elements.length),i.updateElements(t),[i,!0]):(i=new n.TextElementGroupState(e,t),this.set(e,i),[i,!1])}get size(){return this.m_referenceMap.size}get sortedGroupStates(){return void 0===this.m_sortedGroupStates&&(this.m_sortedGroupStates=Array.from(this.m_referenceMap.values()),this.m_sortedGroupStates.sort((e,t)=>t.group.priority-e.group.priority)),r.assert(this.m_referenceMap.size===this.m_sortedGroupStates.length),this.m_sortedGroupStates}update(e,t,i,r){const n=i?this.replaceElement.bind(this,r):void 0;let s=!1;for(const[r,o]of this.m_referenceMap.entries())o.visited?o.updateFading(e,t):(i&&o.traverseVisibleElements(n),this.m_referenceMap.delete(r),this.m_sortedGroupStates=void 0,s=!0);return s}clearVisited(){for(const e of this.m_referenceMap.values())e.visited=!1}clearTextCache(){this.m_textMap.clear()}clear(){this.m_referenceMap.clear(),this.m_sortedGroupStates=void 0,this.m_textMap.clear()}deduplicateElement(e,t){const i=a(t.element),r=this.findDuplicate(t,i,e);if(void 0===r)return this.m_textMap.set(i,[t]),!0;if(-1===r.index)return r.entries.push(t),!0;const n=r.entries[r.index];return!(n.visible||!t.visible)&&(r.entries[r.index]=t,n.reset(),!0)}replaceElement(e,t){r.assert(t.visible);const i=t.element,n=this.findDuplicate(t,a(i),e);if(void 0===n||-1===n.index)return;const s=n.entries[n.index];r.assert(!s.visible),s.replace(t)}get(e){const t=this.m_referenceMap.get(e);return void 0!==t&&(t.visited=!0),t}set(e,t){r.assert(e.elements.length>0),this.m_referenceMap.set(e,t),this.m_sortedGroupStates=void 0}findDuplicate(e,t,i){const n=e.element,a=this.m_textMap.get(t);if(void 0===a)return;if(o.entries=a,n.hasFeatureId()){if(o.index=a.findIndex(e=>e.element.tileOffset===n.tileOffset),-1===o.index)return o;const e=a[o.index].element;return r.assert(n.featureId===e.featureId),e.text!==n.text&&(o.index=-1,s.warn(`Text feature id ${n.featureId} collision between "${n.text} and                      ${e.text}`)),o}const l=function(e){return 100<<(Math.min(4,13-Math.min(13,Math.floor(e)))<<2)}(i),c=a.length,h=n.position,d=e.visible;let u=-1;for(let e=0;e<c;++e){const t=a[e];if((!d||!t.visible)&&h.distanceToSquared(t.element.position)<l){u=e;break}}return o.index=u,o}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(198);t.TextElementGroupState=class{constructor(e,t){this.group=e,this.m_visited=!1,r.assert(e.elements.length>0);const i=e.elements.length;this.m_textElementStates=new Array(i),this.m_visited=!0;for(let r=0;r<i;++r){const i=e.elements[r],s=new n.TextElementState(i),o=t(s);s.update(o),this.m_textElementStates[r]=s}}get visited(){return this.m_visited}set visited(e){this.m_visited=e}get priority(){return this.m_textElementStates[0].element.priority}updateFading(e,t){for(const i of this.m_textElementStates)void 0!==i&&i.updateFading(e,t)}traverseVisibleElements(e){for(const t of this.m_textElementStates)void 0!==t&&t.visible&&e(t)}updateElements(e){for(const t of this.m_textElementStates){const i=e(t);t.update(i)}}get size(){return this.m_textElementStates.length}get textElementStates(){return this.m_textElementStates}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(199),s=i(35);t.TextElementState=class{constructor(e){this.element=e}get initialized(){return void 0!==this.m_textRenderState||void 0!==this.m_iconRenderStates}get visible(){if(void 0!==this.m_textRenderState&&this.m_textRenderState.isVisible())return!0;const e=this.iconRenderState;if(void 0!==e&&e.isVisible())return!0;const t=this.iconRenderStates;if(void 0===t)return!1;for(const e of t)if(e.isVisible())return!0;return!1}reset(){if(void 0!==this.m_textRenderState&&this.m_textRenderState.reset(),this.iconRenderState)this.m_iconRenderStates.reset();else if(void 0!==this.m_iconRenderStates)for(const e of this.m_iconRenderStates)e.reset();this.m_viewDistance=void 0}replace(e){this.m_textRenderState=e.m_textRenderState,this.m_iconRenderStates=e.m_iconRenderStates,e.m_textRenderState=void 0,e.m_iconRenderStates=void 0,void 0===this.element.glyphs&&(this.element.glyphs=e.element.glyphs,this.element.bounds=e.element.bounds,this.element.glyphCaseArray=e.element.glyphCaseArray)}get viewDistance(){return this.m_viewDistance}update(e){this.initialized?this.setViewDistance(e):void 0!==e&&this.initialize(e)}setViewDistance(e){e!==this.m_viewDistance&&(this.m_viewDistance=e)}get renderDistance(){return!0===this.element.alwaysOnTop?0:void 0!==this.m_viewDistance?-this.m_viewDistance:0}get textRenderState(){return this.m_textRenderState}get iconRenderState(){if(void 0!==this.m_iconRenderStates)return this.m_iconRenderStates instanceof n.RenderState?this.m_iconRenderStates:void 0}get iconRenderStates(){if(void 0!==this.m_iconRenderStates)return this.m_iconRenderStates instanceof n.RenderState?void 0:this.m_iconRenderStates}updateFading(e,t){if(void 0!==this.m_textRenderState&&this.m_textRenderState.updateFading(e,t),void 0!==this.iconRenderState){this.m_iconRenderStates.updateFading(e,t)}else if(void 0!==this.iconRenderStates)for(const i of this.m_iconRenderStates)i.updateFading(e,t)}initialize(e){if(r.assert(void 0===this.m_textRenderState),r.assert(void 0===this.m_iconRenderStates),this.setViewDistance(e),this.element.type!==s.TextElementType.LineMarker)this.m_textRenderState=new n.RenderState,this.element.type===s.TextElementType.PoiLabel&&(this.m_iconRenderStates=new n.RenderState);else{this.m_iconRenderStates=new Array;for(const e of this.element.points){const e=this.m_iconRenderStates,t=new n.RenderState;e.push(t)}}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(0);var s;!function(e){e[e.Undefined=0]="Undefined",e[e.FadingIn=1]="FadingIn",e[e.FadedIn=2]="FadedIn",e[e.FadingOut=-1]="FadingOut",e[e.FadedOut=-2]="FadedOut"}(s=t.FadingState||(t.FadingState={})),t.DEFAULT_FADE_TIME=800;t.RenderState=class{constructor(e=0,t=0,i=1){this.value=e,this.startTime=t,this.opacity=i,this.m_state=s.Undefined}reset(){this.m_state=s.Undefined,this.value=0,this.startTime=0,this.opacity=1}isUndefined(){return this.m_state===s.Undefined}isFading(){return this.m_state===s.FadingIn||this.m_state===s.FadingOut}isFadingIn(){return this.m_state===s.FadingIn}isFadingOut(){return this.m_state===s.FadingOut}isFadedIn(){return this.m_state===s.FadedIn}isFadedOut(){return this.m_state===s.FadedOut}isVisible(){return this.m_state!==s.FadedOut&&this.m_state!==s.Undefined}startFadeIn(e){this.m_state!==s.FadingIn&&this.m_state!==s.FadedIn&&(this.m_state===s.FadingOut?(this.value=1-this.value,this.startTime=e-this.value*t.DEFAULT_FADE_TIME):(this.startTime=e,this.value=0,this.opacity=0),this.m_state=s.FadingIn)}startFadeOut(e){this.m_state!==s.FadingOut&&this.m_state!==s.FadedOut&&(this.m_state===s.FadingIn?(this.startTime=e-this.value*t.DEFAULT_FADE_TIME,this.value=1-this.value):(this.startTime=e,this.value=0,this.opacity=1),this.m_state=s.FadingOut)}updateFading(e,i){if(this.m_state!==s.FadingIn&&this.m_state!==s.FadingOut)return;0===this.startTime&&(this.startTime=e);const o=e-this.startTime,a=this.m_state===s.FadingIn?0:1,l=this.m_state===s.FadingIn?1:0;i||o>=t.DEFAULT_FADE_TIME?(this.value=1,this.opacity=l,this.m_state=this.m_state===s.FadingIn?s.FadedIn:s.FadedOut):(this.value=o/t.DEFAULT_FADE_TIME,this.opacity=n.Math.clamp(r.MathUtils.smootherStep(a,l,this.value),0,1),r.assert(this.isFading()))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(86);t.UpdateStats=class{constructor(e){this.m_logger=e,this.tiles=0,this.totalGroups=0,this.newGroups=0,this.totalLabels=0,this.results=new Array(r.PrePlacementResult.Count),this.results.fill(0)}clear(){this.tiles=0,this.totalGroups=0,this.newGroups=0,this.totalLabels=0,this.results.fill(0)}log(){this.m_logger.debug("Tiles",this.tiles),this.m_logger.debug("Total groups",this.totalGroups),this.m_logger.debug("New groups",this.newGroups),this.m_logger.debug("Total labels",this.totalLabels),this.m_logger.debug("Placed labels",this.results[r.PrePlacementResult.Ok]),this.m_logger.debug("Invisible",this.results[r.PrePlacementResult.Invisible]),this.m_logger.debug("Poi not ready",this.results[r.PrePlacementResult.NotReady]),this.m_logger.debug("Too far",this.results[r.PrePlacementResult.TooFar]),this.m_logger.debug("Duplicate",this.results[r.PrePlacementResult.Duplicate])}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1);class n extends r.PriorityListGroup{}t.TextElementGroup=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1);class n extends r.GroupedPriorityList{}t.TextElementGroupPriorityList=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(4),s=i(204),o=i(91),a=i(205),l=i(25),c=i(206),h=o.MSAASampling.Level_1,d=o.MSAASampling.Level_4;t.MapRenderingManager=class{constructor(e,t,i,a={msaaEnabled:!1}){this.bloom={enabled:!1,strength:1.5,radius:.4,threshold:.85},this.outline={enabled:!1,thickness:.005,color:"#000000",ghostExtrudedPolygons:!1,needsUpdate:!1},this.vignette={enabled:!1,offset:1,darkness:1},this.sepia={enabled:!1,amount:.5},this.m_width=1,this.m_height=1,this.m_renderPass=new l.RenderPass,this.m_target1=new r.WebGLRenderTarget(1,1),this.m_target2=new r.WebGLRenderTarget(1,1),this.m_sepiaPass=new l.ShaderPass(n.SepiaShader),this.m_vignettePass=new l.ShaderPass(n.VignetteShader),this.m_readBuffer=new r.WebGLRenderTarget(e,t),this.m_msaaPass=new o.MSAARenderPass,this.m_msaaPass.enabled=void 0!==a&&!0===a.msaaEnabled,this.m_dynamicMsaaSamplingLevel=void 0===a.dynamicMsaaSamplingLevel?h:a.dynamicMsaaSamplingLevel,this.m_staticMsaaSamplingLevel=void 0===a.staticMsaaSamplingLevel?d:a.staticMsaaSamplingLevel,this.m_lowResPass=new s.LowResRenderPass(i),this.m_lowResPass.enabled=void 0!==i}updateOutline(e){this.outline.color=e.color,this.outline.thickness=e.thickness,this.outline.ghostExtrudedPolygons=e.ghostExtrudedPolygons,this.outline.needsUpdate=!0}render(e,t,i,n){if(!n&&void 0!==this.m_lowResPass.pixelRatio)return this.m_lowResPass.renderToScreen=!0,void this.m_lowResPass.render(e,t,i,null,this.m_readBuffer);const s=this.bloom.enabled||this.outline.enabled||this.vignette.enabled||this.sepia.enabled;let o=null;if((this.bloom.enabled||this.vignette.enabled||this.sepia.enabled)&&(e.setRenderTarget(this.m_target1),e.clearDepth()),this.m_msaaPass.enabled?(this.m_msaaPass.samplingLevel=n?this.m_staticMsaaSamplingLevel:this.m_dynamicMsaaSamplingLevel,this.m_msaaPass.renderToScreen=!s,this.m_msaaPass.render(e,t,i,null,this.m_readBuffer)):this.bloom.enabled||this.vignette.enabled||this.sepia.enabled?(o=this.m_target1,this.m_renderPass.render(e,t,i,this.m_target1,null)):(!this.outline.enabled||this.outline.enabled&&!this.bloom.enabled)&&e.render(t,i),this.outline.enabled){void 0===this.m_outlineEffect&&(this.m_outlineEffect=new a.OutlineEffect(e)),this.outline.needsUpdate&&(this.m_outlineEffect.color=this.outline.color,this.m_outlineEffect.thickness=this.outline.thickness,this.m_outlineEffect.ghostExtrudedPolygons=this.outline.ghostExtrudedPolygons,this.outline.needsUpdate=!1);const r=this.bloom.enabled||this.vignette.enabled||this.sepia.enabled;r&&(o=this.m_target1),e.setRenderTarget(r?o:null),this.m_outlineEffect.render(t,i)}if(this.bloom.enabled){void 0===this.m_bloomPass&&(this.m_bloomPass=new c.BloomPass(new r.Vector2(this.m_width,this.m_height),this.bloom.strength,this.bloom.radius,this.bloom.threshold));const n=this.vignette.enabled||this.sepia.enabled;this.m_bloomPass.renderToScreen=!n,this.m_bloomPass.radius=this.bloom.radius,this.m_bloomPass.strength=this.bloom.strength,this.m_bloomPass.threshold=this.bloom.threshold,this.m_bloomPass.render(e,t,i,null,o)}else void 0!==this.m_bloomPass&&(this.m_bloomPass.dispose(),this.m_bloomPass=void 0);if(this.vignette.enabled){const r=o,n=this.sepia.enabled;this.m_vignettePass.uniforms.offset.value=this.vignette.offset,this.m_vignettePass.uniforms.darkness.value=this.vignette.darkness,this.m_vignettePass.renderToScreen=!n,n&&(o=o===this.m_target1?this.m_target2:this.m_target1),this.m_vignettePass.render(e,t,i,o,r)}this.sepia.enabled&&(this.m_sepiaPass.renderToScreen=!0,this.m_sepiaPass.uniforms.amount.value=this.sepia.amount,this.m_sepiaPass.render(e,t,i,null,o))}setSize(e,t){this.m_readBuffer.setSize(e,t),this.m_msaaPass.setSize(e,t),void 0!==this.m_bloomPass&&this.m_bloomPass.setSize(e,t),this.m_lowResPass.setSize(e,t),this.m_target1.setSize(e,t),this.m_target2.setSize(e,t),this.m_width=e,this.m_height=t}get lowResPixelRatio(){return this.m_lowResPass.pixelRatio}set lowResPixelRatio(e){this.m_lowResPass.pixelRatio=e,this.m_lowResPass.enabled=void 0!==e}set dynamicMsaaSamplingLevel(e){this.m_dynamicMsaaSamplingLevel=e}get dynamicMsaaSamplingLevel(){return this.m_dynamicMsaaSamplingLevel}set msaaEnabled(e){this.m_msaaPass.enabled=e}get msaaEnabled(){return this.m_msaaPass.enabled}set staticMsaaSamplingLevel(e){this.m_staticMsaaSamplingLevel=e}get staticMsaaSamplingLevel(){return this.m_staticMsaaSamplingLevel}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),n=i(0),s=i(25);class o extends s.Pass{constructor(e){super(),this.lowResPixelRatio=e,this.m_renderTarget=null,this.m_localCamera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_quadScene=new n.Scene,this.m_quadUniforms=r.CopyShader.uniforms,this.m_quadMaterial=new r.CopyMaterial(this.m_quadUniforms),this.m_quad=new n.Mesh(new n.PlaneBufferGeometry(2,2),this.m_quadMaterial),this.m_savedWidth=0,this.m_savedHeight=0,this.m_quad.frustumCulled=!1,this.m_quadScene.add(this.m_quad),this.m_pixelRatio=e}dispose(){this.m_quadMaterial.dispose(),this.m_quad.geometry.dispose(),null!==this.m_renderTarget&&(this.m_renderTarget.dispose(),this.m_renderTarget=null)}set pixelRatio(e){this.m_pixelRatio=e,this.m_renderTarget&&void 0!==this.pixelRatio&&this.m_renderTarget.setSize(Math.floor(this.m_savedWidth*this.pixelRatio),Math.floor(this.m_savedHeight*this.pixelRatio))}get pixelRatio(){return this.m_pixelRatio}render(e,t,i,r,s){if(!this.enabled||void 0===this.pixelRatio)return;null===this.m_renderTarget&&(this.m_savedWidth=s.width,this.m_savedHeight=s.height,this.m_renderTarget=new n.WebGLRenderTarget(Math.floor(this.m_savedWidth*this.pixelRatio),Math.floor(this.m_savedHeight*this.pixelRatio),{minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat,depthBuffer:!0,stencilBuffer:!0}),this.m_renderTarget.texture.name="LowResRenderPass.sample"),this.m_quadUniforms.tDiffuse.value=this.m_renderTarget.texture,this.m_quadUniforms.opacity.value=1;const o=e.getRenderTarget();e.setRenderTarget(this.m_renderTarget),e.clear(),e.render(t,i),e.setRenderTarget(this.renderToScreen?null:r),e.clear(),e.render(this.m_quadScene,this.m_localCamera),e.setRenderTarget(o)}setSize(e,t){this.m_savedWidth=e,this.m_savedHeight=t,this.m_renderTarget&&void 0!==this.pixelRatio&&this.m_renderTarget.setSize(Math.floor(e*this.pixelRatio),Math.floor(t*this.pixelRatio))}}t.LowResRenderPass=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(0),s="\n    uniform float outlineThickness;\n\n    vec4 calculateOutline( vec4 pos, vec3 objectNormal, vec4 skinned ) {\n\n        float thickness = outlineThickness;\n        const float ratio = 1.0;\n        vec4 pos2 = projectionMatrix * modelViewMatrix * vec4( skinned.xyz + objectNormal, 1.0 );\n        vec4 norm = normalize( pos - pos2 );\n        return pos + norm * thickness * pos.w * ratio;\n\n    }",o="\n    #if ! defined( LAMBERT ) && ! defined( PHONG ) && ! defined( TOON ) && ! defined( STANDARD )\n        #ifndef USE_ENVMAP\n            vec3 objectNormal = normalize( normal );\n        #endif\n    #endif\n\n    #ifdef FLIP_SIDED\n        objectNormal = -objectNormal;\n    #endif\n\n    #ifdef DECLARE_TRANSFORMED\n        vec3 transformed = vec3( position );\n    #endif\n\n    gl_Position = calculateOutline( gl_Position, objectNormal, vec4( transformed, 1.0 ) );\n\n    #include <fog_vertex>",a="\n    #include <common>\n    #include <fog_pars_fragment>\n\n    uniform vec3 outlineColor;\n    uniform float outlineAlpha;\n\n    void main() {\n\n        gl_FragColor = vec4( outlineColor, outlineAlpha );\n\n        #include <fog_fragment>\n\n    }";t.OutlineEffect=class{constructor(e){this.m_renderer=e,this.enabled=!0,this.m_defaultThickness=.02,this.m_defaultColor=new n.Color(0,0,0),this.m_defaultAlpha=1,this.m_defaultKeepAlive=!1,this.m_ghostExtrudedPolygons=!1,this.m_cache={},this.m_removeThresholdCount=60,this.m_originalMaterials={},this.m_originalOnBeforeRenders={},this.m_shaderIDs={MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical"},this.m_uniformsChunk={outlineThickness:{value:this.m_defaultThickness},outlineColor:{value:this.m_defaultColor},outlineAlpha:{value:this.m_defaultAlpha}},this.autoClear=e.autoClear,this.domElement=e.domElement,this.shadowMap=e.shadowMap}set thickness(e){this.m_defaultThickness=e,this.m_uniformsChunk.outlineThickness.value=e,this.m_cache={}}set color(e){this.m_defaultColor.set(e),this.m_cache={}}set ghostExtrudedPolygons(e){this.m_ghostExtrudedPolygons=e}clear(e,t,i){this.m_renderer.clear(e,t,i)}getPixelRatio(){return this.m_renderer.getPixelRatio()}setPixelRatio(e){this.m_renderer.setPixelRatio(e)}getSize(e){return this.m_renderer.getSize(e)}setSize(e,t,i){this.m_renderer.setSize(e,t,i)}setViewport(e,t,i,r){this.m_renderer.setViewport(e,t,i,r)}setScissor(e,t,i,r){this.m_renderer.setScissor(e,t,i,r)}setScissorTest(e){this.m_renderer.setScissorTest(e)}setRenderTarget(e){this.m_renderer.setRenderTarget(e)}render(e,t){if(this.m_ghostExtrudedPolygons){if(!this.enabled)return void this.m_renderer.render(e,t);const i=this.m_renderer.autoClear;this.m_renderer.autoClear=this.autoClear,this.m_renderer.render(e,t),this.m_renderer.autoClear=i}this.renderOutline(e,t)}renderOutline(e,t){const i=this.m_renderer.autoClear,r=e.autoUpdate,n=e.background,s=this.m_renderer.shadowMap.enabled;e.autoUpdate=!1,e.background=null,this.m_renderer.autoClear=!1,this.m_renderer.shadowMap.enabled=!1,e.traverse(this.setOutlineMaterial.bind(this)),this.m_renderer.render(e,t),e.traverse(this.restoreOriginalMaterial.bind(this)),this.cleanupCache(),e.autoUpdate=r,e.background=n,this.m_renderer.autoClear=i,this.m_renderer.shadowMap.enabled=s}createInvisibleMaterial(){return new n.ShaderMaterial({name:"invisible",visible:!1})}createMaterial(e){const t=this.m_shaderIDs[e.type];let i,r;if(void 0!==t){const e=n.ShaderLib[t];i=e.uniforms,r=e.vertexShader}else if(!0===e.isRawShaderMaterial){if(i=e.uniforms,r=e.vertexShader,!/attribute\s+vec3\s+position\s*;/.test(r)||!/attribute\s+vec3\s+normal\s*;/.test(r))return this.createInvisibleMaterial()}else{if(!0!==e.isShaderMaterial)return this.createInvisibleMaterial();i=e.uniforms,r=e.vertexShader}const l=Object.assign(Object.assign({},i),this.m_uniformsChunk),c=r.replace(/void\s+main\s*\(\s*\)/,s+"\nvoid main()").replace(/\}\s*$/,o+"\n}").replace(/#include\s+<[\w_]*light[\w_]*>/g,""),h={};return/vec3\s+transformed\s*=/.test(r)||/#include\s+<begin_vertex>/.test(r)||(h.DECLARE_TRANSFORMED=!0),new n.ShaderMaterial({defines:h,uniforms:l,vertexShader:c,fragmentShader:a,side:n.BackSide,skinning:!1,morphTargets:!1,morphNormals:!1,fog:!1})}getOutlineMaterialFromCache(e){let t=this.m_cache[e.uuid];return void 0===t&&(t={material:this.createMaterial(e),used:!0,keepAlive:this.m_defaultKeepAlive,count:0},this.m_cache[e.uuid]=t),t.used=!0,t.material}getOutlineMaterial(e){const t=this.getOutlineMaterialFromCache(e);return this.m_originalMaterials[t.uuid]=e,this.updateOutlineMaterial(t,e),t}setOutlineMaterial(e){if(void 0!==e.material){if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)e.material[t]=this.getOutlineMaterial(e.material[t]);else e.material=this.getOutlineMaterial(e.material);this.m_originalOnBeforeRenders[e.uuid]=e.onBeforeRender,e.onBeforeRender=r.chainCallbacks(e.onBeforeRender,this.onBeforeRender.bind(this))}}restoreOriginalMaterial(e){if(void 0!==e.material){if(Array.isArray(e.material))for(let t=0,i=e.material.length;t<i;t++)e.material[t]=this.m_originalMaterials[e.material[t].uuid];else e.material=this.m_originalMaterials[e.material.uuid];e.onBeforeRender=this.m_originalOnBeforeRenders[e.uuid]}}onBeforeRender(e,t,i,r,n,s){const o=this.m_originalMaterials[n.uuid];void 0!==o&&this.updateUniforms(n,o)}updateUniforms(e,t){const i=t.userData.outlineParameters;e.uniforms.outlineAlpha.value=t.opacity,void 0!==i&&(void 0!==i.thickness&&(e.uniforms.outlineThickness.value=i.thickness),void 0!==i.color&&e.uniforms.outlineColor.value.fromArray(i.color),void 0!==i.alpha&&(e.uniforms.outlineAlpha.value=i.alpha))}updateOutlineMaterial(e,t){if("invisible"===e.name)return;const i=t.userData.outlineParameters;e.skinning=t.skinning,e.morphTargets=t.morphTargets,e.morphNormals=t.morphNormals,e.fog=t.fog,void 0!==i?(e.visible=!1!==t.visible&&(void 0===i.visible||i.visible),e.transparent=void 0!==i.alpha&&i.alpha<1||t.transparent,void 0!==i.keepAlive&&(this.m_cache[t.uuid].keepAlive=i.keepAlive)):(e.transparent=t.transparent,e.visible=t.visible),!0!==t.wireframe&&!1!==t.depthTest||(e.visible=!1)}cleanupCache(){let e;e=Object.keys(this.m_originalMaterials);for(let t=0,i=e.length;t<i;t++)this.m_originalMaterials[e[t]]=void 0;e=Object.keys(this.m_originalOnBeforeRenders);for(let t=0,i=e.length;t<i;t++)this.m_originalOnBeforeRenders[e[t]]=void 0;e=Object.keys(this.m_cache);for(const t of e)!1===this.m_cache[t].used?(this.m_cache[t].count++,!1===this.m_cache[t].keepAlive&&this.m_cache[t].count>this.m_removeThresholdCount&&delete this.m_cache[t]):(this.m_cache[t].used=!1,this.m_cache[t].count=0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),n=i(0),s=i(25),o=new n.Vector2(1,0),a=new n.Vector2(0,1);class l extends s.Pass{constructor(e,t,i,s){super(),this.resolution=new n.Vector2(256,256),this.m_renderTargetsHorizontal=[],this.m_renderTargetsVertical=[],this.m_nMips=5,this.m_separableBlurMaterials=[],this.m_camera=new n.OrthographicCamera(-1,1,1,-1,0,1),this.m_scene=new n.Scene,this.m_basic=new n.MeshBasicMaterial,this.m_quad=new n.Mesh(new n.PlaneBufferGeometry(2,2)),this.m_bloomTintColors=[new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1),new n.Vector3(1,1,1)],this.strength=t,this.radius=i,this.threshold=s,this.resolution=e,this.m_quad.frustumCulled=!1,this.m_scene.add(this.m_quad);const o={minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat};let a=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);this.m_renderTargetBright=new n.WebGLRenderTarget(a,l,o),this.m_renderTargetBright.texture.name="UnrealBloomPass.bright",this.m_renderTargetBright.texture.generateMipmaps=!1;for(let e=0;e<this.m_nMips;e++){const t=new n.WebGLRenderTarget(a,l,o);t.texture.name="UnrealBloomPass.h"+e,t.texture.generateMipmaps=!1,this.m_renderTargetsHorizontal.push(t);const i=new n.WebGLRenderTarget(a,l,o);i.texture.name="UnrealBloomPass.v"+e,i.texture.generateMipmaps=!1,this.m_renderTargetsVertical.push(i),a=Math.round(a/2),l=Math.round(l/2)}this.m_highPassUniforms=n.UniformsUtils.clone(r.LuminosityHighPassShader.uniforms),this.m_highPassUniforms.luminosityThreshold.value=s,this.m_highPassUniforms.smoothWidth.value=.01,this.m_materialHighPassFilter=new n.ShaderMaterial({uniforms:this.m_highPassUniforms,vertexShader:r.LuminosityHighPassShader.vertexShader,fragmentShader:r.LuminosityHighPassShader.fragmentShader,defines:{}});const c=[3,5,7,9,11];a=Math.round(this.resolution.x/2),l=Math.round(this.resolution.y/2);for(let e=0;e<this.m_nMips;e++)this.m_separableBlurMaterials.push(this.getSeperableBlurMaterial(c[e])),this.m_separableBlurMaterials[e].uniforms.texSize.value=new n.Vector2(a,l),a=Math.round(a/2),l=Math.round(l/2);this.m_compositeMaterial=this.getCompositeMaterial(this.m_nMips),this.m_compositeMaterial.uniforms.blurTexture1.value=this.m_renderTargetsVertical[0].texture,this.m_compositeMaterial.uniforms.blurTexture2.value=this.m_renderTargetsVertical[1].texture,this.m_compositeMaterial.uniforms.blurTexture3.value=this.m_renderTargetsVertical[2].texture,this.m_compositeMaterial.uniforms.blurTexture4.value=this.m_renderTargetsVertical[3].texture,this.m_compositeMaterial.uniforms.blurTexture5.value=this.m_renderTargetsVertical[4].texture,this.m_compositeMaterial.uniforms.bloomStrength.value=t,this.m_compositeMaterial.uniforms.bloomRadius.value=.1,this.m_compositeMaterial.needsUpdate=!0;this.m_compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.m_compositeMaterial.uniforms.bloomTintColors.value=this.m_bloomTintColors,this.m_copyUniforms=n.UniformsUtils.clone(r.CopyShader.uniforms),this.m_copyUniforms.opacity.value=1,this.m_materialCopy=new n.ShaderMaterial({uniforms:this.m_copyUniforms,vertexShader:r.CopyShader.vertexShader,fragmentShader:r.CopyShader.fragmentShader,blending:n.AdditiveBlending,depthTest:!1,depthWrite:!1,transparent:!0})}dispose(){for(const e of this.m_renderTargetsHorizontal)e.dispose();for(const e of this.m_renderTargetsVertical)e.dispose();this.m_renderTargetBright.dispose()}setSize(e,t){let i=Math.round(e/2),r=Math.round(t/2);this.m_renderTargetBright.setSize(i,r);for(let e=0;e<this.m_nMips;e++)this.m_renderTargetsHorizontal[e].setSize(i,r),this.m_renderTargetsVertical[e].setSize(i,r),this.m_separableBlurMaterials[e].uniforms.texSize.value=new n.Vector2(i,r),i=Math.round(i/2),r=Math.round(r/2)}render(e,t,i,r,n){this.renderToScreen&&(this.m_quad.material=this.m_basic,this.m_basic.map=n.texture,e.setRenderTarget(null),e.clear(),e.render(this.m_scene,this.m_camera)),this.m_highPassUniforms.tDiffuse.value=n.texture,this.m_highPassUniforms.luminosityThreshold.value=this.threshold,this.m_quad.material=this.m_materialHighPassFilter,e.setRenderTarget(this.m_renderTargetBright),e.clear(),e.render(this.m_scene,this.m_camera);let s=this.m_renderTargetBright;for(let t=0;t<this.m_nMips;t++)this.m_quad.material=this.m_separableBlurMaterials[t],this.m_separableBlurMaterials[t].uniforms.colorTexture.value=s.texture,this.m_separableBlurMaterials[t].uniforms.direction.value=o,e.setRenderTarget(this.m_renderTargetsHorizontal[t]),e.clear(),e.render(this.m_scene,this.m_camera),this.m_separableBlurMaterials[t].uniforms.colorTexture.value=this.m_renderTargetsHorizontal[t].texture,this.m_separableBlurMaterials[t].uniforms.direction.value=a,e.setRenderTarget(this.m_renderTargetsVertical[t]),e.clear(),e.render(this.m_scene,this.m_camera),s=this.m_renderTargetsVertical[t];this.m_quad.material=this.m_compositeMaterial,this.m_compositeMaterial.uniforms.bloomStrength.value=this.strength,this.m_compositeMaterial.uniforms.bloomRadius.value=this.radius,this.m_compositeMaterial.uniforms.bloomTintColors.value=this.m_bloomTintColors,e.setRenderTarget(this.m_renderTargetsHorizontal[0]),e.clear(),e.render(this.m_scene,this.m_camera),this.m_quad.material=this.m_materialCopy,this.m_copyUniforms.tDiffuse.value=this.m_renderTargetsHorizontal[0].texture,this.renderToScreen?(e.setRenderTarget(null),e.render(this.m_scene,this.m_camera)):(e.setRenderTarget(n),e.render(this.m_scene,this.m_camera))}getSeperableBlurMaterial(e){return new n.ShaderMaterial({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new n.Vector2(.5,.5)},direction:{value:new n.Vector2(.5,.5)}},vertexShader:"varying vec2 vUv;\n            void main() {\n                vUv = uv;\n                gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n            }",fragmentShader:"#include <common>\n            varying vec2 vUv;\n            uniform sampler2D colorTexture;\n            uniform vec2 texSize;\n            uniform vec2 direction;\n\n            float gaussianPdf(in float x, in float sigma) {\n                return 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\n            }\n            void main() {\n                vec2 invSize = 1.0 / texSize;\n                float fSigma = float(SIGMA);\n                float weightSum = gaussianPdf(0.0, fSigma);\n                vec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\n                for( int i = 1; i < KERNEL_RADIUS; i ++ ) {\n                    float x = float(i);\n                    float w = gaussianPdf(x, fSigma);\n                    vec2 uvOffset = direction * invSize * x;\n                    vec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\n                    vec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\n                    diffuseSum += (sample1 + sample2) * w;\n                    weightSum += 2.0 * w;\n                }\n                gl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n            }"})}getCompositeMaterial(e){return new n.ShaderMaterial({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n                void main() {\n                    vUv = uv;\n                    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n                }",fragmentShader:"varying vec2 vUv;\n                uniform sampler2D blurTexture1;\n                uniform sampler2D blurTexture2;\n                uniform sampler2D blurTexture3;\n                uniform sampler2D blurTexture4;\n                uniform sampler2D blurTexture5;\n                uniform sampler2D dirtTexture;\n                uniform float bloomStrength;\n                uniform float bloomRadius;\n                uniform float bloomFactors[NUM_MIPS];\n                uniform vec3 bloomTintColors[NUM_MIPS];\n\n                float lerpBloomFactor(const in float factor) {\n                    float mirrorFactor = 1.2 - factor;\n                    return mix(factor, mirrorFactor, bloomRadius);\n                }\n\n                void main() {\n                    gl_FragColor = bloomStrength * (\nlerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) +\nlerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) +\nlerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) +\nlerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) +\nlerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\n                }"})}}t.BloomPass=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isWorkerBootstrapRequest=function(e){return e&&"worker-bootstrap-request"===e.type&&Array.isArray(e.dependencies)},t.isWorkerBootstrapResponse=function(e){return e&&"worker-bootstrap-response"===e.type&&Array.isArray(e.resolvedDependencies)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(3),n=i(1),s=i(0),o=i(95),a=i(209),l=i(9);class c{constructor(e,t,i=0,r=0,n=0){this.tileKey=e,this.area=t,this.offset=i,this.minElevation=r,this.maxElevation=n}}function h(e,t,i){const r=e.getGeoBox(t),n=360*i;return r.northEast.longitude+=n,r.southWest.longitude+=n,r}t.TileKeyEntry=c;t.FrustumIntersection=class{constructor(e,t,i,r){this.m_camera=e,this.mapView=t,this.m_extendedFrustumCulling=i,this.m_tileWrappingEnabled=r,this.m_frustum=new s.Frustum,this.m_viewProjectionMatrix=new s.Matrix4,this.m_rootTileKeys=[],this.m_tileKeyEntries=new Map,this.m_mapTileCuller=new a.MapTileCuller(e)}get camera(){return this.m_camera}get projection(){return this.mapView.projection}updateFrustum(e){this.m_viewProjectionMatrix.multiplyMatrices(void 0!==e?e:this.m_camera.projectionMatrix,this.m_camera.matrixWorldInverse),this.m_frustum.setFromMatrix(this.m_viewProjectionMatrix),this.m_extendedFrustumCulling&&this.m_mapTileCuller.setup(),this.computeRequiredInitialRootTileKeys(this.m_camera.position)}compute(e,t,i,a,d){this.m_tileKeyEntries.clear();let u=!0;for(const e of this.m_rootTileKeys)this.m_tileKeyEntries.set(l.TileOffsetUtils.getKeyForTileKeyAndOffset(e.tileKey,e.offset),new c(e.tileKey,1/0,e.offset,e.minElevation,e.maxElevation));const m=void 0!==i&&i.getTilingScheme()===e,p=new s.Box3,f=[...this.m_rootTileKeys];for(;f.length>0;){const s=f.pop();if(void 0===s)continue;const g=s.tileKey;if(g.level>t)continue;if(!1===d.some((e,t)=>e.shouldSubdivide(a[t],g)))continue;const v=l.TileOffsetUtils.getKeyForTileKeyAndOffset(g,s.offset),y=this.m_tileKeyEntries.get(v);n.assert(void 0!==y),n.assert(y.area>0);for(const t of e.getSubTileKeys(g)){const a=s.offset,d=l.TileOffsetUtils.getKeyForTileKeyAndOffset(t,a);n.assert(void 0===this.m_tileKeyEntries.get(d));const g=h(e,t,a);if(m){const e=i.getElevationRange(t);g.southWest.altitude=e.minElevation,g.northEast.altitude=e.maxElevation,u=u&&e.calculationStatus===o.CalculationStatus.FinalPrecise}let v=0;if(this.mapView.projection.type===r.ProjectionType.Spherical){const e=new r.OrientedBox3;this.mapView.projection.projectBox(g,e),v=this.computeSubTileArea(e)}else this.mapView.projection.projectBox(g,p),v=this.computeSubTileArea(p);if(v>0){const e=new c(t,v,a,g.southWest.altitude,g.northEast.altitude);this.m_tileKeyEntries.set(d,e),f.push(e)}}}return{tileKeyEntries:this.m_tileKeyEntries,calculationFinal:u}}computeSubTileArea(e){if(e instanceof s.Box3){if((!this.m_extendedFrustumCulling||this.m_mapTileCuller.frustumIntersectsTileBox(e))&&this.m_frustum.intersectsBox(e)){const t=[new s.Vector3(e.min.x,e.min.y,0).applyMatrix4(this.m_viewProjectionMatrix),new s.Vector3(e.max.x,e.min.y,0).applyMatrix4(this.m_viewProjectionMatrix),new s.Vector3(e.max.x,e.max.y,0).applyMatrix4(this.m_viewProjectionMatrix),new s.Vector3(e.min.x,e.max.y,0).applyMatrix4(this.m_viewProjectionMatrix)];t.push(t[0]);const i=t.length;let r=0;for(let e=i-1,n=0;n<i;e=n++)r+=t[e].x*t[n].y-t[n].x*t[e].y;return Math.abs(.5*r)}return 0}{if(!e.intersects(this.m_frustum))return 0;const t=e.getCenter(),i=e.extents,r=this.m_viewProjectionMatrix.clone().multiply((new s.Matrix4).makeTranslation(t.x,t.y,t.z)).multiply(e.getRotationMatrix()),n=[new s.Vector3(-i.x,-i.y,-i.z).applyMatrix4(r),new s.Vector3(i.x,-i.y,-i.z).applyMatrix4(r),new s.Vector3(i.x,i.y,-i.z).applyMatrix4(r),new s.Vector3(-i.x,i.y,-i.z).applyMatrix4(r),new s.Vector3(-i.x,-i.y,i.z).applyMatrix4(r),new s.Vector3(i.x,-i.y,i.z).applyMatrix4(r),new s.Vector3(i.x,i.y,i.z).applyMatrix4(r),new s.Vector3(-i.x,i.y,i.z).applyMatrix4(r)],o=new s.Box2,a=new s.Vector2;for(const e of n)a.set(e.x,e.y),o.expandByPoint(a);const l=o.getSize(a);return l.x*l.y}}computeRequiredInitialRootTileKeys(e){this.m_rootTileKeys=[];const t=r.TileKey.fromRowColumnLevel(0,0,0);if(!(this.mapView.projection.type===r.ProjectionType.Planar)||!this.m_tileWrappingEnabled)return void this.m_rootTileKeys.push(new c(t,0,0,0));const i=this.mapView.projection.unprojectPoint(e),n=Math.round(i.longitude/360),o=this.m_camera,a=l.MapViewUtils.extractAttitude(this.mapView,o).pitch,h=o.aspect>1?o.aspect:1/o.aspect,d=s.Math.degToRad(o.fov*h/2)+a,u=Math.tan(d)*o.position.z-Math.tan(a)*o.position.z,m=new s.Vector3(e.x-u,e.y,e.z),p=this.mapView.projection.unprojectPoint(m),f=s.Math.clamp(Math.ceil(Math.abs((i.longitude-p.longitude)/360)*Math.SQRT2),0,7);for(let e=-f+n;e<=f+n;e++)this.m_rootTileKeys.push(new c(t,0,e,0,0))}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);t.MapTileCuller=class{constructor(e){this.m_camera=e,this.m_globalFrustumMin=new r.Vector3,this.m_globalFrustumMax=new r.Vector3,this.m_frustumCorners=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3]}setup(){const e=this.getFrustumCorners(),t=this.m_camera.matrixWorld;this.m_globalFrustumMin.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.m_globalFrustumMax.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(const i of e)i.applyMatrix4(t),this.m_globalFrustumMin.x=Math.min(this.m_globalFrustumMin.x,i.x),this.m_globalFrustumMin.y=Math.min(this.m_globalFrustumMin.y,i.y),this.m_globalFrustumMin.z=Math.min(this.m_globalFrustumMin.z,i.z),this.m_globalFrustumMax.x=Math.max(this.m_globalFrustumMax.x,i.x),this.m_globalFrustumMax.y=Math.max(this.m_globalFrustumMax.y,i.y),this.m_globalFrustumMax.z=Math.max(this.m_globalFrustumMax.z,i.z)}frustumIntersectsTileBox(e){const t=this.m_globalFrustumMin,i=this.m_globalFrustumMax;return!(i.x<e.min.x||i.y<e.min.y||i.z<e.min.z||t.x>e.max.x||t.y>e.max.y||t.z>e.max.z)}getFrustumCorners(){const e=this.m_frustumCorners,t=this.m_camera.projectionMatrixInverse;let i=0;function r(r,n,s){e[i++].set(r,n,s).applyMatrix4(t)}return r(-1,-1,-1),r(1,-1,-1),r(-1,1,-1),r(1,1,-1),r(-1,-1,1),r(1,-1,1),r(-1,1,1),r(1,1,1),e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2);function n(e,t){if(!("material"in e))return;const i=e.material;"displacementMap"in i&&(i.displacementMap=t)}function s(e,t,i){const r=i.mapView.projection.unprojectPoint(e),n=t.getHeight(r);void 0!==n&&(r.altitude=n,i.mapView.projection.projectPoint(r,e))}function o(e,t,i){if(void 0!==e.path)for(const r of e.path)s(r,t,i);else s(e.position,t,i)}const a=60;t.overlayOnElevation=function(e){const t=e.mapView.elevationProvider;if(void 0===t||0===e.objects.length)return;const i=t.getDisplacementMap(e.tileKey);if(void 0===i||0===e.objects.length)return;const s=e.objects[0];if(!s.userData||!s.userData.kind||!s.userData.kind.find(e=>e!==r.GeometryKind.All&&e!==r.GeometryKind.Terrain))return;for(const t of e.objects)n(t,i.texture);if(!e.allGeometryLoaded)return;if(e.allTextElementsOverlaid)return;const l=Math.ceil(e.textElementGroups.count()/a),c=e.textElementGroups.sortedGroups;let{groupIndex:h,elementIndex:d}=e.nextTextElementToOverlay,u=0;for(;h<c.length;){const i=c[h];for(;u<l&&d<i.elements.length;)o(i.elements[d],t,e),d++,u++;if(!(d>=i.elements.length))break;++h,d=0}e.nextTextElementToOverlay={groupIndex:h,elementIndex:d},e.textElementsChanged=!0,e.mapView.update()}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(212),s=i(96),o=[[r.GeometryKind.Background,r.GeometryKind.Terrain,r.GeometryKind.Area,r.GeometryKind.Border],[r.GeometryKind.Line],[r.GeometryKind.Building],[r.GeometryKind.Label],[r.GeometryKind.All]],a=new r.GeometryKindSet(o[0]);class l extends s.TileGeometryManagerBase{constructor(e){super(e),this.m_maxUpdatedTilePerFrame=5,this.m_loadPhaseDefinitions=o,this.m_basicGeometryKinds=a}initTile(e){e.dataSource.useGeometryLoader&&(e.tileGeometryLoader=new n.PhasedTileGeometryLoader(e,this.m_loadPhaseDefinitions,this.m_basicGeometryKinds))}updateTiles(e){let t=this.mapView.isDynamicFrame?this.updateSomeTiles(e):this.updateAllTilesTogether(e);if(this.m_tileUpdateCallback)for(const t of e)this.m_tileUpdateCallback(t);t=this.updateTileObjectVisibility(e)||t,!t&&this.checkTilesFinished(e)||this.mapView.update()}checkTilesFinished(e){for(const t of e){const e=t.tileGeometryLoader;if(void 0!==e&&!e.allGeometryLoaded)return!1}return!0}updateSomeTiles(e){let t=0;for(const i of e){const e=i.tileGeometryLoader;if(void 0!==e&&e.update(this.enableFilterByKind?this.enabledGeometryKinds:void 0,this.enableFilterByKind?this.disabledGeometryKinds:void 0)&&(t++,this.m_maxUpdatedTilePerFrame>0&&t>=this.m_maxUpdatedTilePerFrame))break}return t>0}updateAllTilesTogether(e){let t,i=!1;for(const i of e){const e=i.tileGeometryLoader;void 0!==e&&(void 0===t||e.currentPhase<t)&&(t=e.currentPhase)}if(void 0!==t&&t<this.m_loadPhaseDefinitions.length){const r=t+1;i=this.updateTilesIfNeeded(e,r)}return i}updateTilesIfNeeded(e,t){let i=!1;for(const r of e){const e=r.tileGeometryLoader;void 0!==e&&e.updateToPhase(t,this.enableFilterByKind?this.enabledGeometryKinds:void 0,this.enableFilterByKind?this.disabledGeometryKinds:void 0)&&(i=!0)}return i}}t.PhasedTileGeometryManager=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(1),s=i(24),o=i(33),a=i(52);t.PhasedTileGeometryLoader=class{constructor(e,t,i){this.m_tile=e,this.m_loadPhaseDefinitions=t,this.m_basicGeometryKinds=i,this.m_isFinished=!1,this.m_geometryKindsLoaded=new r.GeometryKindSet,this.m_currentPhaseIndex=0}get tile(){return this.m_tile}get currentPhase(){return this.m_currentPhaseIndex}get numberOfPhases(){return this.m_loadPhaseDefinitions.length}get geometryKindsCreated(){return this.m_geometryKindsLoaded}get availableGeometryKinds(){return this.m_availableGeometryKinds}get basicGeometryLoaded(){for(const e of this.m_basicGeometryKinds)if(!this.m_geometryKindsLoaded.has(e))return!1;return!0}get allGeometryLoaded(){return this.currentPhase>=this.m_loadPhaseDefinitions.length}setDecodedTile(e){return this.m_decodedTile=e,this.m_currentPhaseIndex=0,this.m_geometryKindsLoaded.clear(),void 0!==this.m_decodedTile&&(this.m_availableGeometryKinds=a.TileGeometryLoader.prepareDecodedTile(this.m_decodedTile)),this.m_decodedTile}updateCompletely(e,t){return this.update(e,t,!0)}updateToPhase(e,t,i){let r=!1;for(e=Math.min(e,this.numberOfPhases);this.currentPhase<e&&this.update(t,i);)r=!0;return r}update(e,t,i=!1){const r=this.tile,a=this.m_loadPhaseDefinitions;if(!r.dataSource.cacheable)return this.m_currentPhaseIndex=a.length,!1;let l=this.m_decodedTile;const c=this.currentPhase;if(void 0===l&&void 0!==r.decodedTile&&(l=this.setDecodedTile(r.decodedTile),o.TileGeometryCreator.instance.processTechniques(l,e,t),r.clear()),void 0===l||c>=this.numberOfPhases)return!1;const h=o.TileGeometryCreator.instance,d=s.PerformanceStatistics.instance;let u=0;if(d.enabled&&(u=n.PerformanceTimer.now()),i)h.createAllGeometries(r,l),this.m_currentPhaseIndex=a.length;else{const e=a[c];for(const t of e)this.createKind(h,t)}if(d.enabled&&d.currentFrame.addValue("geometry.geometryCreationTime",n.PerformanceTimer.now()-u),void 0===this.nextPhase()){if(d.enabled){const e=d.currentFrame;e.addValue("geometryCount.numGeometries",l.geometries.length),e.addValue("geometryCount.numTechniques",l.techniques.length),e.addValue("geometryCount.numPoiGeometries",void 0!==l.poiGeometries?l.poiGeometries.length:0),e.addValue("geometryCount.numTextGeometries",void 0!==l.textGeometries?l.textGeometries.length:0),e.addValue("geometryCount.numTextPathGeometries",void 0!==l.textPathGeometries?l.textPathGeometries.length:0),e.addValue("geometryCount.numPathGeometries",void 0!==l.pathGeometries?l.pathGeometries.length:0),e.addMessage(`Decoded tile: ${r.dataSource.name} # lvl=${r.tileKey.level} `+`col=${r.tileKey.column} row=${r.tileKey.row}`)}this.finish()}return!0}get isFinished(){return this.m_isFinished}dispose(){this.m_decodedTile=void 0}reset(){this.m_decodedTile=void 0,this.m_isFinished=!1,this.m_availableGeometryKinds=void 0,this.m_geometryKindsLoaded.clear(),this.m_currentPhaseIndex=0}nextPhase(){return this.m_currentPhaseIndex<this.m_loadPhaseDefinitions.length&&this.m_currentPhaseIndex++,this.m_currentPhaseIndex<this.m_loadPhaseDefinitions.length?this.m_currentPhaseIndex:void 0}createKind(e,t){if(this.m_geometryKindsLoaded.has(t))return;this.m_geometryKindsLoaded.add(t);const i=this.tile,n=this.m_decodedTile;if(void 0!==n){const s=e=>{if(!1===e.enabled)return!1;const i=e.kind;if(t===r.GeometryKind.All)return!0;if(i instanceof Set){return i.has(t)}return i===t};e.createObjects(i,n,s);const o=e=>!!(r.isPoiTechnique(e)||r.isLineMarkerTechnique(e)||r.isTextTechnique(e))&&s(e);e.createTextElements(i,n,o),e.preparePois(i,n)}}finish(){this.m_decodedTile=void 0,this.m_tile.loadingFinished(),this.m_tile.removeDecodedTile(),this.m_isFinished=!0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(84);t.PoiRendererFactory=class{constructor(e){this.m_mapView=e}createPoiRenderer(e){return new r.PoiRenderer(this.m_mapView,e)}}},function(e,t,i){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i(77)),r(i(215)),r(i(216)),r(i(5)),r(i(217))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addExtrudedWalls=function(e,t,i,r,n,s){const o=r.length/i;for(let i=0;i<o;++i){const r=t+2*i,a=r+1,l=t+(i+1)%o*2,c=l+1;!1!==s||void 0===n?e.push(r,a,c,c,l,r):n[i]&&e.push(r,a,c,c,l,r)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=new r.Vector2,s=new r.Vector2,o=new r.Vector2,a=new r.Vector2;t.addPolygonEdges=function(e,t,i,r,l,c,h,d){for(let u=0;u<l.length;++u)if(l[u])if(!0===c){const c=t+2*u,m=c+1,p=t+(u+1)%l.length*2,f=p+1;!0===h&&e.push(c,p),e.push(m,f);const g=(0===u?l.length:u)-1;if(l[g])if(void 0!==d){const t=r[u*i],h=r[u*i+1],p=r[(u+1)%l.length*i],f=r[(u+1)%l.length*i+1];n.set(t,h),s.set(p,f),o.set(r[g*i],r[g*i+1]),a.set(n.x,n.y),a.sub(o).normalize().dot(s.sub(n).normalize())<=d&&e.push(c,m)}else e.push(c,m)}else{const i=t+u,r=t+(u+1)%l.length;e.push(i,r)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(76);!function(e){function t(e){if(e instanceof Int8Array)return"int8";if(e instanceof Uint8Array)return"uint8";if(e instanceof Int16Array)return"int16";if(e instanceof Uint16Array)return"uint16";if(e instanceof Int32Array)return"int32";if(e instanceof Uint32Array)return"uint32";if(e instanceof Float32Array)return"float";throw new Error(`Unsupported buffer type ${name}`)}function i(e){const i=e.array;return{name:e.name,buffer:i.buffer,type:t(i),itemCount:e.itemSize,normalized:e.normalized}}e.getBufferElementType=t,e.fromThreeBufferAttribute=i,e.fromThreeInterleavedBufferAttribute=function(e){throw new Error("Not implemented yet")},e.fromThreeBufferGeometry=function(e,t){const n=[],s=Object.getOwnPropertyNames(e.attributes);for(const t of s){const r=i(e.attributes[t]);r.name=t,n.push(r)}const o=null!==e.index?i(e.index):void 0;let a=0;if(void 0!==o)a=null===e.index?0:e.index.count;else{const t=e.attributes.position;if(void 0===t)throw new Error("Missing position attibute to deduce item count");a=t.count}return{type:r.GeometryType.Unspecified,vertexAttributes:n,index:o,groups:[{start:0,count:a,technique:t}]}}}(t.ThreeBufferUtils||(t.ThreeBufferUtils={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(51),s=i(103),o=r.LoggerManager.instance.create("ScreenCollissions");class a{constructor(){this.screenBounds=new r.Math2D.Box,this.rtree=new s}static toBox2D(e,t){t.x=e.min.x,t.y=e.min.y,t.w=e.max.x-e.min.x,t.h=e.max.y-e.min.y}reset(){this.rtree.clear()}update(e,t){this.screenBounds.set(e/-2,t/-2,e,t),this.reset()}allocate(e){const t={minX:e.x,minY:e.y,maxX:e.x+e.w,maxY:e.y+e.h,type:"box"};this.rtree.insert(t)}allocateIBoxes(e){this.rtree.load(e)}isAllocated(e){const t=e instanceof r.Math2D.Box?this.toCollisionBox(e):e,i=this.rtree.search(t);for(const e of i)switch(e.type){case"box":return!0;case"line":{const i=e;if(this.intersectsLine(t,i))return!0}}return!1}isVisible(e){return this.screenBounds.intersects(e)}intersectsLine(e,t){const i=t.line,r=i.end.x-i.start.x;let n,s,o,a;if(0!==r){const t=i.end.y-i.start.y,l=t,c=-r,h=i.start.y-t/r*i.start.x;n=Math.sign(e.minX*l+(e.minY-h)*c),s=Math.sign(e.maxX*l+(e.minY-h)*c),o=Math.sign(e.minX*l+(e.maxY-h)*c),a=Math.sign(e.maxX*l+(e.maxY-h)*c)}else n=Math.sign(e.minX-i.start.x),s=Math.sign(e.maxX-i.start.x),o=Math.sign(e.minX-i.start.x),a=Math.sign(e.maxX-i.start.x);return n!==s||n!==o||n!==a}toCollisionBox(e){return{minX:e.x,minY:e.y,maxX:e.x+e.w,maxY:e.y+e.h,type:"box"}}}t.ScreenCollisions=a;t.ScreenCollisionsDebug=class extends a{constructor(e){super(),this.m_renderContext=null,this.m_renderingEnabled=!1,this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0,null!=e&&(this.m_renderContext=e.getContext("2d"))}reset(){super.reset(),this.m_numAllocations=0,this.m_numSuccessfulTests=0,this.m_numFailedTests=0,this.m_numSuccessfulVisibilityTests=0,this.m_numFailedVisibilityTests=0}update(e,t){this.m_renderingEnabled&&o.log(`Allocations: ${this.m_numAllocations} Successful Tests: ${this.m_numSuccessfulTests} Failed Tests: ${this.m_numFailedTests}  Successful Visibility Tests: ${this.m_numSuccessfulVisibilityTests}  Failed Visibility Tests: ${this.m_numFailedVisibilityTests} `),super.update(e,t),null!==this.m_renderContext&&(this.m_renderContext.canvas.width=e,this.m_renderContext.canvas.height=t),this.m_renderingEnabled=n.debugContext.getValue("DEBUG_SCREEN_COLLISIONS")}allocate(e){super.allocate(e),this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#6666ff",this.m_renderContext.strokeRect(e.x-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-e.y-1,e.w,-e.h))}allocateIBoxes(e){for(const t of e)this.m_numAllocations++,this.m_renderingEnabled&&null!==this.m_renderContext&&(this.m_renderContext.strokeStyle="#aa2222",this.m_renderContext.strokeRect(t.minX-this.screenBounds.x,this.screenBounds.y+this.screenBounds.h-t.minY-1,t.maxX-t.minX,-(t.maxY-t.minY)));super.allocateIBoxes(e)}isAllocated(e){const t=super.isAllocated(e);if(this.m_renderingEnabled&&null!==this.m_renderContext){const i=t?2:0;this.m_renderContext.strokeStyle=t?"#FF0000":"#00ff00",this.m_renderContext.strokeRect(e.x-this.screenBounds.x-i,this.screenBounds.y+this.screenBounds.h-e.y-1+i,e.w+2*i,-e.h-2*i)}return t?this.m_numFailedTests++:this.m_numSuccessfulTests++,t}isVisible(e){const t=super.isVisible(e);return t?this.m_numSuccessfulVisibilityTests++:this.m_numFailedVisibilityTests++,t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);function n(e){return e.z>-1&&e.z<1&&e.x>=-1&&e.x<=1&&e.y>=-1&&e.y<=1}class s{constructor(e){this.m_camera=e,this.m_width=0,this.m_height=0}get width(){return this.m_width}get height(){return this.m_height}project(e,t=new r.Vector2){const i=this.projectVector(e,s.tempV3);if(i.z>-1&&i.z<1)return this.ndcToScreen(i,t)}projectOnScreen(e,t=new r.Vector2){const i=this.projectVector(e,s.tempV3);if(n(i))return this.ndcToScreen(i,t)}project3(e,t=new r.Vector3){const i=this.projectVector(e,s.tempV3);if(i.z>-1&&i.z<1)return t.set(i.x*this.m_width/2,i.y*this.m_height/2,i.z),t}projectVector(e,t){return t.set(e.x,e.y,e.z).project(this.m_camera),t}onScreen(e){return n(this.projectVector(e,s.tempV3))}update(e,t,i){this.m_camera=e,this.m_width=t,this.m_height=i}ndcToScreen(e,t){return t.set(e.x*this.m_width/2,e.y*this.m_height/2)}}t.ScreenProjector=s,s.tempV2=new r.Vector2,s.tempV3=new r.Vector3},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(104),n=i(221);t.SkyBackground=class{constructor(e,t,i){switch(this.m_sky=e,this.m_projectionType=t,this.m_sky.type){case"gradient":this.m_skyTexture=new n.SkyGradientTexture(this.m_sky,this.m_projectionType),this.updateCamera(i);break;case"cubemap":this.m_skyTexture=new r.SkyCubemapTexture(this.m_sky)}}dispose(){this.m_skyTexture.dispose()}get texture(){return this.m_skyTexture.texture}updateCamera(e){"gradient"===this.m_sky.type&&this.m_skyTexture.update(e)}updateTexture(e,t){const i=this.m_sky.type===e.type&&this.m_projectionType===t;switch(e.type){case"gradient":i?this.m_skyTexture.updateTexture(e):this.m_skyTexture=new n.SkyGradientTexture(e,t);break;case"cubemap":i?this.m_skyTexture.updateTexture(e):this.m_skyTexture=new r.SkyCubemapTexture(e)}this.m_projectionType=t,this.m_sky=e}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(3),n=i(1),s=i(0);t.DEFAULT_TEXTURE_SIZE=512,t.DEFAULT_MONOMIAL_POWER=1;const o=[new s.Vector3(1,0,0),new s.Vector3(-1,0,0),new s.Vector3(0,-1,0),new s.Vector3(0,1,0),new s.Vector3(0,0,1),new s.Vector3(0,0,-1)],a=[new s.Vector3(0,0,-1),new s.Vector3(0,0,1),new s.Vector3(1,0,0),new s.Vector3(1,0,0),new s.Vector3(1,0,0),new s.Vector3(-1,0,0)],l=[new s.Vector3(0,1,0),new s.Vector3(0,1,0),new s.Vector3(0,0,1),new s.Vector3(0,0,-1),new s.Vector3(0,1,0),new s.Vector3(0,1,0)];t.SkyGradientTexture=class{constructor(e,i,n=t.DEFAULT_TEXTURE_SIZE){this.m_projectionType=i,this.m_height=n;const o=new s.Color(e.topColor),a=new s.Color(e.bottomColor),l=new s.Color(e.groundColor);this.m_width=this.m_projectionType===r.ProjectionType.Planar?1:this.m_height,this.m_faceCount=this.m_projectionType===r.ProjectionType.Planar?1:6,this.m_faces=[];for(let t=0;t<this.m_faceCount;++t){const i=new Uint8Array(3*this.m_width*this.m_height);this.fillTextureData(i,t,o,a,l,e.monomialPower);const r=new s.DataTexture(i,this.m_width,this.m_height,s.RGBFormat);r.needsUpdate=!0,r.unpackAlignment=1,this.m_faces.push(r)}this.m_projectionType===r.ProjectionType.Spherical?(this.m_skybox=new s.CubeTexture(this.m_faces),this.m_skybox.needsUpdate=!0):(this.m_farClipPlaneDividedVertically=new s.Line3,this.m_groundPlane=new s.Plane(new s.Vector3(0,0,1)),this.m_bottomMidFarPoint=new s.Vector3,this.m_topMidFarPoint=new s.Vector3,this.m_horizonPosition=new s.Vector3,this.m_farClipPlaneCorners=[new s.Vector3,new s.Vector3,new s.Vector3,new s.Vector3])}dispose(){for(let e=0;e<this.m_faceCount;++e)this.m_faces[e].dispose();this.m_projectionType===r.ProjectionType.Spherical&&this.m_skybox.dispose()}get texture(){return this.m_projectionType===r.ProjectionType.Planar?this.m_faces[0]:this.m_skybox}update(e){this.m_projectionType===r.ProjectionType.Planar&&(this.setHorizonPosition(e),this.updateTexturePosition())}updateTexture(e){for(let t=0;t<this.m_faceCount;++t)this.fillTextureData(this.m_faces[t].image.data,t,new s.Color(e.topColor),new s.Color(e.bottomColor),new s.Color(e.groundColor),e.monomialPower),this.m_faces[t].needsUpdate=!0;this.m_projectionType===r.ProjectionType.Spherical&&(this.m_skybox.needsUpdate=!0)}fillTextureData(e,i,c,h,d,u){const m=new s.Color,p=new s.Vector3,f=new s.Vector3,g=new s.Vector3,v=new s.Vector3(0,0,1);for(let s=0;s<this.m_height;++s)for(let y=0;y<this.m_width;++y){if(this.m_projectionType===r.ProjectionType.Spherical){const e=f.copy(a[i]).multiplyScalar((y+.5)/this.m_width*2-1),r=g.copy(l[i]).multiplyScalar((s+.5)/this.m_height*2-1);p.copy(o[i]).add(e).add(r).normalize();const _=Math.max(v.dot(p),0);m.copy(d).lerp(h,Math.min(100*_,1)).lerp(c,_**n.getOptionValue(u,t.DEFAULT_MONOMIAL_POWER)).multiplyScalar(255)}else{const e=s/this.m_height;0===s?m.copy(d).multiplyScalar(255):m.copy(h).lerp(c,e**n.getOptionValue(u,t.DEFAULT_MONOMIAL_POWER)).multiplyScalar(255)}e[s*this.m_width*3+3*y]=m.r,e[s*this.m_width*3+3*y+1]=m.g,e[s*this.m_width*3+3*y+2]=m.b}}setHorizonPosition(e){this.m_farClipPlaneCorners[0].set(-1,-1,1).unproject(e),this.m_farClipPlaneCorners[1].set(1,-1,1).unproject(e),this.m_farClipPlaneCorners[2].set(-1,1,1).unproject(e),this.m_farClipPlaneCorners[3].set(1,1,1).unproject(e),this.m_bottomMidFarPoint.copy(this.m_farClipPlaneCorners[0]).add(this.m_farClipPlaneCorners[1]).multiplyScalar(.5),this.m_topMidFarPoint.copy(this.m_farClipPlaneCorners[2]).add(this.m_farClipPlaneCorners[3]).multiplyScalar(.5),this.m_farClipPlaneDividedVertically.set(this.m_bottomMidFarPoint,this.m_topMidFarPoint),this.m_groundPlane.intersectLine(this.m_farClipPlaneDividedVertically,this.m_horizonPosition)||this.m_horizonPosition.set(0,0,0)}updateTexturePosition(){const e=this.m_bottomMidFarPoint.distanceTo(this.m_horizonPosition)/this.m_farClipPlaneDividedVertically.distance(),t=0===this.m_horizonPosition.length()?1:e-2/this.m_height;this.m_faces[0].offset.set(0,this.m_bottomMidFarPoint.z<=0?-t:e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(6),n=i(1);t.DEFAULT_FONT_CATALOG_NAME="default";const s=n.LoggerManager.instance.create("FontCatalogLoader");t.FontCatalogLoader=class{constructor(e){this.m_theme=e,this.m_catalogsLoading=0}initialize(e){if(void 0===this.m_theme.fontCatalogs||0===this.m_theme.fontCatalogs.length)return this.m_theme.fontCatalogs=[{name:t.DEFAULT_FONT_CATALOG_NAME,url:e}],t.DEFAULT_FONT_CATALOG_NAME;return this.m_theme.fontCatalogs[0].name}async loadCatalogs(e){n.assert(void 0!==this.m_theme.fontCatalogs),n.assert(this.m_theme.fontCatalogs.length>0);const t=[];return this.m_theme.fontCatalogs.forEach(i=>{this.m_catalogsLoading+=1;const n=r.FontCatalog.load(i.url,1024).then(e.bind(void 0,i.name)).catch(e=>{s.error("Failed to load FontCatalog: ",e)}).finally(()=>{this.m_catalogsLoading-=1});t.push(n)}),Promise.all(t)}get loading(){return this.m_catalogsLoading>0}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MapViewState=class{constructor(e,t){this.m_mapView=e,this.m_renderedTilesChangeCheck=t}get worldCenter(){return this.m_mapView.worldCenter}get cameraIsMoving(){return this.m_mapView.cameraIsMoving}get maxVisibilityDist(){return this.m_mapView.viewRanges.maximum}get zoomLevel(){return this.m_mapView.zoomLevel}get frameNumber(){return this.m_mapView.frameNumber}get lookAtDistance(){return this.m_mapView.lookAtDistance}get isDynamic(){return this.m_mapView.isDynamicFrame}get hiddenGeometryKinds(){return void 0===this.m_mapView.tileGeometryManager?void 0:this.m_mapView.tileGeometryManager.hiddenGeometryKinds}get renderedTilesChanged(){return this.m_renderedTilesChangeCheck()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(6),n=i(1);t.TextCanvasFactory=class{constructor(e){this.m_renderer=e,this.m_minGlyphCount=0,this.m_maxGlyphCount=0}setGlyphCountLimits(e,t){this.m_minGlyphCount=e,this.m_maxGlyphCount=t}createTextCanvas(e){return n.assert(this.m_maxGlyphCount>0),new r.TextCanvas({renderer:this.m_renderer,fontCatalog:e,minGlyphCount:this.m_minGlyphCount,maxGlyphCount:this.m_maxGlyphCount})}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(30),s=i(54);class o{constructor(e,t){if(this.m_defaults=new Map,this.m_mapViews=[],this.update=()=>{const e=this.m_mapViews.map(e=>e.copyrightInfo).reduce(s.CopyrightInfo.mergeArrays,this.staticInfo||[]);if(0===e.length)return void(this.m_element.style.display="none");if(this.m_element.style.display="block",0!==this.m_defaults.size)for(const t of e){const e=this.m_defaults.get(t.id);void 0!==e&&(t.year=r.getOptionValue(t.year,e.year),t.label=r.getOptionValue(t.label,e.label),t.link=r.getOptionValue(t.link,e.link))}const t=s.CopyrightInfo.mergeArrays(e);this.m_element.innerHTML=s.CopyrightInfo.formatAsHtml(t)},"string"==typeof e){const t=document.getElementById(e);if(!t)throw new Error(`CopyrightElementHandler: unable to find DOM element #${e}`);this.m_element=t}else this.m_element=e;void 0!==t&&this.attach(t)}static install(e,t){return new o(e,t)}destroy(){for(const e of this.m_mapViews)e.removeEventListener(n.MapViewEventNames.CopyrightChanged,this.update)}attach(e){return this.m_mapViews.push(e),e.addEventListener(n.MapViewEventNames.CopyrightChanged,this.update),this.update(),this}detach(e){return e.removeEventListener(n.MapViewEventNames.CopyrightChanged,this.update),this.m_mapViews=this.m_mapViews.filter(t=>t!==e),this.update(),this}setDefaults(e){if(this.m_defaults.clear(),void 0!==e)for(const t of e)this.m_defaults.set(t.id,t);return this}setStaticCopyightInfo(e){return this.staticInfo=e,this}}t.CopyrightElementHandler=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(110),n=i(109);class s extends n.CopyrightCoverageProvider{constructor(e,t){super(),this.m_fetchURL=e,this.m_baseScheme=t}getCopyrightCoverageData(){return void 0!==this.m_cachedCopyrightResponse?this.m_cachedCopyrightResponse:(this.m_cachedCopyrightResponse=(new r.TransferManager).downloadJson(this.m_fetchURL).then(e=>e[this.m_baseScheme]).catch(e=>(this.logger.error(e),[])),this.m_cachedCopyrightResponse)}}t.UrlCopyrightProvider=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i(26);class r{constructor(e){this.executor=e,this.doExec=!1,this.promise=new Promise((e,t)=>{this.resolveFunc=e,this.rejectFunc=t,this.doExec&&this.execInnerPromise(this.resolveFunc,this.rejectFunc)})}exec(){void 0!==this.resolveFunc&&void 0!==this.rejectFunc?this.execInnerPromise(this.resolveFunc,this.rejectFunc):this.doExec=!0}execInnerPromise(e,t){this.executor().then(t=>e(t)).catch(e=>t(e))}}class n{constructor(e=fetch,t=5){this.fetchFunction=e,this.maxRetries=t,this.activeDownloadCount=0,this.downloadQueue=new Array,this.activeDownloads=new Map}static instance(){return n.defaultInstance}static async fetchRepeatedly(e,t,i,r,s){try{const n=await e(r,s);if(503!==n.status||t>i)return n}catch(e){if(e.hasOwnProperty("isCancelled")||e.hasOwnProperty("name")&&"AbortError"===e.name||t>i)throw e}return n.waitFor(n.retryTimeout*t).then(()=>n.fetchRepeatedly(e,i,t+1,r,s))}static waitFor(e){return new Promise(t=>setTimeout(t,e))}downloadJson(e,t){return this.downloadAs(e=>e.json(),e,t)}downloadArrayBuffer(e,t){return this.download(e,t).then(e=>e.arrayBuffer())}download(e,t){if(this.activeDownloadCount>=n.maxParallelDownloads){const i=new r(()=>this.doDownload(e,t));return this.downloadQueue.push(i),i.promise}return this.doDownload(e,t)}doDownload(e,t){return++this.activeDownloadCount,n.fetchRepeatedly(this.fetchFunction,0,this.maxRetries,e,t).then(e=>(this.onDownloadDone(),e)).catch(e=>{throw this.onDownloadDone(),e})}onDownloadDone(){--this.activeDownloadCount,this.execDeferredDownload()}execDeferredDownload(){const e=this.downloadQueue.pop();void 0!==e&&e.exec()}downloadAs(e,t,i){const r=t,n=this.activeDownloads.get(r);if(void 0!==n)return Promise.resolve(n);const s=this.download(t,i).then(t=>{if(this.activeDownloads.delete(r),t.ok)return e(t);throw new Error(JSON.stringify(t))}).catch(e=>{throw this.activeDownloads.delete(r),e});return this.activeDownloads.set(r,s),s}}t.TransferManager=n,n.retryTimeout=500,n.maxParallelDownloads=16,n.defaultInstance=new n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.isLoading=function(e){return void 0!==e.loadingPromise}}(t.ImageItem||(t.ImageItem={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(1),s=i(111),o=n.LoggerManager.instance.create("TileDataAccessor");t.TileDataAccessor=class{constructor(e,t,i){this.tile=e,this.visitor=t,this.m_wantsPoints=!0,this.m_wantsLines=!0,this.m_wantsAreas=!0,this.m_wantsObject3D=!0;const r=!0===i.wantsAll;this.m_wantsPoints=r||!(!1===i.wantsPoints),this.m_wantsLines=r||!(!1===i.wantsLines),this.m_wantsAreas=r||!(!1===i.wantsAreas),this.m_wantsObject3D=r||!(!1===i.wantsObject3D)}visitAll(){const e=this.tile.objects;for(const t of e)this.visitObject(t)}visitObject(e){const t=void 0!==e.userData?e.userData.feature:void 0;if(void 0===t||void 0!==t.objInfos&&1===t.objInfos.length&&!this.visitor.wantsFeature(r.getFeatureId(t.objInfos[0])))return;const i=t.geometryType;if(void 0===i)return void o.warn("#visitObject: visiting object failed, no geometryType",e);switch(n.assert(void 0!==t.objInfos,"featureData.ids missing"),n.assert(void 0!==t.starts,"featureData.starts missing"),n.assert(Array.isArray(t.starts),"featureData.starts is not an array"),void 0!==t.objInfos&&void 0!==t.starts&&n.assert(t.objInfos.length===t.starts.length,"featureData.ids and featureData.starts have unequal length"),i){case r.GeometryType.Point:case r.GeometryType.Text:if(!this.m_wantsPoints)return;break;case r.GeometryType.SolidLine:case r.GeometryType.ExtrudedLine:case r.GeometryType.TextPath:if(!this.m_wantsLines)return;break;case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:if(!this.m_wantsAreas)return;break;case r.GeometryType.Object3D:if(!this.m_wantsObject3D)return;break;default:o.warn("#visitObject: invalid geometryType")}if("Mesh"!==e.type)return void o.warn("#visitObject: visiting object failed, not of type 'Mesh'",e);const s=e;this.visitMesh(s,t)}getBufferGeometry(e){const t=e.geometry;if("BufferGeometry"!==t.type)return void o.warn("#visitObject: object does not have BufferGeometry");const i=t;if(i.getAttribute("position"))return i;o.warn("#visitLines: BufferGeometry has no position attribute")}getGeometryAccessor(e,t,i){switch(e){case r.GeometryType.Point:case r.GeometryType.Text:return;case r.GeometryType.SolidLine:case r.GeometryType.ExtrudedLine:case r.GeometryType.TextPath:return new s.BufferedGeometryLineAccessor(t,e,i);case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:return;case r.GeometryType.Object3D:return new s.BufferedGeometryObject3dAccessor(t,e,i);default:o.warn("#getGeometryAccessor: invalid geometryType")}}getIndexedGeometryAccessor(e,t,i){switch(e){case r.GeometryType.Point:case r.GeometryType.Text:return;case r.GeometryType.SolidLine:case r.GeometryType.ExtrudedLine:case r.GeometryType.TextPath:return new s.IndexedBufferedGeometryLineAccessor(t,e,i);case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:case r.GeometryType.Object3D:return;default:o.warn("#getIndexedGeometryAccessor: invalid geometryType")}}visitMesh(e,t){const{objInfos:i,starts:a}=t,l=t.geometryType;if(void 0===i||void 0===a||void 0===l)return;let c;for(let t=0;t<i.length;t++){const h=r.getFeatureId(i[t]);if(!this.visitor.wantsFeature(h))continue;const d=a[t];let u=-1;if(void 0===c){const t=this.getBufferGeometry(e);if(void 0===t)continue;if(c=null!==t.index?this.getIndexedGeometryAccessor(l,e,t):this.getGeometryAccessor(l,e,t),void 0===c){o.warn("#visitObject: no accessor geometryType",l);continue}}switch(u=t<a.length-1?a[t+1]:c.getCount(),c.setRange(d,u),l){case r.GeometryType.Point:case r.GeometryType.Text:this.visitor.visitPoint(h);break;case r.GeometryType.SolidLine:case r.GeometryType.ExtrudedLine:case r.GeometryType.TextPath:n.assert(s.isLineAccessor(c)),this.visitor.visitLine(h,c);break;case r.GeometryType.Polygon:case r.GeometryType.ExtrudedPolygon:this.visitor.visitArea(h);break;case r.GeometryType.Object3D:n.assert(s.isObject3dAccessor(c)),this.visitor.visitObject3D(h,c);break;default:o.warn("#visitObject: invalid geometryType")}}}}},function(e,t,i){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i(231)),r(i(112)),r(i(113)),r(i(55))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),n=i(0),s=new n.Vector3,o=new n.Vector3,a=new n.Vector3,l=new n.Vector3,c=new n.Vector3,h=.1,d={attributes:[{name:"extrusionCoord",itemSize:3,offset:0},{name:"position",itemSize:3,offset:3},{name:"tangent",itemSize:3,offset:6},{name:"bitangent",itemSize:4,offset:9}],stride:13},u={attributes:[{name:"uv",itemSize:2,offset:d.stride},{name:"normal",itemSize:3,offset:d.stride+2}],stride:5},m={attributes:[...d.attributes,...u.attributes],stride:d.stride+u.stride},p={attributes:[{name:"extrusionCoord",itemSize:2,offset:0},{name:"position",itemSize:3,offset:2},{name:"positionLow",itemSize:3,offset:5},{name:"tangent",itemSize:3,offset:8},{name:"bitangent",itemSize:4,offset:11}],stride:15},f={attributes:[...p.attributes,...u.attributes],stride:p.stride+u.stride};class g{constructor(){this.vertices=[],this.vertexColors=[],this.indices=[]}}function v(e,t){return t?e?f:p:e?m:d}function y(e,t,i,n,d,u=new g,m=!1){if(0===t.length)return u;const p=v(void 0!==n,m).stride,f=t.length/3,y=new Array(f),_=new Array(t.length-3),x=u.vertices.length/p,T=void 0!==i&&i.length>0,S=void 0!==n&&n.length>0,w=void 0!==d&&d.length&&t.length;r.assert(!T||i.length===f),r.assert(!S||n.length/2===f),r.assert(!w||d.length===t.length);let b=h;y[0]=b;let M=!0;for(let e=0;e<f-1;++e){let i=0;for(let r=0;r<3;++r){const n=t[3*(e+1)+r]-t[3*e+r];_[3*e+r]=n,i+=n*n,M=2===r?M&&0===t[3*(e+1)+r]:M}b+=Math.sqrt(i),y[e+1]=b}const E=T?Math.abs(i[i.length-1]-i[0]):1,P=y[y.length-1]/E;if(T)for(let e=0;e<f;++e)y[e]=i[e]*P+h;let C=!0;for(let e=0;e<3;++e)C=C&&t[e]===t[t.length-3+e];const A=[],L=(i,r,h,p,f)=>{A.length=0,u.vertices.push(p,-1*f,P),A.push(p,1*f,P);for(let e=0;e<3;++e){if(m){const r=Math.fround(t[3*i+e]),n=t[3*i+e]-r;u.vertices.push(r,n),A.push(r,n)}else u.vertices.push(t[3*i+e]),A.push(t[3*i+e]);o.setComponent(e,t[3*i+e])}for(let e=0;e<3;++e)a.setComponent(e,_[r+e]),l.setComponent(e,_[h+e]);a.normalize(),u.vertices.push(a.x,a.y,a.z),A.push(a.x,a.y,a.z);const g=function(e,t,i,r){let n=0;t.equals(i)||(n=Math.acos(t.dot(i))*Math.sign(e.dot(s.copy(t).cross(i))),Number.isNaN(n)&&(n=0));return r.copy(t).add(i).normalize().cross(e).normalize(),n}(M?o.set(0,0,1):o.add(e).normalize(),a,l.normalize(),c);u.vertices.push(c.x,c.y,c.z,g),A.push(c.x,c.y,c.z,g),S&&(u.vertices.push(n[2*i],n[2*i+1]),A.push(n[2*i],n[2*i+1]),u.vertices.push(o.x,o.y,o.z),A.push(o.x,o.y,o.z)),u.vertices.push(...A),w&&(u.vertexColors.push(d[3*i],d[3*i+1],d[3*i+2]),u.vertexColors.push(d[3*i],d[3*i+1],d[3*i+2]))};for(let e=0;e<f;++e){const t=C&&0===e?_.length-3:3*Math.max(0,e-1),i=C&&e===f-1?0:Math.min(3*e,_.length-3);e>0&&L(e,t,i,y[e-1],y[e]),e+1<f&&L(e,t,i,-1*y[Math.min(e,y.length-1)],y[Math.min(e+1,y.length-1)])}for(let e=0;e<f-1;++e){const t=x+4*e;u.indices.push(t,t+1,t+2,t+2,t+1,t+3)}return u}function _(e,t,i=new g){if(0===e.length)return i;const r=e.length/3;let n=i.vertices.length/3;const s=void 0!==t&&t.length&&e.length;for(let o=0;o<r;++o,n++){o>0&&i.indices.push(n),o<r-1&&i.indices.push(n);for(let r=0;r<3;++r)i.vertices.push(e[3*o+r]),s&&i.vertexColors.push(t[3*o+r])}return i}t.LineGeometry=g,t.createLineGeometry=y,t.createSimpleLineGeometry=_;class x{constructor(e=!1,t=!1,i=!1){this.hasNormalsAndUvs=e,this.highPrecision=t,this.isSimple=i,this.m_geometry=new g}static createGeometry(e,t,i,r,s=!1,o=!1,a=!1){if(a)return r.setAttribute("position",new n.BufferAttribute(new Float32Array(e),3)),t.length===e.length&&r.setAttribute("color",new n.BufferAttribute(new Float32Array(t),3)),r.setIndex(new n.BufferAttribute(new Uint32Array(i),1)),r;{const a=v(s,o),l=new n.InterleavedBuffer(new Float32Array(e),a.stride);return a.attributes.forEach(e=>{const t=new n.InterleavedBufferAttribute(l,e.itemSize,e.offset,!1);r.setAttribute(e.name,t)}),t.length===e.length&&r.setAttribute("color",new n.BufferAttribute(new Float32Array(t),3)),r.setIndex(new n.BufferAttribute(new Uint32Array(i),1)),r}}clear(){this.m_geometry.vertices=[],this.m_geometry.vertexColors=[],this.m_geometry.indices=[]}add(e,t,i,n,s){return this.isSimple?_(t,s,this.m_geometry):(r.assert(!this.hasNormalsAndUvs||void 0!==n),y(e,t,i,n,s,this.m_geometry,this.highPrecision)),this}get vertices(){return this.m_geometry.vertices}get vertexColors(){return this.m_geometry.vertexColors}get indices(){return this.m_geometry.indices}get vertexAttributes(){return v(this.hasNormalsAndUvs,this.highPrecision).attributes}get stride(){return v(this.hasNormalsAndUvs,this.highPrecision).stride}createGeometry(e){return void 0===e&&(e=new n.BufferGeometry),x.createGeometry(this.m_geometry.vertices,this.m_geometry.vertexColors,this.m_geometry.indices,e,this.hasNormalsAndUvs,this.highPrecision)}}t.LineGroup=x},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(4),s=i(55);class o extends r.Points{constructor(e,t,i,s,o){void 0===t&&(t=new n.HighPrecisionPointMaterial({color:s||n.HighPrecisionPointMaterial.DEFAULT_COLOR,opacity:void 0!==o?o:1})),super(void 0===e?new r.BufferGeometry:e,t),this.matrixWorldInverse=new r.Matrix4,i&&this.setPositions(i)}get bufferGeometry(){return this.geometry}clearGeometry(){return this.geometry=new r.BufferGeometry}get shaderMaterial(){return this.material}setPositions(e){s.HighPrecisionUtils.setPositions(this,e)}setupForRendering(){this.material.isHighPrecisionPointsMaterial&&void 0!==this.dimensionality&&this.material.setDimensionality(this.dimensionality),this.onBeforeRender=(e,t,i,r,n,o)=>{s.HighPrecisionUtils.updateHpUniforms(this,i,this.shaderMaterial)}}updateMatrixWorld(e){const t=this.matrixWorldNeedsUpdate||e;super.updateMatrixWorld(e),t&&this.matrixWorldInverse.getInverse(this.matrixWorld)}}t.HighPrecisionPoints=o},function(e,t,i){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i(234)),r(i(235)),r(i(56)),r(i(57)),r(i(238)),r(i(115))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(56);t.OmvFeatureFilterDescriptionBuilder=class{constructor(e){this.m_processLayersDefault=!0,this.m_processPointsDefault=!0,this.m_processLinesDefault=!0,this.m_processPolygonsDefault=!0,this.m_layersToProcess=new Array,this.m_layersToIgnore=new Array,this.m_pointsToProcess=new Array,this.m_ignoredPoints=new Array,this.m_linesToProcess=new Array,this.m_linesToIgnore=new Array,this.m_polygonsToProcess=new Array,this.m_polygonsToIgnore=new Array,this.m_kindsToProcess=[],this.m_kindsToIgnore=[],e&&(this.m_processLayersDefault=void 0===e.processLayersDefault||e.processLayersDefault,this.m_processPointsDefault=void 0===e.processPointsDefault||e.processPointsDefault,this.m_processLinesDefault=void 0===e.processLinesDefault||e.processLinesDefault,this.m_processPolygonsDefault=void 0===e.processPolygonsDefault||e.processPolygonsDefault)}processLayer(e,t=n.OmvFilterString.StringMatch.Match,i=0,r=1/0){this.m_layersToProcess.push({name:{value:e,match:t},minLevel:i,maxLevel:r})}ignoreLayer(e,t=n.OmvFilterString.StringMatch.Match,i=0,r=1/0){this.m_layersToIgnore.push({name:{value:e,match:t},minLevel:i,maxLevel:r})}processPoint(e){this.addItem(this.m_pointsToProcess,e)}processPoints(e){this.addItems(this.m_pointsToProcess,e)}ignorePoint(e){this.addItem(this.m_ignoredPoints,e)}ignorePoints(e){this.addItems(this.m_ignoredPoints,e)}processLine(e){this.addItem(this.m_linesToProcess,e)}processLines(e){this.addItems(this.m_linesToProcess,e)}ignoreLine(e){this.addItem(this.m_linesToIgnore,e)}ignoreLines(e){this.addItems(this.m_linesToIgnore,e)}processPolygon(e){this.addItem(this.m_polygonsToProcess,e)}processPolygons(e){this.addItems(this.m_polygonsToProcess,e)}ignorePolygon(e){this.addItem(this.m_polygonsToIgnore,e)}ignorePolygons(e){this.addItems(this.m_polygonsToIgnore,e)}processKinds(e){this.m_kindsToProcess=this.m_kindsToProcess.concat(e)}ignoreKinds(e){this.m_kindsToIgnore=this.m_kindsToIgnore.concat(e)}createDescription(){return{processLayersDefault:this.m_processLayersDefault,processPointsDefault:this.m_processPointsDefault,processLinesDefault:this.m_processLinesDefault,processPolygonsDefault:this.m_processPolygonsDefault,layersToProcess:this.m_layersToProcess,layersToIgnore:this.m_layersToIgnore,pointsToProcess:this.m_pointsToProcess,pointsToIgnore:this.m_ignoredPoints,linesToProcess:this.m_linesToProcess,linesToIgnore:this.m_linesToIgnore,polygonsToProcess:this.m_polygonsToProcess,polygonsToIgnore:this.m_polygonsToIgnore,kindsToProcess:this.m_kindsToProcess,kindsToIgnore:this.m_kindsToIgnore}}addItem(e,t){(void 0===t.minLevel||isNaN(t.minLevel))&&(t.minLevel=0),(void 0===t.maxLevel||isNaN(t.maxLevel))&&(t.maxLevel=1/0);const i={layerName:{value:t.layer,match:void 0===t.matchLayer?n.OmvFilterString.StringMatch.Match:t.matchLayer},geometryTypes:void 0!==t.geomType?Array.isArray(t.geomType)?t.geomType:[t.geomType]:void 0,classes:[{value:t.featureClass,match:void 0===t.matchClass?n.OmvFilterString.StringMatch.Match:t.matchClass}],minLevel:t.minLevel,maxLevel:t.maxLevel,featureAttribute:t.featureAttribute};e.push(i)}addItems(e,t){(void 0===t.minLevel||isNaN(t.minLevel))&&(t.minLevel=0),(void 0===t.maxLevel||isNaN(t.maxLevel))&&(t.maxLevel=1/0);const i={layerName:{value:t.layer,match:void 0===t.matchLayer?n.OmvFilterString.StringMatch.Match:t.matchLayer},geometryTypes:void 0!==t.geomTypes?Array.isArray(t.geomTypes)?t.geomTypes:[t.geomTypes]:void 0,classes:t.featureClasses,minLevel:t.minLevel,maxLevel:t.maxLevel,featureAttribute:t.featureAttribute};e.push(i)}};class s{constructor(e){this.description=e,this.description.kindsToProcess.length>0&&(this.enabledKinds=new r.GeometryKindSet(this.description.kindsToProcess)),this.description.kindsToIgnore.length>0&&(this.disabledKinds=new r.GeometryKindSet(this.description.kindsToIgnore))}static matchLayer(e,t,i){for(const r of t)if(!(i<r.minLevel||i>r.maxLevel)&&n.OmvFilterString.matchString(e,r.name))return!0;return!1}wantsLayer(e,t){return!!s.matchLayer(e,this.description.layersToProcess,t)||!s.matchLayer(e,this.description.layersToIgnore,t)&&this.description.processLayersDefault}wantsPointFeature(e,t,i){return this.wantsFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,i,this.description.processPointsDefault)}wantsLineFeature(e,t,i){return this.wantsFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,i,this.description.processLinesDefault)}wantsPolygonFeature(e,t,i){return this.wantsFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,i,this.description.processPolygonsDefault)}wantsKind(e){return void 0===e||(!(void 0!==this.disabledKinds&&this.disabledKinds.hasOrIntersects(e))||void 0!==this.enabledKinds&&this.enabledKinds.hasOrIntersects(e))}get hasKindFilter(){return void 0!==this.enabledKinds||void 0!==this.disabledKinds}wantsFeature(e,t,i,r,s,o){for(const t of e)if(!(s<t.minLevel||s>t.maxLevel)&&n.OmvFilterString.matchString(i,t.layerName)&&void 0!==t.geometryTypes&&t.geometryTypes.indexOf(r)>=0)return!0;for(const e of t)if(n.OmvFilterString.matchString(i,e.layerName)&&void 0!==e.geometryTypes&&e.geometryTypes.indexOf(r)>=0)return!1;return o}}t.OmvGenericFeatureFilter=s;t.ComposedDataFilter=class{constructor(e){this.filters=e}get hasKindFilter(){return this.filters.reduce((e,t)=>e&&t.hasKindFilter,!0)}wantsLayer(e,t){return this.filters.reduce((i,r)=>i&&r.wantsLayer(e,t),!0)}wantsPointFeature(e,t,i){return this.filters.reduce((r,n)=>r&&n.wantsPointFeature(e,t,i),!0)}wantsLineFeature(e,t,i){return this.filters.reduce((r,n)=>r&&n.wantsLineFeature(e,t,i),!0)}wantsPolygonFeature(e,t,i){return this.filters.reduce((r,n)=>r&&n.wantsPolygonFeature(e,t,i),!0)}wantsKind(e){return this.filters.reduce((t,i)=>t&&i.wantsKind(e),!0)}};class o{constructor(e){this.description=e}static matchItems(e,t,i){for(const r of i)if(void 0!==r.classes){if(!n.OmvFilterString.matchString(e,r.layerName))continue;for(const e of r.classes)if(n.OmvFilterString.matchString(t,e))return!0}return!1}static matchAttribute(e,t,i){for(const r of i)if(void 0!==r.featureAttribute&&n.OmvFilterString.matchString(e,r.layerName)&&t.lookup(r.featureAttribute.key)===r.featureAttribute.value)return!0;return!1}doProcessPointFeature(e,t){return this.doProcessFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,this.description.processPointsDefault)}doProcessLineFeature(e,t){return this.doProcessFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,this.description.processLinesDefault)}doProcessPolygonFeature(e,t){return this.doProcessFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,this.description.processPolygonsDefault)}doProcessFeature(e,t,i,r,n){if(void 0===i||0===e.length&&0===t.length)return n;let s;const a=r.lookup("class");return null!=a&&(s=a.toString()),!(!s||!o.matchItems(i,s,e))||(!s||!o.matchItems(i,s,t))&&(!!o.matchAttribute(i,r,e)||!o.matchAttribute(i,r,t)&&n)}}t.OmvGenericFeatureModifier=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(3),s=i(236),o=i(1),a=i(56),l=i(115),c=i(57),h=o.LoggerManager.instance.create("OmvDataSource");function d(e){if(e.dataProvider)return e.dataProvider;if(e.baseUrl||e.url)return new l.OmvRestClient(e);throw new Error("OmvDataSource: missing url, baseUrl or dataProvider params")}let u=!1;class m extends s.TileDataSource{constructor(e){super(e.tileFactory||new s.TileFactory(c.OmvTile),{styleSetName:e.styleSetName||"omv",name:e.name,tilingScheme:n.webMercatorTilingScheme,dataProvider:d(e),concurrentDecoderServiceName:a.OMV_TILE_DECODER_SERVICE_TYPE,decoder:e.decoder,concurrentDecoderScriptUrl:e.concurrentDecoderScriptUrl,copyrightInfo:e.copyrightInfo,copyrightProvider:e.copyrightProvider,minZoomLevel:o.getOptionValue(e.minZoomLevel,1),maxZoomLevel:o.getOptionValue(e.maxZoomLevel,14),storageLevelOffset:o.getOptionValue(e.storageLevelOffset,-1)}),this.m_params=e,this.cacheable=!0,this.addGroundPlane=void 0===e.addGroundPlane||!0===e.addGroundPlane,this.m_decoderOptions={showMissingTechniques:!0===this.m_params.showMissingTechniques,filterDescription:this.m_params.filterDescr,gatherFeatureAttributes:!0===this.m_params.gatherFeatureAttributes,createTileInfo:!0===this.m_params.createTileInfo,gatherRoadSegments:!0===this.m_params.gatherRoadSegments,featureModifierId:this.m_params.featureModifierId,skipShortLabels:this.m_params.skipShortLabels,storageLevelOffset:o.getOptionValue(e.storageLevelOffset,-1),enableElevationOverlay:!0===this.m_params.enableElevationOverlay},this.maxGeometryHeight=o.getOptionValue(e.maxGeometryHeight,n.EarthConstants.MAX_BUILDING_HEIGHT)}async connect(){try{await super.connect()}catch(e){throw r.WorkerServiceProtocol.isUnknownServiceError(e)&&!u&&(h.info("Unable to create decoder service in worker. Use  'OmvTileDecoderService.start();' in decoder script."),u=!0),e}this.configureDecoder(void 0,void 0,void 0,this.m_decoderOptions)}removeDataFilter(){this.configureDecoder(void 0,void 0,void 0,{filterDescription:null})}setDataFilter(e){this.m_decoderOptions.filterDescription=null!==e?e:void 0,this.configureDecoder(void 0,void 0,void 0,{filterDescription:e})}shouldPreloadTiles(){return!0}shouldRender(e,t){return!(t.level>this.maxZoomLevel)&&(t.level===this.maxZoomLevel&&e>=this.maxZoomLevel||super.shouldRender(e,t))}setLanguages(e){void 0!==e&&this.configureDecoder(void 0,void 0,e,void 0)}get storageLevelOffset(){return super.storageLevelOffset}set storageLevelOffset(e){super.storageLevelOffset=e,this.m_decoderOptions.storageLevelOffset=this.storageLevelOffset,this.configureDecoder(void 0,void 0,void 0,{storageLevelOffset:this.storageLevelOffset})}setEnableElevationOverlay(e){this.m_decoderOptions.enableElevationOverlay!==e&&(this.m_decoderOptions.enableElevationOverlay=e,this.configureDecoder(void 0,void 0,void 0,{enableElevationOverlay:e}))}configureDecoder(e,t,i,r){this.clearCache(),this.decoder.configure(e,t,i,r),this.mapView.markTilesDirty(this)}}t.OmvDataSource=m},function(e,t,i){"use strict";function r(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),r(i(237)),r(i(114))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(47),n=i(17),s=i(1),o=i(114);t.TileFactory=class{constructor(e){this.m_modelConstructor=e}create(e,t){return new this.m_modelConstructor(e,t)}};const a=3;class l extends n.DataSource{constructor(e,t){if(super(t.name,t.styleSetName,t.minZoomLevel,t.maxZoomLevel,t.storageLevelOffset),this.m_tileFactory=e,this.m_options=t,this.logger=s.LoggerManager.instance.create("TileDataSource"),this.m_isReady=!1,t.decoder)this.m_decoder=t.decoder;else{if(!t.concurrentDecoderServiceName)throw new Error(`TileDataSource[${this.name}]: unable to create, missing decoder or `+"concurrentDecoderServiceName");this.m_decoder=n.ConcurrentDecoderFacade.getTileDecoder(t.concurrentDecoderServiceName,t.concurrentDecoderScriptUrl,t.concurrentDecoderWorkerCount)}this.useGeometryLoader=!0,this.cacheable=!0,this.m_tileLoaderCache=new r.LRUCache(this.getCacheCount()),this.m_tileLoaderCache.evictionCallback=(e,t)=>{t.cancel()}}dispose(){this.decoder.dispose()}ready(){return this.m_isReady&&this.m_options.dataProvider.ready()}get decoder(){return this.m_decoder}async connect(){await Promise.all([this.m_options.dataProvider.connect(),this.m_decoder.connect()]),this.m_isReady=!0,this.m_decoder.configure(void 0,void 0,void 0,{storageLevelOffset:this.m_options.storageLevelOffset})}setStyleSet(e,t,i){this.m_decoder.configure(e,t,i),this.mapView.markTilesDirty(this)}setTheme(e,t){const i=void 0!==this.styleSetName&&e.styles?e.styles[this.styleSetName]:void 0;void 0!==i&&this.setStyleSet(i,e.definitions,t)}clearCache(){this.m_tileLoaderCache.evictAll()}dataProvider(){return this.m_options.dataProvider}getTilingScheme(){return this.m_options.tilingScheme}getTile(e){const t=this.m_tileFactory.create(this,e),i=e.mortonCode(),r=this.m_tileLoaderCache.get(i);if(void 0!==r)t.tileLoader=r;else{const r=new o.TileLoader(this,e,this.m_options.dataProvider,this.decoder,0);t.tileLoader=r,t.copyrightInfo=this.m_options.copyrightInfo,void 0!==this.m_options.copyrightProvider&&this.m_options.copyrightProvider.getCopyrights(t.geoBox,e.level).then(e=>{t.copyrightInfo=void 0===t.copyrightInfo?e:[...t.copyrightInfo,...e],this.requestUpdate()}),e.level<=a&&this.m_tileLoaderCache.set(i,r)}return void 0!==t.tileLoader.decodedTile?t.decodedTile=t.tileLoader.decodedTile:t.load(),t}getTileInfo(e){return new Promise((t,i)=>{const r=new o.TileInfoLoader(this,e,this.m_options.dataProvider,this.decoder,0);r.loadAndDecode().then(e=>{e===n.TileLoaderState.Ready?t(r.tileInfo):i(new Error(`TileDataSource#getInfoTile wrong final state: ${e}`))})})}getCacheCount(){return 2*Math.pow(2,a)}}t.TileDataSource=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(17),s=i(51),o=i(6),a=i(0),l=i(33),c=i(57),h=new a.LineBasicMaterial({color:0,linewidth:2,depthTest:!1,depthFunc:a.NeverDepth}),d=new a.MeshBasicMaterial({color:16711680,depthTest:!1,depthFunc:a.NeverDepth});new a.MeshBasicMaterial({color:16711680,depthTest:!1,depthFunc:a.NeverDepth}).wireframe=!0,new a.MeshBasicMaterial({color:8421631,depthTest:!1,depthFunc:a.NeverDepth}).wireframe=!0;const u=new a.MeshBasicMaterial({color:0,depthTest:!1,depthFunc:a.NeverDepth}),m=new o.TextRenderStyle,p=new o.TextLayoutStyle;m.fontSize={unit:o.FontUnit.Point,size:9,backgroundSize:0},m.opacity=.75,m.backgroundOpacity=.75;class f extends c.OmvTile{constructor(e,t){super(e,t)}loadingFinished(){this.addLabelDebugInfo()}addLabelDebugInfo(){const e=s.debugContext.getValue("DEBUG_TEXT_PATHS"),t=s.debugContext.getValue("DEBUG_TEXT_PATHS_FULL");if(!e&&!t||void 0===this.decodedTile)return;const i=l.TileGeometryCreator.instance,c=this.decodedTile;i.createTextElements(this,c);const f=new Map,g=s.debugContext.getValue("DEBUG_TEXT_PATHS.FILTER.TEXT"),v=s.debugContext.getValue("DEBUG_TEXT_PATHS.FILTER.INDEX"),y=this.mapView.zoomLevel;if(void 0!==c.textPathGeometries&&(this.preparedTextPaths=i.prepareTextPaths(c.textPathGeometries,c)),void 0!==this.preparedTextPaths){const i=new a.BufferGeometry,s=new Array,l=new Array,_=new a.BufferGeometry,x=new Array,T=new Array,S=new a.BufferGeometry,w=new Array,b=new Array;let M=0;const E=this.mapView.pixelToWorld,P=this.computeWorldOffsetX();for(const i of this.preparedTextPaths){const h=c.techniques[i.technique];if(!r.isTextTechnique(h))continue;void 0!==h.color&&f.set(i.technique,new a.Color(r.getPropertyValue(h.color,y))),M=l.length/3;const d=i.text,u=this.preparedTextPaths.indexOf(i);if((!g||d&&d.indexOf(g)>=0)&&(void 0===v||v===u)){for(let s=0;s<i.path.length;s+=3){const c=s/3,u=i.path[s],f=i.path[s+1],g=i.path[s+2]+s/3;e&&l.push(u,f,g);const v=0===s;if(t||v){const e=E*(v?6:4),i=v?T:b,s=v?x:w;i.push(u,f-e,g),i.push(u+e,f,g),i.push(u,f+e,g),i.push(u-e,f,g);const l=i.length/3;if(s.push(l-4),s.push(l-3),s.push(l-2),s.push(l-4),s.push(l-2),s.push(l-1),t){const e=c%5==0?d+":"+c:Number(c).toString(),t=new n.TextElement(o.ContextualArabicConverter.instance.convert(e),new a.Vector3(u+P,f,g),m,p,r.getPropertyValue(h.priority||0,y),h.xOffset||0,h.yOffset||0);t.minZoomLevel=h.minZoomLevel,t.mayOverlap=!0,t.reserveSpace=!1,t.alwaysOnTop=!0,t.ignoreDistance=!0,this.addUserTextElement(t)}}}const c=i.path.length/3;for(let e=0;e<c;++e)e>0&&s.push(M+e),e+1<c&&s.push(M+e)}}if(s.length>0){i.addGroup(0,s.length,0),i.setAttribute("position",new a.BufferAttribute(new Float32Array(l),3)),i.setIndex(new a.BufferAttribute(new Uint32Array(s),1));const e=new a.LineSegments(i,h);e.renderOrder=2e3,this.objects.push(e)}if(x.length>0){_.addGroup(0,x.length,0),_.setAttribute("position",new a.BufferAttribute(new Float32Array(T),3)),_.setIndex(new a.BufferAttribute(new Uint32Array(x),1));const e=new a.Mesh(_,d);e.renderOrder=3e3,this.objects.push(e)}if(w.length>0){S.addGroup(0,w.length,0),S.setAttribute("position",new a.BufferAttribute(new Float32Array(b),3)),S.setIndex(new a.BufferAttribute(new Uint32Array(w),1));const e=new a.Mesh(S,u);e.renderOrder=2500,this.objects.push(e)}}}}t.OmvDebugLabelsTile=f},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appId="devportal-demo-20180625",t.appCode="9v2BkviRwi9Ot26kp2IysQ",t.accessToken="AGln99HORnqL1kfIQtsQl70",t.copyrightInfo=[{id:"here.com",year:(new Date).getFullYear(),label:"HERE",link:"https://legal.here.com/terms"}]}]);
//# sourceMappingURL=index.bundle.js.map