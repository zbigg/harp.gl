!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=55)}([function(e,t){e.exports=THREE},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(73),i=r(88),o=r(89),s=r(11),a=r(17),u=r(26);!function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(32));const l=new n.ExprEvaluator,c=new i.ExprInstantiator;class h{constructor(){this.properties=new Set}}t.ExprDependencies=h;class p{static of(e){const t=new h;return e.accept(this.instance,t),t}visitNullLiteralExpr(e,t){}visitBooleanLiteralExpr(e,t){}visitNumberLiteralExpr(e,t){}visitStringLiteralExpr(e,t){}visitObjectLiteralExpr(e,t){}visitVarExpr(e,t){t.properties.add(e.name)}visitHasAttributeExpr(e,t){t.properties.add(e.name)}visitContainsExpr(e,t){e.value.accept(this,t)}visitCallExpr(e,t){"zoom"===e.op&&0===e.args.length?t.zoom=!0:e.args.forEach(e=>e.accept(this,t))}visitMatchExpr(e,t){e.value.accept(this,t),e.branches.forEach(([e,r])=>r.accept(this,t)),e.fallback.accept(this,t)}visitCaseExpr(e,t){e.branches.forEach(([e,r])=>{e.accept(this,t),r.accept(this,t)}),e.fallback.accept(this,t)}}function d(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]}var f;p.instance=new p,t.isJsonExpr=d,function(e){e[e.Value=0]="Value",e[e.Condition=1]="Condition",e[e.Dynamic=2]="Dynamic"}(f=t.ExprScope||(t.ExprScope={}));class m{static isExpr(e){return e instanceof m}static parse(e){return new o.ExprParser(e).parse()}static fromJSON(e,t,r){return L(e,void 0!==t?{definitions:t,lockedNames:new Set,cache:r||new Map}:void 0)}evaluate(e,t=f.Value,r){return this.accept(l,new n.ExprEvaluatorContext(l,e,t,r))}instantiate(e){return this.accept(c,e)}dependencies(){return p.of(this)}intern(e){return e.add(this)}toJSON(){return(new A).serialize(this)}isDynamic(){return void 0===this.m_isDynamic&&(this.m_isDynamic=this.exprIsDynamic()),this.m_isDynamic}}t.Expr=m;class g extends m{constructor(e){super(),this.name=e}accept(e,t){return e.visitVarExpr(this,t)}exprIsDynamic(){return!1}}t.VarExpr=g;class y extends m{static fromValue(e){switch(typeof e){case"boolean":return new x(e);case"number":return new b(e);case"string":return new w(e);case"object":return null===e?v.instance:new T(e);default:throw new Error(`failed to create a literal from '${e}'`)}}exprIsDynamic(){return!1}}t.LiteralExpr=y;class v extends y{constructor(){super(),this.value=null}accept(e,t){return e.visitNullLiteralExpr(this,t)}exprIsDynamic(){return!1}}t.NullLiteralExpr=v,v.instance=new v;class x extends y{constructor(e){super(),this.value=e}accept(e,t){return e.visitBooleanLiteralExpr(this,t)}}t.BooleanLiteralExpr=x;class b extends y{constructor(e){super(),this.value=e}accept(e,t){return e.visitNumberLiteralExpr(this,t)}}t.NumberLiteralExpr=b;class w extends y{constructor(e){super(),this.value=e}accept(e,t){return e.visitStringLiteralExpr(this,t)}}t.StringLiteralExpr=w;class T extends y{constructor(e){super(),this.value=e}get isArrayLiteral(){return Array.isArray(this.value)}accept(e,t){return e.visitObjectLiteralExpr(this,t)}}t.ObjectLiteralExpr=T;class _ extends m{constructor(e){super(),this.name=e}accept(e,t){return e.visitHasAttributeExpr(this,t)}exprIsDynamic(){return!1}}t.HasAttributeExpr=_;class S extends m{constructor(e,t){super(),this.value=e,this.elements=t}static isValidElementsArray(e){if(!Array.isArray(e)||0===e.length)return!1;const t=typeof e[0];return("number"===t||"string"===t)&&e.every(e=>typeof e===t)}accept(e,t){return e.visitContainsExpr(this,t)}exprIsDynamic(){return this.value.isDynamic()}}t.ContainsExpr=S;class E extends m{constructor(e,t){super(),this.op=e,this.args=t}get children(){return this.args}accept(e,t){return e.visitCallExpr(this,t)}exprIsDynamic(){const e=this.descriptor||n.ExprEvaluator.getOperator(this.op);return!!(e&&e.isDynamicOperator&&e.isDynamicOperator(this))||this.args.some(e=>e.isDynamic())}}t.CallExpr=E;class M extends m{constructor(e,t,r){super(),this.value=e,this.branches=t,this.fallback=r}static isValidMatchLabel(e){switch(typeof e){case"number":case"string":return!0;case"object":if(!Array.isArray(e)||0===e.length)return!1;const t=typeof e[0];return("number"===t||"string"===t)&&e.every(e=>typeof e===t);default:return!1}}accept(e,t){return e.visitMatchExpr(this,t)}exprIsDynamic(){return this.value.isDynamic()||this.branches.some(([e,t])=>t.isDynamic())||this.fallback.isDynamic()}}t.MatchExpr=M;class P extends m{constructor(e,t){super(),this.branches=e,this.fallback=t}accept(e,t){return e.visitCaseExpr(this,t)}exprIsDynamic(){return this.branches.some(([e,t])=>e.isDynamic()||t.isDynamic())||this.fallback.isDynamic()}}t.CaseExpr=P;class A{serialize(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return["literal",e.value]}visitVarExpr(e,t){return["get",e.name]}visitHasAttributeExpr(e,t){return["has",e.name]}visitContainsExpr(e,t){return["in",this.serialize(e.value),e.elements]}visitCallExpr(e,t){return[e.op,...e.args.map(e=>this.serialize(e))]}visitMatchExpr(e,t){const r=[];for(const[t,n]of e.branches)r.push(t,this.serialize(n));return["match",this.serialize(e.value),...r,this.serialize(e.fallback)]}visitCaseExpr(e,t){const r=[];for(const[t,n]of e.branches)r.push(this.serialize(t),this.serialize(n));return["case",...r,this.serialize(e.fallback)]}}function L(e,t){if(Array.isArray(e))return function e(t,r){const n=t[0];if("string"!=typeof n)throw new Error("expected a builtin function name");switch(n){case"!has":case"!in":return new E("!",[e([n.slice(1),...t.slice(1)])]);case"ref":return function(e,t){if("string"!=typeof e[1])throw new Error("expected the name of an attribute");if(void 0===t)throw new Error("ref used with no definitions");const r=e[1];if(t.lockedNames.has(r))throw new Error(`circular referene to '${r}'`);if(!(r in t.definitions))throw new Error(`definition '${r}' not found`);const n=t.cache.get(r);if(void 0!==n)return n;let i,o=t.definitions[r];u.isSelectorDefinition(o)&&(o=o.value);if(u.isValueDefinition(o)){if(s.isInterpolatedPropertyDefinition(o.value))return m.fromJSON(a.interpolatedPropertyDefinitionToJsonExpr(o.value));if(!d(o.value))return m.fromJSON(o.value);o=o.value}if(!d(o))throw new Error(`unsupported definition ${r}`);t.lockedNames.add(r);try{i=L(o,t)}finally{t.lockedNames.delete(r)}return t.cache.set(r,i),i}(t,r);case"get":return function(e,t){if(void 0!==e[2])return I("get",e,t);const r=e[1];if("string"!=typeof r)throw new Error("expected the name of an attribute");return new g(r)}(t,r);case"has":return function(e,t){if(void 0!==e[2])return I("has",e,t);const r=e[1];if("string"!=typeof r)throw new Error("expected the name of an attribute");return new _(r)}(t,r);case"in":return function(e,t){const r=e[2];if(!S.isValidElementsArray(r))throw new Error("'in' expects an array of number or string literals");return new S(L(e[1],t),r)}(t,r);case"literal":return function(e){const t=e[1];if(null===t||"object"!=typeof t)throw new Error("expected an object or array literal");return new T(t)}(t);case"match":return function(e,t){if(e.length<4)throw new Error("not enough arguments");if(!(e.length%2))throw new Error("fallback is missing in 'match' expression");const r=L(e[1],t),n=[];for(let r=2;r<e.length-1;r+=2){const i=e[r];if(!M.isValidMatchLabel(i))throw new Error(`'${JSON.stringify(i)}' is not a valid label for 'match'`);const o=L(e[r+1],t);n.push([i,o])}const i=L(e[e.length-1],t);return new M(r,n,i)}(t,r);case"case":return function(e,t){if(e.length<3)throw new Error("not enough arguments");if(e.length%2)throw new Error("fallback is missing in 'case' expression");const r=[];for(let n=1;n<e.length-1;n+=2){const i=L(e[n],t),o=L(e[n+1],t);r.push([i,o])}const n=L(e[e.length-1],t);return new P(r,n)}(t,r);default:return I(n,t,r)}}(e,t);if(null===e)return v.instance;if("boolean"==typeof e)return new x(e);if("number"==typeof e)return new b(e);if("string"==typeof e)return new w(e);throw new Error(`failed to create expression from: ${JSON.stringify(e)}`)}function I(e,t,r){return new E(e,t.slice(1).map(e=>L(e,r)))}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(57)),n(r(58)),n(r(62)),n(r(63)),n(r(64)),n(r(65)),n(r(66)),n(r(67)),n(r(68)),n(r(69)),n(r(70)),n(r(25)),n(r(71)),n(r(72))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(16)),n(r(1)),n(r(27)),n(r(34)),n(r(26)),n(r(11)),n(r(17)),n(r(90)),n(r(91)),n(r(92)),n(r(36)),n(r(103)),n(r(105)),n(r(33))},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(12)),n(r(37)),n(r(5)),n(r(38)),n(r(39)),n(r(13)),n(r(40)),n(r(93)),n(r(10)),n(r(18)),n(r(41)),n(r(94)),n(r(42)),n(r(43)),n(r(19)),n(r(95)),n(r(44)),n(r(20)),n(r(45)),n(r(46)),n(r(14)),n(r(96)),n(r(97)),n(r(98)),n(r(99)),n(r(100)),n(r(8)),n(r(9)),n(r(6)),n(r(101)),n(r(102))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(37),i=r(38),o=r(39),s=r(0);class a{constructor(e,t,r){this.latitude=e,this.longitude=t,this.altitude=r}static fromDegrees(e,t,r){return new a(e,t,r)}static fromRadians(e,t,r){return new a(s.Math.radToDeg(e),s.Math.radToDeg(t),r)}static fromLatLng(e){return new a(e.lat,e.lng)}static fromGeoPoint(e){return new a(e[1],e[0],e[2])}static fromObject(e){if(i.isGeoPointLike(e))return a.fromGeoPoint(e);if(n.isGeoCoordinatesLike(e))return a.fromDegrees(e.latitude,e.longitude,e.altitude);if(o.isLatLngLike(e))return a.fromDegrees(e.lat,e.lng);throw new Error("Invalid input coordinate format.")}get latitudeInRadians(){return s.Math.degToRad(this.latitude)}get longitudeInRadians(){return s.Math.degToRad(this.longitude)}get latitudeInDegrees(){return this.latitude}get longitudeInDegrees(){return this.longitude}get lat(){return this.latitude}get lng(){return this.longitude}isValid(){return!isNaN(this.latitude)&&!isNaN(this.longitude)}normalized(){let{latitude:e,longitude:t}=this;if(isNaN(e)||isNaN(t))return this;if(e>90){let r=(e+90)%360;r>=180&&(t+=180,r=360-r),e=r-90}if(e<-90){let r=(e-90)%360;r<=-180&&(t+=180,r=-360-r),e=r+90}if(t<-180||t>180){const e=Math.sign(t);t=(t%360+180*e)%360-180*e}return e===this.latitude&&t===this.longitude?this:new a(e,t,this.altitude)}equals(e){return this.latitude===e.latitude&&this.longitude===e.longitude&&this.altitude===e.altitude}copy(e){return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this}clone(){return new a(this.latitude,this.longitude,this.altitude)}toLatLng(){return{lat:this.latitude,lng:this.longitude}}toGeoPoint(){return void 0!==this.altitude?[this.longitude,this.latitude,this.altitude]:[this.longitude,this.latitude]}}t.GeoCoordinates=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);!function(e){function t(e){return(e%=360)<0&&(e+=360),e}function r(e,r){const n=(e=t(e))-(r=t(r));return n>180?n-360:n<=-180?n+360:n}e.newEmptyBox3=function(){return{min:{x:1/0,y:1/0,z:1/0},max:{x:-1/0,y:-1/0,z:-1/0}}},e.newVector3=function(e,t,r,n){return void 0===n?{x:e,y:t,z:r}:(n.x=e,n.y=t,n.z=r,n)},e.degToRad=n.Math.degToRad,e.radToDeg=n.Math.radToDeg,e.clamp=n.Math.clamp,e.normalizeAngleDeg=t,e.angleDistanceDeg=r,e.interpolateAnglesDeg=function(e,t,n){return(e+r(t,e)*n)%360}}(t.MathUtils||(t.MathUtils={}))},function(e,t,r){"use strict";(function(e){var n=t;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function o(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),r&&i(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}n.asPromise=r(119),n.base64=r(120),n.EventEmitter=r(121),n.float=r(122),n.inquire=r(123),n.utf8=r(124),n.pool=r(125),n.LongBits=r(126),n.global="undefined"!=typeof window&&window||void 0!==e&&e||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isNode=Boolean(n.global.process&&n.global.process.versions&&n.global.process.versions.node),n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!(null==r||!e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(Boolean(t))},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=o,n.ProtocolError=o("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;e?(n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):n._Buffer_from=n._Buffer_allocUnsafe=null}}).call(this,r(118))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isBox3Like=function(e){const t=e;return void 0!==t.min&&void 0!==t.max}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isOrientedBox3Like=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis&&void 0!==t.extents}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6);!function(e){e[e.Planar=0]="Planar",e[e.Spherical=1]="Spherical"}(t.ProjectionType||(t.ProjectionType={}));t.Projection=class{constructor(e){this.unitScale=e}localTangentSpace(e,t){return this.projectPoint(e,t.position),n.MathUtils.newVector3(1,0,0,t.xAxis),n.MathUtils.newVector3(0,1,0,t.yAxis),n.MathUtils.newVector3(0,0,1,t.zAxis),t}reprojectPoint(e,t,r){return e===this?void 0===r?{x:t.x,y:t.y,z:t.z}:(r.x=t.x,r.y=t.y,r.z=t.z,r):this.projectPoint(e.unprojectPoint(t),r)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(2),o=r(16),s=r(32),a=r(81),u=r(1),l=r(17),c=r(33),h=i.LoggerManager.instance.create("InterpolatedProperty"),p=[n.DiscreteInterpolant,n.LinearInterpolant,n.CubicInterpolant,a.ExponentialInterpolant],d=new Array(c.StringEncodedNumeralFormatMaxSize);function f(e){return void 0!==e&&void 0!==e.interpolationMode&&e.zoomLevels instanceof Float32Array&&void 0!==e.values&&e.values.length>0&&(e.zoomLevels.length===e.values.length/4||e.zoomLevels.length===e.values.length/3||e.zoomLevels.length===e.values.length)}t.isInterpolatedPropertyDefinition=function(e){return!!(e&&void 0===e.interpolationMode&&Array.isArray(e.values)&&e.values.length>0&&void 0!==e.values[0]&&Array.isArray(e.zoomLevels)&&e.zoomLevels.length>0&&void 0!==e.zoomLevels[0]&&e.values.length===e.zoomLevels.length)},t.isInterpolatedProperty=f;const m=new s.MapEnv({$zoom:0,$pixelToMeters:1});function g(e,t,r){const n=e.values.length/e.zoomLevels.length,i=new p[e.interpolationMode](e.zoomLevels,e.values,n);if(e.interpolationMode===l.InterpolationMode.Exponential&&void 0!==e.exponent&&(i.exponent=e.exponent),i.evaluate(t),void 0===e._stringEncodedNumeralDynamicMask)return i.resultBuffer[0];{const n=new p[e.interpolationMode](e.zoomLevels,e._stringEncodedNumeralDynamicMask,1);return e.interpolationMode===l.InterpolationMode.Exponential&&void 0!==e.exponent&&(n.exponent=e.exponent),n.evaluate(t),i.resultBuffer[0]*(1+n.resultBuffer[0]*(r-1))}}t.getPropertyValue=function(e,t,r=1){if(u.Expr.isExpr(e)){let n;return"number"==typeof t?(m.entries.$zoom=t,m.entries.$pixelToMeters=r,n=m):n=t,e.evaluate(n,u.ExprScope.Dynamic)}let s;if("number"==typeof t?s=t:(s=t.lookup("$zoom"),r=t.lookup("$pixelToMeters")),!f(e)){if("string"!=typeof e)return e;{const t=c.parseStringEncodedNumeral(e,r);return void 0!==t?t:e}}if(void 0!==e._stringEncodedNumeralType)switch(e._stringEncodedNumeralType){case c.StringEncodedNumeralType.Meters:case c.StringEncodedNumeralType.Pixels:return g(e,s,r);case c.StringEncodedNumeralType.Hex:case c.StringEncodedNumeralType.RGB:case c.StringEncodedNumeralType.RGBA:case c.StringEncodedNumeralType.HSL:return function(e,t){const r=e.values.length/e.zoomLevels.length,s=new p[e.interpolationMode](e.zoomLevels,e.values,r);e.interpolationMode===l.InterpolationMode.Exponential&&void 0!==e.exponent&&(s.exponent=e.exponent);return s.evaluate(t),i.assert(3===r||4===r),4===r?o.ColorUtils.getHexFromRgba(n.Math.clamp(s.resultBuffer[0],0,1),n.Math.clamp(s.resultBuffer[1],0,1),n.Math.clamp(s.resultBuffer[2],0,1),n.Math.clamp(s.resultBuffer[3],0,1)):o.ColorUtils.getHexFromRgb(n.Math.clamp(s.resultBuffer[0],0,1),n.Math.clamp(s.resultBuffer[1],0,1),n.Math.clamp(s.resultBuffer[2],0,1))}(e,s)}return g(e,s,r)},t.createInterpolatedProperty=function(e){!function(e){const t="Cubic"===e.interpolation;for(let r=0;r<e.values.length;++r){e.zoomLevels.findIndex(n=>t?Math.abs(n-e.zoomLevels[r])<.001:n===e.zoomLevels[r])!==r&&(e.zoomLevels.splice(--r,1),e.values.splice(--r,1))}}(e);const t=void 0!==e.interpolation?l.InterpolationMode[e.interpolation]:l.InterpolationMode.Discrete,r=new Float32Array(e.zoomLevels),n=e.values[0];switch(typeof n){default:case"number":case"boolean":return{interpolationMode:t,zoomLevels:r,values:new Float32Array(e.values),exponent:e.exponent};case"string":const i=c.StringEncodedNumeralFormats.find(e=>e.regExp.test(n));if(void 0===i)return t===l.InterpolationMode.Discrete?{interpolationMode:t,zoomLevels:r,values:e.values}:void h.error(`No StringEncodedNumeralFormat matched ${n}.`);let o=!1;const s=new Float32Array(e.values.length*i.size),a=new Float32Array(e.values.length);return o=function(e,t,r,n){let i=!1;const o=e.type===c.StringEncodedNumeralType.Meters||e.type===c.StringEncodedNumeralType.Pixels?c.StringEncodedMetricFormats:c.StringEncodedColorFormats;for(let e=0;e<t.values.length;++e){let s=!1;for(const a of o){const o=t.values[e];if(s=a.decoder(o,d),s){void 0!==a.mask&&(n[e]=a.mask,i=!0);for(let t=0;t<a.size;++t)r[e*a.size+t]=d[t];break}}if(!s)throw Error(`Not all interpolation values match the same format: ${JSON.stringify(t)}`)}return i}(i,e,s,a),{interpolationMode:t,zoomLevels:r,values:s,exponent:e.exponent,_stringEncodedNumeralType:i.type,_stringEncodedNumeralDynamicMask:o?a:void 0}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(0);class o{constructor(e,t){this.southWest=e,this.northEast=t}static fromCoordinates(e,t){return new o(e,t)}get minAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.min(this.southWest.altitude,this.northEast.altitude)}get maxAltitude(){if(void 0!==this.southWest.altitude&&void 0!==this.northEast.altitude)return Math.max(this.southWest.altitude,this.northEast.altitude)}get south(){return this.southWest.latitude}get north(){return this.northEast.latitude}get west(){return this.southWest.longitude}get east(){return this.northEast.longitude}get center(){const e=.5*(this.south+this.north),{west:t,east:r}=this,{minAltitude:i,altitudeSpan:o}=this;let s;if(void 0!==i&&void 0!==o&&(s=i+.5*o),t<r)return new n.GeoCoordinates(e,.5*(t+r),s);let a=.5*(360+r+t);return a>360&&(a-=360),new n.GeoCoordinates(e,a,s)}get latitudeSpanInRadians(){return i.Math.degToRad(this.latitudeSpan)}get longitudeSpanInRadians(){return i.Math.degToRad(this.longitudeSpan)}get latitudeSpan(){return this.north-this.south}get altitudeSpan(){if(void 0!==this.maxAltitude&&void 0!==this.minAltitude)return this.maxAltitude-this.minAltitude}get longitudeSpan(){let e=this.northEast.longitude-this.southWest.longitude;return e<0&&(e+=360),e}get latitudeSpanInDegrees(){return this.latitudeSpan}get longitudeSpanInDegrees(){return this.longitudeSpan}contains(e){if(void 0===e.altitude||void 0===this.minAltitude||void 0===this.maxAltitude)return this.containsHelper(e);const t=this.minAltitude===this.maxAltitude,r=this.minAltitude===e.altitude,n=this.minAltitude<=e.altitude&&this.maxAltitude>e.altitude;return!(t?!r:!n)&&this.containsHelper(e)}clone(){return new o(this.southWest,this.northEast)}growToContain(e){this.southWest.latitude=Math.min(this.southWest.latitude,e.latitude),this.southWest.longitude=Math.min(this.southWest.longitude,e.longitude),this.southWest.altitude=void 0!==this.southWest.altitude&&void 0!==e.altitude?Math.min(this.southWest.altitude,e.altitude):void 0!==this.southWest.altitude?this.southWest.altitude:void 0!==e.altitude?e.altitude:void 0,this.northEast.latitude=Math.max(this.northEast.latitude,e.latitude),this.northEast.longitude=Math.max(this.northEast.longitude,e.longitude),this.northEast.altitude=void 0!==this.northEast.altitude&&void 0!==e.altitude?Math.max(this.northEast.altitude,e.altitude):void 0!==this.northEast.altitude?this.northEast.altitude:void 0!==e.altitude?e.altitude:void 0}containsHelper(e){if(e.latitude<this.southWest.latitude||e.latitude>=this.northEast.latitude)return!1;const{west:t,east:r}=this;return r>t?e.longitude>=t&&e.longitude<r:e.longitude>r||e.longitude<=t}}t.GeoBox=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{}t.EarthConstants=n,n.EQUATORIAL_CIRCUMFERENCE=40075016.68557849,n.EQUATORIAL_RADIUS=6378137,n.MIN_ELEVATION=-433,n.MAX_ELEVATION=8848,n.MAX_BUILDING_HEIGHT=828},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(42),i=r(45),o=r(46);t.TilingScheme=class{constructor(e,t){this.subdivisionScheme=e,this.projection=t,this.boundingBoxGenerator=new n.FlatTileBoundingBoxGenerator(this),this.tileTreeTraverse=new o.TileTreeTraverse(e)}getSubTileKeys(e){return this.tileTreeTraverse.subTiles(e)}getTileKey(e,t){return i.TileKeyUtils.geoCoordinatesToTileKey(this,e,t)}getTileKeys(e,t){return i.TileKeyUtils.geoRectangleToTileKeys(this,e,t)}getGeoBox(e){return this.boundingBoxGenerator.getGeoBox(e)}getWorldBox(e,t){return this.boundingBoxGenerator.getWorldBox(e,t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.tomTom=0]="tomTom"}(t.FeatureModifierId||(t.FeatureModifierId={})),function(e){let t;!function(e){e[e.Any=0]="Any",e[e.Match=1]="Match",e[e.StartsWith=2]="StartsWith",e[e.Contains=3]="Contains",e[e.EndsWith=4]="EndsWith"}(t=e.StringMatch||(e.StringMatch={})),e.matchString=function(t,r){switch(r.match){case e.StringMatch.Any:return!0;case e.StringMatch.Match:return t===r.value;case e.StringMatch.StartsWith:return r.value.startsWith(t);case e.StringMatch.EndsWith:return r.value.endsWith(t);default:return t.indexOf(r.value)>=0}}}(t.OmvFilterString||(t.OmvFilterString={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.POINT=1]="POINT",e[e.LINESTRING=2]="LINESTRING",e[e.POLYGON=3]="POLYGON"}(t.OmvGeometryType||(t.OmvGeometryType={})),t.OMV_TILE_DECODER_SERVICE_TYPE="omv-tile-decoder",t.OMV_TILER_SERVICE_TYPE="omv-tiler"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(0),o=24,s=16,a=8,u=0,l=255,c=16777215,h=4294967295,p=new i.Color;!function(e){e.getHexFromRgba=function(e,t,r,i){return n.assert(i>=0&&i<=1),l-Math.floor(i*l)<<o^e*l<<s^t*l<<a^r*l<<u},e.getHexFromRgb=function(e,t,r){return n.assert(e>=0&&e<=1),n.assert(t>=0&&t<=1),n.assert(r>=0&&r<=1),e*l<<s^t*l<<a^r*l<<u},e.getHexFromHsl=function(e,t,r){return n.assert(e>=0&&e<=1),n.assert(t>=0&&t<=1),n.assert(r>=0&&r<=1),p.setHSL(e,t,r).getHex()},e.getRgbaFromHex=function(e){return n.assert(0==(e&~h),"Wrong hex format: #"+e.toString(16)),{r:(e>>s&l)/l,g:(e>>a&l)/l,b:(e>>u&l)/l,a:(l-(e>>o&l))/l}},e.hasAlphaInHex=function(e){return n.assert(0==(e&~h),"Wrong hex format: #"+e.toString(16)),e>>o!=0},e.getAlphaFromHex=function(e){return n.assert(0==(e&~h),"Wrong hex format: #"+e.toString(16)),(l-(e>>o)&l)/l},e.removeAlphaFromHex=function(e){return n.assert(0==(e&~h),"Wrong hex format: #"+e.toString(16)),e&c}}(t.ColorUtils||(t.ColorUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Discrete=0]="Discrete",e[e.Linear=1]="Linear",e[e.Cubic=2]="Cubic",e[e.Exponential=3]="Exponential"}(t.InterpolationMode||(t.InterpolationMode={})),t.interpolatedPropertyDefinitionToJsonExpr=function(e){if(void 0===e.interpolation||"Discrete"===e.interpolation){const t=["step",["zoom"],e.values[0]];for(let r=1;r<e.zoomLevels.length;++r)t.push(e.zoomLevels[r],e.values[r]);return t}const t=["interpolate"];switch(e.interpolation){case"Linear":t.push(["linear"]);break;case"Cubic":t.push(["cubic"]);break;case"Exponential":t.push(["exponential",void 0!==e.exponent?e.exponent:2]);break;default:throw new Error(`interpolation mode '${e.interpolation}' is not supported`)}t.push(["zoom"]);for(let r=0;r<e.zoomLevels.length;++r)t.push(e.zoomLevels[r],e.values[r]);return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(12),i=r(5),o=r(8),s=r(6),a=r(9),u=r(13),l=r(10);class c extends l.Projection{constructor(){super(...arguments),this.type=l.ProjectionType.Planar}static clamp(e,t,r){return Math.min(Math.max(t,e),r)}static latitudeClamp(e){return c.clamp(e,-h.MAXIMUM_LATITUDE,h.MAXIMUM_LATITUDE)}static latitudeProject(e){return Math.log(Math.tan(.25*Math.PI+.5*e))/Math.PI}static latitudeClampProject(e){return c.latitudeProject(c.latitudeClamp(e))}static unprojectLatitude(e){return 2*Math.atan(Math.exp(Math.PI*e))-.5*Math.PI}getScaleFactor(e){return Math.cosh(2*Math.PI*(e.y/this.unitScale-.5))}worldExtent(e,t,r){return r||(r=s.MathUtils.newEmptyBox3()),r.min.x=0,r.min.y=0,r.min.z=e,r.max.x=this.unitScale,r.max.y=this.unitScale,r.max.z=t,r}projectPoint(e,t){let r;return r=e instanceof i.GeoCoordinates?e:new i.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(r.longitude+180)/360*this.unitScale,t.y=(.5*c.latitudeClampProject(r.latitudeInRadians)+.5)*this.unitScale,t.z=r.altitude||0,t}unprojectPoint(e){return i.GeoCoordinates.fromRadians(c.unprojectLatitude(2*(e.y/this.unitScale-.5)),e.x/this.unitScale*2*Math.PI-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){const r=this.projectPoint(e.center),n=(.5*c.latitudeClampProject(e.northEast.latitudeInRadians)+.5)*this.unitScale,i=(.5*c.latitudeClampProject(e.southWest.latitudeInRadians)+.5)*this.unitScale,u=.5*(n+i);r.y=u;const l=n-i,h=e.longitudeSpan/360*this.unitScale;if(t||(t=s.MathUtils.newEmptyBox3()),o.isBox3Like(t)){t.min.x=r.x-.5*h,t.min.y=r.y-.5*l,t.max.x=r.x+.5*h,t.max.y=r.y+.5*l;const n=e.altitudeSpan;void 0!==n?(t.min.z=r.z-.5*n,t.max.z=r.z+.5*n):(t.min.z=0,t.max.z=0)}else{if(!a.isOrientedBox3Like(t))throw new Error("invalid bounding box");s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,1,0,t.yAxis),s.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=r.x,t.position.y=r.y,t.position.z=r.z,t.extents.x=.5*h,t.extents.y=.5*l,t.extents.z=Math.max(Number.EPSILON,.5*(e.altitudeSpan||0))}return t}unprojectBox(e){const t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return n.GeoBox.fromCoordinates(t,r)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}reprojectPoint(e,r,n){return e===this||e!==t.webMercatorProjection&&e!==t.mercatorProjection?super.reprojectPoint(e,r,n):(void 0===n&&(n={}),n.x=r.x,n.y=this.unitScale-r.y,n.z=r.z,n)}}class h{}t.MercatorConstants=h,h.MAXIMUM_LATITUDE=1.4844222297453322,t.mercatorProjection=new c(u.EarthConstants.EQUATORIAL_CIRCUMFERENCE),t.webMercatorProjection=new class extends c{projectPoint(e,t){let r;r=e instanceof i.GeoCoordinates?e:new i.GeoCoordinates(e.latitude,e.longitude,e.altitude),t||(t={x:0,y:0,z:0}),t.x=(r.longitude+180)/360*this.unitScale;const n=Math.sin(c.latitudeClamp(r.latitudeInRadians));return t.y=(.5-Math.log((1+n)/(1-n))/(4*Math.PI))*this.unitScale,t.z=r.altitude||0,t}unprojectPoint(e){const t=e.x/this.unitScale-.5,r=.5-e.y/this.unitScale,n=360*t,o=90-360*Math.atan(Math.exp(2*-r*Math.PI))/Math.PI;return new i.GeoCoordinates(o,n,e.z)}projectBox(e,t){const r=super.projectBox(e,t);if(o.isBox3Like(r)){const e=r.max.y;r.max.y=this.unitScale-r.min.y,r.min.y=this.unitScale-e}else a.isOrientedBox3Like(r)&&(s.MathUtils.newVector3(1,0,0,r.xAxis),s.MathUtils.newVector3(0,-1,0,r.yAxis),s.MathUtils.newVector3(0,0,-1,r.zAxis),r.position.y=this.unitScale-r.position.y);return r}unprojectBox(e){const t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return new n.GeoBox(new i.GeoCoordinates(r.latitude,t.longitude,t.altitude),new i.GeoCoordinates(t.latitude,r.longitude,r.altitude))}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}localTangentSpace(e,t){return this.projectPoint(e,t.position),s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,-1,0,t.yAxis),s.MathUtils.newVector3(0,0,-1,t.zAxis),t}}(u.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.quadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(){return 2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 1<<e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=[1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,4194304,8388608,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,2147483648,4294967296,8589934592,17179869184,34359738368,68719476736,137438953472,274877906944,549755813888,1099511627776,2199023255552,4398046511104,8796093022208,17592186044416,35184372088832,70368744177664,0x800000000000,281474976710656,562949953421312,0x4000000000000,0x8000000000000,4503599627370496];class i{constructor(e,t,r){this.row=e,this.column=t,this.level=r}static fromRowColumnLevel(e,t,r){return new i(e,t,r)}static fromQuadKey(e){const t=e.length;let r=0,n=0;for(let i=0;i<e.length;++i){const o=1<<i,s=parseInt(e.charAt(t-i-1),10);1&s&&(n|=o),2&s&&(r|=o)}return i.fromRowColumnLevel(r,n,t)}static fromMortonCode(e){let t=0,r=0,n=0,o=e;for(;o>1;){const e=1<<t;1&o&&(n|=e),2&o&&(r|=e),t++,o=(o-(3&o))/4}const s=i.fromRowColumnLevel(r,n,t);return s.m_mortonCode=e,s}static fromHereTile(e){const t=i.fromMortonCode(parseInt(e,10));return t.m_hereTile=e,t}static columnsAtLevel(e){return Math.pow(2,e)}static rowsAtLevel(e){return Math.pow(2,e)}static atCoords(e,t,r,n,o){return i.fromRowColumnLevel(Math.floor(r/(o/i.rowsAtLevel(e))),Math.floor(t/(n/i.columnsAtLevel(e))),e)}static parentMortonCode(e){return Math.floor(e/4)}parent(){if(0===this.level)throw new Error("Cannot get the parent of the root tile key");return i.fromRowColumnLevel(this.row>>>1,this.column>>>1,this.level-1)}changedLevelBy(e){const t=Math.max(0,this.level+e);let r=this.row,n=this.column;return e>=0?(r<<=e,n<<=e):(r>>>=-e,n>>>=-e),i.fromRowColumnLevel(r,n,t)}changedLevelTo(e){return this.changedLevelBy(e-this.level)}mortonCode(){if(void 0===this.m_mortonCode){let e=this.column,t=this.row,r=n[this.level<<1];for(let i=0;i<this.level;++i)1&e&&(r+=n[2*i]),1&t&&(r+=n[2*i+1]),e>>>=1,t>>>=1;this.m_mortonCode=r}return this.m_mortonCode}toHereTile(){return void 0===this.m_hereTile&&(this.m_hereTile=this.mortonCode().toString()),this.m_hereTile}toQuadKey(){let e="";for(let t=this.level;t>0;--t){const r=1<<t-1,n=0!=(this.column&r),i=0!=(this.row&r);e+=n&&i?"3":i?"2":n?"1":"0"}return e}equals(e){return this.row===e.row&&this.column===e.column&&this.level===e.level}addedSubKey(e){const t=i.fromQuadKey(0===e.length?"-":e),r=this.changedLevelBy(t.level);return i.fromRowColumnLevel(r.row+t.row,r.column+t.column,r.level)}addedSubHereTile(e){const t=i.fromHereTile(e),r=this.changedLevelBy(t.level);return i.fromRowColumnLevel(r.row+t.row,r.column+t.column,r.level)}getSubHereTile(e){const t=1<<2*e;return(this.mortonCode()&t-1|t).toString()}rowCount(){return i.rowsAtLevel(this.level)}columnCount(){return i.columnsAtLevel(this.level)}}t.TileKey=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(2).LoggerManager.instance.create("WorkerService",{enabled:!1});t.WorkerService=class{constructor(e){this.serviceId=e,this.m_pendingRequests=new Map,this.onMessage=e=>{if("string"==typeof e.data.service&&e.data.service===this.serviceId)try{if(n.WorkerServiceProtocol.isRequestMessage(e.data)){const t=e.data,r={service:t.service,messageId:t.messageId,responseSent:!1};this.m_pendingRequests.set(t.messageId,r),this.tryHandleRequest(t.request).then(e=>{this.doSendResponse(r,{service:this.serviceId,type:n.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,response:e.response},e.transferList)}).catch(e=>{this.doSendResponse(r,{service:this.serviceId,type:n.WorkerServiceProtocol.ServiceMessageName.Response,messageId:t.messageId,errorMessage:e.toString(),errorStack:e.stack})})}else this.tryHandleMessage(e.data)}catch(t){i.error(`[${this.serviceId}]: Unhandled exception when handling ${e.type}`)}},self.addEventListener("message",this.onMessage);const t={service:e,type:n.WorkerServiceProtocol.ServiceMessageName.Initialized};self.postMessage(t)}destroy(){this.cancelAllPendingRequests(),self.removeEventListener("message",this.onMessage)}handleMessage(e){i.error(`[${this.serviceId}]: Invalid message ${e.type}`)}handleRequest(e){throw new Error(`ServiceAdapter[${this.serviceId}]: Invalid request '${e.type}'`)}tryHandleMessage(e){try{this.handleMessage(e)}catch(t){i.error(`[${this.serviceId}]: Failed, handling message ${e.type}`)}}tryHandleRequest(e){try{return this.handleRequest(e)}catch(e){return i.error(`[${this.serviceId}]: Failure`,e),Promise.reject(e)}}doSendResponse(e,t,r){e.responseSent||(void 0!==r?self.postMessage(t,r):self.postMessage(t),e.responseSent=!0,this.m_pendingRequests.delete(e.messageId))}cancelAllPendingRequests(){this.m_pendingRequests.forEach(e=>{this.doSendResponse(e,{service:this.serviceId,type:n.WorkerServiceProtocol.ServiceMessageName.Response,messageId:e.messageId,errorMessage:"cancelled"})})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(0),o=r(51);function s(e,t,r=Math.floor){return r((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,t))}function a(e,t){const{north:r,west:n}=t.geoBox,i=Math.log2(e),a=Math.pow(2,t.tileKey.level+i);return{extents:e,scale:a,top:s(r,t.tileKey.level+i,t.adapterId===o.VTJsonDataAdapterId?Math.round:Math.floor),left:(n+180)/360*a}}function u(e,t,r,i=!1,o){void 0!==t.worldTileProjectionCookie&&t.worldTileProjectionCookie.extents===e||(t.worldTileProjectionCookie=a(e,t));const{top:s,left:u,scale:l}=t.worldTileProjectionCookie,c=n.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return o.set((u+r.x)/l*c,(s+(i?-r.y:r.y))/l*c)}t.isArrayBufferLike=function(e){return"undefined"!=typeof SharedArrayBuffer?e instanceof ArrayBuffer||e instanceof SharedArrayBuffer:e instanceof ArrayBuffer},t.lat2tile=s,t.tile2lat=function(e,t){const r=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(r)-Math.exp(-r)))},t.createWorldTileTransformationCookie=a,t.tile2world=u,t.world2tile=function(e,t,r,i=!1,o){void 0!==t.worldTileProjectionCookie&&t.worldTileProjectionCookie.extents===e||(t.worldTileProjectionCookie=a(e,t));const{top:s,left:u,scale:l}=t.worldTileProjectionCookie,c=n.EarthConstants.EQUATORIAL_CIRCUMFERENCE;return o.set(r.x/c*l-u,(i?-1:1)*(r.y/c*l-s))};const l=new i.Vector2;function c(e,t,r,i,o=!1){const s=u(e,t,r,o,l);i.set(s.x,s.y,0),t.targetProjection.reprojectPoint(n.webMercatorProjection,i,i)}t.webMercatorTile2TargetWorld=c,t.webMercatorTile2TargetTile=function(e,t,r,n,i=!1){c(e,t,r,n,i),n.sub(t.center)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(4),o=r(49),s=r(2),a=r(0),u=r(113),l=r(54),c=r(132),h=r(15),p=r(138),d=r(139),f=r(140),m=r(51),g=s.LoggerManager.instance.create("OmvDecoder",{enabled:!1});t.Ring=class{constructor(e,t,r){this.extents=e,this.vertexStride=t,this.contour=r,this.winding=this.area()<0}area(){const e=this.contour,t=this.vertexStride,r=e.length/t;let n=0;for(let i=r-1,o=0;o<r;i=o++)n+=e[i*t]*e[o*t+1]-e[o*t]*e[i*t+1];return n/2}};class y{constructor(e,t,r,n,i,o=!1,s=!1,a=!1,c=!0,h=0,p=!1,d){this.m_projection=e,this.m_styleSetEvaluator=t,this.m_showMissingTechniques=r,this.m_dataFilter=n,this.m_featureModifier=i,this.m_gatherFeatureAttributes=o,this.m_createTileInfo=s,this.m_gatherRoadSegments=a,this.m_skipShortLabels=c,this.m_storageLevelOffset=h,this.m_enableElevationOverlay=p,this.m_languages=d,this.m_dataAdapters=[];const y=new f.StyleSetDataFilter(t),v=n?new l.ComposedDataFilter([y,n]):y;this.m_dataAdapters.push(new u.OmvProtobufDataAdapter(this,v,g)),this.m_dataAdapters.push(new m.VTJsonDataAdapter(this,v,g))}get storageLevelOffset(){return this.m_storageLevelOffset}getDecodedTile(e,t){let r;for(const e of this.m_dataAdapters.values())if(e.canProcess(t)){r=e;break}if(void 0===r)return{techniques:[],geometries:[]};this.m_styleSetEvaluator.resetTechniques();const n=this.estimatedTileSizeOnScreen(),i=new y.DecodeInfo(r.id,this.m_projection,e,n);if(this.m_decodedTileEmitter=new c.OmvDecodedTileEmitter(i,this.m_styleSetEvaluator,this.m_gatherFeatureAttributes,this.m_skipShortLabels,this.m_enableElevationOverlay,this.m_languages),this.m_createTileInfo){const e=!0;this.m_infoTileEmitter=new p.OmvTileInfoEmitter(i,this.m_styleSetEvaluator,e,this.m_gatherRoadSegments)}r.process(t,e,i.geoBox);const o=this.m_decodedTileEmitter.getDecodedTile();return this.m_createTileInfo&&(o.tileInfo=this.m_infoTileEmitter.getTileInfo()),o}getTileInfo(e,t){let r;for(const e of this.m_dataAdapters.values())if(e.canProcess(t)){r=e;break}if(void 0===r)return new n.ExtendedTileInfo(e,!1);this.m_styleSetEvaluator.resetTechniques();const i=this.estimatedTileSizeOnScreen(),o=new y.DecodeInfo(r.id,this.m_projection,e,i);this.m_infoTileEmitter=new p.OmvTileInfoEmitter(o,this.m_styleSetEvaluator,!0,this.m_gatherRoadSegments);for(const r of this.m_dataAdapters.values())if(r.canProcess(t)){r.process(t,e,o.geoBox);break}return this.m_infoTileEmitter.getTileInfo()}processPointFeature(e,t,r,i,o){if(void 0!==this.m_featureModifier&&!this.m_featureModifier.doProcessPointFeature(e,i,o))return;const s=this.applyKindFilter(this.m_styleSetEvaluator.getMatchingTechniques(i,e,"point"),n.GeometryKind.Label);if(0===s.length)return void(this.m_showMissingTechniques&&g.log("OmvDecoder#processPointFeature: no techniques for object:",JSON.stringify(i.unmap())));const a={env:i,storageLevel:o,zoomLevel:this.getZoomLevel(o),cachedExprResults:this.m_styleSetEvaluator.expressionEvaluatorCache},u=i.lookup("$id");this.m_decodedTileEmitter&&this.m_decodedTileEmitter.processPointFeature(e,t,r,a,s,u),this.m_infoTileEmitter&&this.m_infoTileEmitter.processPointFeature(e,t,r,a,s,u)}processLineFeature(e,t,r,i,o){if(void 0!==this.m_featureModifier&&!this.m_featureModifier.doProcessLineFeature(e,i,o))return;const s=this.applyKindFilter(this.m_styleSetEvaluator.getMatchingTechniques(i,e,"line"),n.GeometryKind.Line);if(0===s.length)return void(this.m_showMissingTechniques&&g.log("OmvDecoder#processLineFeature: no techniques for object:",JSON.stringify(i.unmap())));const a={env:i,storageLevel:o,zoomLevel:this.getZoomLevel(o),cachedExprResults:this.m_styleSetEvaluator.expressionEvaluatorCache},u=i.lookup("$id");this.m_decodedTileEmitter&&this.m_decodedTileEmitter.processLineFeature(e,t,r,a,s,u),this.m_infoTileEmitter&&this.m_infoTileEmitter.processLineFeature(e,t,r,a,s,u)}processPolygonFeature(e,t,r,i,o){if(void 0!==this.m_featureModifier&&!this.m_featureModifier.doProcessPolygonFeature(e,i,o))return;const s=this.applyKindFilter(this.m_styleSetEvaluator.getMatchingTechniques(i,e,"polygon"),n.GeometryKind.Area);if(0===s.length)return void(this.m_showMissingTechniques&&g.log("OmvDecoder#processPolygonFeature: no techniques for object:",JSON.stringify(i.unmap())));const a={env:i,storageLevel:o,zoomLevel:this.getZoomLevel(o),cachedExprResults:this.m_styleSetEvaluator.expressionEvaluatorCache},u=i.lookup("$id");this.m_decodedTileEmitter&&this.m_decodedTileEmitter.processPolygonFeature(e,t,r,a,s,u),this.m_infoTileEmitter&&this.m_infoTileEmitter.processPolygonFeature(e,t,r,a,s,u)}estimatedTileSizeOnScreen(){return 256*Math.pow(2,-this.m_storageLevelOffset)}getZoomLevel(e){return Math.max(0,e-(this.m_storageLevelOffset||0))}applyKindFilter(e,t){return void 0!==this.m_dataFilter&&this.m_dataFilter.hasKindFilter&&(e=e.filter(e=>void 0===e.kind?this.m_dataFilter.wantsKind(t):this.m_dataFilter.wantsKind(e.kind))),e}}t.OmvDecoder=y,function(e){e.DecodeInfo=class{constructor(e,t,r,n){this.adapterId=e,this.targetProjection=t,this.tileKey=r,this.tileSizeOnScreen=n,this.projectedBoundingBox=new i.OrientedBox3,this.tileBounds=new a.Box3,this.tileSize=new a.Vector3,this.center=new a.Vector3,this.projectedTileBounds=new a.Box3,this.geoBox=this.tilingScheme.getGeoBox(r),this.targetProjection.projectBox(this.geoBox,this.projectedTileBounds),this.targetProjection.projectBox(this.geoBox,this.projectedBoundingBox),this.projectedBoundingBox.getCenter(this.center),this.tilingScheme.getWorldBox(r,this.tileBounds),this.tileBounds.getSize(this.tileSize)}get tilingScheme(){return i.webMercatorTilingScheme}get sourceProjection(){return this.tilingScheme.projection}}}(y=t.OmvDecoder||(t.OmvDecoder={}));class v extends o.ThemedTileDecoder{constructor(){super(...arguments),this.m_showMissingTechniques=!1,this.m_gatherFeatureAttributes=!1,this.m_createTileInfo=!1,this.m_gatherRoadSegments=!1,this.m_skipShortLabels=!0,this.m_enableElevationOverlay=!1}connect(){return Promise.resolve()}decodeThemedTile(e,t,r,n){const i=s.PerformanceTimer.now(),o=new y(n,r,this.m_showMissingTechniques,this.m_featureFilter,this.m_featureModifier,this.m_gatherFeatureAttributes,this.m_createTileInfo,this.m_gatherRoadSegments,this.m_skipShortLabels,this.m_storageLevelOffset,this.m_enableElevationOverlay,this.languages).getDecodedTile(t,e);return o.decodeTime=s.PerformanceTimer.now()-i,Promise.resolve(o)}getTileInfo(e,t,r){const n=s.PerformanceTimer.now(),i=this.m_styleSetEvaluator;if(void 0===i)return Promise.reject(new Error("no theme loaded"));const o=new y(r,i,this.m_showMissingTechniques,this.m_featureFilter,this.m_featureModifier,this.m_gatherFeatureAttributes,this.m_createTileInfo,this.m_gatherRoadSegments,this.m_skipShortLabels,this.m_storageLevelOffset,this.m_enableElevationOverlay,this.languages).getTileInfo(t,e);return o.setupTime=s.PerformanceTimer.now()-n,Promise.resolve(o)}configure(e,t,r,n){if(super.configure(e,t,r,n),n){const e=n;void 0!==e.showMissingTechniques&&(this.m_showMissingTechniques=!0===e.showMissingTechniques),e&&void 0!==e.filterDescription&&(null!==e.filterDescription?(this.m_featureFilter=new l.OmvGenericFeatureFilter(e.filterDescription),this.m_featureModifier=this.createFeatureModifier(e.filterDescription,e.featureModifierId)):(this.m_featureFilter=void 0,this.m_featureModifier=void 0)),void 0!==e.gatherFeatureAttributes&&(this.m_gatherFeatureAttributes=!0===e.gatherFeatureAttributes),void 0!==e.createTileInfo&&(this.m_createTileInfo=!0===e.createTileInfo),void 0!==e.gatherRoadSegments&&(this.m_gatherRoadSegments=!0===e.gatherRoadSegments),void 0!==e.skipShortLabels&&(this.m_skipShortLabels=e.skipShortLabels),void 0!==e.enableElevationOverlay&&(this.m_enableElevationOverlay=e.enableElevationOverlay)}void 0!==r&&(this.languages=r)}createFeatureModifier(e,t){return t===h.FeatureModifierId.tomTom?new d.OmvTomTomFeatureModifier(e):new l.OmvGenericFeatureModifier(e)}}t.OmvTileDecoder=v;class x{static start(){o.WorkerServiceManager.getInstance().register({serviceType:h.OMV_TILE_DECODER_SERVICE_TYPE,factory:e=>o.TileDecoderService.start(e,new v)})}}t.OmvTileDecoderService=x;t.default=class{constructor(){g.warn("OmvWorkerClient class is deprecated, please use OmvTileDecoderService.start"),x.start()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=0]="Trace",e[e.Debug=1]="Debug",e[e.Log=2]="Log",e[e.Info=3]="Info",e[e.Warn=4]="Warn",e[e.Error=5]="Error"}(t.LogLevel||(t.LogLevel={}));t.LoggerOptions=class{}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveReferenceUri=function(e,t){if(n.test(t))return t;if(t.startsWith("/")){return o(e)+t}return t.startsWith("./")&&(t=t.substr(2)),i(e)+t};const n=new RegExp("^(?:[a-z]+:)?//","i");function i(e){if(void 0===e)return"./";let t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),t=e.indexOf("?"),-1!==t&&(e=e.slice(0,t)),t=e.lastIndexOf("/"),-1===t?"./":e.substring(0,t+1)}function o(e){if(void 0===e)return"";const t=s(e);return"file:"===t.protocol?"file://":t.host&&t.protocol?t.protocol+"//"+t.host:t.host?"//"+t.host:t.protocol?t.protocol+"//":""}function s(e){const t=new RegExp(/^(?:([a-z]+:))?\/\/([^\/]*)/,"i"),r=e.match(t);if(!r)throw new Error(`getUrlHostAndProtocol: unable to parse URL '${e}'`);return{protocol:r[1],host:r[2]}}t.baseUrl=i,t.getUrlOrigin=o,t.getUrlHostAndProtocol=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isValueDefinition=function(e){const t=e;return"object"==typeof t&&null!==t&&"string"==typeof t.type&&void 0!==t.value},t.isSelectorDefinition=function(e){const t=e;return"object"==typeof t&&null!==t&&"selector"===t.type&&("string"==typeof t.value||Array.isArray(t.value))},t.isJsonExprReference=function(e){return Array.isArray(e)&&2===e.length&&"ref"===e[0]&&"string"==typeof e[1]},t.isActualSelectorDefinition=function(e){const t=e;return"object"==typeof t&&null!==t&&!Array.isArray(t)&&"string"==typeof t.technique}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(34),i=r(35);t.TEXTURE_PROPERTY_KEYS=["map","normalMap","displacementMap","roughnessMap","emissiveMap","alphaMap","metalnessMap","bumpMap"],t.TRANSPARENCY_PROPERTY_KEYS=["opacity","transparent"],t.techniqueDescriptors={},t.baseTechniqueParamsDescriptor={attrTransparencyColor:"color",attrScopes:{renderOrder:i.AttrScope.TechniqueGeometry,renderOrderOffset:i.AttrScope.TechniqueGeometry,enabled:i.AttrScope.TechniqueGeometry,kind:i.AttrScope.TechniqueGeometry,transient:i.AttrScope.TechniqueGeometry,fadeFar:i.AttrScope.TechniqueRendering,fadeNear:i.AttrScope.TechniqueRendering}},t.pointTechniquePropTypes=i.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{texture:i.AttrScope.TechniqueGeometry,enablePicking:i.AttrScope.TechniqueGeometry,color:i.AttrScope.TechniqueRendering,transparent:i.AttrScope.TechniqueRendering,opacity:i.AttrScope.TechniqueGeometry}}),t.squaresTechniquePropTypes=i.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,t.pointTechniquePropTypes),t.techniqueDescriptors.squares=t.squaresTechniquePropTypes,t.circlesTechniquePropTypes=i.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,t.pointTechniquePropTypes),t.techniqueDescriptors.circles=t.circlesTechniquePropTypes;const o=i.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{text:i.AttrScope.FeatureGeometry,label:i.AttrScope.FeatureGeometry,useAbbreviation:i.AttrScope.FeatureGeometry,useIsoCode:i.AttrScope.FeatureGeometry,priority:i.AttrScope.TechniqueGeometry,textMinZoomLevel:i.AttrScope.TechniqueGeometry,textMaxZoomLevel:i.AttrScope.TechniqueGeometry,iconMinZoomLevel:i.AttrScope.TechniqueGeometry,iconMaxZoomLevel:i.AttrScope.TechniqueGeometry,distanceScale:i.AttrScope.TechniqueGeometry,textMayOverlap:i.AttrScope.TechniqueGeometry,iconMayOverlap:i.AttrScope.TechniqueGeometry,textReserveSpace:i.AttrScope.TechniqueGeometry,iconReserveSpace:i.AttrScope.TechniqueGeometry,renderTextDuringMovements:i.AttrScope.TechniqueGeometry,alwaysOnTop:i.AttrScope.TechniqueGeometry,textIsOptional:i.AttrScope.TechniqueGeometry,showOnMap:i.AttrScope.TechniqueGeometry,stackMode:i.AttrScope.TechniqueGeometry,minDistance:i.AttrScope.TechniqueGeometry,iconIsOptional:i.AttrScope.TechniqueGeometry,iconFadeTime:i.AttrScope.TechniqueGeometry,textFadeTime:i.AttrScope.TechniqueGeometry,xOffset:i.AttrScope.TechniqueGeometry,yOffset:i.AttrScope.TechniqueGeometry,iconXOffset:i.AttrScope.TechniqueGeometry,iconYOffset:i.AttrScope.TechniqueGeometry,iconScale:i.AttrScope.TechniqueGeometry,screenHeight:i.AttrScope.TechniqueGeometry,screenWidth:i.AttrScope.TechniqueGeometry,poiTable:i.AttrScope.TechniqueGeometry,poiName:i.AttrScope.FeatureGeometry,poiNameField:i.AttrScope.TechniqueGeometry,imageTexture:i.AttrScope.FeatureGeometry,imageTextureField:i.AttrScope.TechniqueGeometry,imageTexturePrefix:i.AttrScope.TechniqueGeometry,imageTexturePostfix:i.AttrScope.TechniqueGeometry,style:i.AttrScope.TechniqueGeometry,fontName:i.AttrScope.TechniqueGeometry,fontStyle:i.AttrScope.TechniqueGeometry,fontVariant:i.AttrScope.TechniqueGeometry,rotation:i.AttrScope.TechniqueGeometry,tracking:i.AttrScope.TechniqueGeometry,leading:i.AttrScope.TechniqueGeometry,maxLines:i.AttrScope.TechniqueGeometry,lineWidth:i.AttrScope.TechniqueGeometry,canvasRotation:i.AttrScope.TechniqueGeometry,lineRotation:i.AttrScope.TechniqueGeometry,wrappingMode:i.AttrScope.TechniqueGeometry,hAlignment:i.AttrScope.TechniqueGeometry,vAlignment:i.AttrScope.TechniqueGeometry,backgroundColor:i.AttrScope.TechniqueRendering,backgroundSize:i.AttrScope.TechniqueRendering,backgroundOpacity:i.AttrScope.TechniqueRendering,color:i.AttrScope.TechniqueRendering,opacity:i.AttrScope.TechniqueRendering,size:i.AttrScope.TechniqueRendering}});t.techniqueDescriptors["line-marker"]=o,t.techniqueDescriptors["labeled-icon"]=o;const s={attrScopes:{polygonOffset:i.AttrScope.TechniqueRendering,polygonOffsetFactor:i.AttrScope.TechniqueRendering,polygonOffsetUnits:i.AttrScope.TechniqueRendering,lineColor:i.AttrScope.TechniqueRendering,lineFadeFar:i.AttrScope.TechniqueRendering,lineFadeNear:i.AttrScope.TechniqueRendering}};t.solidLineTechniqueDescriptor=i.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,s,{attrScopes:{clipping:i.AttrScope.TechniqueGeometry,secondaryRenderOrder:i.AttrScope.TechniqueGeometry,color:i.AttrScope.TechniqueRendering,opacity:i.AttrScope.TechniqueRendering,transparent:i.AttrScope.TechniqueRendering,lineWidth:i.AttrScope.TechniqueRendering,secondaryWidth:i.AttrScope.TechniqueRendering,secondaryColor:i.AttrScope.TechniqueRendering,dashSize:i.AttrScope.TechniqueRendering,gapSize:i.AttrScope.TechniqueRendering}}),t.techniqueDescriptors["solid-line"]=t.solidLineTechniqueDescriptor,t.techniqueDescriptors["dashed-line"]=t.solidLineTechniqueDescriptor,t.lineTechniqueDescriptor=i.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{color:i.AttrScope.TechniqueRendering,opacity:i.AttrScope.TechniqueRendering,transparent:i.AttrScope.TechniqueRendering,lineWidth:i.AttrScope.FeatureGeometry}}),t.techniqueDescriptors.line=t.lineTechniqueDescriptor;const a=i.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,s,{attrScopes:{color:i.AttrScope.TechniqueRendering,opacity:i.AttrScope.TechniqueRendering,transparent:i.AttrScope.TechniqueRendering,lineWidth:i.AttrScope.TechniqueRendering}});t.techniqueDescriptors.fill=a;const u=i.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{color:i.AttrScope.FeatureGeometry,vertexColors:i.AttrScope.FeatureGeometry,wireframe:i.AttrScope.TechniqueRendering,roughness:i.AttrScope.TechniqueRendering,metalness:i.AttrScope.TechniqueRendering,alphaTest:i.AttrScope.TechniqueRendering,depthTest:i.AttrScope.TechniqueRendering,transparent:i.AttrScope.TechniqueRendering,opacity:i.AttrScope.TechniqueRendering,emissive:i.AttrScope.TechniqueRendering,emissiveIntensity:i.AttrScope.TechniqueRendering,refractionRatio:i.AttrScope.TechniqueRendering,map:i.AttrScope.TechniqueGeometry,mapProperties:i.AttrScope.TechniqueGeometry,normalMap:i.AttrScope.TechniqueGeometry,normalMapProperties:i.AttrScope.TechniqueGeometry,displacementMap:i.AttrScope.TechniqueGeometry,displacementMapProperties:i.AttrScope.TechniqueGeometry,roughnessMap:i.AttrScope.TechniqueGeometry,roughnessMapProperties:i.AttrScope.TechniqueGeometry,emissiveMap:i.AttrScope.TechniqueGeometry,emissiveMapProperties:i.AttrScope.TechniqueGeometry,bumpMap:i.AttrScope.TechniqueGeometry,bumpMapProperties:i.AttrScope.TechniqueGeometry,metalnessMap:i.AttrScope.TechniqueGeometry,metalnessMapProperties:i.AttrScope.TechniqueGeometry,alphaMap:i.AttrScope.TechniqueGeometry,alphaMapProperties:i.AttrScope.TechniqueGeometry}});t.techniqueDescriptors.standard=u;const l=i.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,u,{attrScopes:{height:i.AttrScope.FeatureGeometry,floorHeight:i.AttrScope.FeatureGeometry,color:i.AttrScope.FeatureGeometry,defaultColor:i.AttrScope.FeatureGeometry,defaultHeight:i.AttrScope.FeatureGeometry,constantHeight:i.AttrScope.FeatureGeometry,boundaryWalls:i.AttrScope.FeatureGeometry,footprint:i.AttrScope.FeatureGeometry,maxSlope:i.AttrScope.FeatureGeometry,enableDepthPrePass:i.AttrScope.TechniqueGeometry,animateExtrusionDuration:i.AttrScope.TechniqueGeometry,animateExtrusion:i.AttrScope.TechniqueRendering,opacity:i.AttrScope.TechniqueRendering,transparent:i.AttrScope.TechniqueRendering,lineWidth:i.AttrScope.TechniqueRendering,lineFadeNear:i.AttrScope.TechniqueRendering,lineFadeFar:i.AttrScope.TechniqueRendering,lineColorMix:i.AttrScope.TechniqueGeometry,lineColor:i.AttrScope.TechniqueRendering}});t.techniqueDescriptors["extruded-polygon"]=l;const c=i.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{text:i.AttrScope.FeatureGeometry,label:i.AttrScope.FeatureGeometry,useAbbreviation:i.AttrScope.FeatureGeometry,useIsoCode:i.AttrScope.FeatureGeometry,minZoomLevel:i.AttrScope.TechniqueGeometry,maxZoomLevel:i.AttrScope.TechniqueGeometry,distanceScale:i.AttrScope.TechniqueGeometry,mayOverlap:i.AttrScope.TechniqueGeometry,reserveSpace:i.AttrScope.TechniqueGeometry,textFadeTime:i.AttrScope.TechniqueGeometry,xOffset:i.AttrScope.TechniqueGeometry,yOffset:i.AttrScope.TechniqueGeometry,style:i.AttrScope.TechniqueGeometry,fontName:i.AttrScope.TechniqueGeometry,fontStyle:i.AttrScope.TechniqueGeometry,fontVariant:i.AttrScope.TechniqueGeometry,rotation:i.AttrScope.TechniqueGeometry,tracking:i.AttrScope.TechniqueGeometry,leading:i.AttrScope.TechniqueGeometry,maxLines:i.AttrScope.TechniqueGeometry,lineWidth:i.AttrScope.TechniqueGeometry,canvasRotation:i.AttrScope.TechniqueGeometry,lineRotation:i.AttrScope.TechniqueGeometry,wrappingMode:i.AttrScope.TechniqueGeometry,hAlignment:i.AttrScope.TechniqueGeometry,vAlignment:i.AttrScope.TechniqueGeometry,backgroundColor:i.AttrScope.TechniqueRendering,backgroundSize:i.AttrScope.TechniqueRendering,backgroundOpacity:i.AttrScope.TechniqueRendering,color:i.AttrScope.TechniqueRendering,opacity:i.AttrScope.TechniqueRendering,priority:i.AttrScope.TechniqueRendering,size:i.AttrScope.TechniqueRendering}});t.techniqueDescriptors.text=c;const h=i.mergeTechniqueDescriptor(t.baseTechniqueParamsDescriptor,{attrScopes:{primitive:i.AttrScope.TechniqueGeometry,params:i.AttrScope.TechniqueRendering}});function p(e){return"extruded-line"===e.name}function d(e){return p(e)&&"standard"===e.shading}function f(e){return"fill"===e.name}function m(e){return"extruded-polygon"===e.name}function g(e){return"standard"===e.name}function y(e){return"terrain"===e.name}t.techniqueDescriptors.shader=h,t.isCirclesTechnique=function(e){return"circles"===e.name},t.isSquaresTechnique=function(e){return"squares"===e.name},t.isPoiTechnique=function(e){return"labeled-icon"===e.name},t.isLineMarkerTechnique=function(e){return"line-marker"===e.name},t.isLineTechnique=function(e){return"line"===e.name},t.isSolidLineTechnique=function(e){return"solid-line"===e.name||"dashed-line"===e.name},t.isSegmentsTechnique=function(e){return"segments"===e.name},t.isExtrudedLineTechnique=p,t.isBasicExtrudedLineTechnique=function(e){return p(e)&&"basic"===e.shading},t.isStandardExtrudedLineTechnique=d,t.isFillTechnique=f,t.isExtrudedPolygonTechnique=m,t.isStandardTechnique=g,t.isTerrainTechnique=y,t.isTextTechnique=function(e){return"text"===e.name},t.isShaderTechnique=function(e){return"shader"===e.name},t.isLabelRejectionLineTechnique=function(e){return"label-rejection-line"===e.name},t.needsVertexNormals=function(e){return f(e)||g(e)||y(e)||d(e)},t.textureCoordinateType=function(e){return g(e)?e.textureCoordinateType:m(e)?e.textureCoordinateType:y(e)?e.textureCoordinateType:void 0},t.addBuffersToTransferList=function(e,r){if(g(e)||m(e)||y(e))for(const i of t.TEXTURE_PROPERTY_KEYS){const t=e[i];n.isTextureBuffer(t)&&t.buffer instanceof ArrayBuffer&&r.push(t.buffer)}},t.composeTechniqueTextureName=function(e,t){let r=e;return"string"==typeof t.imageTexturePrefix&&(r=t.imageTexturePrefix+r),"string"==typeof t.imageTexturePostfix&&(r+=t.imageTexturePostfix),r}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(47)),n(r(107)),n(r(108)),n(r(1)),n(r(109))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ConsoleChannel=class{error(e,...t){console.error(e,...t)}debug(e,...t){console.debug(e,...t)}info(e,...t){console.info(e,...t)}log(e,...t){console.log(e,...t)}trace(e,...t){console.trace(e,...t)}warn(e,...t){console.warn(e,...t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(24);t.Logger=class{constructor(e,t,r){this.name=e,this.m_channel=t,this.enabled=!0,this.level=n.LogLevel.Trace,void 0!==r&&this.update(r)}error(e,...t){this.enabled&&this.level<=n.LogLevel.Error&&this.m_channel.error(this.prefix,e,...t)}debug(e,...t){this.enabled&&this.level<=n.LogLevel.Debug&&this.m_channel.debug(this.prefix,e,...t)}info(e,...t){this.enabled&&this.level<=n.LogLevel.Info&&this.m_channel.info(this.prefix,e,...t)}log(e,...t){this.enabled&&this.level<=n.LogLevel.Log&&this.m_channel.log(this.prefix,e,...t)}trace(e,...t){this.enabled&&this.level<=n.LogLevel.Trace&&this.m_channel.trace(this.prefix,e,...t)}warn(e,...t){this.enabled&&this.level<=n.LogLevel.Warn&&this.m_channel.warn(this.prefix,e,...t)}update(e){this.enabled=void 0===e.enabled?this.enabled:e.enabled,this.level=void 0===e.level?this.level:e.level}get prefix(){return this.name+":"}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(24);t.WORKERCHANNEL_MSG_TYPE="worker-channel-message";t.WorkerChannel=class{error(e,...r){const i={message:[e,...r],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Error};self.postMessage(i)}debug(e,...r){const i={message:[e,...r],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Debug};self.postMessage(i)}info(e,...r){const i={message:[e,...r],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Info};self.postMessage(i)}log(e,...r){const i={message:[e,...r],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Log};self.postMessage(i)}trace(e,...r){const i={message:[e,...r],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Trace};self.postMessage(i)}warn(e,...r){const i={message:[e,...r],type:t.WORKERCHANNEL_MSG_TYPE,level:n.LogLevel.Warn};self.postMessage(i)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{lookup(e){}unmap(){return{}}}t.Env=n;t.MapEnv=class extends n{constructor(e,t){super(),this.entries=e,this.parent=t}lookup(e){if(this.entries.hasOwnProperty(e)){const t=this.entries[e];if(void 0!==t)return t}return this.parent?this.parent.lookup(e):void 0}unmap(){const e=this.parent?this.parent.unmap():{};for(const t in this.entries)this.entries.hasOwnProperty(t)&&(e[t]=this.entries[t]);return e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(0),o=r(16),s=new i.Color;var a;!function(e){e[e.Meters=0]="Meters",e[e.Pixels=1]="Pixels",e[e.Hex=2]="Hex",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.HSL=5]="HSL"}(a=t.StringEncodedNumeralType||(t.StringEncodedNumeralType={}));const u={type:a.Meters,size:1,regExp:/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))m$/,decoder:(e,t)=>{const r=u.regExp.exec(e);return!!r&&void 0!==(t[0]=Number(r[1]))}},l={type:a.Pixels,size:1,mask:1,regExp:/^((?=\.\d|\d)(?:\d+)?(?:\.?\d*))px$/,decoder:(e,t)=>{const r=l.regExp.exec(e);return null!==r&&(t[0]=Number(r[1]),!0)}},c={type:a.Hex,size:4,regExp:/^\#((?:[0-9A-Fa-f][0-9A-Fa-f]){3,4}|[0-9A-Fa-f]{3,4})$/,decoder:(e,t)=>{const r=c.regExp.exec(e);if(null===r)return!1;const i=r[1],o=i.length;return n.assert(3===o||4===o||6===o||8===o,`Matched incorrect hex format: ${e}`),3===o||4===o?(t[0]=parseInt(i.charAt(0)+i.charAt(0),16)/255,t[1]=parseInt(i.charAt(1)+i.charAt(1),16)/255,t[2]=parseInt(i.charAt(2)+i.charAt(2),16)/255,t[3]=4===o?parseInt(i.charAt(3)+i.charAt(3),16)/255:1):6!==o&&8!==o||(t[0]=parseInt(i.charAt(0)+i.charAt(1),16)/255,t[1]=parseInt(i.charAt(2)+i.charAt(3),16)/255,t[2]=parseInt(i.charAt(4)+i.charAt(5),16)/255,t[3]=8===o?parseInt(i.charAt(6)+i.charAt(7),16)/255:1),!0}},h={type:a.RGB,size:3,regExp:/^rgb\( ?(?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5]), ?)(?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5]), ?)(?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5])) ?\)$/,decoder:(e,t)=>{const r=h.regExp.exec(e);return null!==r&&(t[0]=parseInt(r[1],10)/255,t[1]=parseInt(r[2],10)/255,t[2]=parseInt(r[3],10)/255,!0)}},p={type:a.RGBA,size:4,regExp:/^rgba\( ?(?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5]), ?)(?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5]), ?)(?:([0-9]{1,2}|1[0-9]{1,2}|2[0-4][0-9]|25[0-5]), ?)(?:(0(?:\.[0-9]+)?|1(?:\.0+)?)) ?\)$/,decoder:(e,t)=>{const r=p.regExp.exec(e);return null!==r&&(t[0]=parseInt(r[1],10)/255,t[1]=parseInt(r[2],10)/255,t[2]=parseInt(r[3],10)/255,t[3]=parseInt(r[4],10),!0)}},d={type:a.HSL,size:3,regExp:/^hsl\( ?((?:[0-9]|[1-9][0-9]|1[0-9]{1,2}|2[0-9]{1,2}|3[0-5][0-9]|360)), ?(?:([0-9]|[1-9][0-9]|100)%), ?(?:([0-9]|[1-9][0-9]|100)%) ?\)$/,decoder:(e,t)=>{const r=d.regExp.exec(e);return null!==r&&(s.setHSL(parseInt(r[1],10)/360,parseInt(r[2],10)/100,parseInt(r[3],10)/100),t[0]=s.r,t[1]=s.g,t[2]=s.b,!0)}};t.StringEncodedMetricFormats=[u,l];const f=t.StringEncodedMetricFormats.reduce((e,t)=>Math.max(e,t.size),0);t.StringEncodedColorFormats=[c,h,p,d];const m=t.StringEncodedColorFormats.reduce((e,t)=>Math.max(e,t.size),0);t.StringEncodedNumeralFormats=[...t.StringEncodedMetricFormats,...t.StringEncodedColorFormats],t.StringEncodedNumeralFormatMaxSize=Math.max(m,f);const g=new Array(t.StringEncodedNumeralFormatMaxSize);t.parseStringEncodedNumeral=function(e,r=1){let n;return t.StringEncodedNumeralFormats.some(t=>{if(t.decoder(e,g)){switch(t.type){case a.Meters:n=g[0];break;case a.Pixels:n=g[0]*r;break;case a.Hex:case a.RGBA:n=o.ColorUtils.getHexFromRgba(g[0],g[1],g[2],g[3]);case a.RGB:case a.HSL:n=o.ColorUtils.getHexFromRgb(g[0],g[1],g[2]);break;default:n=g[0]}return!0}return!1}),n},t.parseStringEncodedColor=function(e){const r=(n=t.StringEncodedColorFormats,i=e,s=g,n.find(e=>!!e.decoder(i,s)));var n,i,s;if(void 0!==r)switch(r.type){case a.Hex:case a.RGBA:return o.ColorUtils.getHexFromRgba(g[0],g[1],g[2],g[3]);case a.RGB:case a.HSL:return o.ColorUtils.getHexFromRgb(g[0],g[1],g[2]);default:return g[0]}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.All="_all_",e.Background="background",e.Terrain="terrain",e.Area="area",e.Line="line",e.Water="water",e.Border="border",e.Road="road",e.Building="building",e.Label="label",e.Detail="detail"}(t.GeometryKind||(t.GeometryKind={}));class n extends Set{isSuperset(e){for(const t of e)if(!this.has(t))return!1;return!0}hasIntersection(e){for(const t of e)if(this.has(t))return!0;return!1}hasOrIntersects(e){return e instanceof Set?this.hasIntersection(e):this.has(e)}hasOrIntersectsArray(e){for(const t of e)if(this.has(t))return!0;return!1}}t.GeometryKindSet=n,function(e){e.TileSpace="tile-space",e.EquirectangularSpace="equirectangular-space"}(t.TextureCoordinateType||(t.TextureCoordinateType={})),function(e){e.Show="show-in-stack",e.Hide="hide-in-stack",e.ShowParent="show-parent"}(t.PoiStackMode||(t.PoiStackMode={})),t.isTextureBuffer=function(e){return e&&e.buffer&&"string"==typeof e.type}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.FeatureGeometry=0]="FeatureGeometry",e[e.TechniqueGeometry=1]="TechniqueGeometry",e[e.TechniqueRendering=2]="TechniqueRendering"}(t.AttrScope||(t.AttrScope={})),t.mergeTechniqueDescriptor=function(...e){const t={attrScopes:{}};for(const r of e)void 0!==r.attrTransparencyColor&&(t.attrTransparencyColor=r.attrTransparencyColor),void 0!==r.attrScopes&&(t.attrScopes=Object.assign(Object.assign({},t.attrScopes),r.attrScopes));return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4);t.getArrayConstructor=function(e){switch(e){case"float":return Float32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array}},function(e){e[e.Unspecified=0]="Unspecified",e[e.Point=1]="Point",e[e.Line=2]="Line",e[e.SolidLine=3]="SolidLine",e[e.Text=4]="Text",e[e.TextPath=5]="TextPath",e[e.ExtrudedLine=6]="ExtrudedLine",e[e.Polygon=7]="Polygon",e[e.ExtrudedPolygon=8]="ExtrudedPolygon",e[e.Object3D=9]="Object3D",e[e.Other=1e3]="Other"}(t.GeometryType||(t.GeometryType={})),t.getProjection=function(e){switch(e){case"mercator":return n.mercatorProjection;case"webMercator":return n.webMercatorProjection;case"sphere":return n.sphereProjection;case"normalizedEquirectangular":return n.normalizedEquirectangularProjection;case"equirectangular":return n.equirectangularProjection;default:throw new Error(`Unknown projection ${e}`)}},t.getProjectionName=function(e){if(e===n.mercatorProjection)return"mercator";if(e===n.webMercatorProjection)return"webMercator";if(e===n.sphereProjection)return"sphere";if(e===n.normalizedEquirectangularProjection)return"normalizedEquirectangular";if(e===n.equirectangularProjection)return"equirectangular";throw new Error("Unknown projection")},t.getFeatureId=function(e){return void 0===e?0:"number"==typeof e?e:e.hasOwnProperty("$id")?e.$id:0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoCoordinatesLike=function(e){return e&&"number"==typeof e.latitude&&"number"==typeof e.longitude&&("number"==typeof e.altitude||void 0===e.altitude)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isGeoPointLike=function(e){if(Array.isArray(e)){const[t,r,n]=e;return"number"==typeof t&&"number"==typeof r&&(void 0===n||"number"==typeof n)}return!1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLatLngLike=function(e){return e&&"number"==typeof e.lat&&"number"==typeof e.lng}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(12),i=r(5),o=r(8),s=r(6),a=r(9),u=r(13),l=r(10),c=r(0);class h extends l.Projection{constructor(){super(...arguments),this.type=l.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,r){return r||(r=s.MathUtils.newEmptyBox3()),r.min.x=0,r.min.y=0,r.min.z=e,r.max.x=this.unitScale,r.max.y=this.unitScale/2,r.max.z=t,r}projectPoint(e,t){return void 0===t&&(t={x:0,y:0,z:0}),t.x=(c.Math.degToRad(e.longitude)+Math.PI)*h.geoToWorldScale*this.unitScale,t.y=(c.Math.degToRad(e.latitude)+.5*Math.PI)*h.geoToWorldScale*this.unitScale,t.z=e.altitude||0,t}unprojectPoint(e){return i.GeoCoordinates.fromRadians(e.y*h.worldToGeoScale/this.unitScale-.5*Math.PI,e.x*h.worldToGeoScale/this.unitScale-Math.PI,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){const r=this.projectPoint(new i.GeoCoordinates(e.center.latitude,e.center.longitude,0)),{latitudeSpanInRadians:n,longitudeSpanInRadians:u,altitudeSpan:l}=e,c=u*h.geoToWorldScale,p=n*h.geoToWorldScale;return t||(t=s.MathUtils.newEmptyBox3()),o.isBox3Like(t)?(t.min.x=r.x-.5*c*this.unitScale,t.min.y=r.y-.5*p*this.unitScale,t.max.x=r.x+.5*c*this.unitScale,t.max.y=r.y+.5*p*this.unitScale,void 0!==l?(t.min.z=r.z-.5*l,t.max.z=r.z+.5*l):(t.min.z=0,t.max.z=0)):a.isOrientedBox3Like(t)&&(s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,1,0,t.yAxis),s.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=r.x,t.position.y=r.y,t.position.z=r.z,t.extents.x=.5*c*this.unitScale,t.extents.y=.5*p*this.unitScale,t.extents.z=Math.max(Number.EPSILON,.5*(l||0))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return n.GeoBox.fromCoordinates(t,r)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}h.geoToWorldScale=1/(2*Math.PI),h.worldToGeoScale=2*Math.PI/1,t.normalizedEquirectangularProjection=new h(1),t.equirectangularProjection=new h(u.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(12),i=r(5),o=r(8),s=r(6),a=r(9),u=r(13),l=r(10);class c extends l.Projection{constructor(e){super(e),this.unitScale=e,this.type=l.ProjectionType.Planar,this.m_phi0=0,this.m_lambda0=0}static clampGeoPoint(e,t){const r=e.latitude,n=e.longitude,o=h.POLE_RADIUS,s=h.POLE_RADIUS_SQ,a=Math.round(n/90),u=90*a-n;if(a%2==0||Math.abs(u)>o)return e;const l=r-0,c=u*u+l*l;if(c<s){const e=Math.sqrt(c),t=(o-e)/e,s=1,a=0===u&&0===l?o*s:u;return new i.GeoCoordinates(r+l*t,n+a*t)}return e}getScaleFactor(e){return Math.cosh(2*(e.x/this.unitScale-.5)*Math.PI)}worldExtent(e,t,r){return r||(r=s.MathUtils.newEmptyBox3()),r.min.x=0,r.min.y=0,r.min.z=e,r.max.x=this.unitScale,r.max.y=this.unitScale,r.max.z=t,r}projectPoint(e,t){t||(t={x:0,y:0,z:0});const r=c.clampGeoPoint(e,this.unitScale),n=r.longitude/360+.5,i=1===n?0:Math.floor(n),o=s.MathUtils.degToRad(r.latitude),a=s.MathUtils.degToRad(r.longitude-360*i)-this.m_lambda0,u=Math.cos(o)*Math.sin(a);t.x=Math.atanh(u),t.y=Math.atan2(Math.tan(o),Math.cos(a))-this.m_phi0;const l=.5/Math.PI;return t.x=this.unitScale*(s.MathUtils.clamp(t.x*l+.5,0,1)+i),t.y=this.unitScale*s.MathUtils.clamp(t.y*l+.5,0,1),t.z=e.altitude||0,t}unprojectPoint(e){const t=2*Math.PI,r=e.x/this.unitScale,n=e.y/this.unitScale,o=1===r?0:Math.floor(r),s=t*(r-.5-o),a=t*(n-.5),u=e.z||0,l=a+this.m_phi0,c=Math.asin(Math.sin(l)/Math.cosh(s)),h=this.m_lambda0+Math.atan2(Math.sinh(s),Math.cos(l))+o*t;return i.GeoCoordinates.fromRadians(c,h,u)}projectBox(e,t){const{north:r,south:n,east:u,west:l}=e,c=[e.center,e.northEast,e.southWest,new i.GeoCoordinates(n,u),new i.GeoCoordinates(r,l)],p=h.POLE_EDGE_DEG,d=l<90&&u>90,f=l<0&&u>0,m=l<p&&u>-p&&r>0&&n<0;l<-90&&u>-90&&(c.push(new i.GeoCoordinates(r,-90)),c.push(new i.GeoCoordinates(n,-90))),d&&(c.push(new i.GeoCoordinates(r,90)),c.push(new i.GeoCoordinates(n,90))),f&&(c.push(new i.GeoCoordinates(r,0)),c.push(new i.GeoCoordinates(n,0))),m&&(c.push(new i.GeoCoordinates(0,l)),c.push(new i.GeoCoordinates(0,u))),h.alignLatitude(c,c[0]);const g=c.map(e=>this.projectPoint(e)),y=g.map(e=>e.x),v=g.map(e=>e.y),x=g.map(e=>e.z),b=Math.min(...y),w=Math.min(...v),T=Math.min(...x),_=Math.max(...y),S=Math.max(...v),E=Math.max(...x);if(t||(t=s.MathUtils.newEmptyBox3()),o.isBox3Like(t))t.min.x=b,t.min.y=w,t.min.z=T,t.max.x=_,t.max.y=S,t.max.z=E;else{if(!a.isOrientedBox3Like(t))throw new Error("invalid bounding box");s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,1,0,t.yAxis),s.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=(b+_)/2,t.position.y=(w+S)/2,t.position.z=(T+E)/2,t.extents.x=(_-b)/2,t.extents.y=(S-w)/2,t.extents.z=(E-T)/2}return t}unprojectBox(e){const t=this.unitScale,r=e.min,o=e.max,s=[{x:(r.x+o.x)/2,y:(r.y+o.y)/2,z:0},r,o,{x:r.x,y:o.y,z:0},{x:o.x,y:r.y,z:0}],a=.5*t,u=.25*t,l=.75*t,c=r.x<a&&o.x>a,p=r.y<a&&o.y>a,d=r.y<u&&o.y>u,f=r.y<l&&o.y>l;p&&(s.push({x:r.x,y:a,z:0}),s.push({x:o.x,y:a,z:0}),c&&s.push({x:a,y:a,z:0})),d&&(s.push({x:r.x,y:u,z:0}),s.push({x:o.x,y:u,z:0}),c&&s.push({x:a,y:u,z:0})),f&&(s.push({x:r.x,y:l,z:0}),s.push({x:o.x,y:l,z:0}),c&&s.push({x:a,y:l,z:0}));const m=s.map(e=>this.unprojectPoint(e));h.alignLongitude(m,m[0]);const g=m.map(e=>e.latitude),y=m.filter(e=>Math.abs(e.latitude)<90).map(e=>e.longitude),v=m.map(e=>e.altitude||0),x=new i.GeoCoordinates(Math.min(...g),Math.min(...y),Math.min(...v)),b=new i.GeoCoordinates(Math.max(...g),Math.max(...y),Math.max(...v));return n.GeoBox.fromCoordinates(x,b)}unprojectAltitude(e){return e.z}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:-1}:(t.x=0,t.y=0,t.z=-1),t}}class h{static alignLatitude(e,t){for(const r of e)0===r.latitude&&(r.latitude=1e-9*t.latitude)}static alignLongitude(e,t){const r=t.longitude<0?180:-180,n=t.longitude<0?-180:180;for(const t of e)t.longitude===r&&(t.longitude=n)}}t.TransverseMercatorUtils=h,h.POLE_EDGE=1.4844222297453322,h.POLE_EDGE_DEG=s.MathUtils.radToDeg(h.POLE_EDGE),h.POLE_RADIUS=90-h.POLE_EDGE_DEG,h.POLE_RADIUS_SQ=Math.pow(h.POLE_RADIUS,2),t.transverseMercatorProjection=new c(u.EarthConstants.EQUATORIAL_CIRCUMFERENCE)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(6);t.FlatTileBoundingBoxGenerator=class{constructor(e,t=0,r=0){this.tilingScheme=e,this.minElevation=t,this.maxElevation=r,this.m_tilingScheme=e,this.m_worldBox=e.projection.worldExtent(t,r);const{min:n,max:i}=this.m_worldBox;this.m_worldDimensions={x:i.x-n.x,y:i.y-n.y,z:i.z-n.z}}get projection(){return this.m_tilingScheme.projection}get subdivisionScheme(){return this.m_tilingScheme.subdivisionScheme}getWorldBox(e,t){const r=e.level,i=this.subdivisionScheme.getLevelDimensionX(r),o=this.subdivisionScheme.getLevelDimensionY(r),s=this.m_worldDimensions.x/i,a=this.m_worldDimensions.y/o,u=this.m_worldBox.min.x+s*e.column,l=this.m_worldBox.min.y+a*e.row;return t||(t=n.MathUtils.newEmptyBox3()),t.min.x=u,t.min.y=l,t.min.z=this.m_worldBox.min.z,t.max.x=u+s,t.max.y=l+a,t.max.z=this.m_worldBox.max.z,t}getGeoBox(e){const t=this.getWorldBox(e);return this.projection.unprojectBox(t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.halfQuadTreeSubdivisionScheme=new class{getSubdivisionX(){return 2}getSubdivisionY(e){return 0===e?1:2}getLevelDimensionX(e){return 1<<e}getLevelDimensionY(e){return 0!==e?1<<e-1:1}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(20);class i{constructor(e,t,r){this.tileKey=e,this.sizeX=t,this.sizeY=r}[Symbol.iterator](){return 2===this.sizeX&&2===this.sizeY?i.ZCurveIterator(this.tileKey):i.RowColumnIterator(this.tileKey,this.sizeX,this.sizeY)}}t.SubTiles=i,function(e){e.RowColumnIterator=function*(e,t,r){for(let i=0;i<r;i++)for(let o=0;o<t;o++)yield n.TileKey.fromRowColumnLevel(e.row*r+i,e.column*t+o,e.level+1)},e.ZCurveIterator=function*(e){for(let t=0;t<4;t++)yield n.TileKey.fromRowColumnLevel(e.row<<1|t>>1,e.column<<1|1&t,e.level+1)}}(i=t.SubTiles||(t.SubTiles={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(20);class o{static geoCoordinatesToTileKey(e,t,r){const n=e.projection.projectPoint(t);return this.worldCoordinatesToTileKey(e,n,r)}static worldCoordinatesToTileKey(e,t,r){const n=e.projection,o=e.subdivisionScheme,s=o.getLevelDimensionX(r),a=o.getLevelDimensionY(r),{min:u,max:l}=n.worldExtent(0,0),c=l.x-u.x,h=l.y-u.y;if(t.x<u.x||t.x>l.x)return null;if(t.y<u.y||t.y>l.y)return null;const p=Math.min(s-1,Math.floor(s*(t.x-u.x)/c)),d=Math.min(a-1,Math.floor(a*(t.y-u.y)/h));return i.TileKey.fromRowColumnLevel(d,p,r)}static geoRectangleToTileKeys(e,t,r){const s=(e,t,r)=>e<t?r-(t-e)%(r-t):t+(e-t)%(r-t),a=(e,t,r)=>Math.min(Math.max(e,t),r),u=s(t.southWest.longitudeInRadians,-Math.PI,Math.PI),l=a(t.southWest.latitudeInRadians,-.5*Math.PI,.5*Math.PI),c=s(t.northEast.longitudeInRadians,-Math.PI,Math.PI),h=a(t.northEast.latitudeInRadians,-.5*Math.PI,.5*Math.PI),p=o.geoCoordinatesToTileKey(e,n.GeoCoordinates.fromRadians(l,u),r),d=o.geoCoordinatesToTileKey(e,n.GeoCoordinates.fromRadians(h,c),r),f=e.subdivisionScheme.getLevelDimensionX(r);if(!p||!d)throw new Error("Invalid coordinates");const m=p.column;let g=d.column;u>c&&(g+=g!==m?f:f-1);const y=Math.min(p.row,d.row),v=Math.max(p.row,d.row),x=new Array;for(let e=y;e<=v;++e)for(let t=m;t<=g;++t)x.push(i.TileKey.fromRowColumnLevel(e,t%f,r));return x}}t.TileKeyUtils=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(44);t.TileTreeTraverse=class{constructor(e){this.m_subdivisionScheme=e}subTiles(e){const t=this.m_subdivisionScheme.getSubdivisionX(e.level),r=this.m_subdivisionScheme.getSubdivisionY(e.level);return new n.SubTiles(e,t,r)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(1),o=r(104),s=r(11),a=r(17),u=r(35),l=r(27),c=r(26),h=n.LoggerManager.instance.create("StyleSetEvaluator"),p=u.mergeTechniqueDescriptor({});class d{classify(e){if(e._whenExpr){const t=this.switchStyle(e);e._whenExpr=e._whenExpr.accept(this,void 0),this._style=t}}visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){return e}visitHasAttributeExpr(e,t){return e}visitContainsExpr(e,t){return e}visitMatchExpr(e,t){return e}visitCaseExpr(e,t){return e}visitCallExpr(e,t){if("all"===e.op){const t=e.args.map(t=>t.accept(this,e)).filter(e=>void 0!==e);return new i.CallExpr(e.op,t)}if(t){const t=this.matchVarStringComparison(e);if(t){if(void 0===this._style.layer&&"$layer"===t.name)return void(this._style.layer=t.value);if(void 0===this._style._geometryType&&"$geometryType"===t.name)return void(this._style._geometryType=t.value)}}return e}matchVarStringComparison(e){if("=="===e.op){const t=e.args[0],r=e.args[1];if(t instanceof i.VarExpr&&r instanceof i.StringLiteralExpr)return{name:t.name,value:r.value};if(r instanceof i.VarExpr&&t instanceof i.StringLiteralExpr)return{name:r.name,value:t.value}}}switchStyle(e){const t=this._style;return this._style=e,t}}class f{constructor(e,t){this.key="",this.set(e,t)}set(e,t,r){let n=!1;if(void 0===e){const t=void 0!==r?r.lookup("$layer"):void 0;e="string"==typeof t?t:void 0}if(this.layer!==e&&(this.layer=e,n=!0),void 0===t){const e=void 0!==r?r.lookup("$geometryType"):void 0;t="string"==typeof e?e:void 0}return this.geometryType!==t&&(this.geometryType=t,n=!0),n&&this.updateKey(),this}updateKey(){void 0!==this.layer?void 0!==this.geometryType?this.key=`${this.layer}:${this.geometryType}`:this.key=`${this.layer}:`:void 0!==this.geometryType?this.key=`:${this.geometryType}`:this.key="all",this.cachedStyleSet=void 0}}function m(e){const t={};for(const r in e){if(!e.hasOwnProperty(r))continue;let n=e[r];i.Expr.isExpr(n)&&(n=n.toJSON()),t[r]=n}return t}t.StyleSetEvaluator=class{constructor(e,t){this.m_techniques=[],this.m_exprPool=new o.ExprPool,this.m_cachedResults=new Map,this.m_styleConditionClassifier=new d,this.m_subStyleSetCache=new Map,this.m_definitionExprCache=new Map,this.m_tmpOptimizedSubSetKey=new f,this.m_emptyEnv=new i.Env,this.m_definitions=t,this.styleSet=function(e,t){return e.map(e=>(function e(t,r){if(i.isJsonExpr(t)){if(!c.isJsonExprReference(t))throw new Error("invalid expression in this context, only 'ref's are supported");const n=t[1],i=r&&r[n];if(!i)throw new Error(`invalid reference '${n}' - not found`);if(!c.isActualSelectorDefinition(i))throw new Error(`invalid reference '${n}' - expected style definition`);return e(i,r)}return Object.assign({},t)})(e,t))}(e,t),function(e){let t=0,r=0;for(const n of e)n._styleSetIndex=r++,void 0!==n.technique&&void 0===n.renderOrder&&(n.renderOrder=t++)}(this.styleSet),this.compileStyleSet()}getMatchingTechniques(e,t,r){const n=[];this.m_cachedResults.clear();const i=this.m_tmpOptimizedSubSetKey;i.set(t,r,e),this.m_layer=i.layer,this.m_geometryType=i.geometryType,this.m_zoomLevel=e.lookup("$zoom");const o=this.getOptimizedStyleSet(i);for(const t of o)if(this.processStyle(e,t,n))break;return n}wantsLayer(e){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,void 0)).length>0}wantsFeature(e,t){return this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e,t)).length>0}get expressionEvaluatorCache(){return this.m_cachedResults}resetTechniques(){for(const e of this.m_techniques)e._index=void 0;this.m_techniques.length=0}get techniques(){return this.m_techniques}get decodedTechniques(){return this.m_techniques.map(m)}getOptimizedStyleSet(e){if(void 0!==e.cachedStyleSet)return e.cachedStyleSet;let t=this.m_subStyleSetCache.get(e.key);return void 0!==t?(e.cachedStyleSet=t,t):(t=this.createPreFilteredStyleSet(e),this.m_subStyleSetCache.set(e.key,t),e.cachedStyleSet=t,t)}createPreFilteredStyleSet(e){const{layer:t,geometryType:r}=e;return this.styleSet.filter(e=>(void 0===t||void 0===e.layer||e.layer===t)&&(void 0===r||void 0===e._geometryType||e._geometryType===r))}compileStyleSet(){this.styleSet.forEach(e=>this.compileStyle(e)),this.styleSet.forEach(e=>{this.getOptimizedStyleSet(this.m_tmpOptimizedSubSetKey.set(e.layer,e._geometryType))})}compileStyle(e){if(void 0!==e.when)try{e._whenExpr=Array.isArray(e.when)?i.Expr.fromJSON(e.when,this.m_definitions,this.m_definitionExprCache):i.Expr.parse(e.when),this.m_styleConditionClassifier.classify(e),void 0!==e._whenExpr&&(e._whenExpr=e._whenExpr.intern(this.m_exprPool)),i.isJsonExpr(e.minZoomLevel)&&(e._minZoomLevelExpr=i.Expr.fromJSON(e.minZoomLevel).intern(this.m_exprPool)),i.isJsonExpr(e.maxZoomLevel)&&(e._maxZoomLevelExpr=i.Expr.fromJSON(e.maxZoomLevel).intern(this.m_exprPool))}catch(t){h.log("failed to evaluate expression",JSON.stringify(e.when),"error",String(t))}}processStyle(e,t,r){if(!this.checkZoomLevel(e,t))return!1;if(void 0!==this.m_layer&&void 0!==t.layer&&t.layer!==this.m_layer)return!1;if(void 0!==this.m_geometryType&&void 0!==t._geometryType&&t._geometryType!==this.m_geometryType)return!1;if(t._whenExpr)try{if(!t._whenExpr.evaluate(e,i.ExprScope.Condition,this.m_cachedResults))return!1}catch(e){return h.error(`failed to evaluate expression '${JSON.stringify(t.when)}': ${e}`),!1}return void 0!==t.technique&&("none"!==t.technique&&r.push(this.getTechniqueForStyleMatch(e,t)),!0===t.final)}checkZoomLevel(e,t){if(void 0===t.minZoomLevel&&void 0===t.maxZoomLevel)return!0;const r=this.m_zoomLevel;if(void 0===r)return!0;if(void 0!==t.minZoomLevel){let n=t.minZoomLevel;if(t._minZoomLevelExpr)try{n=t._minZoomLevelExpr.evaluate(e,i.ExprScope.Condition,this.m_cachedResults)}catch(e){h.error(`failed to evaluate expression '${JSON.stringify(t._minZoomLevelExpr)}': ${e}`)}if("number"==typeof n&&r<n)return!1}if(void 0!==t.maxZoomLevel){let n=t.maxZoomLevel;if(t._maxZoomLevelExpr)try{n=t._maxZoomLevelExpr.evaluate(e,i.ExprScope.Condition,this.m_cachedResults)}catch(e){h.error(`failed to evaluate expression '${JSON.stringify(t._maxZoomLevelExpr)}': ${e}`)}if("number"==typeof n&&r>n)return!1}return!0}getTechniqueForStyleMatch(e,t){let r;if(this.checkStyleDynamicAttributes(t),void 0!==t._dynamicTechniques){const n=this.evaluateTechniqueProperties(t,e),i=this.getDynamicTechniqueKey(t,n);r=t._dynamicTechniques.get(i),void 0===r&&(r=this.createTechnique(t,i,n),t._dynamicTechniques.set(i,r))}else r=t._staticTechnique,void 0===r&&(t._staticTechnique=r=this.createTechnique(t,`${t._styleSetIndex}`,[]));return void 0===r._index&&(r._index=this.m_techniques.length,this.m_techniques.push(r)),r}getDynamicTechniqueKey(e,t){const r=t.map(([e,t])=>void 0===t?"U":JSON.stringify(t)).join(":");return`${e._styleSetIndex}:${r}`}checkStyleDynamicAttributes(e){if(void 0!==e._dynamicTechniqueAttributes||"none"===e.technique)return;e._dynamicTechniqueAttributes=[],e._dynamicFeatureAttributes=[],e._dynamicForwardedAttributes=[],e._staticAttributes=[];const t=e._dynamicFeatureAttributes,r=e._dynamicTechniqueAttributes,n=e._dynamicForwardedAttributes,o=e._staticAttributes,c=l.techniqueDescriptors[e.technique]||p,h=(e,l)=>{if(void 0!==l){if(i.isJsonExpr(l)?l=i.Expr.fromJSON(l,this.m_definitions,this.m_definitionExprCache).intern(this.m_exprPool):s.isInterpolatedPropertyDefinition(l)&&(l=i.Expr.fromJSON(a.interpolatedPropertyDefinitionToJsonExpr(l)).intern(this.m_exprPool)),i.Expr.isExpr(l)){const e=l.dependencies();e.zoom||0!==e.properties.size||(l=l.evaluate(this.m_emptyEnv))}if(i.Expr.isExpr(l)){let i=c.attrScopes[e];void 0===i&&(i=u.AttrScope.TechniqueGeometry);const o=l.dependencies();switch(i){case u.AttrScope.FeatureGeometry:t.push([e,l]);break;case u.AttrScope.TechniqueGeometry:r.push([e,l]);break;case u.AttrScope.TechniqueRendering:0===o.properties.size?n.push([e,l]):r.push([e,l])}}else null!=l&&o.push([e,l])}};if(h("renderOrder",e.renderOrder),h("label",e.labelProperty),h("secondaryRenderOrder",e.secondaryRenderOrder),void 0!==e.attr)for(const t in e.attr)e.attr.hasOwnProperty(t)&&h(t,e.attr[t]);r.length>0&&(e._dynamicTechniques=new Map)}evaluateTechniqueProperties(e,t){if(void 0===e._dynamicTechniqueAttributes)return[];const r={env:t};return e._dynamicTechniqueAttributes.map(([e,n])=>{try{if(n.isDynamic()){return[e,n.instantiate(r)]}return[e,n.evaluate(t,i.ExprScope.Value,this.m_cachedResults)]}catch(t){return h.error(`failed to evaluate expression '${n.toJSON()}': ${t}`),[e,null]}})}createTechnique(e,t,r){const n={};if(n.name=e.technique,void 0!==e._staticAttributes)for(const[t,r]of e._staticAttributes)null!==r&&(n[t]=r);for(const[e,t]of r)null!==t&&(n[e]=t);if(void 0!==e._dynamicFeatureAttributes)for(const[t,r]of e._dynamicFeatureAttributes)n[t]=r;if(void 0!==e._dynamicForwardedAttributes)for(const[t,r]of e._dynamicForwardedAttributes)i.Expr.isExpr(r)?n[t]=r.toJSON():n[t]=r;return n._index=this.m_techniques.length,n._styleSetIndex=e._styleSetIndex,n._key=t,this.m_techniques.push(n),n}},t.makeDecodedTechnique=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(1),o=r(11),s=n.LoggerManager.instance.create("TechniqueAttr");t.evaluateTechniqueAttr=function(e,t,r){const n=e instanceof i.Env?e:e.env;let a;if(i.Expr.isExpr(t))try{a=t.evaluate(n,i.ExprScope.Dynamic,e instanceof i.Env?void 0:e.cachedExprResults)}catch(e){s.error(`failed to evaluate expression '${JSON.stringify(t)}': ${e}`),a=void 0}else if(o.isInterpolatedProperty(t)){const r=e instanceof i.Env?e.lookup("$zoom"):e.zoomLevel;a=o.getPropertyValue(t,r)}else a=t;return null==a?r:a}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(106)),n(r(110)),n(r(111)),n(r(21)),n(r(112)),n(r(50))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(142),i=n.default||n;t.GeoJsonTiler=class{constructor(){this.indexes=new Map}dispose(){}async connect(){return Promise.resolve()}async registerIndex(e,t){if(!this.indexes.has(e))return this.updateIndex(e,t)}async updateIndex(e,t){if(t instanceof URL){const e=await fetch(t.href);if(!e.ok)throw new Error(`GeoJsonTiler: Unable to fetch ${t.href}: ${e.statusText}`);t=await e.json()}else t=t;const r=i(t,{maxZoom:20,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:0,lineMetrics:!1,promoteId:null,generateId:!0,debug:0});r.geojson=t,this.indexes.set(e,r)}async getTile(e,t){const r=this.indexes.get(e);if(void 0===r)throw new Error("Tile not found");const n=r.getTile(t.level,t.column,t.row);if(null!==n){n.layer=e;for(const e of n.features)e.originalGeometry=this.getOriginalGeometry(e,r.geojson)}return n||{}}getOriginalGeometry(e,t){switch(t.type){case"Point":case"MultiPoint":case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":case"GeometryCollection":return t;case"Feature":return t.geometry;case"FeatureCollection":return t.features[e.id].geometry}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(28),i=r(4),o=r(0),s=r(22),a=4096;var u;!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(u||(u={})),t.VTJsonDataAdapterId="vt-json";t.VTJsonDataAdapter=class{constructor(e,r,n){this.m_processor=e,this.m_dataFilter=r,this.m_logger=n,this.id=t.VTJsonDataAdapterId}get dataFilter(){return this.m_dataFilter}set dataFilter(e){this.m_dataFilter=e}canProcess(e){if(s.isArrayBufferLike(e))return!1;const t=e;return void 0!==t.features&&void 0!==t.source&&void 0!==t.x&&void 0!==t.y&&void 0!==t.z}process(e,t,r){for(const r of e.features){const s=new n.MapEnv(Object.assign({$layer:e.layer,$geometryType:this.convertGeometryType(r.type),$level:t.level,$zoom:Math.max(0,t.level-(this.m_processor.storageLevelOffset||0)),$id:r.id},r.tags));switch(r.type){case u.Point:for(const n of r.geometry){const r=n[0],i=n[1],u=new o.Vector2(r,i);this.m_processor.processPointFeature(e.layer,a,[u],s,t.level)}break;case u.LineString:{let n;if("LineString"===r.originalGeometry.type){n=[];for(const[e,t]of r.originalGeometry.coordinates)n.push(new i.GeoCoordinates(t,e))}else if("MultiLineString"===r.originalGeometry.type){n=[];for(const e of r.originalGeometry.coordinates)for(const[t,r]of e)n.push(new i.GeoCoordinates(r,t))}for(const i of r.geometry){const r={positions:[],untiledPositions:n};for(const[e,t]of i){const n=new o.Vector2(e,t);r.positions.push(n)}this.m_processor.processLineFeature(e.layer,a,[r],s,t.level)}break}case u.Polygon:{const n={rings:[]};for(const e of r.geometry){const t=[];for(const[r,n]of e){const e=new o.Vector2(r,n);t.push(e)}n.rings.push(t)}this.m_processor.processPolygonFeature(e.layer,a,[n],s,t.level);break}case u.Unknown:}}}convertGeometryType(e){switch(e){case u.Point:return"point";case u.LineString:return"line";case u.Polygon:return"polygon";default:return"unknown"}}}},function(e,t,r){"use strict";e.exports=h;var n,i=r(7),o=i.LongBits,s=i.base64,a=i.utf8;function u(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function l(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new u(l,0,0),this.tail=this.head,this.states=null}function p(e,t,r){t[r]=255&e}function d(e,t){this.len=e,this.next=void 0,this.val=t}function f(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function m(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}h.create=i.Buffer?function(){return(h.create=function(){return new n})()}:function(){return new h},h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,r){return this.tail=this.tail.next=new u(e,t,r),this.len+=t,this},d.prototype=Object.create(u.prototype),d.prototype.fn=function(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new d((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(f,10,o.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=o.from(e);return this._push(f,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=o.from(e).zzEncode();return this._push(f,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(m,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=o.from(e);return this._push(m,4,t.lo)._push(m,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var g=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(i.isString(e)){var r=h.alloc(t=s.length(e));s.decode(e,r,0),e=r}return this.uint32(t)._push(g,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new u(l,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(l,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},h._configure=function(e){n=e}},function(e,t,r){"use strict";e.exports=u;var n,i=r(7),o=i.LongBits,s=i.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function u(e){this.buf=e,this.pos=0,this.len=e.length}var l,c="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new u(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new u(e);throw Error("illegal buffer")};function h(){var e=new o(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function p(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw a(this,8);return new o(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}u.create=i.Buffer?function(e){return(u.create=function(e){return i.Buffer.isBuffer(e)?new n(e):c(e)})(e)}:c,u.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,u.prototype.uint32=(l=4294967295,function(){if(l=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return l;if(l=(l|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return l;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return l}),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},u.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},u.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,r):t===r?new this.buf.constructor(0):this._slice.call(this.buf,t,r)},u.prototype.string=function(){var e=this.bytes();return s.read(e,0,e.length)},u.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},u._configure=function(e){n=e;var t=i.Long?"toLong":"toNumber";i.merge(u.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return d.call(this)[t](!0)},sfixed64:function(){return d.call(this)[t](!1)}})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(15);t.OmvFeatureFilterDescriptionBuilder=class{constructor(e){this.m_processLayersDefault=!0,this.m_processPointsDefault=!0,this.m_processLinesDefault=!0,this.m_processPolygonsDefault=!0,this.m_layersToProcess=new Array,this.m_layersToIgnore=new Array,this.m_pointsToProcess=new Array,this.m_ignoredPoints=new Array,this.m_linesToProcess=new Array,this.m_linesToIgnore=new Array,this.m_polygonsToProcess=new Array,this.m_polygonsToIgnore=new Array,this.m_kindsToProcess=[],this.m_kindsToIgnore=[],e&&(this.m_processLayersDefault=void 0===e.processLayersDefault||e.processLayersDefault,this.m_processPointsDefault=void 0===e.processPointsDefault||e.processPointsDefault,this.m_processLinesDefault=void 0===e.processLinesDefault||e.processLinesDefault,this.m_processPolygonsDefault=void 0===e.processPolygonsDefault||e.processPolygonsDefault)}processLayer(e,t=i.OmvFilterString.StringMatch.Match,r=0,n=1/0){this.m_layersToProcess.push({name:{value:e,match:t},minLevel:r,maxLevel:n})}ignoreLayer(e,t=i.OmvFilterString.StringMatch.Match,r=0,n=1/0){this.m_layersToIgnore.push({name:{value:e,match:t},minLevel:r,maxLevel:n})}processPoint(e){this.addItem(this.m_pointsToProcess,e)}processPoints(e){this.addItems(this.m_pointsToProcess,e)}ignorePoint(e){this.addItem(this.m_ignoredPoints,e)}ignorePoints(e){this.addItems(this.m_ignoredPoints,e)}processLine(e){this.addItem(this.m_linesToProcess,e)}processLines(e){this.addItems(this.m_linesToProcess,e)}ignoreLine(e){this.addItem(this.m_linesToIgnore,e)}ignoreLines(e){this.addItems(this.m_linesToIgnore,e)}processPolygon(e){this.addItem(this.m_polygonsToProcess,e)}processPolygons(e){this.addItems(this.m_polygonsToProcess,e)}ignorePolygon(e){this.addItem(this.m_polygonsToIgnore,e)}ignorePolygons(e){this.addItems(this.m_polygonsToIgnore,e)}processKinds(e){this.m_kindsToProcess=this.m_kindsToProcess.concat(e)}ignoreKinds(e){this.m_kindsToIgnore=this.m_kindsToIgnore.concat(e)}createDescription(){return{processLayersDefault:this.m_processLayersDefault,processPointsDefault:this.m_processPointsDefault,processLinesDefault:this.m_processLinesDefault,processPolygonsDefault:this.m_processPolygonsDefault,layersToProcess:this.m_layersToProcess,layersToIgnore:this.m_layersToIgnore,pointsToProcess:this.m_pointsToProcess,pointsToIgnore:this.m_ignoredPoints,linesToProcess:this.m_linesToProcess,linesToIgnore:this.m_linesToIgnore,polygonsToProcess:this.m_polygonsToProcess,polygonsToIgnore:this.m_polygonsToIgnore,kindsToProcess:this.m_kindsToProcess,kindsToIgnore:this.m_kindsToIgnore}}addItem(e,t){(void 0===t.minLevel||isNaN(t.minLevel))&&(t.minLevel=0),(void 0===t.maxLevel||isNaN(t.maxLevel))&&(t.maxLevel=1/0);const r={layerName:{value:t.layer,match:void 0===t.matchLayer?i.OmvFilterString.StringMatch.Match:t.matchLayer},geometryTypes:void 0!==t.geomType?Array.isArray(t.geomType)?t.geomType:[t.geomType]:void 0,classes:[{value:t.featureClass,match:void 0===t.matchClass?i.OmvFilterString.StringMatch.Match:t.matchClass}],minLevel:t.minLevel,maxLevel:t.maxLevel,featureAttribute:t.featureAttribute};e.push(r)}addItems(e,t){(void 0===t.minLevel||isNaN(t.minLevel))&&(t.minLevel=0),(void 0===t.maxLevel||isNaN(t.maxLevel))&&(t.maxLevel=1/0);const r={layerName:{value:t.layer,match:void 0===t.matchLayer?i.OmvFilterString.StringMatch.Match:t.matchLayer},geometryTypes:void 0!==t.geomTypes?Array.isArray(t.geomTypes)?t.geomTypes:[t.geomTypes]:void 0,classes:t.featureClasses,minLevel:t.minLevel,maxLevel:t.maxLevel,featureAttribute:t.featureAttribute};e.push(r)}};class o{constructor(e){this.description=e,this.description.kindsToProcess.length>0&&(this.enabledKinds=new n.GeometryKindSet(this.description.kindsToProcess)),this.description.kindsToIgnore.length>0&&(this.disabledKinds=new n.GeometryKindSet(this.description.kindsToIgnore))}static matchLayer(e,t,r){for(const n of t)if(!(r<n.minLevel||r>n.maxLevel)&&i.OmvFilterString.matchString(e,n.name))return!0;return!1}wantsLayer(e,t){return!!o.matchLayer(e,this.description.layersToProcess,t)||!o.matchLayer(e,this.description.layersToIgnore,t)&&this.description.processLayersDefault}wantsPointFeature(e,t,r){return this.wantsFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,r,this.description.processPointsDefault)}wantsLineFeature(e,t,r){return this.wantsFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,r,this.description.processLinesDefault)}wantsPolygonFeature(e,t,r){return this.wantsFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,r,this.description.processPolygonsDefault)}wantsKind(e){return void 0===e||(!(void 0!==this.disabledKinds&&this.disabledKinds.hasOrIntersects(e))||void 0!==this.enabledKinds&&this.enabledKinds.hasOrIntersects(e))}get hasKindFilter(){return void 0!==this.enabledKinds||void 0!==this.disabledKinds}wantsFeature(e,t,r,n,o,s){for(const t of e)if(!(o<t.minLevel||o>t.maxLevel)&&i.OmvFilterString.matchString(r,t.layerName)&&void 0!==t.geometryTypes&&t.geometryTypes.indexOf(n)>=0)return!0;for(const e of t)if(i.OmvFilterString.matchString(r,e.layerName)&&void 0!==e.geometryTypes&&e.geometryTypes.indexOf(n)>=0)return!1;return s}}t.OmvGenericFeatureFilter=o;t.ComposedDataFilter=class{constructor(e){this.filters=e}get hasKindFilter(){return this.filters.reduce((e,t)=>e&&t.hasKindFilter,!0)}wantsLayer(e,t){return this.filters.reduce((r,n)=>r&&n.wantsLayer(e,t),!0)}wantsPointFeature(e,t,r){return this.filters.reduce((n,i)=>n&&i.wantsPointFeature(e,t,r),!0)}wantsLineFeature(e,t,r){return this.filters.reduce((n,i)=>n&&i.wantsLineFeature(e,t,r),!0)}wantsPolygonFeature(e,t,r){return this.filters.reduce((n,i)=>n&&i.wantsPolygonFeature(e,t,r),!0)}wantsKind(e){return this.filters.reduce((t,r)=>t&&r.wantsKind(e),!0)}};class s{constructor(e){this.description=e}static matchItems(e,t,r){for(const n of r)if(void 0!==n.classes){if(!i.OmvFilterString.matchString(e,n.layerName))continue;for(const e of n.classes)if(i.OmvFilterString.matchString(t,e))return!0}return!1}static matchAttribute(e,t,r){for(const n of r)if(void 0!==n.featureAttribute&&i.OmvFilterString.matchString(e,n.layerName)&&t.lookup(n.featureAttribute.key)===n.featureAttribute.value)return!0;return!1}doProcessPointFeature(e,t){return this.doProcessFeature(this.description.pointsToProcess,this.description.pointsToIgnore,e,t,this.description.processPointsDefault)}doProcessLineFeature(e,t){return this.doProcessFeature(this.description.linesToProcess,this.description.linesToIgnore,e,t,this.description.processLinesDefault)}doProcessPolygonFeature(e,t){return this.doProcessFeature(this.description.polygonsToProcess,this.description.polygonsToIgnore,e,t,this.description.processPolygonsDefault)}doProcessFeature(e,t,r,n,i){if(void 0===r||0===e.length&&0===t.length)return i;let o;const a=n.lookup("class");return null!=a&&(o=a.toString()),!(!o||!s.matchItems(r,o,e))||(!o||!s.matchItems(r,o,t))&&(!!s.matchAttribute(r,n,e)||!s.matchAttribute(r,n,t)&&i)}}t.OmvGenericFeatureModifier=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),self.importScripts("three.min.js"),r(56).OmvTileDecoderService.start()},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(23)),n(r(141)),n(r(15))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(e,t=new Array){this.priority=e,this.elements=t}clone(){return new n(this.priority,this.elements.slice())}}t.PriorityListGroup=n;t.GroupedPriorityList=class{constructor(){this.groups=new Map}add(e){this.getGroup(e.priority).elements.push(e)}remove(e){const t=this.getGroup(e.priority);if(void 0!==t){const r=t.elements.indexOf(e);if(r>=0){if(t.elements.splice(r,1),0===t.elements.length){const t=Math.floor(e.priority);this.groups.delete(t),this.m_sortedGroups&&(this.m_sortedGroups=[])}return!0}}return!1}clear(){this.groups.clear(),this.m_sortedGroups&&(this.m_sortedGroups=[])}merge(e){for(const t of e.groups){const e=this.findGroup(t[1].priority);void 0!==e?e.elements=e.elements.concat(t[1].elements):(this.groups.set(Math.floor(t[1].priority),t[1].clone()),this.m_sortedGroups&&(this.m_sortedGroups=[]))}return this}get sortedGroups(){if(this.m_sortedGroups&&this.m_sortedGroups.length>0)return this.m_sortedGroups;this.m_sortedGroups||(this.m_sortedGroups=[]);for(const e of this.groups)this.m_sortedGroups.push(e[1]);return this.m_sortedGroups.sort((e,t)=>t.priority-e.priority),this.m_sortedGroups}forEach(e){for(const t of this.groups)t[1].elements.forEach(e)}count(){let e=0;for(const t of this.groups)e+=t[1].elements.length;return e}findGroup(e){const t=Math.floor(e);return this.groups.get(t)}getGroup(e){let t=this.findGroup(e);if(void 0===t){const r=Math.floor(e);t=new n(r),this.groups.set(r,t),this.m_sortedGroups&&(this.m_sortedGroups=[])}return t}}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(29)),n(r(24)),n(r(30)),n(r(59)),n(r(61)),n(r(31))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(60);t.LoggerManager=class{static get instance(){return this.m_instance||(this.m_instance=new n.LoggerManagerImpl)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(29),i=r(30),o=r(31);t.LoggerManagerImpl=class{constructor(){this.m_loggers=[],this.channel="undefined"==typeof self||void 0!==self.document?new n.ConsoleChannel:new o.WorkerChannel}getLoggerNames(){return this.m_loggers.map(e=>e.name)}getLogger(e){return this.m_loggers.find(t=>t.name===e)}create(e,t={}){void 0!==this.m_levelSetForAll&&(void 0===t.level||t.level<this.m_levelSetForAll)&&(t.level=this.m_levelSetForAll);const r=new i.Logger(e,this.channel,t);return this.m_loggers.push(r),r}dispose(e){const t=this.m_loggers.indexOf(e);if(t<0)throw new Error(`Cannot unregister "${e}" : no such logger registered.`);this.m_loggers.splice(t,1)}updateAll(e){for(const t of this.m_loggers)t.update(e)}update(e,t){for(const r of this.m_loggers)r.name===e&&r.update(t)}enableAll(e){for(const t of this.m_loggers)t.enabled=e}enable(e,t){this.update(e,{enabled:t})}setLogLevelForAll(e){this.m_levelSetForAll=e;for(const t of this.m_loggers)t.level=e}setLogLevel(e,t){this.update(e,{level:t})}setChannel(e){this.channel=e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.MultiChannel=class{constructor(...e){this.channels=[],this.channels=e}error(e,...t){for(const r of this.channels)r.error(e,...t)}debug(e,...t){for(const r of this.channels)r.debug(e,...t)}info(e,...t){for(const r of this.channels)r.info(e,...t)}log(e,...t){for(const r of this.channels)r.log(e,...t)}trace(e,...t){for(const r of this.channels)r.trace(e,...t)}warn(e,...t){for(const r of this.channels)r.warn(e,...t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,r,n){return(e-r)*(e-r)+(t-n)*(t-n)}e.Box=class{constructor(e=0,t=0,r=0,n=0){this.x=e,this.y=t,this.w=r,this.h=n}set(e,t,r,n){this.x=e,this.y=t,this.w=r,this.h=n}contains(e,t){return this.x<=e&&this.x+this.w>=e&&this.y<=t&&this.y+this.h>=t}intersects(e){return this.x<=e.x+e.w&&this.x+this.w>=e.x&&this.y<=e.y+e.h&&this.y+this.h>=e.y}},e.distSquared=t,e.computeSquaredLineLength=function(e){let t=0;const r=e.length-4;for(let n=0;n<r;n+=3){const r=e[n+3]-e[n],i=e[n+4]-e[n+1];t+=r*r+i*i}return t},e.distToSegmentSquared=function(e,r,n,i,o,s){const a=t(n,i,o,s);if(0===a)return t(e,r,n,i);let u=((e-n)*(o-n)+(r-i)*(s-i))/a;return u=Math.max(0,Math.min(1,u)),t(e,r,n+u*(o-n),i+u*(s-i))}}(t.Math2D||(t.Math2D={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,r){return e<t?t:e>r?r:e}e.clamp=t,e.lerp=function(e,t,r){return e*(1-r)+t*r},e.smoothStep=function(e,r,n){return(n=t((n-e)/(r-e),0,1))*n*(3-2*n)},e.smootherStep=function(e,r,n){return(n=t((n-e)/(r-e),0,1))*n*n*(n*(6*n-15)+10)},e.map=function(e,t,r,n,i){return(e-t)*(i-n)/(r-t)+n},e.min2=function(e,t){let r;return void 0!==e&&(r=e),void 0!==t&&(r=void 0===r?t:Math.min(r,t)),r},e.max2=function(e,t){let r;return void 0!==e&&(r=e),void 0!==t&&(r=void 0===r?t:Math.max(r,t)),r},e.isClamped=function(e,t,r){return!(void 0!==t&&e<t)&&!(void 0!==r&&e>r)},e.easeInOutCubic=function(e,t,r){return e+(t-e)*(r<.5?4*r*r*r:(r-1)*(2*r-2)*(2*r-2)+1)}}(t.MathUtils||(t.MathUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixins=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(r=>{e.prototype[r]=t.prototype[r]})})},t.applyMixinsWithoutProperties=function(e,t){t.forEach(t=>{Object.getOwnPropertyNames(t.prototype).forEach(r=>{const n=Object.getOwnPropertyDescriptor(t.prototype,r);void 0!==n&&void 0===n.get&&(e.prototype[r]=t.prototype[r])})})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=!0;t.assert=function(e,t){if(!n&&!e)throw new Error(void 0!==t?t:"ASSERTION failed")},t.assertExists=function(e,t){if(!n&&null==e)throw new Error(void 0!==t?t:"ASSERTION failed: Element is undefined or null");return e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ContextLogger=class{constructor(e,t){this.m_logger=e,this.headerMessage=t,this.context=[],this.m_headerLogged=!1,this.warn=this.createLogMethod("warn"),this.info=this.createLogMethod("info"),this.error=this.createLogMethod("error")}pushAttr(e){this.context.push(`${this.context.length>0?".":""}${e}`)}pushIndex(e){this.context.push(`[${e}]`)}pop(){this.context.pop()}createLogMethod(e){return(t,...r)=>{this.m_headerLogged||(this.m_logger.info(this.headerMessage),this.m_headerLogged=!0),this.m_logger[e](`${this.context.join("")}: ${t}`,...r)}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{static now(){return n.nowFunc()}static getNowFunc(){return"undefined"!=typeof performance&&void 0!==performance.now?()=>performance.now():()=>(new Date).getTime()}}t.PerformanceTimer=n,n.instance=new n,n.nowFunc=n.getNowFunc()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cloneDeep=function(e){const t=new Map,r=function e(r){if(null===r)return null;if("object"==typeof r){const n=t.get(r);if(void 0!==n)return n;if(Array.isArray(r)){const n=[];t.set(r,n),n.length=r.length;for(let t=0;t<n.length;++t)n[t]=e(r[t]);return n}if(r instanceof Date){const e=new Date(r.getTime());return t.set(r,e),e}if(r instanceof RegExp){const e=new RegExp(r.source,r.flags);return t.set(r,e),e}if(r.constructor!==Object)throw new Error("cloneDeep doesn't support objects with custom prototypes");{const n={};t.set(r,n);for(const t in r)r.hasOwnProperty(t)&&(n[t]=e(r[t]));return n}}return r}(e);return t.clear(),r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getOptionValue=function(...e){for(const t of e)if(null!=t)return t},t.mergeWithOptions=function(e,t){const r=Object.assign({},e);if(null==t)return r;for(const n in e)if(e.hasOwnProperty(n)){const e=t[n];null!=e&&(r[n]=e)}return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(25);t.PrefixMapUriResolver=class{constructor(e){this.definitions=e}resolveUri(e){return Object.keys(this.definitions).reduce((e,t)=>{if(t.endsWith("/")&&e.startsWith(t)){return this.definitions[t]+e.substr(t.length)}return e===t?this.definitions[t]:e},e)}};t.RelativeUriResolver=class{constructor(e){this.parentUri=e}resolveUri(e){return n.resolveReferenceUri(this.parentUri,e)}},t.composeUriResolvers=function(...e){return{resolveUri:t=>e.reduce((e,t)=>void 0!==t?t.resolveUri(e):e,t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(25);t.getAppBaseUrl=function(){return n.baseUrl(window.location.href)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chainCallbacks=function(e,t){return function(...r){return e&&e.apply(this,r),t.apply(this,r)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i=r(74),o=r(75),s=r(76),a=r(77),u=r(78),l=r(79),c=r(80),h=r(82),p=r(83),d=r(84),f=r(85),m=r(86),g=r(87),y=new Map;t.ExprEvaluatorContext=class{constructor(e,t,r,n){this.evaluator=e,this.env=t,this.scope=r,this.cache=n,this.m_partialEvaluation=!1}get partialEvaluation(){return this.m_partialEvaluation}evaluate(e){if(void 0!==e)return e.accept(this.evaluator,this);throw new Error("Failed to evaluate expression")}partiallyEvaluate(e){if(void 0===e)throw new Error("Failed to evaluate expression");const t=this.m_partialEvaluation;this.m_partialEvaluation=!0;try{const r=e.accept(this.evaluator,this);return this.m_partialEvaluation=t,r instanceof n.Expr?r:n.LiteralExpr.fromValue(r)}catch(e){throw e}finally{this.m_partialEvaluation=t}}};class v{static defineOperator(e,t){y.set(e,t)}static defineOperators(e){Object.getOwnPropertyNames(e).forEach(t=>{this.defineOperator(t,e[t])})}static getOperator(e){return y.get(e)}visitVarExpr(e,t){const r=t.env.lookup(e.name);return void 0!==r?r:null}visitNullLiteralExpr(e,t){return null}visitBooleanLiteralExpr(e,t){return e.value}visitNumberLiteralExpr(e,t){return e.value}visitStringLiteralExpr(e,t){return e.value}visitObjectLiteralExpr(e,t){return e.value}visitHasAttributeExpr(e,t){return void 0!==t.env.lookup(e.name)}visitContainsExpr(e,t){const r=e.value.accept(this,t),n=e.elements.includes(r);return void 0!==t.cache&&t.cache.set(e,n),n}visitMatchExpr(e,t){const r=t.evaluate(e.value);for(const[n,i]of e.branches){if(Array.isArray(n)&&n.includes(r))return t.evaluate(i);if(n===r)return t.evaluate(i)}return t.evaluate(e.fallback)}visitCaseExpr(e,t){for(const[r,n]of e.branches)if(t.evaluate(r))return t.evaluate(n);return t.evaluate(e.fallback)}visitCallExpr(e,t){if(void 0!==t.cache){const r=t.cache.get(e);if(void 0!==r)return r}const r=e.descriptor||y.get(e.op);if(r){e.descriptor=r;const n=r.call(t,e);return t.cache&&t.cache.set(e,n),n}throw new Error(`undefined operator '${e.op}`)}}t.ExprEvaluator=v,v.defineOperators(o.CastOperators),v.defineOperators(a.ComparisonOperators),v.defineOperators(p.MathOperators),v.defineOperators(m.StringOperators),v.defineOperators(s.ColorOperators),v.defineOperators(g.TypeOperators),v.defineOperators(d.MiscOperators),v.defineOperators(l.FlowOperators),v.defineOperators(i.ArrayOperators),v.defineOperators(c.InterpolationOperators),v.defineOperators(f.ObjectOperators),v.defineOperators(u.FeatureOperators),v.defineOperators(h.MapOperators)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={at:{call:(e,t)=>{const r=t.args,n=e.evaluate(r[0]);if("number"!=typeof n)throw new Error("expected the index of the element to retrieve");const i=e.evaluate(r[1]);if(!Array.isArray(i))throw new Error("expected an array");return n>=0&&n<i.length?i[n]:null}}};t.ArrayOperators=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={"to-boolean":{call:(e,t)=>Boolean(e.evaluate(t.args[0]))},"to-string":{call:(e,t)=>String(e.evaluate(t.args[0]))},"to-number":{call:(e,t)=>{for(const r of t.args){const t=Number(e.evaluate(r));if(!isNaN(t))return t}throw new Error("cannot convert the value to a number")}}};t.CastOperators=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=r(16),o={rgba:{call:(e,t)=>{const r=e.evaluate(t.args[0]),o=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]),a=e.evaluate(t.args[3]);if("number"==typeof r&&"number"==typeof o&&"number"==typeof s&&"number"==typeof a&&r>=0&&o>=0&&s>=0&&a>=0&&a<=1)return function(e,t,r,o){return i.ColorUtils.getHexFromRgba(n.Math.clamp(e,0,255)/255,n.Math.clamp(t,0,255)/255,n.Math.clamp(r,0,255)/255,n.Math.clamp(o,0,1))}(r,o,s,a);throw new Error(`unknown color 'rgba(${r},${o},${s},${a})'`)}},rgb:{call:(e,t)=>{const r=e.evaluate(t.args[0]),o=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]);if("number"==typeof r&&"number"==typeof o&&"number"==typeof s&&r>=0&&o>=0&&s>=0)return function(e,t,r){return i.ColorUtils.getHexFromRgb(n.Math.clamp(e,0,255)/255,n.Math.clamp(t,0,255)/255,n.Math.clamp(r,0,255)/255)}(r,o,s);throw new Error(`unknown color 'rgb(${r},${o},${s})'`)}},hsl:{call:(e,t)=>{const r=e.evaluate(t.args[0]),o=e.evaluate(t.args[1]),s=e.evaluate(t.args[2]);if("number"==typeof r&&"number"==typeof o&&"number"==typeof s&&r>=0&&o>=0&&s>=0)return function(e,t,r){return i.ColorUtils.getHexFromHsl(n.Math.euclideanModulo(e,360)/360,n.Math.clamp(t,0,100)/100,n.Math.clamp(r,0,100)/100)}(r,o,s);throw new Error(`unknown color 'hsl(${r},${o}%,${s}%)'`)}}};t.ColorOperators=o},function(e,t,r){"use strict";function n(e,t,r=!1){const n=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]);if(!("number"==typeof n&&"number"==typeof i||"string"==typeof n&&"string"==typeof i)&&r)throw new Error(`invalid operands '${n}' and '${i}' for operator '${t.op}'`);switch(t.op){case"<":return n<i;case">":return n>i;case"<=":return n<=i;case">=":return n>=i;default:throw new Error(`invalid comparison operator '${t.op}'`)}}Object.defineProperty(t,"__esModule",{value:!0});const i={"!":{call:(e,t)=>!e.evaluate(t.args[0])},"==":{call:(e,t)=>{return e.evaluate(t.args[0])===e.evaluate(t.args[1])}},"!=":{call:(e,t)=>{return e.evaluate(t.args[0])!==e.evaluate(t.args[1])}},"<":{call:(e,t)=>n(e,t)},">":{call:(e,t)=>n(e,t)},"<=":{call:(e,t)=>n(e,t)},">=":{call:(e,t)=>n(e,t)}};t.ComparisonOperators=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.FeatureOperators={"geometry-type":{call:(e,t)=>{switch(e.env.lookup("$geometryType")){case"point":return"Point";case"line":return"LineString";case"polygon":return"Polygon";default:return null}}}}},function(e,t,r){"use strict";function n(e,t,r){switch(t){case"boolean":case"number":case"string":for(const n of r){const r=e.evaluate(n);if(typeof r===t)return r}throw new Error(`expected a '${t}'`);default:throw new Error(`invalid type '${t}'`)}}Object.defineProperty(t,"__esModule",{value:!0});const i={all:{call:(e,t)=>{for(const r of t.args)if(!e.evaluate(r))return!1;return!0}},any:{call:(e,t)=>{for(const r of t.args)if(e.evaluate(r))return!0;return!1}},none:{call:(e,t)=>{for(const r of t.args)if(e.evaluate(r))return!1;return!0}},boolean:{call:(e,t)=>n(e,"boolean",t.args)},number:{call:(e,t)=>n(e,"number",t.args)},string:{call:(e,t)=>n(e,"string",t.args)}};t.FlowOperators=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i=r(11);const o={interpolate:{isDynamicOperator:e=>e.args[1]&&e.args[1].isDynamic(),call:(e,t)=>{if(function(e){if(e._interpolatedProperty||void 0!==e._mode)return;const t=e.args[0];if(!(t instanceof n.CallExpr))throw new Error("expected an interpolation type");let r,o;if("linear"===t.op)r="Linear";else if("discrete"===t.op)r="Discrete";else if("cubic"===t.op)r="Cubic";else{if("exponential"!==t.op)throw new Error("unrecognized interpolation type");{r="Exponential";const e=t.args[0];if(!(e instanceof n.NumberLiteralExpr))throw new Error("expected the base of the exponential interpolation");o=e.value}}const s=e.args[1];if(!(s instanceof n.CallExpr))throw new Error("expected the input of the interpolation");if("zoom"!==s.op)throw new Error("only 'zoom' is supported");if(2===e.args.length||e.args.length%2)throw new Error("invalid number of samples");const a=[],u=[];let l=!0;for(let t=2;t<e.args.length;t+=2){const r=e.args[t];if(!(r instanceof n.NumberLiteralExpr))throw new Error("expected a numeric literal");if(a.push(r.value),l){const r=e.args[t+1];r instanceof n.LiteralExpr?u.push(r.value):l=!1}}if(l){const t=i.createInterpolatedProperty({interpolation:r,exponent:o,zoomLevels:a,values:u});if(!t)throw new Error("failed to create interpolation");e._interpolatedProperty=t}else e._mode=r,e._exponent=o,e._stops=a}(t),e.scope!==n.ExprScope.Dynamic)return t;let r=t._interpolatedProperty;if(!r){const n=[];for(let r=2;r<t.args.length;r+=2){const i=e.evaluate(t.args[r+1]);n.push(i)}if(r=i.createInterpolatedProperty({interpolation:t._mode,exponent:t._exponent,zoomLevels:t._stops,values:n}),void 0===r)throw new Error("failed to create interpolator")}return i.getPropertyValue(r,e.env)}},step:{isDynamicOperator:e=>e.args[0]&&e.args[0].isDynamic(),call:(e,t)=>{if(function(e){if(void 0!==e._inputIsZoom)return;if(void 0===e.args[0])throw new Error("expected the input of the 'step' operator");if(e.args.length<3||e.args.length%2)throw new Error("not enough arguments");const t=e.args[0];t instanceof n.CallExpr&&"zoom"===t.op?e._inputIsZoom=!0:e._inputIsZoom=!1;for(let t=2;t<e.args.length;t+=2){if(!(e.args[t]instanceof n.NumberLiteralExpr))throw new Error("expected a numeric literal")}}(t),e.scope===n.ExprScope.Value)return t;if(e.scope===n.ExprScope.Condition||!1===t._inputIsZoom)return function(e,t){const{args:r}=t,i=e.evaluate(r[0]);if(null===i)return e.evaluate(r[1]);if("number"!=typeof i)throw new Error("the input of a 'step' operator must have type 'number'");let o=1,s=r.length/2-1;for(;o<s;){const e=o+s>>>1,t=r[2*e].value;i<t?s=e-1:i>t?o=e+1:s=e}const a=r[2*o];if(!(a instanceof n.NumberLiteralExpr))throw new Error("expected a numeric literal");const u=a.value<=i?o:o-1;return e.evaluate(r[2*u+1])}(e,t);!function(e){if(e._stops||e._interpolatedProperty)return;const t=[Number.MIN_SAFE_INTEGER];for(let r=2;r<e.args.length;r+=2){const n=e.args[r];t.push(n.value)}const r=[];let o=!0;for(let t=1;o&&t<e.args.length;t+=2){const i=e.args[t];i instanceof n.LiteralExpr?r.push(i.value):o=!1}if(o){const n=i.createInterpolatedProperty({interpolation:"Discrete",zoomLevels:t,values:r});if(void 0===n)throw new Error("failed to create interpolator");e._interpolatedProperty=n}else e._stops=t}(t);let r=t._interpolatedProperty;if(!r){const n=[];for(let r=1;r<t.args.length;r+=2){const i=e.evaluate(t.args[r]);n.push(i)}if(r=i.createInterpolatedProperty({interpolation:"Discrete",zoomLevels:t._stops,values:n}),void 0===r)throw new Error("failed to create interpolator")}return i.getPropertyValue(r,e.env)}}};t.InterpolationOperators=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);class i extends n.Interpolant{constructor(){super(...arguments),this.exponent=2}interpolate_(e,t,r,n){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,u=a-s,l=Math.pow((r-t)/(n-t),this.exponent),c=1-l;for(let e=0;e!==s;++e)i[e]=o[u+e]*c+o[a+e]*l;return i}}t.ExponentialInterpolant=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1),i={ppi:{call:e=>{const t=e.env.lookup("$ppi");return"number"==typeof t?t:72}},zoom:{isDynamicOperator:()=>!0,call:e=>{if(e.scope===n.ExprScope.Condition){const t=e.env.lookup("$zoom");if(void 0!==t)return t;throw new Error("failed to get the zoom level.")}throw new Error("invalid usage of the 'zoom' operator.")}}};t.MapOperators=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i={"^":{call:(e,t)=>{const r=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof r||"number"!=typeof n)throw new Error(`invalid operands '${typeof r}' and '${typeof n}' for operator '^'`);return Math.pow(r,n)}},"-":{call:(e,t)=>{const r=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof r||"number"!=typeof n)throw new Error(`invalid operands '${typeof r}' and '${typeof n}' for operator '-'`);return r-n}},"/":{call:(e,t)=>{const r=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof r||"number"!=typeof n)throw new Error(`invalid operands '${typeof r}' and '${typeof n}' for operator '/'`);return r/n}},"%":{call:(e,t)=>{const r=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);if("number"!=typeof r||"number"!=typeof n)throw new Error(`invalid operands '${typeof r}' and '${typeof n}' for operator '%'`);return r%n}},"+":{call:(e,t)=>t.args.reduce((t,r)=>Number(t)+Number(e.evaluate(r)),0)},"*":{call:(e,t)=>t.args.reduce((t,r)=>Number(t)*Number(e.evaluate(r)),1)},abs:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'abs'`);return Math.abs(r)}},acos:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'acos'`);return Math.acos(r)}},asin:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'asin'`);return Math.asin(r)}},atan:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'atan'`);return Math.atan(r)}},ceil:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'ceil'`);return Math.ceil(r)}},cos:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'cos'`);return Math.cos(r)}},e:{call:()=>Math.E},floor:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'floor'`);return Math.floor(r)}},ln:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'ln'`);return Math.log(r)}},ln2:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'ln2'`);return Math.log2(r)}},log10:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'log10'`);return Math.log10(r)}},max:{call:(e,t)=>Math.max(...t.args.map(t=>Number(e.evaluate(t))))},min:{call:(e,t)=>Math.min(...t.args.map(t=>Number(e.evaluate(t))))},clamp:{call:(e,t)=>{const r=e.evaluate(t.args[0]),i=e.evaluate(t.args[1]),o=e.evaluate(t.args[2]);if("number"!=typeof r||"number"!=typeof i||"number"!=typeof o)throw new Error(`invalid operands '${r}', ${i}, ${o} for operator 'clamp'`);return n.Math.clamp(r,i,o)}},pi:{call:()=>Math.PI},round:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'round'`);return Math.round(r)}},sin:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'sin'`);return Math.sin(r)}},sqrt:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'sqrt'`);return Math.sqrt(r)}},tan:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if("number"!=typeof r)throw new Error(`invalid operand '${r}' for operator 'tan'`);return Math.tan(r)}}};t.MathOperators=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={length:{call:(e,t)=>{const r=e.evaluate(t.args[0]);if(Array.isArray(r)||"string"==typeof r)return r.length;throw new Error(`invalid operand '${r}' for operator 'length'`)}},coalesce:{call:(e,t)=>{for(const r of t.args){const t=e.evaluate(r);if(null!==t)return t}return null}}};t.MiscOperators=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=Object.prototype.hasOwnProperty;var i;function o(e,t,r){const o=e.evaluate(t[0]);if("string"!=typeof o)throw new Error("expected the name of an attribute");const s=e.evaluate(t[1]);return s&&"object"==typeof s&&n.call(s,o)?r!==i.get||s[o]:r===i.get&&null}!function(e){e[e.get=0]="get",e[e.has=1]="has"}(i||(i={}));const s={get:{call:(e,t)=>o(e,t.args,i.get)},has:{call:(e,t)=>o(e,t.args,i.has)}};t.ObjectOperators=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n={concat:{call:(e,t)=>"".concat(...t.args.map(t=>String(e.evaluate(t))))},downcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleLowerCase()},upcase:{call:(e,t)=>String(e.evaluate(t.args[0])).toLocaleUpperCase()},"~=":{call:(e,t)=>{const r=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return"string"==typeof r&&"string"==typeof n&&-1!==r.indexOf(n)}},"^=":{call:(e,t)=>{const r=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return"string"==typeof r&&"string"==typeof n&&r.startsWith(n)}},"$=":{call:(e,t)=>{const r=e.evaluate(t.args[0]),n=e.evaluate(t.args[1]);return"string"==typeof r&&"string"==typeof n&&r.endsWith(n)}}};t.StringOperators=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TypeOperators={typeof:{call:(e,t)=>typeof e.evaluate(t.args[0])}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);t.ExprInstantiator=class{visitNullLiteralExpr(e,t){return e}visitBooleanLiteralExpr(e,t){return e}visitNumberLiteralExpr(e,t){return e}visitStringLiteralExpr(e,t){return e}visitObjectLiteralExpr(e,t){return e}visitVarExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const r=t.env.lookup(e.name);return n.LiteralExpr.fromValue(void 0!==r?r:null)}visitHasAttributeExpr(e,t){if(t.preserve&&t.preserve.has(e.name))return e;const r=void 0!==t.env.lookup(e.name);return n.LiteralExpr.fromValue(r)}visitContainsExpr(e,t){const r=e.value.accept(this,t);if(r instanceof n.LiteralExpr){const t=e.elements.includes(r.value);return n.LiteralExpr.fromValue(t)}return r===e.value?e:new n.ContainsExpr(r,e.elements)}visitCallExpr(e,t){const r=e.args.map(e=>e.accept(this,t));return r.some((t,r)=>t!==e.args[r])?new n.CallExpr(e.op,r):e}visitMatchExpr(e,t){const r=e.value.accept(this,t);if(r instanceof n.LiteralExpr){const n=r.value;for(const[r,i]of e.branches){if(Array.isArray(r)&&r.includes(n))return i.accept(this,t);if(r===n)return i.accept(this,t)}return e.fallback.accept(this,t)}let i=e.value!==r;const o=e.branches.map(([e,r])=>{const n=r.accept(this,t);return n!==r&&(i=!0),[e,n]}),s=e.fallback.accept(this,t);return s!==e.fallback&&(i=!0),i?new n.MatchExpr(r,o,s):e}visitCaseExpr(e,t){const r=[];let i=!1;for(const[o,s]of e.branches){const e=o.accept(this,t);if(e instanceof n.LiteralExpr){if(e.value)return s.accept(this,t)}else e!==o&&(i=!0),r.push([e,s])}if(0===r.length)return e.fallback.accept(this,t);r.length!==e.branches.length&&(i=!0),r.forEach(e=>{const r=e[1].accept(this,t);r!==e[1]&&(i=!0),e[1]=r});const o=e.fallback.accept(this,t);return o!==e.fallback&&(i=!0),i?new n.CaseExpr(r,o):e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);var i,o;function s(e){switch(e){case i.Tab:case i.Lf:case i.Cr:case i.Space:return!0;default:return!1}}function a(e){return e>=i._0&&e<=i._9}function u(e){return e>=i.a&&e<=i.z||e>=i.A&&e<=i.Z}function l(e){return function(e){return u(e)||a(e)}(e)||e===i._||e===i.Dollar||e===i.Dot||e===i.LBracket||e===i.RBracket}function c(e){switch(e){case o.Eof:return"eof";case o.Error:return"error";case o.Identifier:return"identifier";case o.Number:return"number";case o.String:return"string";case o.Comma:return",";case o.LParen:return"(";case o.RParen:return")";case o.LBracket:return"[";case o.RBracket:return"]";case o.Exclaim:return"!";case o.TildeEqual:return"~=";case o.CaretEqual:return"^=";case o.DollarEqual:return"$=";case o.EqualEqual:return"==";case o.ExclaimEqual:return"!=";case o.Less:return"<";case o.Greater:return">";case o.LessEqual:return"<=";case o.GreaterEqual:return">=";case o.BarBar:return"||";case o.AmpAmp:return"&&";default:throw new Error(`invalid token ${e}`)}}!function(e){e[e.Tab=9]="Tab",e[e.Lf=10]="Lf",e[e.Cr=13]="Cr",e[e.Space=32]="Space",e[e.LParen=40]="LParen",e[e.RParen=41]="RParen",e[e.Comma=44]="Comma",e[e.Dot=46]="Dot",e[e.LBracket=91]="LBracket",e[e.Backslash=92]="Backslash",e[e.RBracket=93]="RBracket",e[e._0=48]="_0",e[e._9=57]="_9",e[e._=95]="_",e[e.A=64]="A",e[e.Z=90]="Z",e[e.a=97]="a",e[e.z=122]="z",e[e.DoubleQuote=34]="DoubleQuote",e[e.SingleQuote=39]="SingleQuote",e[e.Exclaim=33]="Exclaim",e[e.Equal=61]="Equal",e[e.Caret=94]="Caret",e[e.Tilde=126]="Tilde",e[e.Dollar=36]="Dollar",e[e.Less=60]="Less",e[e.Greater=62]="Greater",e[e.Bar=124]="Bar",e[e.Amp=38]="Amp"}(i||(i={})),function(e){e[e.Eof=0]="Eof",e[e.Error=1]="Error",e[e.Identifier=2]="Identifier",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Comma=5]="Comma",e[e.LParen=6]="LParen",e[e.RParen=7]="RParen",e[e.LBracket=8]="LBracket",e[e.RBracket=9]="RBracket",e[e.Exclaim=10]="Exclaim",e[e.TildeEqual=11]="TildeEqual",e[e.CaretEqual=12]="CaretEqual",e[e.DollarEqual=13]="DollarEqual",e[e.EqualEqual=14]="EqualEqual",e[e.ExclaimEqual=15]="ExclaimEqual",e[e.Less=16]="Less",e[e.Greater=17]="Greater",e[e.LessEqual=18]="LessEqual",e[e.GreaterEqual=19]="GreaterEqual",e[e.BarBar=20]="BarBar",e[e.AmpAmp=21]="AmpAmp"}(o||(o={}));class h{constructor(e){this.code=e,this.m_token=o.Error,this.m_index=0,this.m_char=i.Lf}token(){return this.m_token}text(){return this.m_text||""}next(){if(this.m_token=this.yylex(),this.m_token===o.Error)throw new Error(`unexpected character ${this.m_char}`);return this.m_token}yyinp(){this.m_char=this.code.codePointAt(this.m_index++)||0}yylex(){for(this.m_text=void 0;s(this.m_char);)this.yyinp();if(0===this.m_char)return o.Eof;const e=this.m_char;switch(this.yyinp(),e){case i.LParen:return o.LParen;case i.RParen:return o.RParen;case i.LBracket:return o.LBracket;case i.RBracket:return o.RBracket;case i.Comma:return o.Comma;case i.SingleQuote:case i.DoubleQuote:{const t=this.m_index-1;for(;this.m_char&&this.m_char!==e;)this.yyinp();if(this.m_char!==e)throw new Error("Unfinished string literal");return this.yyinp(),this.m_text=this.code.substring(t,this.m_index-2),o.String}case i.Exclaim:return this.m_char===i.Equal?(this.yyinp(),o.ExclaimEqual):o.Exclaim;case i.Caret:return this.m_char===i.Equal?(this.yyinp(),o.CaretEqual):o.Error;case i.Tilde:return this.m_char===i.Equal?(this.yyinp(),o.TildeEqual):o.Error;case i.Equal:return this.m_char===i.Equal?(this.yyinp(),o.EqualEqual):o.Error;case i.Less:return this.m_char===i.Equal?(this.yyinp(),o.LessEqual):o.Less;case i.Greater:return this.m_char===i.Equal?(this.yyinp(),o.GreaterEqual):o.Greater;case i.Bar:return this.m_char===i.Bar?(this.yyinp(),o.BarBar):o.Error;case i.Amp:return this.m_char===i.Amp?(this.yyinp(),o.AmpAmp):o.Error;default:{const t=this.m_index-2;if(u(e)||e===i._||e===i.Dollar&&l(this.m_char)){for(;l(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),o.Identifier}if(a(e)){for(;a(this.m_char);)this.yyinp();if(this.m_char===i.Dot)for(this.yyinp();a(this.m_char);)this.yyinp();return this.m_text=this.code.substring(t,this.m_index-1),o.Number}if(e===i.Dollar)return this.m_char===i.Equal?(this.yyinp(),o.DollarEqual):o.Error}}return o.Error}}function p(e){switch(e){case o.TildeEqual:return"~=";case o.CaretEqual:return"^=";case o.DollarEqual:return"$=";case o.EqualEqual:return"==";case o.ExclaimEqual:return"!=";default:return}}function d(e){switch(e){case o.Less:return"<";case o.Greater:return">";case o.LessEqual:return"<=";case o.GreaterEqual:return">=";default:return}}t.ExprParser=class{constructor(e){this.lex=new h(e),this.lex.next()}parse(){return this.parseLogicalOr()}yyexpect(e){if(this.lex.token()!==e)throw new Error(`Syntax error: Expected token '${c(e)}' but `+`found '${c(this.lex.token())}'`);this.lex.next()}parsePrimary(){switch(this.lex.token()){case o.Identifier:{const e=this.lex.text();switch(e){case"has":this.lex.next(),this.yyexpect(o.LParen);const t=this.lex.text();return this.yyexpect(o.Identifier),this.yyexpect(o.RParen),new n.HasAttributeExpr(t);case"length":this.lex.next(),this.yyexpect(o.LParen);const r=this.parseLogicalOr();return this.yyexpect(o.RParen),new n.CallExpr("length",[r]);default:const i=new n.VarExpr(e);return this.lex.next(),i}}case o.LParen:{this.lex.next();const e=this.parseLogicalOr();return this.yyexpect(o.RParen),e}default:return this.parseLiteral()}}parseLiteral(){switch(this.lex.token()){case o.Number:{const e=new n.NumberLiteralExpr(parseFloat(this.lex.text()));return this.lex.next(),e}case o.String:{const e=new n.StringLiteralExpr(this.lex.text());return this.lex.next(),e}default:throw new Error("Syntax error")}}parseUnary(){return this.lex.token()===o.Exclaim?(this.lex.next(),new n.CallExpr("!",[this.parseUnary()])):this.parsePrimary()}parseRelational(){let e=this.parseUnary();for(;;)if(this.lex.token()===o.Identifier&&"in"===this.lex.text()){this.lex.next(),this.yyexpect(o.LBracket);const t=[this.parseLiteral()];for(;this.lex.token()===o.Comma;)this.lex.next(),t.push(this.parseLiteral());this.yyexpect(o.RBracket),e=new n.ContainsExpr(e,t.map(e=>e.value))}else{const t=d(this.lex.token());if(void 0===t)break;this.lex.next();const r=this.parseUnary();e=new n.CallExpr(t,[e,r])}return e}parseEquality(){let e=this.parseRelational();for(;;){const t=p(this.lex.token());if(void 0===t)break;this.lex.next();const r=this.parseRelational();e=new n.CallExpr(t,[e,r])}return e}parseLogicalAnd(){const e=this.parseEquality();if(this.lex.token()!==o.AmpAmp)return e;const t=[e];do{this.lex.next(),t.push(this.parseEquality())}while(this.lex.token()===o.AmpAmp);return new n.CallExpr("all",t)}parseLogicalOr(){const e=this.parseLogicalAnd();if(this.lex.token()!==o.BarBar)return e;const t=[e];do{this.lex.next(),t.push(this.parseLogicalAnd())}while(this.lex.token()===o.BarBar);return new n.CallExpr("any",t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t,r;e.WORKER_SERVICE_MANAGER_SERVICE_ID="worker-service-manager",function(e){e.Initialized="initialized",e.Request="request",e.Response="response"}(t=e.ServiceMessageName||(e.ServiceMessageName={})),e.isInitializedMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Initialized},function(e){e.CreateService="create-service",e.DestroyService="destroy-service"}(r=e.Requests||(e.Requests={})),e.isUnknownServiceError=function(e){return/unknown targetServiceType requested: /.test(e.message)},e.isRequestMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Request},e.isResponseMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Response}}(t.WorkerServiceProtocol||(t.WorkerServiceProtocol={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){let t;!function(e){e.RegisterIndex="register-index",e.UpdateIndex="update-index",e.TileRequest="tile-request"}(t=e.Requests||(e.Requests={})),e.isRegisterIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.RegisterIndex},e.isUpdateIndexRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.UpdateIndex},e.isTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===t.TileRequest}}(t.WorkerTilerProtocol||(t.WorkerTilerProtocol={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.RequestController=class{constructor(e=0,t=new AbortController){this.priority=e,this.abortController=t}get signal(){return this.abortController.signal}abort(){this.abortController.abort()}},function(e){let t,r;!function(e){e.Configuration="configuration"}(t=e.DecoderMessageName||(e.DecoderMessageName={})),e.isConfigurationMessage=function(e){return e&&"string"==typeof e.service&&"string"==typeof e.type&&e.type===t.Configuration},function(e){e.DecodeTileRequest="decode-tile-request",e.TileInfoRequest="tile-info-request"}(r=e.Requests||(e.Requests={})),e.isDecodeTileRequest=function(e){return e&&"string"==typeof e.type&&e.type===r.DecodeTileRequest},e.isTileInfoRequest=function(e){return e&&"string"==typeof e.type&&e.type===r.TileInfoRequest}}(t.WorkerDecoderProtocol||(t.WorkerDecoderProtocol={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(12),i=r(5),o=r(8),s=r(6),a=r(9),u=r(10),l=r(0);class c extends u.Projection{constructor(){super(...arguments),this.type=u.ProjectionType.Planar}getScaleFactor(e){return 1}worldExtent(e,t,r){return r||(r=s.MathUtils.newEmptyBox3()),r.min.x=-Math.PI,r.min.y=.5*-Math.PI,r.min.z=e,r.max.x=Math.PI,r.max.y=.5*Math.PI,r.max.z=t,r}projectPoint(e,t){return t||(t={x:0,y:0,z:0}),t.x=l.Math.degToRad(e.longitude),t.y=l.Math.degToRad(e.latitude),t.z=e.altitude||0,t}unprojectPoint(e){return i.GeoCoordinates.fromRadians(e.y,e.x,e.z)}unprojectAltitude(e){return e.z}projectBox(e,t){t||(t=s.MathUtils.newEmptyBox3());const r=this.projectPoint(new i.GeoCoordinates(e.south,e.west,e.minAltitude)),n=this.projectPoint(new i.GeoCoordinates(e.north,e.east,e.maxAltitude));return o.isBox3Like(t)?(t.min.x=r.x,t.min.y=r.y,t.min.z=r.z,t.max.x=n.x,t.max.y=n.y,t.max.z=n.z):a.isOrientedBox3Like(t)&&(s.MathUtils.newVector3(1,0,0,t.xAxis),s.MathUtils.newVector3(0,1,0,t.yAxis),s.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(r.x+n.x),t.position.y=.5*(r.y+n.y),t.position.z=.5*(r.z+n.z),t.extents.x=.5*(n.x-r.x),t.extents.y=.5*(n.y-r.y),t.extents.z=Math.max(Number.EPSILON,.5*(n.z-r.z))),t}unprojectBox(e){const t=this.unprojectPoint(e.min),r=this.unprojectPoint(e.max);return n.GeoBox.fromCoordinates(t,r)}groundDistance(e){return e.z}scalePointToSurface(e){return e.z=0,e}surfaceNormal(e,t){return void 0===t?t={x:0,y:0,z:1}:(t.x=0,t.y=0,t.z=1),t}}t.identityProjection=new c(1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(5),i=r(8),o=r(6),s=r(9),a=r(13),u=r(18),l=r(10),c=r(0);function h(e){const t=1/Math.PI,r=Math.floor(2*(e*t+1));return c.Math.clamp(r,0,4)}function p(e){return Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z)}function d(e,t,r){const n=.5*(r+(e.maxAltitude||0)),i=c.Math.degToRad(e.west),o=c.Math.degToRad(e.east),s=h(i),a=h(o);let u=Math.cos(i),l=u,p=Math.sin(i),d=p;for(let e=s+1;e<=a;e++){const t=(e+1&1)*((2&e)-1);u=Math.min(t,u),l=Math.max(t,l);const r=(1&e)*((2&e)-1);p=Math.min(r,p),d=Math.max(r,d)}const f=Math.cos(o);u=Math.min(f,u),l=Math.max(f,l);const m=Math.sin(o);p=Math.min(m,p),d=Math.max(m,d);const g=(l+u)*n,y=(l-u)*n,v=(d+p)*n,x=(d-p)*n,b=c.Math.degToRad(e.south),w=c.Math.degToRad(e.north),T=Math.sin(w),_=Math.sin(b),S=(T+_)*n,E=(T-_)*n;return t.min.x=g-y,t.min.y=v-x,t.min.z=S-E,t.max.x=g+y,t.max.y=v+x,t.max.z=S+E,t}class f extends l.Projection{constructor(){super(...arguments),this.type=l.ProjectionType.Spherical}worldExtent(e,t,r=o.MathUtils.newEmptyBox3()){const n=this.unitScale+t;return r.min.x=-n,r.min.y=-n,r.min.z=-n,r.max.x=n,r.max.y=n,r.max.z=n,r}projectPoint(e,t=o.MathUtils.newVector3(0,0,0)){return function(e,t,r){const n=r+(e.altitude||0),i=c.Math.degToRad(e.latitude),o=c.Math.degToRad(e.longitude),s=Math.cos(i);return t.x=n*s*Math.cos(o),t.y=n*s*Math.sin(o),t.z=n*Math.sin(i),t}(e,t,this.unitScale)}unprojectPoint(e){const t=e.x*e.x+e.y*e.y,r=Math.sqrt(t),i=e.z/r;if(isNaN(i))return n.GeoCoordinates.fromRadians(0,0,-this.unitScale);const o=Math.sqrt(t+e.z*e.z);return n.GeoCoordinates.fromRadians(Math.atan(i),Math.atan2(e.y,e.x),o-this.unitScale)}unprojectAltitude(e){const t=e.x*e.x+e.y*e.y+e.z*e.z;return Math.sqrt(t)-a.EarthConstants.EQUATORIAL_RADIUS}projectBox(e,t=o.MathUtils.newEmptyBox3()){if(i.isBox3Like(t))return d(e,t,this.unitScale);if(s.isOrientedBox3Like(t)){if(e.longitudeSpan>=90){const r=d(e,o.MathUtils.newEmptyBox3(),this.unitScale);return o.MathUtils.newVector3(1,0,0,t.xAxis),o.MathUtils.newVector3(0,1,0,t.yAxis),o.MathUtils.newVector3(0,0,1,t.zAxis),t.position.x=.5*(r.max.x+r.min.x),t.position.y=.5*(r.max.y+r.min.y),t.position.z=.5*(r.max.z+r.min.z),t.extents.x=.5*(r.max.x-r.min.x),t.extents.y=.5*(r.max.y-r.min.y),t.extents.z=.5*(r.max.z-r.min.z),t}const{south:r,west:n,north:i,east:s,center:a}=e,u=a.longitude,l=a.latitude,h=Math.cos(c.Math.degToRad(r)),p=Math.sin(c.Math.degToRad(r)),f=Math.cos(c.Math.degToRad(n)),m=Math.sin(c.Math.degToRad(n)),g=Math.cos(c.Math.degToRad(i)),y=Math.sin(c.Math.degToRad(i)),v=Math.cos(c.Math.degToRad(s)),x=Math.sin(c.Math.degToRad(s)),b=Math.cos(c.Math.degToRad(u)),w=Math.sin(c.Math.degToRad(u)),T=Math.cos(c.Math.degToRad(l)),_=Math.sin(c.Math.degToRad(l));let S,E,M;o.MathUtils.newVector3(b*T,w*T,_,t.zAxis),o.MathUtils.newVector3(-w,b,0,t.xAxis),o.MathUtils.newVector3(-b*_,-w*_,T,t.yAxis),r>=0?(S=Math.abs(h*(b*(m-x)+w*(v-f))),E=T*p-_*h,M=T*y-_*g*(b*v+w*x)):(i<=0?(S=Math.abs(g*(b*(m-x)+w*(v-f))),M=T*y-_*g):(S=Math.abs(b*(m-x)+w*(v-f)),M=T*y-_*g*(w*x+b*v)),E=T*p-_*h*(b*v+w*x));const P=.5*(this.unitScale+(e.maxAltitude||0)),A=.5*(this.unitScale+(e.minAltitude||0)),L=T*(b*v+w*x),I=Math.min(g*L+y*_,h*L+p*_);return o.MathUtils.newVector3(S*P,(M-E)*P,P-I*A,t.extents),o.MathUtils.newVector3(0,(E+M)*P,P+P,t.position),function(e,t,r,n){const i=e.x*n.x+t.x*n.y+r.x*n.z,o=e.y*n.x+t.y*n.y+r.y*n.z,s=e.z*n.x+t.z*n.y+r.z*n.z;n.x=i,n.y=o,n.z=s}(t.xAxis,t.yAxis,t.zAxis,t.position),t.position.x=t.position.x-t.zAxis.x*t.extents.z,t.position.y=t.position.y-t.zAxis.y*t.extents.z,t.position.z=t.position.z-t.zAxis.z*t.extents.z,t}throw new Error("Invalid bounding box")}unprojectBox(e){throw new Error("Method not implemented.")}getScaleFactor(e){return 1}groundDistance(e){return p(e)-this.unitScale}scalePointToSurface(e){const t=this.unitScale/(p(e)||1);return e.x*=t,e.y*=t,e.z*=t,e}surfaceNormal(e,t){void 0===t&&(t={x:0,y:0,z:0});const r=1/(p(e)||1);return t.x=e.x*r,t.y=e.y*r,t.z=e.z*r,t}reprojectPoint(e,t,r){if(e===u.mercatorProjection||e===u.webMercatorProjection){const{x:n,y:i,z:o}=t,s=this.unitScale,a=n/s-Math.PI,l=i/s-Math.PI,c=Math.exp(l),h=c*c,p=2*c/(h+1),d=(h-1)/(h+1),f=s+o;return void 0===r&&(r={}),r.x=Math.cos(a)*p*f,r.y=Math.sin(a)*p*f,r.z=d*f,e===u.webMercatorProjection&&(r.z=-r.z),r}return super.reprojectPoint(e,t,r)}localTangentSpace(e,t){const r=c.Math.degToRad(e.latitude),n=c.Math.degToRad(e.longitude),i=Math.cos(n),s=Math.sin(n),a=Math.cos(r),u=Math.sin(r);return o.MathUtils.newVector3(i*a,s*a,u,t.zAxis),o.MathUtils.newVector3(-s,i,0,t.xAxis),o.MathUtils.newVector3(-i*u,-s*u,a,t.yAxis),this.projectPoint(e,t.position),t}}t.sphereProjection=new f(a.EarthConstants.EQUATORIAL_RADIUS)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(20);t.QuadTree=class{constructor(e){this.tilingScheme=e}visit(e){this.visitTileKey(n.TileKey.fromRowColumnLevel(0,0,0),e)}visitTileKey(e,t){if(t(e,this.tilingScheme.getGeoBox(e)))for(const r of this.tilingScheme.getSubTileKeys(e))this.visitTileKey(r,t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(40),i=r(43),o=r(14);t.hereTilingScheme=new o.TilingScheme(i.halfQuadTreeSubdivisionScheme,n.normalizedEquirectangularProjection)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(18),i=r(19),o=r(14);t.webMercatorTilingScheme=new o.TilingScheme(i.quadTreeSubdivisionScheme,n.webMercatorProjection)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(18),i=r(19),o=r(14);t.mercatorTilingScheme=new o.TilingScheme(i.quadTreeSubdivisionScheme,n.mercatorProjection)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(41),i=r(19),o=r(14);t.polarTilingScheme=new o.TilingScheme(i.quadTreeSubdivisionScheme,n.transverseMercatorProjection)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isVector3Like=function(e){return e&&"number"==typeof e.x&&"number"==typeof e.y&&"number"==typeof e.z}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isTransformLike=function(e){const t=e;return void 0!==t.position&&void 0!==t.xAxis&&void 0!==t.yAxis&&void 0!==t.zAxis}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0);class i{constructor(e,t,r){this.position=new n.Vector3,this.xAxis=new n.Vector3(1,0,0),this.yAxis=new n.Vector3(0,1,0),this.zAxis=new n.Vector3(0,0,1),this.extents=new n.Vector3,void 0!==e&&this.position.copy(e),void 0!==t&&t.extractBasis(this.xAxis,this.yAxis,this.zAxis),void 0!==r&&this.extents.copy(r)}clone(){const e=new i;return e.copy(this),e}copy(e){this.position.copy(e.position),this.xAxis.copy(e.xAxis),this.yAxis.copy(e.yAxis),this.zAxis.copy(e.zAxis),this.extents.copy(e.extents)}getCenter(e=new n.Vector3){return e.copy(this.position)}getSize(e=new n.Vector3){return e.copy(this.extents).multiplyScalar(2)}getRotationMatrix(e=new n.Matrix4){return e.makeBasis(this.xAxis,this.yAxis,this.zAxis)}intersects(e){const t=Array.isArray(e)?e:e.planes;for(const e of t){const t=Math.abs(e.normal.dot(this.xAxis)*this.extents.x)+Math.abs(e.normal.dot(this.yAxis)*this.extents.y)+Math.abs(e.normal.dot(this.zAxis)*this.extents.z);if(e.distanceToPoint(this.position)+t<0)return!1}return!0}contains(e){const t=e.x-this.position.x,r=e.y-this.position.y,n=e.z-this.position.z,i=Math.abs(t*this.xAxis.x+r*this.xAxis.y+n*this.xAxis.z),o=Math.abs(t*this.yAxis.x+r*this.yAxis.y+n*this.yAxis.z),s=Math.abs(t*this.zAxis.x+r*this.zAxis.y+n*this.zAxis.z);return!(i>this.extents.x||o>this.extents.y||s>this.extents.z)}distanceToPoint(e){return Math.sqrt(this.distanceToPointSquared(e))}distanceToPointSquared(e){const t=new n.Vector3;t.subVectors(e,this.position);const r=[t.dot(this.xAxis),t.dot(this.yAxis),t.dot(this.zAxis)];let i=0;for(let e=0;e<3;++e){const t=r[e],n=this.extents.getComponent(e);if(t<-n){const e=n+t;i+=e*e}else if(t>n){const e=t-n;i+=e*e}}return i}}t.OrientedBox3=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(1),o=r(47),s=r(48),a=r(27);var u;!function(e){e[e.Point=0]="Point",e[e.Line=1]="Line",e[e.Polygon=2]="Polygon"}(u=t.FeatureGroupType||(t.FeatureGroupType={}));const l=100;class c{constructor(e,t=5e3){this.featureIds=new Array,this.numFeatures=0,this.numPositions=0,this.featureIds=new Array(t),this.featureIds.length=t,this.techniqueIndex=new Array(t),this.techniqueIndex.length=t,this.textIndex=new Array(t),this.textIndex.length=t,this.positionIndex=new Array(t),this.positionIndex.length=t,this.positions=new Array(10*t),this.positions.length=10*t,e&&(this.layerIndex=new Array(t),this.layerIndex.length=t,this.classIndex=new Array(t),this.classIndex.length=t,this.typeIndex=new Array(t),this.typeIndex.length=t)}getNumBytes(){return 8*(this.featureIds.length+this.techniqueIndex.length+this.textIndex.length+this.positionIndex.length+this.positions.length+(void 0!==this.layerIndex?this.layerIndex.length:0)+(void 0!==this.classIndex?this.classIndex.length:0)+(void 0!==this.typeIndex?this.typeIndex.length:0))}}t.FeatureGroup=c;class h extends c{constructor(){super(...arguments),this.userData=[]}getNumBytes(){return super.getNumBytes()+8*((void 0!==this.segmentIds?this.segmentIds.length:0)+(void 0!==this.segmentStartOffsets?this.segmentStartOffsets.length:0)+(void 0!==this.segmentEndOffsets?this.segmentEndOffsets.length:0))}}t.LineFeatureGroup=h;class p extends c{constructor(e,t=5e3){super(e,t),this.groupNumRings=0,this.outerRingStartIndex=new Array(t),this.outerRingStartIndex.length=t,this.innerRingIsOuterContour=new Array(t),this.innerRingIsOuterContour.length=t,this.innerRingStartIndex=new Array(t),this.innerRingStartIndex.length=t}getNumBytes(){return super.getNumBytes()+8*((void 0!==this.outerRingStartIndex?this.outerRingStartIndex.length:0)+(void 0!==this.innerRingIsOuterContour?this.innerRingIsOuterContour.length:0)+(void 0!==this.innerRingStartIndex?this.innerRingStartIndex.length:0))}}t.PolygonFeatureGroup=p;class d{constructor(e,t){this.tileKey=e,this.textCatalog=new Array,this.techniqueCatalog=new Array,this.setupTime=0,this.numBytes=0,this.pointGroup=new c(t),this.lineGroup=new h(t),this.polygonGroup=new p(t),t&&(this.layerCatalog=new Array,this.classCatalog=new Array,this.typeCatalog=new Array)}getNumBytes(){let e=l;for(const t of this.textCatalog)e+=2*t.length;if(e+=this.techniqueCatalog.length*l,e+=this.pointGroup.getNumBytes(),e+=this.lineGroup.getNumBytes(),e+=this.polygonGroup.getNumBytes(),void 0!==this.layerCatalog){for(const t of this.layerCatalog)e+=2*t.length;for(const t of this.classCatalog)e+=2*t.length;for(const t of this.typeCatalog)e+=2*t.length}return e}}t.ExtendedTileInfo=d,function(e){function t(e){e.featureIds.length=e.numFeatures,e.techniqueIndex.length=e.numFeatures,e.textIndex.length=e.numFeatures,e.positionIndex.length=e.numFeatures,e.positions.length=e.numPositions,void 0!==e.layerIndex&&(e.layerIndex.length=e.numFeatures),void 0!==e.classIndex&&(e.classIndex.length=e.numFeatures),void 0!==e.typeIndex&&(e.typeIndex.length=e.numFeatures)}function r(e){return e.numPositions===e.positions.length}function n(e,t,r,n){let i;if(t){const t=e.lookup("name:short");if("string"==typeof t&&t.length>0)return t}if(r){const t=e.lookup("iso_code");if("string"==typeof t&&t.length>0)return t}if(void 0!==n)for(const t of n)if(i=e.lookup(`name:${t}`)||e.lookup(`name_${t}`),"string"==typeof i&&i.length>0)return i;if(i=e.lookup("name"),"string"==typeof i)return i}e.finish=function(e){var r,n;t(e.pointGroup),t(r=e.lineGroup),void 0!==r.segmentIds&&(r.segmentIds.length=r.numFeatures,r.segmentStartOffsets.length=r.numFeatures,r.segmentEndOffsets.length=r.numFeatures),t(n=e.polygonGroup),n.outerRingStartIndex.length=n.numFeatures,n.innerRingIsOuterContour.length=n.groupNumRings,n.innerRingStartIndex.length=n.groupNumRings,e.numBytes=e.getNumBytes()},e.featureGroupSize=function(e){return e.numFeatures},e.featureGroupFinished=r,e.tileInfoFinished=function(e){return r(e.pointGroup)&&r(e.lineGroup)&&r(e.polygonGroup)},e.getFeatureName=n,e.getFeatureText=function(e,t,r){let o,u;const l=e instanceof i.Env?e:e.env;if(a.isTextTechnique(t)||a.isPoiTechnique(t)||a.isLineMarkerTechnique(t)){if(void 0!==t.text)return s.evaluateTechniqueAttr(e,t.text);if(void 0!==t.label){const e=l.lookup(t.label);return"string"==typeof e?e:void 0}o=t.useAbbreviation,u=t.useIsoCode}return n(l,o,u,r)}}(d=t.ExtendedTileInfo||(t.ExtendedTileInfo={}));t.ExtendedTileInfoWriter=class{constructor(e,t){this.tileInfo=e,this.storeExtendedTags=t,this.techniqueIndexMap=new Map,this.stringMap=new Map,this.layerMap=new Map,this.classMap=new Map,this.typeMap=new Map}addTechnique(e){let t=this.techniqueIndexMap.get(e._index);if(void 0!==t)return t;const r=o.makeDecodedTechnique(e);return t=this.tileInfo.techniqueCatalog.length,this.techniqueIndexMap.set(r._index,t),this.tileInfo.techniqueCatalog.push(r),t}addFeature(e,t,r,i,o,s){let a=-1;switch(void 0!==i&&i.length>0&&(a=this.addText(i)),e.featureIds[e.numFeatures]=r,e.techniqueIndex[e.numFeatures]=o,e.textIndex[e.numFeatures]=a,e.positionIndex[e.numFeatures]=e.numPositions,s){case u.Polygon:const r=e;n.assert(void 0!==r.outerRingStartIndex),n.assert(void 0!==r.innerRingStartIndex),n.assert(void 0!==r.innerRingIsOuterContour),r.outerRingStartIndex[e.numFeatures]=r.groupNumRings;break;case u.Line:e.userData[e.numFeatures]=t.entries}this.storeExtendedTags&&(e.layerIndex[e.numFeatures]=this.addLayer(t.lookup("$layer")),e.classIndex[e.numFeatures]=this.addClass(t.lookup("class")),e.typeIndex[e.numFeatures]=this.addType(t.lookup("type"))),e.numFeatures++}addFeaturePoint(e,t,r){e.positions[e.numPositions++]=t,e.positions[e.numPositions++]=r}addFeaturePoints(e,t){const r=e.numPositions,n=t.length,i=e.positions;for(let e=0;e<n;e++)i[r+e]=t[e];e.numPositions+=t.length}addRoadSegments(e,t,r,n){void 0===e.segmentIds&&(e.segmentIds=new Array,e.segmentStartOffsets=new Array,e.segmentEndOffsets=new Array),e.segmentIds[e.numFeatures-1]=t,e.segmentStartOffsets[e.numFeatures-1]=r,e.segmentEndOffsets[e.numFeatures-1]=n}addRingPoints(e,t,r){e.innerRingStartIndex[e.groupNumRings]=e.numPositions,e.innerRingIsOuterContour[e.groupNumRings]=r?1:0,e.groupNumRings++;const n=e.numPositions,i=t.length,o=e.positions;for(let e=0;e<i;e++)o[n+e]=t[e];e.numPositions+=t.length}finish(){d.finish(this.tileInfo)}addText(e){return this.addStringValue(e,this.tileInfo.textCatalog,this.stringMap)}addLayer(e){return this.addStringValue(e,this.tileInfo.layerCatalog,this.layerMap)}addClass(e){return this.addStringValue(e,this.tileInfo.classCatalog,this.classMap)}addType(e){return this.addStringValue(e,this.tileInfo.typeCatalog,this.typeMap)}addStringValue(e,t,r){if(null==e)return-1;const n=e.toString();let i=r.get(n);return void 0!==i?i:(i=t.length,t.push(n),r.set(n,i),i)}};class f{constructor(e){this.tileInfo=e}visitAll(e){this.visitAllPointFeatures(e),this.visitAllLineFeatures(e),this.visitAllPolygonFeatures(e)}visitFeature(e,t){let r=0;const n=this.tileInfo.pointGroup.numFeatures,i=this.tileInfo.pointGroup.featureIds;for(let o=0;o<n;o++)i[o]===e&&(r++,this.visitPointFeature(o,t));const o=this.tileInfo.lineGroup.numFeatures,s=this.tileInfo.lineGroup.featureIds;for(let n=0;n<o;n++)s[n]===e&&(r++,this.visitLineFeature(n,t));const a=this.tileInfo.polygonGroup.numFeatures,u=this.tileInfo.polygonGroup.featureIds;for(let n=0;n<a;n++)u[n]===e&&(r++,this.visitPolygonFeature(n,t));return r}visitAllPointFeatures(e){const t=this.tileInfo.pointGroup.numFeatures;for(let r=0;r<t;r++)this.visitPointFeature(r,e)}visitAllLineFeatures(e){const t=this.tileInfo.lineGroup.numFeatures;for(let r=0;r<t;r++)this.visitLineFeature(r,e)}visitAllPolygonFeatures(e){const t=this.tileInfo.polygonGroup.numFeatures;for(let r=0;r<t;r++)this.visitPolygonFeature(r,e)}getTag(e,t){return void 0!==t&&t[e]>=0?t[e]:-1}visitPointFeature(e,t){const r=this.tileInfo.pointGroup,n=r.positionIndex[e],i=r.positions[n],o=r.positions[n+1];t.acceptPoint&&t.acceptPoint(r.featureIds[e],r.techniqueIndex[e],i,o,r.textIndex[e],this.getTag(e,r.layerIndex),this.getTag(e,r.classIndex),this.getTag(e,r.typeIndex))}visitLineFeature(e,t){const r=this.tileInfo,n=r.lineGroup,i=n.numFeatures,o=n.positionIndex[e],s=e===i-1?n.positions.length-o:n.positionIndex[e+1]-o;let a,u,l;void 0!==n.segmentIds&&(a=n.segmentIds[e],u=n.segmentStartOffsets[e],l=n.segmentEndOffsets[e]),t.acceptLine&&t.acceptLine(n.featureIds[e],n.techniqueIndex[e],n.textIndex[e],this.getTag(e,n.layerIndex),this.getTag(e,n.classIndex),this.getTag(e,n.typeIndex),r.lineGroup.positions,o,s,a,u,l)}visitPolygonFeature(e,t){if(void 0===t.acceptPolygon)return;const r=this.tileInfo.polygonGroup,n=r.numFeatures,i=r.outerRingStartIndex[e],o=e===n-1?r.innerRingStartIndex.length-i:r.outerRingStartIndex[e+1]-i;f.polygonAccessor.setup(r,e,i,o),t.acceptPolygon(r.featureIds[e],r.techniqueIndex[e],r.textIndex[e],this.getTag(e,r.layerIndex),this.getTag(e,r.classIndex),this.getTag(e,r.typeIndex),f.polygonAccessor),f.polygonAccessor.reset()}}t.ExtendedTileInfoVisitor=f,f.polygonAccessor=new class{constructor(){this.featureIndex=0,this.ringStart=0,this.numRings=0}setup(e,t,r,n){this.polygons=e,this.featureIndex=t,this.ringStart=r,this.numRings=n}reset(){this.polygons=void 0,this.featureIndex=0,this.ringStart=0,this.numRings=0}isOuterRing(e){if(n.assert(e>=0),n.assert(e<this.numRings),n.assert(void 0!==this.polygons),e<0||e>=this.numRings||void 0===this.polygons)throw new Error("ExtendedTileInfoPolygonAccessor: Invalid ring index");return 0!==this.polygons.innerRingIsOuterContour[this.ringStart+e]}getPoints(e){if(n.assert(e>=0),n.assert(e<this.numRings),n.assert(void 0!==this.polygons),e<0||e>=this.numRings||void 0===this.polygons)throw new Error("ExtendedTileInfoPolygonAccessor: Invalid ring index");const t=this.polygons.innerRingStartIndex[this.ringStart+e];let r;return r=e<this.numRings-1?this.polygons.innerRingStartIndex[this.ringStart+e+1]-t:this.ringStart+e<this.polygons.innerRingStartIndex.length-1?this.polygons.innerRingStartIndex[this.ringStart+e+1]-t:this.polygons.positions.length-t,{points:this.polygons.positions,pointsStart:t,numPointValues:r}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);t.ExprPool=class{constructor(){this.m_booleanLiterals=new Map,this.m_numberLiterals=new Map,this.m_stringLiterals=new Map,this.m_objectLiterals=new Map,this.m_varExprs=new Map,this.m_hasAttributeExprs=new Map,this.m_inExprs=new Map,this.m_callExprs=new Map}add(e){return e.accept(this,void 0)}visitNullLiteralExpr(e,t){return n.NullLiteralExpr.instance}visitBooleanLiteralExpr(e,t){const r=this.m_booleanLiterals.get(e.value);return r||(this.m_booleanLiterals.set(e.value,e),e)}visitNumberLiteralExpr(e,t){const r=this.m_numberLiterals.get(e.value);return r||(this.m_numberLiterals.set(e.value,e),e)}visitStringLiteralExpr(e,t){const r=this.m_stringLiterals.get(e.value);return r||(this.m_stringLiterals.set(e.value,e),e)}visitObjectLiteralExpr(e,t){const r=this.m_objectLiterals.get(e.value);return r||(this.m_objectLiterals.set(e.value,e),e)}visitVarExpr(e,t){const r=this.m_varExprs.get(e.name);return r||(this.m_varExprs.set(e.name,e),e)}visitHasAttributeExpr(e,t){const r=this.m_hasAttributeExprs.get(e.name);return r||(this.m_hasAttributeExprs.set(e.name,e),e)}visitContainsExpr(e,t){const r=e.value.accept(this,t);this.m_inExprs.has(r)||this.m_inExprs.set(r,[]);const i=this.m_inExprs.get(r);for(const t of i){if(t.elements.length!==e.elements.length)continue;if(-1===t.elements.findIndex(t=>!e.elements.includes(t)))return t}const o=new n.ContainsExpr(r,e.elements);return this.m_inExprs.set(r,[o]),o}visitMatchExpr(e,t){const r=e.value.accept(this,t),i=e.branches.map(([e,r])=>[e,r.accept(this,t)]),o=e.fallback.accept(this,t);return new n.MatchExpr(r,i,o)}visitCaseExpr(e,t){const r=e.branches.map(([e,r])=>[e.accept(this,t),r.accept(this,t)]),i=e.fallback.accept(this,t);return new n.CaseExpr(r,i)}visitCallExpr(e,t){const r=e.args.map(e=>e.accept(this,t));this.m_callExprs.has(e.op)||this.m_callExprs.set(e.op,[]);const i=this.m_callExprs.get(e.op);for(const e of i){if(e.args.length!==r.length)continue;let t=0;for(;t<e.args.length&&e.args[t]===r[t];++t);if(t===e.args.length)return e}const o=new n.CallExpr(e.op,r);return i.push(o),o}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(1);t.ThemeVisitor=class{constructor(e){this.theme=e}visitStyles(e){const t=t=>!n.isJsonExpr(t)&&!!e(t);if(void 0!==this.theme.styles)for(const e in this.theme.styles)if(void 0!==this.theme.styles[e])for(const r of this.theme.styles[e])if(t(r))return!0;return!1}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(28);t.ThemedTileDecoder=class{constructor(){this.m_storageLevelOffset=0}dispose(){}decodeTile(e,t,r){return void 0===this.m_styleSetEvaluator?Promise.reject(new Error("No style is defined")):this.decodeThemedTile(e,t,this.m_styleSetEvaluator,r)}getTileInfo(e,t,r){return Promise.resolve(void 0)}configure(e,t,r,i){void 0!==e&&(this.m_styleSetEvaluator=new n.StyleSetEvaluator(e,t)),void 0!==r&&(this.languages=r),void 0!==i&&void 0!==i.storageLevelOffset&&(this.m_storageLevelOffset=i.storageLevelOffset)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addExtrudedWalls=function(e,t,r,n,i,o){const s=n.length/r;for(let r=0;r<s;++r){const n=t+2*r,a=n+1,u=t+(r+1)%s*2,l=u+1;!1!==o||void 0===i?e.push(n,a,l,l,u,n):i[r]&&e.push(n,a,l,l,u,n)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=new n.Vector2,o=new n.Vector2,s=new n.Vector2,a=new n.Vector2;t.addPolygonEdges=function(e,t,r,n,u,l,c,h){for(let p=0;p<u.length;++p)if(u[p])if(!0===l){const l=t+2*p,d=l+1,f=t+(p+1)%u.length*2,m=f+1;!0===c&&e.push(l,f),e.push(d,m);const g=(0===p?u.length:p)-1;if(u[g])if(void 0!==h){const t=n[p*r],c=n[p*r+1],f=n[(p+1)%u.length*r],m=n[(p+1)%u.length*r+1];i.set(t,c),o.set(f,m),s.set(n[g*r],n[g*r+1]),a.set(i.x,i.y),a.sub(s).normalize().dot(o.sub(i).normalize())<=h&&e.push(l,d)}else e.push(l,d)}else{const r=t+p,n=t+(p+1)%u.length;e.push(r,n)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(36);!function(e){function t(e){if(e instanceof Int8Array)return"int8";if(e instanceof Uint8Array)return"uint8";if(e instanceof Int16Array)return"int16";if(e instanceof Uint16Array)return"uint16";if(e instanceof Int32Array)return"int32";if(e instanceof Uint32Array)return"uint32";if(e instanceof Float32Array)return"float";throw new Error(`Unsupported buffer type ${name}`)}function r(e){const r=e.array;return{name:e.name,buffer:r.buffer,type:t(r),itemCount:e.itemSize,normalized:e.normalized}}e.getBufferElementType=t,e.fromThreeBufferAttribute=r,e.fromThreeInterleavedBufferAttribute=function(e){throw new Error("Not implemented yet")},e.fromThreeBufferGeometry=function(e,t){const i=[],o=Object.getOwnPropertyNames(e.attributes);for(const t of o){const n=r(e.attributes[t]);n.name=t,i.push(n)}const s=null!==e.index?r(e.index):void 0;let a=0;if(void 0!==s)a=null===e.index?0:e.index.count;else{const t=e.attributes.position;if(void 0===t)throw new Error("Missing position attibute to deduce item count");a=t.count}return{type:n.GeometryType.Unspecified,vertexAttributes:i,index:s,groups:[{start:0,count:a,technique:t}]}}}(t.ThreeBufferUtils||(t.ThreeBufferUtils={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(4),o=r(2),s=r(21),a=o.LoggerManager.instance.create("TileDecoderService");class u extends s.WorkerService{constructor(e,t){super(e),this.serviceId=e,this.m_decoder=t,this.m_decoder.connect()}static start(e,t){return new u(e,t)}handleRequest(e){return n.WorkerDecoderProtocol.isDecodeTileRequest(e)?this.handleDecodeTileRequest(e):n.WorkerDecoderProtocol.isTileInfoRequest(e)?this.handleTileInfoRequest(e):super.handleRequest(e)}handleMessage(e){n.WorkerDecoderProtocol.isConfigurationMessage(e)?this.handleConfigurationMessage(e):a.error(`[${this.serviceId}]: invalid message ${e.type}`)}handleDecodeTileRequest(e){const t=i.TileKey.fromMortonCode(e.tileKey),r=n.getProjection(e.projection);return this.m_decoder.decodeTile(e.data,t,r).then(e=>{const t=[];return e.geometries.forEach(e=>{e.vertexAttributes.forEach(e=>{e.buffer instanceof ArrayBuffer&&t.push(e.buffer)}),e.index&&e.index.buffer instanceof ArrayBuffer&&t.push(e.index.buffer),void 0!==e.objInfos&&1===e.objInfos.length&&void 0!==e.objInfos[0]&&"displacementMap"in e.objInfos[0]&&t.push(e.objInfos[0].displacementMap.buffer)}),e.techniques.forEach(e=>{n.addBuffersToTransferList(e,t)}),{response:e,transferList:t}})}handleTileInfoRequest(e){const t=i.TileKey.fromMortonCode(e.tileKey),r=n.getProjection(e.projection);return this.m_decoder.getTileInfo(e.data,t,r).then(e=>{return{response:e,transferList:void 0!==e&&void 0!==e.transferList?e.transferList:[]}})}handleConfigurationMessage(e){this.m_decoder.configure(e.styleSet,e.definitions,e.languages,e.options)}}t.TileDecoderService=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(4),o=r(50),s=r(21);class a extends s.WorkerService{constructor(e){super(e),this.serviceId=e,this.tiler=new o.GeoJsonTiler}static start(e){return new a(e)}handleRequest(e){return n.WorkerTilerProtocol.isRegisterIndexRequest(e)?this.handleRegisterIndexRequest(e):n.WorkerTilerProtocol.isUpdateIndexRequest(e)?this.handleUpdateIndexRequest(e):n.WorkerTilerProtocol.isTileRequest(e)?this.handleTileRequest(e):super.handleRequest(e)}async handleTileRequest(e){const t=i.TileKey.fromMortonCode(e.tileKey);return{response:await this.tiler.getTile(e.index,t)||{}}}async handleRegisterIndexRequest(e){const t="string"==typeof e.input?new URL(e.input):e.input;return await this.tiler.registerIndex(e.id,t),{response:{}}}async handleUpdateIndexRequest(e){const t="string"==typeof e.input?new URL(e.input):e.input;return this.tiler.updateIndex(e.id,t),{response:{}}}}t.TilerService=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(21);class o extends i.WorkerService{constructor(e=n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID){super(e),this.m_factories=new Map,this.m_services=new Map}static getInstance(){return void 0===this.m_service&&(this.m_service=new o(n.WorkerServiceProtocol.WORKER_SERVICE_MANAGER_SERVICE_ID)),this.m_service}register(e){this.m_factories.set(e.serviceType,e.factory)}handleRequest(e){if(e.type===n.WorkerServiceProtocol.Requests.CreateService){if(void 0!==this.m_services.get(e.targetServiceId))throw Error(`error - service with targetServiceId='${e.targetServiceId}' already running, ignoring CreateService request`);const t=this.m_factories.get(e.targetServiceType);if(void 0===t)throw Error(`unknown targetServiceType requested: '${e.targetServiceType}'`);const r=t(e.targetServiceId);this.m_services.set(e.targetServiceId,r)}if(e.type===n.WorkerServiceProtocol.Requests.DestroyService){const t=this.m_services.get(e.targetServiceId);if(void 0===t)throw Error(`unknown targetServiceId '${e.targetServiceId}'`);t.destroy(),this.m_services.delete(e.targetServiceId)}return Promise.resolve({response:{}})}}t.WorkerServiceManager=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(28),i=r(114),o=r(0),s=r(15),a=r(22),u=r(115);var l;function c(e){return e.kind===l.MoveTo}function h(e){return e.kind===l.LineTo}function p(e){return e.kind===l.ClosePath}function d(e,t){if(e.layers)for(const r of e.layers)t.visitLayer&&!t.visitLayer(r)||f(r,t),t.endVisitLayer&&t.endVisitLayer(r)}function f(e,t){if((!t.visitLayer||t.visitLayer(e))&&e.features)for(const r of e.features)switch(r.type){case u.com.mapbox.pb.Tile.GeomType.UNKNOWN:break;case u.com.mapbox.pb.Tile.GeomType.POINT:t.visitPointFeature&&t.visitPointFeature(r);break;case u.com.mapbox.pb.Tile.GeomType.LINESTRING:t.visitLineFeature&&t.visitLineFeature(r);break;case u.com.mapbox.pb.Tile.GeomType.POLYGON:t.visitPolygonFeature&&t.visitPolygonFeature(r)}t.endVisitLayer&&t.endVisitLayer(e)}!function(e){e[e.MoveTo=1]="MoveTo",e[e.LineTo=2]="LineTo",e[e.ClosePath=7]="ClosePath"}(l=t.CommandKind||(t.CommandKind={})),t.isMoveToCommand=c,t.isLineToCommand=h,t.isClosePathCommand=p,t.visitOmv=d,t.visitOmvLayer=f;class m{accept(e,t,r){const{keys:n,values:i}=e,o=t.tags;if(o&&n&&i)for(let e=0;e<o.length;e+=2){const t=n[o[e]],s=i[o[e+1]];if(!r.visitAttribute(t,s))break}}}t.FeatureAttributes=m;class g{accept(e,t){const r=e.length;let n=0,i=0;const s=[],a=[],u=[];for(let c=0;c<r;){const r=7&e[c],h=e[c]>>3;if(++c,r===l.MoveTo||r===l.LineTo)for(let l=0;l<h;++l){const l=e[c++],h=e[c++];n+=l>>1^-(1&l),i+=h>>1^-(1&h),"Polygon"===t.type&&(s.push(n),a.push(i));const p=new o.Vector2(n,i);u.push({kind:r,position:p})}else{for(const e of u)t.visitCommand(e);t.visitCommand({kind:r}),s.length=0,a.length=0,u.length=0}}if(u.length>0)for(const e of u)t.visitCommand(e)}}t.GeometryCommands=g;const y=["stringValue","floatValue","doubleValue","intValue","uintValue","sintValue","boolValue"];function v(e,t,r={}){const n=new m,o=r||{};return n.accept(e,t,{visitAttribute:(e,t)=>(o[function(e){switch(e){case"id":return"$id";default:return e}}(e)]=function(e){const t=Object.prototype.hasOwnProperty;for(const r of y)if(t.call(e,r)){const t=e[r];if(void 0===t)throw new Error("unpexted undefined value");return i.isLong(t)?t.toNumber():t}throw new Error("not happening")}(t),!0)}),o}function x(e,t,r,o,s,a,u){const l={$layer:e.name,$level:o,$zoom:Math.max(0,o-(s||0)),$geometryType:r};if(void 0!==t.id){const e=function(e,t){if(void 0!==e.id){if("number"==typeof e.id)return e.id;if(i.isLong(e.id))return e.id.greaterThan(Number.MAX_SAFE_INTEGER)&&void 0!==t&&t.error("Invalid ID: Larger than largest available Number in feature: ",e),e.id.toNumber()}}(t,a);void 0!==e&&(l.$id=e)}return v(e,t,l),new n.MapEnv(l,u)}function b(e){if(void 0===e)return s.OmvGeometryType.UNKNOWN;switch(e.type){case u.com.mapbox.pb.Tile.GeomType.UNKNOWN:return s.OmvGeometryType.UNKNOWN;case u.com.mapbox.pb.Tile.GeomType.POINT:return s.OmvGeometryType.POINT;case u.com.mapbox.pb.Tile.GeomType.LINESTRING:return s.OmvGeometryType.LINESTRING;case u.com.mapbox.pb.Tile.GeomType.POLYGON:return s.OmvGeometryType.POLYGON;default:return s.OmvGeometryType.UNKNOWN}}t.OmvProtobufDataAdapter=class{constructor(e,t,r){this.id="omv-protobuf",this.m_geometryCommands=new g,this.m_processor=e,this.m_dataFilter=t,this.m_logger=r}get dataFilter(){return this.m_dataFilter}set dataFilter(e){this.m_dataFilter=e}canProcess(e){return a.isArrayBufferLike(e)}process(e,t){const r=new Uint8Array(e),n=u.com.mapbox.pb.Tile.decode(r);this.m_tileKey=t,d(n,this)}visitLayer(e){this.m_layer=e;const t=this.m_tileKey.level,r=e.name;return!(void 0!==this.m_dataFilter&&!this.m_dataFilter.wantsLayer(r,t))}visitPointFeature(e){if(void 0===e.geometry)return;const t=this.m_tileKey.level,r=this.m_layer.name,n=this.m_layer.extent||4096;if(void 0!==this.m_dataFilter&&!this.m_dataFilter.wantsPointFeature(r,b(e),t))return;const i=[];if(this.m_geometryCommands.accept(e.geometry,{type:"Point",visitCommand:e=>{c(e)&&i.push(e.position)}}),0===i.length)return;const o=x(this.m_layer,e,"point",t,this.m_processor.storageLevelOffset,this.m_logger);this.m_processor.processPointFeature(r,n,i,o,t)}visitLineFeature(e){if(void 0===e.geometry)return;const t=this.m_tileKey.level,r=this.m_layer.name,n=this.m_layer.extent||4096;if(void 0!==this.m_dataFilter&&!this.m_dataFilter.wantsLineFeature(r,b(e),t))return;const i=[];let o;if(this.m_geometryCommands.accept(e.geometry,{type:"Line",visitCommand:e=>{c(e)?(o=[e.position],i.push({positions:o})):h(e)&&o.push(e.position)}}),0===i.length)return;const s=x(this.m_layer,e,"line",t,this.m_processor.storageLevelOffset,this.m_logger);this.m_processor.processLineFeature(r,n,i,s,t)}visitPolygonFeature(e){if(void 0===e.geometry)return;const t=this.m_tileKey.level,r=this.m_layer.name,n=this.m_layer.extent||4096;if(void 0!==this.m_dataFilter&&!this.m_dataFilter.wantsPolygonFeature(r,b(e),t))return;const i=[],o={rings:[]};let s;if(this.m_geometryCommands.accept(e.geometry,{type:"Polygon",visitCommand:e=>{c(e)?s=[e.position]:h(e)?s.push(e.position):p(e)&&o.rings.push(s)}}),o.rings.length>0&&i.push(o),0===i.length)return;const a=x(this.m_layer,e,"polygon",t,this.m_processor.storageLevelOffset,this.m_logger);this.m_processor.processPolygonFeature(r,n,i,a,t)}}},function(e,t){e.exports=n;var r=null;try{r=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}function n(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function i(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=i;var o={},s={};function a(e,t){var r,n,i;return t?(i=0<=(e>>>=0)&&e<256)&&(n=s[e])?n:(r=l(e,(0|e)<0?-1:0,!0),i&&(s[e]=r),r):(i=-128<=(e|=0)&&e<128)&&(n=o[e])?n:(r=l(e,e<0?-1:0,!1),i&&(o[e]=r),r)}function u(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=f)return _}else{if(e<=-m)return S;if(e+1>=m)return T}return e<0?u(-e,t).neg():l(e%d|0,e/d|0,t)}function l(e,t,r){return new n(e,t,r)}n.fromInt=a,n.fromNumber=u,n.fromBits=l;var c=Math.pow;function h(e,t,r){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return y;if("number"==typeof t?(r=t,t=!1):t=!!t,(r=r||10)<2||36<r)throw RangeError("radix");var n;if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return h(e.substring(1),t,r).neg();for(var i=u(c(r,8)),o=y,s=0;s<e.length;s+=8){var a=Math.min(8,e.length-s),l=parseInt(e.substring(s,s+a),r);if(a<8){var p=u(c(r,a));o=o.mul(p).add(u(l))}else o=(o=o.mul(i)).add(u(l))}return o.unsigned=t,o}function p(e,t){return"number"==typeof e?u(e,t):"string"==typeof e?h(e,t):l(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}n.fromString=h,n.fromValue=p;var d=4294967296,f=d*d,m=f/2,g=a(1<<24),y=a(0);n.ZERO=y;var v=a(0,!0);n.UZERO=v;var x=a(1);n.ONE=x;var b=a(1,!0);n.UONE=b;var w=a(-1);n.NEG_ONE=w;var T=l(-1,2147483647,!1);n.MAX_VALUE=T;var _=l(-1,-1,!0);n.MAX_UNSIGNED_VALUE=_;var S=l(0,-2147483648,!1);n.MIN_VALUE=S;var E=n.prototype;E.toInt=function(){return this.unsigned?this.low>>>0:this.low},E.toNumber=function(){return this.unsigned?(this.high>>>0)*d+(this.low>>>0):this.high*d+(this.low>>>0)},E.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(S)){var t=u(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=u(c(e,6),this.unsigned),o=this,s="";;){var a=o.div(i),l=(o.sub(a.mul(i)).toInt()>>>0).toString(e);if((o=a).isZero())return l+s;for(;l.length<6;)l="0"+l;s=""+l+s}},E.getHighBits=function(){return this.high},E.getHighBitsUnsigned=function(){return this.high>>>0},E.getLowBits=function(){return this.low},E.getLowBitsUnsigned=function(){return this.low>>>0},E.getNumBitsAbs=function(){if(this.isNegative())return this.eq(S)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},E.isZero=function(){return 0===this.high&&0===this.low},E.eqz=E.isZero,E.isNegative=function(){return!this.unsigned&&this.high<0},E.isPositive=function(){return this.unsigned||this.high>=0},E.isOdd=function(){return 1==(1&this.low)},E.isEven=function(){return 0==(1&this.low)},E.equals=function(e){return i(e)||(e=p(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&(this.high===e.high&&this.low===e.low)},E.eq=E.equals,E.notEquals=function(e){return!this.eq(e)},E.neq=E.notEquals,E.ne=E.notEquals,E.lessThan=function(e){return this.comp(e)<0},E.lt=E.lessThan,E.lessThanOrEqual=function(e){return this.comp(e)<=0},E.lte=E.lessThanOrEqual,E.le=E.lessThanOrEqual,E.greaterThan=function(e){return this.comp(e)>0},E.gt=E.greaterThan,E.greaterThanOrEqual=function(e){return this.comp(e)>=0},E.gte=E.greaterThanOrEqual,E.ge=E.greaterThanOrEqual,E.compare=function(e){if(i(e)||(e=p(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},E.comp=E.compare,E.negate=function(){return!this.unsigned&&this.eq(S)?S:this.not().add(x)},E.neg=E.negate,E.add=function(e){i(e)||(e=p(e));var t=this.high>>>16,r=65535&this.high,n=this.low>>>16,o=65535&this.low,s=e.high>>>16,a=65535&e.high,u=e.low>>>16,c=0,h=0,d=0,f=0;return d+=(f+=o+(65535&e.low))>>>16,h+=(d+=n+u)>>>16,c+=(h+=r+a)>>>16,c+=t+s,l((d&=65535)<<16|(f&=65535),(c&=65535)<<16|(h&=65535),this.unsigned)},E.subtract=function(e){return i(e)||(e=p(e)),this.add(e.neg())},E.sub=E.subtract,E.multiply=function(e){if(this.isZero())return y;if(i(e)||(e=p(e)),r)return l(r.mul(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned);if(e.isZero())return y;if(this.eq(S))return e.isOdd()?S:y;if(e.eq(S))return this.isOdd()?S:y;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return u(this.toNumber()*e.toNumber(),this.unsigned);var t=this.high>>>16,n=65535&this.high,o=this.low>>>16,s=65535&this.low,a=e.high>>>16,c=65535&e.high,h=e.low>>>16,d=65535&e.low,f=0,m=0,v=0,x=0;return v+=(x+=s*d)>>>16,m+=(v+=o*d)>>>16,v&=65535,m+=(v+=s*h)>>>16,f+=(m+=n*d)>>>16,m&=65535,f+=(m+=o*h)>>>16,m&=65535,f+=(m+=s*c)>>>16,f+=t*d+n*h+o*c+s*a,l((v&=65535)<<16|(x&=65535),(f&=65535)<<16|(m&=65535),this.unsigned)},E.mul=E.multiply,E.divide=function(e){if(i(e)||(e=p(e)),e.isZero())throw Error("division by zero");var t,n,o;if(r)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?l((this.unsigned?r.div_u:r.div_s)(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return b;o=v}else{if(this.eq(S))return e.eq(x)||e.eq(w)?S:e.eq(S)?x:(t=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?x:w:(n=this.sub(e.mul(t)),o=t.add(n.div(e)));if(e.eq(S))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=y}for(n=this;n.gte(e);){t=Math.max(1,Math.floor(n.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(t)/Math.LN2),a=s<=48?1:c(2,s-48),h=u(t),d=h.mul(e);d.isNegative()||d.gt(n);)d=(h=u(t-=a,this.unsigned)).mul(e);h.isZero()&&(h=x),o=o.add(h),n=n.sub(d)}return o},E.div=E.divide,E.modulo=function(e){return i(e)||(e=p(e)),r?l((this.unsigned?r.rem_u:r.rem_s)(this.low,this.high,e.low,e.high),r.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},E.mod=E.modulo,E.rem=E.modulo,E.not=function(){return l(~this.low,~this.high,this.unsigned)},E.and=function(e){return i(e)||(e=p(e)),l(this.low&e.low,this.high&e.high,this.unsigned)},E.or=function(e){return i(e)||(e=p(e)),l(this.low|e.low,this.high|e.high,this.unsigned)},E.xor=function(e){return i(e)||(e=p(e)),l(this.low^e.low,this.high^e.high,this.unsigned)},E.shiftLeft=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l(0,this.low<<e-32,this.unsigned)},E.shl=E.shiftLeft,E.shiftRight=function(e){return i(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?l(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},E.shr=E.shiftRight,E.shiftRightUnsigned=function(e){if(i(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?l(this.low>>>e|t<<32-e,t>>>e,this.unsigned):l(32===e?t:t>>>e-32,0,this.unsigned)},E.shru=E.shiftRightUnsigned,E.shr_u=E.shiftRightUnsigned,E.toSigned=function(){return this.unsigned?l(this.low,this.high,!1):this},E.toUnsigned=function(){return this.unsigned?this:l(this.low,this.high,!0)},E.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},E.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},E.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},function(e,t,r){"use strict";var n,i,o,s=r(116),a=s.Reader,u=s.util,l=s.roots.default||(s.roots.default={});l.com=((o={}).mapbox=((i={}).pb=((n={}).Tile=function(){function e(e){if(this.layers=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}var t,r;return e.prototype.layers=u.emptyArray,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new l.com.mapbox.pb.Tile;e.pos<r;){var i=e.uint32();switch(i>>>3){case 3:n.layers&&n.layers.length||(n.layers=[]),n.layers.push(l.com.mapbox.pb.Tile.Layer.decode(e,e.uint32()));break;default:e.skipType(7&i)}}return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof l.com.mapbox.pb.Tile)return e;var t=new l.com.mapbox.pb.Tile;if(e.layers){if(!Array.isArray(e.layers))throw TypeError(".com.mapbox.pb.Tile.layers: array expected");t.layers=[];for(var r=0;r<e.layers.length;++r){if("object"!=typeof e.layers[r])throw TypeError(".com.mapbox.pb.Tile.layers: object expected");t.layers[r]=l.com.mapbox.pb.Tile.Layer.fromObject(e.layers[r])}}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.layers=[]),e.layers&&e.layers.length){r.layers=[];for(var n=0;n<e.layers.length;++n)r.layers[n]=l.com.mapbox.pb.Tile.Layer.toObject(e.layers[n],t)}return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e.GeomType=(t={},(r=Object.create(t))[t[0]="UNKNOWN"]=0,r[t[1]="POINT"]=1,r[t[2]="LINESTRING"]=2,r[t[3]="POLYGON"]=3,r),e.Value=function(){function e(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.stringValue="",e.prototype.floatValue=0,e.prototype.doubleValue=0,e.prototype.intValue=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.uintValue=u.Long?u.Long.fromBits(0,0,!0):0,e.prototype.sintValue=u.Long?u.Long.fromBits(0,0,!1):0,e.prototype.boolValue=!1,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new l.com.mapbox.pb.Tile.Value;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.stringValue=e.string();break;case 2:n.floatValue=e.float();break;case 3:n.doubleValue=e.double();break;case 4:n.intValue=e.int64();break;case 5:n.uintValue=e.uint64();break;case 6:n.sintValue=e.sint64();break;case 7:n.boolValue=e.bool();break;default:e.skipType(7&i)}}return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof l.com.mapbox.pb.Tile.Value)return e;var t=new l.com.mapbox.pb.Tile.Value;return null!=e.stringValue&&(t.stringValue=String(e.stringValue)),null!=e.floatValue&&(t.floatValue=Number(e.floatValue)),null!=e.doubleValue&&(t.doubleValue=Number(e.doubleValue)),null!=e.intValue&&(u.Long?(t.intValue=u.Long.fromValue(e.intValue)).unsigned=!1:"string"==typeof e.intValue?t.intValue=parseInt(e.intValue,10):"number"==typeof e.intValue?t.intValue=e.intValue:"object"==typeof e.intValue&&(t.intValue=new u.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber())),null!=e.uintValue&&(u.Long?(t.uintValue=u.Long.fromValue(e.uintValue)).unsigned=!0:"string"==typeof e.uintValue?t.uintValue=parseInt(e.uintValue,10):"number"==typeof e.uintValue?t.uintValue=e.uintValue:"object"==typeof e.uintValue&&(t.uintValue=new u.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0))),null!=e.sintValue&&(u.Long?(t.sintValue=u.Long.fromValue(e.sintValue)).unsigned=!1:"string"==typeof e.sintValue?t.sintValue=parseInt(e.sintValue,10):"number"==typeof e.sintValue?t.sintValue=e.sintValue:"object"==typeof e.sintValue&&(t.sintValue=new u.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber())),null!=e.boolValue&&(t.boolValue=Boolean(e.boolValue)),t},e.toObject=function(e,t){t||(t={});var r={};if(t.defaults){if(r.stringValue="",r.floatValue=0,r.doubleValue=0,u.Long){var n=new u.Long(0,0,!1);r.intValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.intValue=t.longs===String?"0":0;u.Long?(n=new u.Long(0,0,!0),r.uintValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n):r.uintValue=t.longs===String?"0":0,u.Long?(n=new u.Long(0,0,!1),r.sintValue=t.longs===String?n.toString():t.longs===Number?n.toNumber():n):r.sintValue=t.longs===String?"0":0,r.boolValue=!1}return null!=e.stringValue&&e.hasOwnProperty("stringValue")&&(r.stringValue=e.stringValue),null!=e.floatValue&&e.hasOwnProperty("floatValue")&&(r.floatValue=t.json&&!isFinite(e.floatValue)?String(e.floatValue):e.floatValue),null!=e.doubleValue&&e.hasOwnProperty("doubleValue")&&(r.doubleValue=t.json&&!isFinite(e.doubleValue)?String(e.doubleValue):e.doubleValue),null!=e.intValue&&e.hasOwnProperty("intValue")&&("number"==typeof e.intValue?r.intValue=t.longs===String?String(e.intValue):e.intValue:r.intValue=t.longs===String?u.Long.prototype.toString.call(e.intValue):t.longs===Number?new u.LongBits(e.intValue.low>>>0,e.intValue.high>>>0).toNumber():e.intValue),null!=e.uintValue&&e.hasOwnProperty("uintValue")&&("number"==typeof e.uintValue?r.uintValue=t.longs===String?String(e.uintValue):e.uintValue:r.uintValue=t.longs===String?u.Long.prototype.toString.call(e.uintValue):t.longs===Number?new u.LongBits(e.uintValue.low>>>0,e.uintValue.high>>>0).toNumber(!0):e.uintValue),null!=e.sintValue&&e.hasOwnProperty("sintValue")&&("number"==typeof e.sintValue?r.sintValue=t.longs===String?String(e.sintValue):e.sintValue:r.sintValue=t.longs===String?u.Long.prototype.toString.call(e.sintValue):t.longs===Number?new u.LongBits(e.sintValue.low>>>0,e.sintValue.high>>>0).toNumber():e.sintValue),null!=e.boolValue&&e.hasOwnProperty("boolValue")&&(r.boolValue=e.boolValue),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e}(),e.Feature=function(){function e(e){if(this.tags=[],this.geometry=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.id=u.Long?u.Long.fromBits(0,0,!0):0,e.prototype.tags=u.emptyArray,e.prototype.type=0,e.prototype.geometry=u.emptyArray,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new l.com.mapbox.pb.Tile.Feature;e.pos<r;){var i=e.uint32();switch(i>>>3){case 1:n.id=e.uint64();break;case 2:if(n.tags&&n.tags.length||(n.tags=[]),2==(7&i))for(var o=e.uint32()+e.pos;e.pos<o;)n.tags.push(e.uint32());else n.tags.push(e.uint32());break;case 3:n.type=e.int32();break;case 4:if(n.geometry&&n.geometry.length||(n.geometry=[]),2==(7&i))for(o=e.uint32()+e.pos;e.pos<o;)n.geometry.push(e.uint32());else n.geometry.push(e.uint32());break;default:e.skipType(7&i)}}return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof l.com.mapbox.pb.Tile.Feature)return e;var t=new l.com.mapbox.pb.Tile.Feature;if(null!=e.id&&(u.Long?(t.id=u.Long.fromValue(e.id)).unsigned=!0:"string"==typeof e.id?t.id=parseInt(e.id,10):"number"==typeof e.id?t.id=e.id:"object"==typeof e.id&&(t.id=new u.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0))),e.tags){if(!Array.isArray(e.tags))throw TypeError(".com.mapbox.pb.Tile.Feature.tags: array expected");t.tags=[];for(var r=0;r<e.tags.length;++r)t.tags[r]=e.tags[r]>>>0}switch(e.type){case"UNKNOWN":case 0:t.type=0;break;case"POINT":case 1:t.type=1;break;case"LINESTRING":case 2:t.type=2;break;case"POLYGON":case 3:t.type=3}if(e.geometry){if(!Array.isArray(e.geometry))throw TypeError(".com.mapbox.pb.Tile.Feature.geometry: array expected");for(t.geometry=[],r=0;r<e.geometry.length;++r)t.geometry[r]=e.geometry[r]>>>0}return t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.tags=[],r.geometry=[]),t.defaults){if(u.Long){var n=new u.Long(0,0,!0);r.id=t.longs===String?n.toString():t.longs===Number?n.toNumber():n}else r.id=t.longs===String?"0":0;r.type=t.enums===String?"UNKNOWN":0}if(null!=e.id&&e.hasOwnProperty("id")&&("number"==typeof e.id?r.id=t.longs===String?String(e.id):e.id:r.id=t.longs===String?u.Long.prototype.toString.call(e.id):t.longs===Number?new u.LongBits(e.id.low>>>0,e.id.high>>>0).toNumber(!0):e.id),e.tags&&e.tags.length){r.tags=[];for(var i=0;i<e.tags.length;++i)r.tags[i]=e.tags[i]}if(null!=e.type&&e.hasOwnProperty("type")&&(r.type=t.enums===String?l.com.mapbox.pb.Tile.GeomType[e.type]:e.type),e.geometry&&e.geometry.length)for(r.geometry=[],i=0;i<e.geometry.length;++i)r.geometry[i]=e.geometry[i];return r},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e}(),e.Layer=function(){function e(e){if(this.features=[],this.keys=[],this.values=[],e)for(var t=Object.keys(e),r=0;r<t.length;++r)null!=e[t[r]]&&(this[t[r]]=e[t[r]])}return e.prototype.version=1,e.prototype.name="",e.prototype.features=u.emptyArray,e.prototype.keys=u.emptyArray,e.prototype.values=u.emptyArray,e.prototype.extent=4096,e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var r=void 0===t?e.len:e.pos+t,n=new l.com.mapbox.pb.Tile.Layer;e.pos<r;){var i=e.uint32();switch(i>>>3){case 15:n.version=e.uint32();break;case 1:n.name=e.string();break;case 2:n.features&&n.features.length||(n.features=[]),n.features.push(l.com.mapbox.pb.Tile.Feature.decode(e,e.uint32()));break;case 3:n.keys&&n.keys.length||(n.keys=[]),n.keys.push(e.string());break;case 4:n.values&&n.values.length||(n.values=[]),n.values.push(l.com.mapbox.pb.Tile.Value.decode(e,e.uint32()));break;case 5:n.extent=e.uint32();break;default:e.skipType(7&i)}}if(!n.hasOwnProperty("version"))throw u.ProtocolError("missing required 'version'",{instance:n});if(!n.hasOwnProperty("name"))throw u.ProtocolError("missing required 'name'",{instance:n});return n},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.fromObject=function(e){if(e instanceof l.com.mapbox.pb.Tile.Layer)return e;var t=new l.com.mapbox.pb.Tile.Layer;if(null!=e.version&&(t.version=e.version>>>0),null!=e.name&&(t.name=String(e.name)),e.features){if(!Array.isArray(e.features))throw TypeError(".com.mapbox.pb.Tile.Layer.features: array expected");t.features=[];for(var r=0;r<e.features.length;++r){if("object"!=typeof e.features[r])throw TypeError(".com.mapbox.pb.Tile.Layer.features: object expected");t.features[r]=l.com.mapbox.pb.Tile.Feature.fromObject(e.features[r])}}if(e.keys){if(!Array.isArray(e.keys))throw TypeError(".com.mapbox.pb.Tile.Layer.keys: array expected");for(t.keys=[],r=0;r<e.keys.length;++r)t.keys[r]=String(e.keys[r])}if(e.values){if(!Array.isArray(e.values))throw TypeError(".com.mapbox.pb.Tile.Layer.values: array expected");for(t.values=[],r=0;r<e.values.length;++r){if("object"!=typeof e.values[r])throw TypeError(".com.mapbox.pb.Tile.Layer.values: object expected");t.values[r]=l.com.mapbox.pb.Tile.Value.fromObject(e.values[r])}}return null!=e.extent&&(t.extent=e.extent>>>0),t},e.toObject=function(e,t){t||(t={});var r={};if((t.arrays||t.defaults)&&(r.features=[],r.keys=[],r.values=[]),t.defaults&&(r.name="",r.extent=4096,r.version=1),null!=e.name&&e.hasOwnProperty("name")&&(r.name=e.name),e.features&&e.features.length){r.features=[];for(var n=0;n<e.features.length;++n)r.features[n]=l.com.mapbox.pb.Tile.Feature.toObject(e.features[n],t)}if(e.keys&&e.keys.length)for(r.keys=[],n=0;n<e.keys.length;++n)r.keys[n]=e.keys[n];if(e.values&&e.values.length)for(r.values=[],n=0;n<e.values.length;++n)r.values[n]=l.com.mapbox.pb.Tile.Value.toObject(e.values[n],t);return null!=e.extent&&e.hasOwnProperty("extent")&&(r.extent=e.extent),null!=e.version&&e.hasOwnProperty("version")&&(r.version=e.version),r},e.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},e}(),e}(),n),i),o),e.exports=l},function(e,t,r){"use strict";e.exports=r(117)},function(e,t,r){"use strict";var n=t;function i(){n.Reader._configure(n.BufferReader),n.util._configure()}n.build="minimal",n.Writer=r(52),n.BufferWriter=r(127),n.Reader=r(53),n.BufferReader=r(128),n.util=r(7),n.rpc=r(129),n.roots=r(131),n.configure=i,n.Writer._configure(n.BufferWriter),i()},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";e.exports=function(e,t){var r=new Array(arguments.length-1),n=0,i=2,o=!0;for(;i<arguments.length;)r[n++]=arguments[i++];return new Promise((function(i,s){r[n]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=new Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}};try{e.apply(t||null,r)}catch(e){o&&(o=!1,s(e))}}))}},function(e,t,r){"use strict";var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var i=new Array(64),o=new Array(123),s=0;s<64;)o[i[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;n.encode=function(e,t,r){for(var n,o=null,s=[],a=0,u=0;t<r;){var l=e[t++];switch(u){case 0:s[a++]=i[l>>2],n=(3&l)<<4,u=1;break;case 1:s[a++]=i[n|l>>4],n=(15&l)<<2,u=2;break;case 2:s[a++]=i[n|l>>6],s[a++]=i[63&l],u=0}a>8191&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return u&&(s[a++]=i[n],s[a++]=61,1===u&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))};n.decode=function(e,t,r){for(var n,i=r,s=0,a=0;a<e.length;){var u=e.charCodeAt(a++);if(61===u&&s>1)break;if(void 0===(u=o[u]))throw Error("invalid encoding");switch(s){case 0:n=u,s=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,s=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,s=3;break;case 3:t[r++]=(3&n)<<6|u,s=0}}if(1===s)throw Error("invalid encoding");return r-i},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},function(e,t,r){"use strict";function n(){this._listeners={}}e.exports=n,n.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},n.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},n.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},function(e,t,r){"use strict";function n(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function o(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function a(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:o,e.writeFloatBE=n?o:i,e.readFloatLE=n?s:a,e.readFloatBE=n?a:s}():function(){function t(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,r,n)}}function r(e,t,r){var n=e(t,r),i=2*(n>>31)+1,o=n>>>23&255,s=8388607&n;return 255===o?s?NaN:i*(1/0):0===o?1401298464324817e-60*i*s:i*Math.pow(2,o-150)*(s+8388608)}e.writeFloatLE=t.bind(null,i),e.writeFloatBE=t.bind(null,o),e.readFloatLE=r.bind(null,s),e.readFloatBE=r.bind(null,a)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function o(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function s(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function a(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:o,e.writeDoubleBE=n?o:i,e.readDoubleLE=n?s:a,e.readDoubleBE=n?a:s}():function(){function t(e,t,r,n,i,o){var s=n<0?1:0;if(s&&(n=-n),0===n)e(0,i,o+t),e(1/n>0?0:2147483648,i,o+r);else if(isNaN(n))e(0,i,o+t),e(2146959360,i,o+r);else if(n>17976931348623157e292)e(0,i,o+t),e((s<<31|2146435072)>>>0,i,o+r);else{var a;if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,o+t),e((s<<31|a/4294967296)>>>0,i,o+r);else{var u=Math.floor(Math.log(n)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(a=n*Math.pow(2,-u))>>>0,i,o+t),e((s<<31|u+1023<<20|1048576*a&1048575)>>>0,i,o+r)}}}function r(e,t,r,n,i){var o=e(n,i+t),s=e(n,i+r),a=2*(s>>31)+1,u=s>>>20&2047,l=4294967296*(1048575&s)+o;return 2047===u?l?NaN:a*(1/0):0===u?5e-324*a*l:a*Math.pow(2,u-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,i,0,4),e.writeDoubleBE=t.bind(null,o,4,0),e.readDoubleLE=r.bind(null,s,0,4),e.readDoubleBE=r.bind(null,a,4,0)}(),e}function i(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function o(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function s(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function a(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=n(n)},function(module,exports,__webpack_require__){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},function(e,t,r){"use strict";var n=t;n.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:55296==(64512&r)&&56320==(64512&e.charCodeAt(n+1))?(++n,t+=4):t+=3;return t},n.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,o=[],s=0;t<r;)(n=e[t++])<128?o[s++]=n:n>191&&n<224?o[s++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(n>>10),o[s++]=56320+(1023&n)):o[s++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},n.write=function(e,t,r){for(var n,i,o=r,s=0;s<e.length;++s)(n=e.charCodeAt(s))<128?t[r++]=n:n<2048?(t[r++]=n>>6|192,t[r++]=63&n|128):55296==(64512&n)&&56320==(64512&(i=e.charCodeAt(s+1)))?(n=65536+((1023&n)<<10)+(1023&i),++s,t[r++]=n>>18|240,t[r++]=n>>12&63|128,t[r++]=n>>6&63|128,t[r++]=63&n|128):(t[r++]=n>>12|224,t[r++]=n>>6&63|128,t[r++]=63&n|128);return r-o}},function(e,t,r){"use strict";e.exports=function(e,t,r){var n=r||8192,i=n>>>1,o=null,s=n;return function(r){if(r<1||r>i)return e(r);s+r>n&&(o=e(n),s=0);var a=t.call(o,s,s+=r);return 7&s&&(s=1+(7|s)),a}}},function(e,t,r){"use strict";e.exports=i;var n=r(7);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var o=i.zero=new i(0,0);o.toNumber=function(){return 0},o.zzEncode=o.zzDecode=function(){return this},o.length=function(){return 1};var s=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return o;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e)){if(!n.Long)return i.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):o},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;i.fromHash=function(e){return e===s?o:new i((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},function(e,t,r){"use strict";e.exports=s;var n=r(52);(s.prototype=Object.create(n.prototype)).constructor=s;var i=r(7),o=i.Buffer;function s(){n.call(this)}s.alloc=function(e){return(s.alloc=i._Buffer_allocUnsafe)(e)};var a=o&&o.prototype instanceof Uint8Array&&"set"===o.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]};function u(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write(e,r)}s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(a,t,e),this},s.prototype.string=function(e){var t=o.byteLength(e);return this.uint32(t),t&&this._push(u,t,e),this}},function(e,t,r){"use strict";e.exports=o;var n=r(53);(o.prototype=Object.create(n.prototype)).constructor=o;var i=r(7);function o(e){n.call(this,e)}i.Buffer&&(o.prototype._slice=i.Buffer.prototype.slice),o.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len))}},function(e,t,r){"use strict";t.Service=r(130)},function(e,t,r){"use strict";e.exports=i;var n=r(7);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(r)}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,o,s){if(!o)throw TypeError("request must be specified");var a=this;if(!s)return n.asPromise(e,a,t,r,i,o);if(a.rpcImpl)try{return a.rpcImpl(t,r[a.requestDelimited?"encodeDelimited":"encode"](o).finish(),(function(e,r){if(e)return a.emit("error",e,t),s(e);if(null!==r){if(!(r instanceof i))try{r=i[a.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return a.emit("error",e,t),s(e)}return a.emit("data",r,t),s(null,r)}a.end(!0)}))}catch(e){return a.emit("error",e,t),void setTimeout((function(){s(e)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},function(e,t,r){"use strict";e.exports={}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(133),o=r(134),s=r(2),a=r(135),u=r(0),l=r(4),c=r(23),h=r(22),p=r(48),d=r(136),f=s.LoggerManager.instance.create("OmvDecodedTileEmitter"),m=new u.Vector3,g=new u.Vector3,y=new u.Vector3,v=new u.Vector3,x=new u.Vector3,b=new u.Vector2,w=new u.Vector2,T=new u.Vector3,_=new u.Vector3,S=new u.Vector2,E=new u.Vector2,M=new u.Vector2,P=new u.Vector3,A=new u.Vector3,L=new u.Vector3,I=new u.Vector3,O=new u.Vector3,q=new u.Line3,C=1e-18,R=5,F=.5,j=Math.PI/8,z=-1;class G{constructor(e){this.type=e,this.positions=[],this.normals=[],this.textureCoordinates=[],this.colors=[],this.extrusionAxis=[],this.indices=[],this.edgeIndices=[],this.groups=[],this.texts=[],this.pathLengths=[],this.stringCatalog=[],this.imageTextures=[],this.featureStarts=[],this.objInfos=[]}addText(e){let t=this.stringCatalog.indexOf(e);return t<0&&(t=this.stringCatalog.length,this.stringCatalog.push(e)),t}}var k;!function(e){e[e.Simple=0]="Simple",e[e.Complex=1]="Complex"}(k=t.LineType||(t.LineType={}));const N=new u.Color;t.OmvDecodedTileEmitter=class{constructor(e,t,r,n,i,o){this.m_decodeInfo=e,this.m_styleSetEvaluator=t,this.m_gatherFeatureAttributes=r,this.m_skipShortLabels=n,this.m_enableElevationOverlay=i,this.m_languages=o,this.m_meshBuffers=new Map,this.m_geometries=[],this.m_textGeometries=[],this.m_textPathGeometries=[],this.m_pathGeometries=[],this.m_poiGeometries=[],this.m_simpleLines=[],this.m_solidLines=[],this.m_sources=[],this.m_maxGeometryHeight=0}get projection(){return this.m_decodeInfo.targetProjection}get center(){return this.m_decodeInfo.center}processPointFeature(e,t,r,i,o,s){const a=i.env;this.processFeatureCommon(a);for(const e of o){if(void 0===e)continue;const o=e._index,s=this.findOrCreateMeshBuffers(o,n.GeometryType.Point);if(void 0===s)continue;const{positions:u,texts:l,imageTextures:c,objInfos:d}=s,f=n.isTextTechnique(e)||n.isPoiTechnique(e);let m;const g=n.isPoiTechnique(e);if(g){const t=e;if(m=p.evaluateTechniqueAttr(i,t.imageTexture),void 0!==t.poiName)m=p.evaluateTechniqueAttr(i,t.poiName);else if("string"==typeof t.poiNameField){m=a.lookup(t.poiNameField)}else if("string"==typeof t.imageTextureField){const e=a.lookup(t.imageTextureField);m=n.composeTechniqueTextureName(e,t)}}for(const o of r){if(f){const t=e,r=n.ExtendedTileInfo.getFeatureText(i,t,this.m_languages);void 0!==r&&r.length>0?l.push(s.addText(r)):l.push(z)}f?h.webMercatorTile2TargetWorld(t,this.m_decodeInfo,o,T):h.webMercatorTile2TargetTile(t,this.m_decodeInfo,o,T),u.push(T.x,T.y,T.z),d.push(this.m_gatherFeatureAttributes?a.entries:n.getFeatureId(a.entries)),g&&(void 0===m?c.push(z):c.push(s.addText(m)))}}}processLineFeature(e,t,r,i,a,l){const c=i.env;this.processFeatureCommon(c);const d=[],m=[],g=[],y=[],{projectedTileBounds:v}=this.m_decodeInfo,x=v.max.x-v.min.x,b=v.max.y-v.min.y,w=Math.max(x,b);let S,E;const M=void 0!==r[0].untiledPositions;for(const e of a)if(void 0!==e)if(S){const t=this.getTextureCoordinateType(e);s.assert(void 0===t||E===t)}else S=this.getComputeTexCoordsFunc(e),E=this.getTextureCoordinateType(e);for(const e of r){const r=[];let n=0;M&&(this.m_decodeInfo.targetProjection.projectPoint(e.untiledPositions[0],_),e.untiledPositions.forEach(e=>{this.m_decodeInfo.targetProjection.projectPoint(e,T),n+=T.distanceTo(_),_.copy(T),this.m_decodeInfo.targetProjection.projectPoint(e.normalized(),T),r.push(T.x,T.y,T.z,n)}));const i=[],o=[],s=[],a=[];e.positions.forEach(e=>{if(h.webMercatorTile2TargetWorld(t,this.m_decodeInfo,e,T),o.push(T.x,T.y,T.z),S){const{u:r,v:n}=S(e,t);s.push(r,n)}if(M){const e=this.findRelativePositionInLine(T,r)/n;a.push(e)}T.sub(this.m_decodeInfo.center),i.push(T.x,T.y,T.z)}),d.push(i),m.push(o),g.push(s),y.push(a)}const P=this.m_decodeInfo.tileKey.level>=11;for(const e of a){if(void 0===e)continue;const t=e._index,r=e.name;if(n.isLineTechnique(e)||n.isSolidLineTechnique(e)){const r=n.isLineTechnique(e)?this.m_simpleLines:this.m_solidLines,o=n.isLineTechnique(e)?k.Simple:k.Complex;this.applyLineTechnique(r,e,t,o,c.entries,d,i,this.getTextureCoordinateType(e)?g:void 0,M?y:void 0)}else if(n.isTextTechnique(e)||n.isPoiTechnique(e)||n.isLineMarkerTechnique(e)){const r=e,o=n.ExtendedTileInfo.getFeatureText(i,r,this.m_languages);if(void 0===o||0===o.length)continue;let a=[];if(this.m_skipShortLabels){const e=w/this.m_decodeInfo.tileSizeOnScreen,t=R*o.length*e*F,r=t*t;a=this.splitJaggyLines(m,r,j)}else a=m;if(0===a.length)continue;if(n.isTextTechnique(e)){if(void 0===o)continue;for(const e of a){const r=s.Math2D.computeSquaredLineLength(e);this.m_textPathGeometries.push({technique:t,path:e,pathLengthSqr:r,text:String(o),objInfos:this.m_gatherFeatureAttributes?c.entries:n.getFeatureId(c.entries)})}}else{const r=e;let s=p.evaluateTechniqueAttr(i,r.imageTexture);if("string"==typeof r.imageTextureField){s=c.lookup(r.imageTextureField),"string"==typeof r.imageTexturePrefix&&(s=r.imageTexturePrefix+s),"string"==typeof r.imageTexturePostfix&&(s+=r.imageTexturePostfix)}for(const e of a)this.m_poiGeometries.push({technique:t,positions:{name:"position",type:"float",buffer:new Float32Array(e).buffer,itemCount:3},texts:[0],stringCatalog:[o,s],imageTextures:[1],objInfos:this.m_gatherFeatureAttributes?[c.entries]:[n.getFeatureId(c.entries)]})}}else if(n.isLabelRejectionLineTechnique(e))for(const e of m){const t=[];for(let r=0;r<e.length;r+=3)t.push((new u.Vector3).fromArray(e,r));this.m_pathGeometries.push({path:t})}else if(n.isExtrudedLineTechnique(e)){const r=this.findOrCreateMeshBuffers(t,n.GeometryType.ExtrudedLine);if(void 0===r)continue;const{positions:s,indices:a,groups:u,featureStarts:h,objInfos:f}=r,m=a.length,g=p.evaluateTechniqueAttr(i,e.lineWidth);if(void 0===g)continue;const y=p.evaluateTechniqueAttr(i,e.caps,"Circle"),v=P&&"Circle"===y;d.forEach(e=>{o.triangulateLine(e,g,s,a,v),h.push(m),f.push(this.m_gatherFeatureAttributes?c.entries:n.getFeatureId(c.entries))});const x=a.length-m;u.push({start:m,count:x,technique:t,featureId:l})}else f.warn(`OmvDecodedTileEmitter#processLineFeature: Invalid line technique\n                     ${r} for layer: ${c.entries.$layer} `)}}processPolygonFeature(e,t,r,i,o,s){const a=i.env;this.processFeatureCommon(a),o.forEach(e=>{if(void 0===e)return;const o=e._index;if(void 0===o)throw new Error("OmvDecodedTileEmitter#processPolygonFeature: Internal error - No technique index");const u=[],l=n.isExtrudedPolygonTechnique(e),p=n.isFillTechnique(e),d=l||p||n.isStandardTechnique(e),f=this.getComputeTexCoordsFunc(e),m=void 0!==f?4:2;for(const e of r){const r=[];for(const n of e.rings){const e=[];for(const r of n)if(e.push(r.x,r.y),void 0!==f){const{u:n,v:i}=f(r,t);e.push(n,i)}r.push(new c.Ring(t,m,e))}u.push(r)}const g=n.isSolidLineTechnique(e)||n.isLineTechnique(e);if(d)this.applyPolygonTechnique(u,e,o,s,i,t);else if(g){const r="line"===e.name?this.m_simpleLines:this.m_solidLines,n="line"===e.name?k.Simple:k.Complex;u.forEach(s=>{const u=[];s.forEach(e=>{const r=e.contour.length/e.vertexStride;let n=[];for(let i=0;i<r;++i){const o=(i+1)%r,s=e.contour[i*e.vertexStride],a=e.contour[i*e.vertexStride+1],l=e.contour[o*e.vertexStride],c=e.contour[o*e.vertexStride+1],p=!(s<=0&&l<=0||s>=e.extents&&l>=e.extents||a<=0&&c<=0||a>=e.extents&&c>=e.extents);p||0===n.length?p&&0===n.length&&(h.webMercatorTile2TargetTile(t,this.m_decodeInfo,b.set(s,a),T),n.push(T.x,T.y,T.z)):(u.push(n),n=[]),p&&(h.webMercatorTile2TargetTile(t,this.m_decodeInfo,b.set(l,c),T),n.push(T.x,T.y,T.z))}n.length&&u.push(n)}),0!==u.length&&this.applyLineTechnique(r,e,o,n,a.entries,u,i)})}})}getDecodedTile(){this.createGeometries(),this.processSimpleLines(this.m_simpleLines),this.processLines(this.m_solidLines);const e={techniques:this.m_styleSetEvaluator.decodedTechniques,geometries:this.m_geometries,decodeTime:void 0};return this.m_textGeometries.length>0&&(e.textGeometries=this.m_textGeometries),this.m_poiGeometries.length>0&&(e.poiGeometries=this.m_poiGeometries),this.m_textPathGeometries.length>0&&(e.textPathGeometries=this.m_textPathGeometries),this.m_pathGeometries.length>0&&(e.pathGeometries=this.m_pathGeometries),0!==this.m_sources.length&&(e.copyrightHolderIds=this.m_sources),e.maxGeometryHeight=this.m_maxGeometryHeight,e}splitJaggyLines(e,t,r){const n=[],i=(e,t,r)=>{let n=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;for(let a=t;a<r;a+=3){const t=e[a],r=e[a+1];t<n&&(n=t),t>i&&(i=t),r<o&&(o=r),r>s&&(s=r)}return(i-n)*(i-n)+(s-o)*(s-o)},o=e.slice();for(;o.length>0;){const e=o.pop();if(void 0===e||e.length<6)continue;let s=-1;for(let t=0;t<e.length-3;t+=3){S.set(e[t],e[t+1]),E.set(e[t+3],e[t+4]);const n=E.sub(S).normalize();if(t>0){const e=Math.atan2(M.x*n.y-n.x*M.y,n.dot(M));if(Math.abs(e)>r){s=t;break}}M.set(n.x,n.y)}if(s>0){const r=i(e,0,s+3),a=i(e,s,e.length);r>t&&n.push(e.slice(0,s+3)),a>t&&o.push(e.slice(s))}else{i(e,0,e.length)>t&&n.push(e)}}return n}getTextureCoordinateType(e){return(n.isFillTechnique(e)||n.isSolidLineTechnique(e)||n.isExtrudedPolygonTechnique(e))&&this.m_enableElevationOverlay?n.TextureCoordinateType.TileSpace:n.textureCoordinateType(e)}getComputeTexCoordsFunc(e){const t=this.getTextureCoordinateType(e);return t===n.TextureCoordinateType.TileSpace?(e,t)=>{const{x:r,y:n}=(new u.Vector2).copy(e).divideScalar(t);return{u:r,v:1-n}}:t===n.TextureCoordinateType.EquirectangularSpace?(e,t)=>{const r=h.tile2world(t,this.m_decodeInfo,e,!1,w),{x:n,y:i}=l.normalizedEquirectangularProjection.reprojectPoint(l.webMercatorProjection,new u.Vector3(r.x,r.y,0));return{u:n,v:i}}:void 0}applyLineTechnique(e,t,r,o=k.Complex,s,a,u,l,c){const h=p.evaluateTechniqueAttr(u,t.renderOrderOffset,0);let d;const f=e.find(e=>e.technique===r&&e.renderOrderOffset===h),m=void 0!==l;if(void 0===f){d=new i.LineGroup(m,void 0,o===k.Simple);const a={type:o===k.Complex?n.GeometryType.SolidLine:n.GeometryType.Line,technique:r,renderOrderOffset:void 0!==h?Number(h):void 0,lines:d};!p.evaluateTechniqueAttr(u,t.transient,!1)&&this.m_gatherFeatureAttributes&&(a.objInfos=[s],a.featureStarts=[0]),e.push(a)}else d=f.lines,this.m_gatherFeatureAttributes&&f.objInfos&&f.featureStarts&&(f.objInfos.push(s),f.featureStarts.push(d.indices.length));let g=0;a.forEach(e=>{d.add(this.m_decodeInfo.center,e,c?c[g]:void 0,l?l[g]:void 0),g++})}applyPolygonTechnique(e,t,r,i,o,c){const _=n.isExtrudedPolygonTechnique(t),S=_?n.GeometryType.ExtrudedPolygon:n.GeometryType.Polygon,E=this.findOrCreateMeshBuffers(r,S);if(void 0===E)return;const M=t,P=t,A=!1!==M.boundaryWalls,L=n.isFillTechnique(t),I=this.getTextureCoordinateType(t);let O=p.evaluateTechniqueAttr(o,M.height),q=p.evaluateTechniqueAttr(o,M.floorHeight);if(void 0===O){const e=o.env.lookup("height"),t=p.evaluateTechniqueAttr(o,M.defaultHeight);O=void 0!==e?e:void 0!==t?t:0}if(void 0===q){const e=o.env.lookup("min_height");q=void 0===e||L?0:e}O===q&&(O+=C);const R=s.getOptionValue(M.constantHeight,!1);this.m_decodeInfo.tileBounds.getCenter(m);const{positions:F,normals:j,textureCoordinates:z,colors:G,extrusionAxis:k,indices:V,edgeIndices:D,groups:B}=E,U=void 0!==I?4:2,$=U+2,W=this.m_decodeInfo.targetProjection.type===l.ProjectionType.Spherical,K=(_?M.lineWidth||0:L&&P.lineWidth||0)>0;let H;if(n.isExtrudedPolygonTechnique(t)&&s.getOptionValue(t.vertexColors,!1)){let e=p.evaluateTechniqueAttr(o,t.color);if(void 0===e){const t=o.env.lookup("color");this.isColorStringValid(t)&&(e=String(t))}void 0===e&&(e=p.evaluateTechniqueAttr(o,t.defaultColor,0)),void 0===e&&(e=0),N.set(e),H=N}for(const t of e){const e=V.length;for(let e=0;e<t.length;){const r=[],n=F.length/3,{contour:i,winding:o}=t[e++];for(let e=0;e<i.length/U;++e){for(let t=0;t<U;++t)r.push((1===t?-1:1)*i[e*U+t]);const t=(e+1)%(i.length/U),n=i[e*U],o=i[e*U+1],s=i[t*U],a=i[t*U+1],u=!(n<=0&&s<=0||n>=c&&s>=c||o<=0&&a<=0||o>=c&&a>=c);r.push(u?t:-1,A||u?t:-1)}const s=[];for(;e<t.length&&t[e].winding!==o;){const n=r.length/$;s.push(n);const i=t[e++].contour;for(let e=0;e<i.length/U;++e){for(let t=0;t<U;++t)r.push((1===t?-1:1)*i[e*U+t]);const t=(e+1)%(i.length/U),o=i[e*U],s=i[e*U+1],a=i[t*U],u=i[t*U+1],l=!(o<=0&&a<=0||o>=c&&a>=c||s<=0&&u<=0||s>=c&&u>=c);r.push(l?n+t:-1,A||l?n+t:-1)}}try{const e=a.default(r,s,$),t=r.length/$;if(W){const t=new u.BufferGeometry,n=[],i=[],o=[],s=[];for(let e=0;e<r.length;e+=$){const t=h.tile2world(c,this.m_decodeInfo,b.set(r[e],r[e+1]),!0,w);n.push(t.x,t.y,0),void 0!==I&&i.push(r[e+2],r[e+3]),o.push(r[e+U]),s.push(r[e+U+1])}const a=new u.BufferAttribute(new Float32Array(n),3);let p;t.setAttribute("position",a),void 0!==I&&(p=new u.BufferAttribute(new Float32Array(i),2),t.setAttribute("uv",p));const f=new u.BufferAttribute(new Float32Array(o),1);t.setAttribute("edge",f);const m=new u.BufferAttribute(new Float32Array(s),1);t.setAttribute("wall",f);const g=new u.BufferAttribute(new Uint32Array(e),1);t.setIndex(g),new d.SphericalGeometrySubdivisionModifier(u.Math.degToRad(10),l.webMercatorProjection).modify(t),r.length=0,e.length=0;for(let e=0;e<a.array.length;e+=3){const t=h.world2tile(c,this.m_decodeInfo,b.set(a.array[e],a.array[e+1]),!0,w);r.push(t.x,t.y),void 0!==I&&(r.push(p.array[e/3*2]),r.push(p.array[e/3*2+1])),r.push(f.array[e/3]),r.push(m.array[e/3])}e.push(...t.getIndex().array)}y.set(0,0,1);for(let e=0;e<r.length;e+=$){h.webMercatorTile2TargetTile(c,this.m_decodeInfo,b.set(r[e],r[e+1]),T,!0);let t=1;_&&!0!==R&&(g.set(m.x+T.x,m.y+T.y,m.z+T.z),t=this.m_decodeInfo.targetProjection.getScaleFactor(g)),this.m_maxGeometryHeight=Math.max(this.m_maxGeometryHeight,t*O),W&&y.set(T.x,T.y,T.z).add(this.center).normalize(),v.copy(y).multiplyScalar(q*t),x.copy(y).multiplyScalar(O*t),F.push(T.x+v.x,T.y+v.y,T.z+v.z),void 0!==I&&z.push(r[e+2],r[e+3]),this.m_enableElevationOverlay&&j.push(...y.toArray()),_&&(F.push(T.x+x.x,T.y+x.y,T.z+x.z),k.push(0,0,0,0,x.x-v.x,x.y-v.y,x.z-v.z,1),void 0!==I&&z.push(r[e+2],r[e+3]),this.m_enableElevationOverlay&&j.push(...y.toArray()),void 0!==H&&G.push(H.r,H.g,H.b,H.r,H.g,H.b))}for(let t=0;t<e.length;t+=3)if(_){const r=n+2*e[t+0]+1,i=n+2*e[t+1]+1,o=n+2*e[t+2]+1;V.push(r,i,o)}else{const r=n+e[t+0],i=n+e[t+1],o=n+e[t+2];V.push(r,i,o)}K&&this.addEdges(n,t,$,U,F,r,D,_,M.footprint,M.maxSlope),_&&this.addWalls(n,t,$,U,r,V)}catch(e){f.error("cannot triangulate geometry",e)}}this.m_gatherFeatureAttributes&&(E.objInfos.push(o.env.entries),E.featureStarts.push(e));const n=V.length-e;n>0&&B.push({start:e,count:n,technique:r,featureId:i})}}createGeometries(){this.m_meshBuffers.forEach((e,t)=>{if(0===e.positions.length)return;if(!this.m_styleSetEvaluator.techniques||this.m_styleSetEvaluator.techniques.length<=t)throw new Error("Invalid technique index");const r=this.m_styleSetEvaluator.techniques[t];if(void 0===r)return;const i=new Float32Array(e.positions);if(e.texts.length>0&&n.isTextTechnique(r))return void this.m_textGeometries.push({positions:{name:"position",type:"float",buffer:i.buffer,itemCount:3},texts:e.texts,technique:t,stringCatalog:e.stringCatalog,objInfos:e.objInfos});if(e.texts.length>0&&n.isPoiTechnique(r))return void this.m_poiGeometries.push({positions:{name:"position",type:"float",buffer:i.buffer,itemCount:3},texts:e.texts,technique:t,stringCatalog:e.stringCatalog,imageTextures:e.imageTextures,objInfos:e.objInfos});0===e.groups.length&&e.groups.push({start:0,count:i.length/3,technique:t});const o={type:e.type,vertexAttributes:[{name:"position",buffer:i.buffer,itemCount:3,type:"float"}],groups:e.groups};if(e.normals.length>0){const t=new Float32Array(e.normals);s.assert(t.length===i.length,"length of normals buffer is different than the length of the position buffer"),o.vertexAttributes.push({name:"normal",buffer:t.buffer,itemCount:3,type:"float"})}if(e.colors.length>0){const t=new Float32Array(e.colors);s.assert(t.length===i.length,"length of colors buffer is different than the length of the position buffer"),o.vertexAttributes.push({name:"color",buffer:t.buffer,itemCount:3,type:"float"})}if(e.textureCoordinates.length>0){const t=e.positions.length/3,r=e.textureCoordinates.length/2;s.assert(r===t,"length of textureCoordinates buffer is different than the length of theposition buffer");const n=new Float32Array(e.textureCoordinates);o.vertexAttributes.push({name:"uv",buffer:n.buffer,itemCount:2,type:"float"})}if(e.extrusionAxis.length>0){const t=new Float32Array(e.extrusionAxis);s.assert(t.length/4==i.length/3,"length of extrusionAxis buffer is different than the length of the position buffer"),o.vertexAttributes.push({name:"extrusionAxis",buffer:t.buffer,itemCount:4,type:"float"})}e.indices.length>0&&(o.index={name:"index",buffer:new Uint32Array(e.indices).buffer,itemCount:1,type:"uint32"}),e.edgeIndices.length>0&&(o.edgeIndex={name:"edgeIndex",buffer:new Uint32Array(e.edgeIndices).buffer,itemCount:1,type:"uint32"}),o.featureStarts=e.featureStarts,o.objInfos=e.objInfos,this.m_geometries.push(o)})}processLines(e){e.forEach(e=>{const{vertices:t,indices:r}=e.lines,i=e.renderOrderOffset,o=e.technique,s=new Float32Array(t).buffer,a=new Uint32Array(r).buffer,u={type:"float",stride:e.lines.stride,buffer:s,attributes:e.lines.vertexAttributes},l={type:n.GeometryType.SolidLine,index:{buffer:a,itemCount:1,type:"uint32",name:"index"},interleavedVertexAttributes:[u],groups:[{start:0,count:r.length,technique:o,renderOrderOffset:i}],vertexAttributes:[],featureStarts:e.featureStarts,objInfos:e.objInfos};this.m_geometries.push(l)})}processSimpleLines(e){e.forEach(e=>{const{vertices:t,indices:r}=e.lines,i=e.renderOrderOffset,o=e.technique,s=new Float32Array(t).buffer,a=new Uint32Array(r).buffer,u={buffer:s,itemCount:3,type:"float",name:"position"},l={type:n.GeometryType.Line,index:{buffer:a,itemCount:1,type:"uint32",name:"index"},vertexAttributes:[u],groups:[{start:0,count:r.length,technique:o,renderOrderOffset:i}],featureStarts:e.featureStarts,objInfos:e.objInfos};this.m_geometries.push(l)})}findOrCreateMeshBuffers(e,t){let r=this.m_meshBuffers.get(e);return void 0!==r?r.type!==t?void f.error(`MeshBuffer has been created with wrong type "${n.GeometryType[t]}"\n                instead of "${n.GeometryType[r.type]}"`):r:(r=new G(t),this.m_meshBuffers.set(e,r),r)}processFeatureCommon(e){const t=e.lookup("source");"string"==typeof t&&""!==t&&(this.m_sources.includes(t)||this.m_sources.push(t))}isColorStringValid(e){return"string"==typeof e&&e.length>0}addEdges(e,t,r,n,i,o,s,a,l,c){const h=new u.Vector3,p=new u.Vector3;let d,f,m=0,g=0;for(;m<t;){for(;m!==d;){void 0===d&&(d=m),m<t&&(g=Math.max(g,m));const u=o[m*r+n];if(u<0)break;if(a)if(!0===l&&s.push(e+2*m,e+2*u),s.push(e+2*m+1,e+2*u+1),void 0!==c){if(void 0!==f){const t=3*(e+2*f),r=3*(e+2*m),n=3*(e+2*u);h.set(i[r]-i[t],i[r+1]-i[t+1],i[r+2]-i[t+2]).normalize(),p.set(i[n]-i[r],i[n+1]-i[r+1],i[n+2]-i[r+2]).normalize(),h.dot(p)<=c&&s.push(e+2*m,e+2*m+1)}}else s.push(e+2*m,e+2*m+1);else s.push(e+m,e+u);f=m,m=u}m=g+1,d=void 0,f=void 0}}addWalls(e,t,r,n,i,o){let s,a=0,u=0;for(;a<t;){for(;a!==s;){void 0===s&&(s=a),a<t&&(u=Math.max(u,a));const l=i[a*r+n+1];if(l<0)break;o.push(e+2*a,e+2*a+1,e+2*l+1,e+2*l+1,e+2*l,e+2*a),a=l}a=u+1,s=void 0}}findRelativePositionInLine(e,t){let r=1/0,n=0;for(let i=0;i<t.length;i+=4){q.set(P.set(t[i],t[i+1],t[i+2]),A.set(t[i+4],t[i+5],t[i+6])),q.closestPointToPoint(e,!0,L);const o=L.distanceTo(e);o<r&&(I.copy(L),O.copy(P),r=o,n=t[i+3])}return n+I.distanceTo(O)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(0),o=new i.Vector3,s=new i.Vector3,a=new i.Vector3,u=new i.Vector3,l=new i.Vector3,c=.1,h={attributes:[{name:"extrusionCoord",itemSize:3,offset:0},{name:"position",itemSize:3,offset:3},{name:"tangent",itemSize:3,offset:6},{name:"bitangent",itemSize:4,offset:9}],stride:13},p={attributes:[{name:"uv",itemSize:2,offset:h.stride},{name:"normal",itemSize:3,offset:h.stride+2}],stride:5},d={attributes:[...h.attributes,...p.attributes],stride:h.stride+p.stride},f={attributes:[{name:"extrusionCoord",itemSize:2,offset:0},{name:"position",itemSize:3,offset:2},{name:"positionLow",itemSize:3,offset:5},{name:"tangent",itemSize:3,offset:8},{name:"bitangent",itemSize:4,offset:11}],stride:15},m={attributes:[...f.attributes,...p.attributes],stride:f.stride+p.stride};class g{constructor(){this.vertices=[],this.vertexColors=[],this.indices=[]}}function y(e,t){return t?e?m:f:e?d:h}function v(e,t,r,i,h,p=new g,d=!1){if(0===t.length)return p;const f=y(void 0!==i,d).stride,m=t.length/3,v=new Array(m),x=new Array(t.length-3),b=p.vertices.length/f,w=void 0!==r&&r.length>0,T=void 0!==i&&i.length>0,_=void 0!==h&&h.length&&t.length;n.assert(!w||r.length===m),n.assert(!T||i.length/2===m),n.assert(!_||h.length===t.length);let S=c;v[0]=S;let E=!0;for(let e=0;e<m-1;++e){let r=0;for(let n=0;n<3;++n){const i=t[3*(e+1)+n]-t[3*e+n];x[3*e+n]=i,r+=i*i,E=2===n?E&&0===t[3*(e+1)+n]:E}S+=Math.sqrt(r),v[e+1]=S}const M=w?Math.abs(r[r.length-1]-r[0]):1,P=v[v.length-1]/M;if(w)for(let e=0;e<m;++e)v[e]=r[e]*P+c;let A=!0;for(let e=0;e<3;++e)A=A&&t[e]===t[t.length-3+e];const L=[],I=(r,n,c,f,m)=>{L.length=0,p.vertices.push(f,-1*m,P),L.push(f,1*m,P);for(let e=0;e<3;++e){if(d){const n=Math.fround(t[3*r+e]),i=t[3*r+e]-n;p.vertices.push(n,i),L.push(n,i)}else p.vertices.push(t[3*r+e]),L.push(t[3*r+e]);s.setComponent(e,t[3*r+e])}for(let e=0;e<3;++e)a.setComponent(e,x[n+e]),u.setComponent(e,x[c+e]);a.normalize(),p.vertices.push(a.x,a.y,a.z),L.push(a.x,a.y,a.z);const g=function(e,t,r,n){let i=0;t.equals(r)||(i=Math.acos(t.dot(r))*Math.sign(e.dot(o.copy(t).cross(r))),Number.isNaN(i)&&(i=0));return n.copy(t).add(r).normalize().cross(e).normalize(),i}(E?s.set(0,0,1):s.add(e).normalize(),a,u.normalize(),l);p.vertices.push(l.x,l.y,l.z,g),L.push(l.x,l.y,l.z,g),T&&(p.vertices.push(i[2*r],i[2*r+1]),L.push(i[2*r],i[2*r+1]),p.vertices.push(s.x,s.y,s.z),L.push(s.x,s.y,s.z)),p.vertices.push(...L),_&&(p.vertexColors.push(h[3*r],h[3*r+1],h[3*r+2]),p.vertexColors.push(h[3*r],h[3*r+1],h[3*r+2]))};for(let e=0;e<m;++e){const t=A&&0===e?x.length-3:3*Math.max(0,e-1),r=A&&e===m-1?0:Math.min(3*e,x.length-3);e>0&&I(e,t,r,v[e-1],v[e]),e+1<m&&I(e,t,r,-1*v[Math.min(e,v.length-1)],v[Math.min(e+1,v.length-1)])}for(let e=0;e<m-1;++e){const t=b+4*e;p.indices.push(t,t+1,t+2,t+2,t+1,t+3)}return p}function x(e,t,r=new g){if(0===e.length)return r;const n=e.length/3;let i=r.vertices.length/3;const o=void 0!==t&&t.length&&e.length;for(let s=0;s<n;++s,i++){s>0&&r.indices.push(i),s<n-1&&r.indices.push(i);for(let n=0;n<3;++n)r.vertices.push(e[3*s+n]),o&&r.vertexColors.push(t[3*s+n])}return r}t.LineGeometry=g,t.createLineGeometry=v,t.createSimpleLineGeometry=x;class b{constructor(e=!1,t=!1,r=!1){this.hasNormalsAndUvs=e,this.highPrecision=t,this.isSimple=r,this.m_geometry=new g}static createGeometry(e,t,r,n,o=!1,s=!1,a=!1){if(a)return n.setAttribute("position",new i.BufferAttribute(new Float32Array(e),3)),t.length===e.length&&n.setAttribute("color",new i.BufferAttribute(new Float32Array(t),3)),n.setIndex(new i.BufferAttribute(new Uint32Array(r),1)),n;{const a=y(o,s),u=new i.InterleavedBuffer(new Float32Array(e),a.stride);return a.attributes.forEach(e=>{const t=new i.InterleavedBufferAttribute(u,e.itemSize,e.offset,!1);n.setAttribute(e.name,t)}),t.length===e.length&&n.setAttribute("color",new i.BufferAttribute(new Float32Array(t),3)),n.setIndex(new i.BufferAttribute(new Uint32Array(r),1)),n}}clear(){this.m_geometry.vertices=[],this.m_geometry.vertexColors=[],this.m_geometry.indices=[]}add(e,t,r,i,o){return this.isSimple?x(t,o,this.m_geometry):(n.assert(!this.hasNormalsAndUvs||void 0!==i),v(e,t,r,i,o,this.m_geometry,this.highPrecision)),this}get vertices(){return this.m_geometry.vertices}get vertexColors(){return this.m_geometry.vertexColors}get indices(){return this.m_geometry.indices}get vertexAttributes(){return y(this.hasNormalsAndUvs,this.highPrecision).attributes}get stride(){return y(this.hasNormalsAndUvs,this.highPrecision).stride}createGeometry(e){return void 0===e&&(e=new i.BufferGeometry),b.createGeometry(this.m_geometry.vertices,this.m_geometry.vertexColors,this.m_geometry.indices,e,this.hasNormalsAndUvs,this.highPrecision)}}t.LineGroup=b},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=new n.Vector3(0,0,1),o=[0,1,2,1,3,2],s=[0,1,3,3,1,2,0,3,4,5,4,3],a=8,u=Math.PI/a;function l(e,t,r,n,i,o){const s=i.length/3;i.push(e,t,0);for(let l=0;l<a+1;++l){const c=u*l+Math.PI/2+r;i.push(e+n*Math.cos(c),t+n*Math.sin(c),0),o.push(s,s+l+1,s+(l+1)%(a+1)+1)}}t.numCirclePoints=function(e){return a+1},t.triangulateLine=function(e,t,r,a,u=!0,c=u){if(e.length<3)return;const h=new n.Vector2;if(u){const n=3!==e.length?h.set(e[3]-e[0],e[4]-e[1]).angle():0;l(e[0],e[1],n,t,r,a)}const p=r.length/3,d=new n.Vector3,f=new n.Vector3,m=new n.Vector3,g=new n.Vector3,y=new n.Vector3,v=new n.Vector3,x=new n.Vector3,b=new n.Vector3,w=new n.Vector3,T=e.length/3;let _=0;for(let n=0;n<T;++n){let u=!1;if(f.set(e[3*n],e[3*n+1],e[3*n+2]),n+1<T){if(m.set(e[3*(n+1)],e[3*(n+1)+1],e[3*(n+1)+2]),g.copy(m).sub(f).normalize().cross(i),y.copy(g),n>0&&(y.add(d).multiplyScalar(1-.5*g.dot(d)),u=d.angleTo(g)>Math.PI/2,u)){const e=t/Math.cos(g.angleTo(d)/2);v.copy(g).add(d).normalize().multiplyScalar(-e).add(f),x.copy(d).multiplyScalar(t).add(f),b.copy(g).add(d).normalize().multiplyScalar(e).add(f),w.copy(g).multiplyScalar(t).add(f)}u?r.push(v.x,v.y,v.z,x.x,x.y,x.z,b.x,b.y,b.z,w.x,w.y,w.z):(v.copy(y).multiplyScalar(-t).add(f),x.copy(y).multiplyScalar(t).add(f),r.push(v.x,v.y,v.z,x.x,x.y,x.z)),d.copy(g)}else v.copy(d).multiplyScalar(-t).add(f),x.copy(d).multiplyScalar(t).add(f),r.push(v.x,v.y,v.z,x.x,x.y,x.z);n!==T-1&&((u?s:o).forEach(e=>a.push(p+_+e)),_+=u?4:2)}if(c){const n=2!==e.length?h.set(e[3*(T-3)]-e[3*(T-2)],e[3*(T-3)+1]-e[3*(T-2)+1]).angle():Math.PI;l(e[3*(T-2)],e[3*(T-2)+1],n,t,r,a)}},t.reconstructLine=function(e,t){const r=new Float32Array(e.length/2);for(let n=3*t,i=2*n;n<r.length;n+=3,i+=6)r[n]=e[i]+.5*(e[i+3]-e[i]),r[n+1]=e[i+1]+.5*(e[i+3+1]-e[i+1]),r[n+2]=e[i+2]+.5*(e[i+3+2]-e[i+2]);return r},t.reconstructLineWidth=function(e,t){const r=e[2*t+3]-e[2*t],n=e[2*t+3+1]-e[2*t+1],i=e[2*t+3+2]-e[2*t+2];return.5*Math.sqrt(r*r+n*n+i*i)}},function(e,t,r){"use strict";function n(e,t,r){r=r||2;var n,a,u,l,c,d,f,g=t&&t.length,y=g?t[0]*r:e.length,v=i(e,0,y,r,!0),x=[];if(!v||v.next===v.prev)return x;if(g&&(v=function(e,t,r,n){var s,a,u,l,c,d=[];for(s=0,a=t.length;s<a;s++)u=t[s]*n,l=s<a-1?t[s+1]*n:e.length,(c=i(e,u,l,n,!1))===c.next&&(c.steiner=!0),d.push(m(c));for(d.sort(h),s=0;s<d.length;s++)p(d[s],r),r=o(r,r.next);return r}(e,t,v,r)),e.length>80*r){n=u=e[0],a=l=e[1];for(var b=r;b<y;b+=r)(c=e[b])<n&&(n=c),(d=e[b+1])<a&&(a=d),c>u&&(u=c),d>l&&(l=d);f=0!==(f=Math.max(u-n,l-a))?1/f:0}return s(v,x,r,n,a,f),x}function i(e,t,r,n,i){var o,s;if(i===A(e,t,r,n)>0)for(o=t;o<r;o+=n)s=E(o,e[o],e[o+1],s);else for(o=r-n;o>=t;o-=n)s=E(o,e[o],e[o+1],s);return s&&x(s,s.next)&&(M(s),s=s.next),s}function o(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!x(n,n.next)&&0!==v(n.prev,n,n.next))n=n.next;else{if(M(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function s(e,t,r,n,i,h,p){if(e){!p&&h&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=f(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,o,s,a,u,l=1;do{for(r=e,e=null,o=null,s=0;r;){for(s++,n=r,a=0,t=0;t<l&&(a++,n=n.nextZ);t++);for(u=l;a>0||u>0&&n;)0!==a&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,l*=2}while(s>1)}(i)}(e,n,i,h);for(var d,m,g=e;e.prev!==e.next;)if(d=e.prev,m=e.next,h?u(e,n,i,h):a(e))t.push(d.i/r),t.push(e.i/r),t.push(m.i/r),M(e),e=m.next,g=m.next;else if((e=m)===g){p?1===p?s(e=l(o(e),t,r),t,r,n,i,h,2):2===p&&c(e,t,r,n,i,h):s(o(e),t,r,n,i,h,1);break}}}function a(e){var t=e.prev,r=e,n=e.next;if(v(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(g(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&v(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function u(e,t,r,n){var i=e.prev,o=e,s=e.next;if(v(i,o,s)>=0)return!1;for(var a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,u=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,l=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,c=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,h=f(a,u,t,r,n),p=f(l,c,t,r,n),d=e.prevZ,m=e.nextZ;d&&d.z>=h&&m&&m.z<=p;){if(d!==e.prev&&d!==e.next&&g(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,m!==e.prev&&m!==e.next&&g(i.x,i.y,o.x,o.y,s.x,s.y,m.x,m.y)&&v(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&g(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&v(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;m&&m.z<=p;){if(m!==e.prev&&m!==e.next&&g(i.x,i.y,o.x,o.y,s.x,s.y,m.x,m.y)&&v(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function l(e,t,r){var n=e;do{var i=n.prev,s=n.next.next;!x(i,s)&&b(i,n,n.next,s)&&_(i,s)&&_(s,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(s.i/r),M(n),M(n.next),n=e=s),n=n.next}while(n!==e);return o(n)}function c(e,t,r,n,i,a){var u=e;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&y(u,l)){var c=S(u,l);return u=o(u,u.next),c=o(c,c.next),s(u,t,r,n,i,a),void s(c,t,r,n,i,a)}l=l.next}u=u.next}while(u!==e)}function h(e,t){return e.x-t.x}function p(e,t){if(t=function(e,t){var r,n=t,i=e.x,o=e.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s){if(s=a,a===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r;var u,l=r,c=r.x,h=r.y,p=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&g(o<h?i:s,o,c,h,o<h?s:i,o,n.x,n.y)&&(u=Math.abs(o-n.y)/(i-n.x),_(n,e)&&(u<p||u===p&&(n.x>r.x||n.x===r.x&&d(r,n)))&&(r=n,p=u)),n=n.next}while(n!==l);return r}(e,t)){var r=S(t,e);o(r,r.next)}}function d(e,t){return v(e.prev,e,t.prev)<0&&v(t.next,e,e.next)<0}function f(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function m(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function g(e,t,r,n,i,o,s,a){return(i-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(n-a)-(r-s)*(t-a)>=0&&(r-s)*(o-a)-(i-s)*(n-a)>=0}function y(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&b(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(_(e,t)&&_(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(v(e.prev,e,t.prev)||v(e,t.prev,t))||x(e,t)&&v(e.prev,e,e.next)>0&&v(t.prev,t,t.next)>0)}function v(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function x(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,r,n){var i=T(v(e,t,r)),o=T(v(e,t,n)),s=T(v(r,n,e)),a=T(v(r,n,t));return i!==o&&s!==a||(!(0!==i||!w(e,r,t))||(!(0!==o||!w(e,n,t))||(!(0!==s||!w(r,e,n))||!(0!==a||!w(r,t,n)))))}function w(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function T(e){return e>0?1:e<0?-1:0}function _(e,t){return v(e.prev,e,e.next)<0?v(e,t,e.next)>=0&&v(e,e.prev,t)>=0:v(e,t,e.prev)<0||v(e,e.next,t)<0}function S(e,t){var r=new P(e.i,e.x,e.y),n=new P(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function E(e,t,r,n){var i=new P(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function P(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(e,t,r,n){for(var i=0,o=t,s=r-n;o<r;o+=n)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}e.exports=n,e.exports.default=n,n.deviation=function(e,t,r,n){var i=t&&t.length,o=i?t[0]*r:e.length,s=Math.abs(A(e,0,o,r));if(i)for(var a=0,u=t.length;a<u;a++){var l=t[a]*r,c=a<u-1?t[a+1]*r:e.length;s-=Math.abs(A(e,l,c,r))}var h=0;for(a=0;a<n.length;a+=3){var p=n[a]*r,d=n[a+1]*r,f=n[a+2]*r;h+=Math.abs((e[p]-e[f])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[f+1]-e[p+1]))}return 0===s&&0===h?0:Math.abs((h-s)/s)},n.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var s=0;s<t;s++)r.vertices.push(e[i][o][s]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(4),i=r(0),o=r(137),s=[new i.Vector3,new i.Vector3,new i.Vector3];class a extends o.SubdivisionModifier{constructor(e,t=n.sphereProjection){super(),this.angle=e,this.projection=t}shouldSplitTriangle(e,t,r){const i=n.sphereProjection.reprojectPoint(this.projection,e,s[0]),o=n.sphereProjection.reprojectPoint(this.projection,t,s[1]),a=n.sphereProjection.reprojectPoint(this.projection,r,s[2]),u=i.angleTo(o),l=o.angleTo(a),c=a.angleTo(i),h=Math.max(u,Math.max(l,c));if(!(h<this.angle)){if(h===u)return 0;if(h===l)return 1;if(h===c)return 2;throw new Error("failed to split triangle")}}}t.SphericalGeometrySubdivisionModifier=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(0),i=new n.Vector3,o=new n.Vector3,s=new n.Vector3;t.SubdivisionModifier=class{constructor(){}modify(e){const t=e.getAttribute("position"),r=Array.from(t.array),n=e.getAttribute("uv"),a=void 0!==n?Array.from(n.array):void 0,u=e.getAttribute("edge"),l=void 0!==u?Array.from(u.array):void 0,c=e.getAttribute("wall"),h=void 0!==c?Array.from(c.array):void 0,p=e.getIndex(),d=Array.from(p.array),f=new Map;function m(e,t){const n=`${Math.min(e,t)}_${Math.max(e,t)}`,u=f.get(n);if(void 0!==u)return u;i.set(r[3*e],r[3*e+1],r[3*e+2]),o.set(r[3*t],r[3*t+1],r[3*t+2]),s.lerpVectors(i,o,.5);const c=r.length/3;return r.push(...s.toArray()),f.set(n,c),void 0!==a&&(i.set(a[2*e],a[2*e+1],0),o.set(a[2*t],a[2*t+1],0),s.lerpVectors(i,o,.5),a.push(s.x,s.y)),void 0!==l&&(l[e]===t?(l.push(t),l[e]=c):l[t]===e?(l.push(e),l[t]=c):l.push(-1)),void 0!==h&&(h[e]===t?(h.push(t),h[e]=c):h[t]===e?(h.push(e),h[t]=c):h.push(-1)),c}const g=[];for(;d.length>=3;){const e=d.shift(),t=d.shift(),n=d.shift();switch(i.set(r[3*e],r[3*e+1],r[3*e+2]),o.set(r[3*t],r[3*t+1],r[3*t+2]),s.set(r[3*n],r[3*n+1],r[3*n+2]),this.shouldSplitTriangle(i,o,s)){case 0:{const r=m(e,t);d.push(e,r,n,r,t,n);break}case 1:{const r=m(t,n);d.push(e,t,r,e,r,n);break}case 2:{const r=m(n,e);d.push(e,t,r,r,t,n);break}case void 0:g.push(e,t,n);break;default:throw new Error("failed to subdivide the given geometry")}}return t.array=new Float32Array(r),t.count=r.length/t.itemSize,t.needsUpdate=!0,e.setIndex(g),void 0!==a&&(n.array=new Float32Array(a),n.count=a.length/n.itemSize,n.needsUpdate=!0),void 0!==l&&(u.array=new Float32Array(l),u.count=l.length/u.itemSize,u.needsUpdate=!0),e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(3),i=r(0),o=r(23),s=r(22);t.OmvTileInfoEmitter=class{constructor(e,t,r,i,o){this.m_decodeInfo=e,this.m_styleSetEvaluator=t,this.m_storeExtendedTags=r,this.m_gatherRoadSegments=i,this.m_languages=o,this.m_tileInfo=new n.ExtendedTileInfo(e.tileKey,this.m_storeExtendedTags),this.m_tileInfoWriter=new n.ExtendedTileInfoWriter(this.m_tileInfo,this.m_storeExtendedTags)}processPointFeature(e,t,r,o,a,u){const l=this.m_tileInfoWriter,c=new i.Vector3;for(const e of a){if(void 0===e)continue;const i=l.addTechnique(e),a=n.ExtendedTileInfo.getFeatureText(o,e,this.m_languages);for(const e of r)s.webMercatorTile2TargetTile(t,this.m_decodeInfo,e,c),l.addFeature(this.m_tileInfo.pointGroup,o.env,u,a,i,n.FeatureGroupType.Point),l.addFeaturePoint(this.m_tileInfo.pointGroup,c.x,c.y)}}processLineFeature(e,t,r,o,a,u){const l=this.m_tileInfoWriter,c=o.env,h=new i.Vector3,p=[];for(const e of r){const r=[];for(const n of e.positions)s.webMercatorTile2TargetTile(t,this.m_decodeInfo,n,h),r.push(h.x,h.y);p.push(r)}for(const e of a){if(void 0===e)continue;const t=l.addTechnique(e),r=n.ExtendedTileInfo.getFeatureText(o,e,this.m_languages);for(const e of p)l.addFeature(this.m_tileInfo.lineGroup,c,u,r,t,n.FeatureGroupType.Line),l.addFeaturePoints(this.m_tileInfo.lineGroup,e)}if(this.m_gatherRoadSegments){const e=c.lookup("segmentId");if(void 0!==e){const t=c.lookup("startOffset"),r=c.lookup("endOffset");l.addRoadSegments(this.m_tileInfo.lineGroup,e,void 0!==t?t:0,void 0!==r?r:1)}}}processPolygonFeature(e,t,r,a,u,l){if(0===u.length)throw new Error("OmvTileInfoEmitter#processPolygonFeature: Internal error - No technique index");const c=this.m_tileInfoWriter,h=new i.Vector3,p=[];for(const e of r){const r=[];for(const n of e.rings){const e=[];for(const r of n)s.webMercatorTile2TargetTile(t,this.m_decodeInfo,r,h),e.push(h.x,h.y,h.z);r.push(new o.Ring(t,3,e))}p.push(r)}for(const e of u){if(void 0===e)continue;const t=c.addTechnique(e),r=n.ExtendedTileInfo.getFeatureText(a,e,this.m_languages);c.addFeature(this.m_tileInfo.polygonGroup,a.env,l,r,t,n.FeatureGroupType.Polygon)}for(const e of p){if(0===e.length)continue;const t=e[0].winding;for(const r of e)c.addRingPoints(this.m_tileInfo.polygonGroup,r.contour,r.winding===t)}}getTileInfo(){return this.m_tileInfoWriter.finish(),this.m_tileInfo}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(2),i=r(54),o=n.LoggerManager.instance.create("OmvTomTomFeatureModifier"),s="#AAAAAA",a="true",u="2",l="20";class c extends i.OmvGenericFeatureModifier{constructor(e){super(e)}doProcessFeature(e,t,r,n,i){return this.rewriteEnvironment(r,n),super.doProcessFeature(e,t,r,n,i)}rewriteEnvironment(e,t){this.isWood(e)?this.updateEnvironment(t,"landuse","wood"):this.isHospital(e)?this.updateEnvironment(t,"landuse","hospital"):this.isCemetery(e)?this.updateEnvironment(t,"landuse","cemetery"):this.isIndustrial(e)?this.updateEnvironment(t,"landuse","industrial"):this.isPark(e)?this.updateEnvironment(t,"landuse","park"):this.isBuiltup(e)?this.updateEnvironment(t,"landuse","builtup"):this.isWater(e)?this.updateEnvironment(t,"water"):this.isRoadLabel(e)?this.updateEnvironment(t,"road_label"):this.isRoadPath(e)?this.updateEnvironment(t,"road","path"):this.isRoadStreet(e)?this.updateEnvironment(t,"road","street"):this.isRoadPrimary(e)?this.updateEnvironment(t,"road","primary"):this.isRoadSecondary(e)?this.updateEnvironment(t,"road","secondary"):this.isRailway(e)?this.updateEnvironment(t,"road","major_rail"):this.isFerry(e)?this.updateEnvironment(t,"road","ferry"):this.isAeroway(e)?this.updateEnvironment(t,"aeroway"):this.isBorder(e)?this.updateEnvironment(t,"admin"):this.isCountryLabel(e)?this.updateEnvironment(t,"country_label"):this.isCountyLabel(e)?this.updateEnvironment(t,"county_label"):this.isRegionLabel(e)?this.updateEnvironment(t,"region_label"):this.isStateLabel(e)?this.updateEnvironment(t,"state_label"):this.isPlaceLabel(e)?this.updateEnvironment(t,"place_label"):this.isWaterLabel(e)?this.updateEnvironment(t,"water_label"):this.isMarineLabel(e)?this.updateEnvironment(t,"marine_label"):this.isPoiLabel(e)?this.updateEnvironment(t,"poi_label"):this.isBuilding(e)?(this.updateEnvironment(t,"building"),t.entries.color=s,t.entries.extrude=a,t.entries.min_height=u,t.entries.height=l):o.info(`Not yet rewritten layer: ##${t.entries.$layer}## `),this.isTunnel(e)&&(t.entries.structure="tunnel"),this.isBridge(e)&&(t.entries.structure="bridge")}updateEnvironment(e,t,r,n){e.entries.$layer=t,void 0!==r&&(e.entries.class=r),void 0!==n&&(e.entries.structure=n)}isWood(e){return"Woodland"===e||"Moor or heathland"===e}isHospital(e){return"Hospital"===e}isCemetery(e){return"Cemetery"===e}isIndustrial(e){return e.indexOf("Industrial")>=0||"Airport"===e}isPark(e){return"Park"===e||"City park"===e||"National park"===e||"Regional park"===e||e.indexOf("grass")>=0||e.indexOf("greens")>=0}isBuiltup(e){return"Built-up area"===e||"Town paved area"===e||"Shopping"===e||"University"===e||"Stadium"===e||e.indexOf("ground")>0}isWater(e){return"Other water"===e||"Ocean or sea"===e||"Ocean"===e||"Lake"===e||"Sea"===e||"Town swimming pool"===e||"River"===e}isRoadLabel(e){return e.indexOf("road label")>=0}isRoadPath(e){return e.indexOf("path")>0||"Parking road"===e||"Town walkway"===e||"Pedestrian road"===e||"Walkway road"===e||"Town carriageway divider"===e||"Runway"===e||"Non public road"===e}isRoadStreet(e){return e.indexOf("Minor local road")>=0||e.indexOf("minor local road")>=0||e.indexOf("Toll local road")>=0||e.indexOf("Local road")>=0}isRoadPrimary(e){return e.indexOf("Major local road")>=0||e.indexOf("Major road")>=0||e.indexOf("major road")>=0||e.indexOf("Motorway")>=0||e.indexOf("motorway")>=0||e.indexOf("International road")>=0||e.indexOf("international road")>=0}isRoadSecondary(e){return e.indexOf("connecting road")>=0||e.indexOf("Connecting road")>=0||e.indexOf("secondary road")>=0||e.indexOf("Secondary road")>=0}isRailway(e){return"Railway"===e}isFerry(e){return"Ferry road"===e}isBorder(e){return e.indexOf("border")>0}isCountryLabel(e){return"Country name"===e||"Country label"===e}isStateLabel(e){return"City"===e||e.indexOf("city")>0}isRegionLabel(e){return"Town"===e}isCountyLabel(e){return"Village"===e}isPlaceLabel(e){return"Park"===e||"Railway station"===e||"Airport POI"===e||"Town greens"===e}isWaterLabel(e){return"Ocean name"===e||"River label"===e||e.indexOf("water label")>0}isMarineLabel(e){return e.indexOf("water label")>0}isPoiLabel(e){return"National park name"===e||"Landmark label"===e||e.indexOf("label")>=0}isAeroway(e){return"Airport"===e}isBuilding(e){return e.indexOf("building")>=0}isTunnel(e){return e.indexOf("tunnel")>=0}isBridge(e){return e.indexOf("bridge")>=0}}t.OmvTomTomFeatureModifier=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StyleSetDataFilter=class{constructor(e){this.styleSetEvaluator=e,this.hasKindFilter=!1}wantsLayer(e,t){return this.styleSetEvaluator.wantsLayer(e)}wantsPointFeature(e){return this.styleSetEvaluator.wantsFeature(e,"point")}wantsLineFeature(e){return this.styleSetEvaluator.wantsFeature(e,"line")}wantsPolygonFeature(e){return this.styleSetEvaluator.wantsFeature(e,"polygon")}wantsKind(){return!0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(49),i=r(15);t.OmvTilerService=class{static start(){n.WorkerServiceManager.getInstance().register({serviceType:i.OMV_TILER_SERVICE_TYPE,factory:e=>n.TilerService.start(e)})}}},function(e,t,r){"use strict";function n(e,t,r,n,i,o){var s=i-r,a=o-n;if(0!==s||0!==a){var u=((e-r)*s+(t-n)*a)/(s*s+a*a);u>1?(r=i,n=o):u>0&&(r+=s*u,n+=a*u)}return(s=e-r)*s+(a=t-n)*a}function i(e,t,r,n){var i={id:void 0===e?null:e,type:t,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,r=e.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)o(e,t);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<t.length;n++)o(e,t[n]);else if("MultiPolygon"===r)for(n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)o(e,t[n][i])}(i),i}function o(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function s(e,t,r,n){if(t.geometry){var o=t.geometry.coordinates,c=t.geometry.type,h=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),p=[],d=t.id;if(r.promoteId?d=t.properties[r.promoteId]:r.generateId&&(d=n||0),"Point"===c)a(o,p);else if("MultiPoint"===c)for(var f=0;f<o.length;f++)a(o[f],p);else if("LineString"===c)u(o,p,h,!1);else if("MultiLineString"===c){if(r.lineMetrics){for(f=0;f<o.length;f++)p=[],u(o[f],p,h,!1),e.push(i(d,"LineString",p,t.properties));return}l(o,p,h,!1)}else if("Polygon"===c)l(o,p,h,!0);else{if("MultiPolygon"!==c){if("GeometryCollection"===c){for(f=0;f<t.geometry.geometries.length;f++)s(e,{id:d,geometry:t.geometry.geometries[f],properties:t.properties},r,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(f=0;f<o.length;f++){var m=[];l(o[f],m,h,!0),p.push(m)}}e.push(i(d,c,p,t.properties))}}function a(e,t){t.push(c(e[0])),t.push(h(e[1])),t.push(0)}function u(e,t,r,i){for(var o,s,a=0,u=0;u<e.length;u++){var l=c(e[u][0]),p=h(e[u][1]);t.push(l),t.push(p),t.push(0),u>0&&(a+=i?(o*p-l*s)/2:Math.sqrt(Math.pow(l-o,2)+Math.pow(p-s,2))),o=l,s=p}var d=t.length-3;t[2]=1,function e(t,r,i,o){for(var s,a=o,u=i-r>>1,l=i-r,c=t[r],h=t[r+1],p=t[i],d=t[i+1],f=r+3;f<i;f+=3){var m=n(t[f],t[f+1],c,h,p,d);if(m>a)s=f,a=m;else if(m===a){var g=Math.abs(f-u);g<l&&(s=f,l=g)}}a>o&&(s-r>3&&e(t,r,s,o),t[s+2]=a,i-s>3&&e(t,s,i,o))}(t,0,d,r),t[d+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function l(e,t,r,n){for(var i=0;i<e.length;i++){var o=[];u(e[i],o,r,n),t.push(o)}}function c(e){return e/360+.5}function h(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function p(e,t,r,n,o,s,a,u){if(n/=t,s>=(r/=t)&&a<n)return e;if(a<r||s>=n)return null;for(var l=[],c=0;c<e.length;c++){var h=e[c],p=h.geometry,m=h.type,y=0===o?h.minX:h.minY,v=0===o?h.maxX:h.maxY;if(y>=r&&v<n)l.push(h);else if(!(v<r||y>=n)){var x=[];if("Point"===m||"MultiPoint"===m)d(p,x,r,n,o);else if("LineString"===m)f(p,x,r,n,o,!1,u.lineMetrics);else if("MultiLineString"===m)g(p,x,r,n,o,!1);else if("Polygon"===m)g(p,x,r,n,o,!0);else if("MultiPolygon"===m)for(var b=0;b<p.length;b++){var w=[];g(p[b],w,r,n,o,!0),w.length&&x.push(w)}if(x.length){if(u.lineMetrics&&"LineString"===m){for(b=0;b<x.length;b++)l.push(i(h.id,m,x[b],h.tags));continue}"LineString"!==m&&"MultiLineString"!==m||(1===x.length?(m="LineString",x=x[0]):m="MultiLineString"),"Point"!==m&&"MultiPoint"!==m||(m=3===x.length?"Point":"MultiPoint"),l.push(i(h.id,m,x,h.tags))}}}return l.length?l:null}function d(e,t,r,n,i){for(var o=0;o<e.length;o+=3){var s=e[o+i];s>=r&&s<=n&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function f(e,t,r,n,i,o,s){for(var a,u,l=m(e),c=0===i?v:x,h=e.start,p=0;p<e.length-3;p+=3){var d=e[p],f=e[p+1],g=e[p+2],b=e[p+3],w=e[p+4],T=0===i?d:f,_=0===i?b:w,S=!1;s&&(a=Math.sqrt(Math.pow(d-b,2)+Math.pow(f-w,2))),T<r?_>r&&(u=c(l,d,f,b,w,r),s&&(l.start=h+a*u)):T>n?_<n&&(u=c(l,d,f,b,w,n),s&&(l.start=h+a*u)):y(l,d,f,g),_<r&&T>=r&&(u=c(l,d,f,b,w,r),S=!0),_>n&&T<=n&&(u=c(l,d,f,b,w,n),S=!0),!o&&S&&(s&&(l.end=h+a*u),t.push(l),l=m(e)),s&&(h+=a)}var E=e.length-3;d=e[E],f=e[E+1],g=e[E+2],(T=0===i?d:f)>=r&&T<=n&&y(l,d,f,g),E=l.length-3,o&&E>=3&&(l[E]!==l[0]||l[E+1]!==l[1])&&y(l,l[0],l[1],l[2]),l.length&&t.push(l)}function m(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function g(e,t,r,n,i,o){for(var s=0;s<e.length;s++)f(e[s],t,r,n,i,o,!1)}function y(e,t,r,n){e.push(t),e.push(r),e.push(n)}function v(e,t,r,n,i,o){var s=(o-t)/(n-t);return e.push(o),e.push(r+(i-r)*s),e.push(1),s}function x(e,t,r,n,i,o){var s=(o-r)/(i-r);return e.push(t+(n-t)*s),e.push(o),e.push(1),s}function b(e,t){for(var r=[],n=0;n<e.length;n++){var o,s=e[n],a=s.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)o=w(s.geometry,t);else if("MultiLineString"===a||"Polygon"===a){o=[];for(var u=0;u<s.geometry.length;u++)o.push(w(s.geometry[u],t))}else if("MultiPolygon"===a)for(o=[],u=0;u<s.geometry.length;u++){for(var l=[],c=0;c<s.geometry[u].length;c++)l.push(w(s.geometry[u][c],t));o.push(l)}r.push(i(s.id,a,o,s.tags))}return r}function w(e,t){var r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+t,e[n+1],e[n+2]);return r}function T(e,t){if(e.transformed)return e;var r,n,i,o=1<<e.z,s=e.x,a=e.y;for(r=0;r<e.features.length;r++){var u=e.features[r],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(n=0;n<l.length;n+=2)u.geometry.push(_(l[n],l[n+1],t,o,s,a));else for(n=0;n<l.length;n++){var h=[];for(i=0;i<l[n].length;i+=2)h.push(_(l[n][i],l[n][i+1],t,o,s,a));u.geometry.push(h)}}return e.transformed=!0,e}function _(e,t,r,n,i,o){return[Math.round(r*(e*n-i)),Math.round(r*(t*n-o))]}function S(e,t,r,n,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<e.length;a++){s.numFeatures++,E(s,e[a],o,i);var u=e[a].minX,l=e[a].minY,c=e[a].maxX,h=e[a].maxY;u<s.minX&&(s.minX=u),l<s.minY&&(s.minY=l),c>s.maxX&&(s.maxX=c),h>s.maxY&&(s.maxY=h)}return s}function E(e,t,r,n){var i=t.geometry,o=t.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<i.length;a+=3)s.push(i[a]),s.push(i[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)M(s,i,e,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<i.length;a++)M(s,i[a],e,r,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(a=0;a<l.length;a++)M(s,l[a],e,r,!0,0===a)}if(s.length){var c=t.tags||null;if("LineString"===o&&n.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var p={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==t.id&&(p.id=t.id),e.features.push(p)}}function M(e,t,r,n,i,o){var s=n*n;if(n>0&&t.size<(i?s:n))r.numPoints+=t.length/3;else{for(var a=[],u=0;u<t.length;u+=3)(0===n||t[u+2]>s)&&(r.numSimplified++,a.push(t[u]),a.push(t[u+1])),r.numPoints++;i&&function(e,t){for(var r=0,n=0,i=e.length,o=i-2;n<i;o=n,n+=2)r+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(r>0===t)for(n=0,i=e.length;n<i/2;n+=2){var s=e[n],a=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=s,e[i-1-n]=a}}(a,o),e.push(a)}}function P(e,t){return new A(e,t)}function A(e,t){var r=(t=this.options=function(e,t){for(var r in t)e[r]=t[r];return e}(Object.create(this.options),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(e,t){var r=[];if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)s(r,e.features[n],t,n);else"Feature"===e.type?s(r,e,t):s(r,{geometry:e},t);return r}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(n=function(e,t){var r=t.buffer/t.extent,n=e,i=p(e,1,-1-r,r,0,-1,2,t),o=p(e,1,1-r,2+r,0,-1,2,t);return(i||o)&&(n=p(e,1,-r,1+r,0,-1,2,t)||[],i&&(n=b(i,1).concat(n)),o&&(n=n.concat(b(o,-1)))),n}(n,t)).length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function L(e,t,r){return 32*((1<<e)*r+t)+e}r.r(t),r.d(t,"default",(function(){return P})),A.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},A.prototype.splitTile=function(e,t,r,n,i,o,s){for(var a=[e,t,r,n],u=this.options,l=u.debug;a.length;){n=a.pop(),r=a.pop(),t=a.pop(),e=a.pop();var c=1<<t,h=L(t,r,n),d=this.tiles[h];if(!d&&(l>1&&console.time("creation"),d=this.tiles[h]=S(e,t,r,n,u),this.tileCoords.push({z:t,x:r,y:n}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,n,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var f="z"+t;this.stats[f]=(this.stats[f]||0)+1,this.total++}if(d.source=e,i){if(t===u.maxZoom||t===i)continue;var m=1<<i-t;if(r!==Math.floor(o/m)||n!==Math.floor(s/m))continue}else if(t===u.indexMaxZoom||d.numPoints<=u.indexMaxPoints)continue;if(d.source=null,0!==e.length){l>1&&console.time("clipping");var g,y,v,x,b,w,T=.5*u.buffer/u.extent,_=.5-T,E=.5+T,M=1+T;g=y=v=x=null,b=p(e,c,r-T,r+E,0,d.minX,d.maxX,u),w=p(e,c,r+_,r+M,0,d.minX,d.maxX,u),e=null,b&&(g=p(b,c,n-T,n+E,1,d.minY,d.maxY,u),y=p(b,c,n+_,n+M,1,d.minY,d.maxY,u),b=null),w&&(v=p(w,c,n-T,n+E,1,d.minY,d.maxY,u),x=p(w,c,n+_,n+M,1,d.minY,d.maxY,u),w=null),l>1&&console.timeEnd("clipping"),a.push(g||[],t+1,2*r,2*n),a.push(y||[],t+1,2*r,2*n+1),a.push(v||[],t+1,2*r+1,2*n),a.push(x||[],t+1,2*r+1,2*n+1)}}},A.prototype.getTile=function(e,t,r){var n=this.options,i=n.extent,o=n.debug;if(e<0||e>24)return null;var s=1<<e,a=L(e,t=(t%s+s)%s,r);if(this.tiles[a])return T(this.tiles[a],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var u,l=e,c=t,h=r;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[L(l,c,h)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,h),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,e,t,r),o>1&&console.timeEnd("drilling down"),this.tiles[a]?T(this.tiles[a],i):null):null}}]);
//# sourceMappingURL=decoder.bundle.js.map